const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/raw-D3z6yJ8o-DpkYBZ3-.js","assets/basedecoder-DosmR3tB-DvumDe3Y.js","assets/lzw-CZKlmdgF-BzLpCAJq.js","assets/jpeg-CHs-Yi-F-DtJaof_w.js","assets/deflate-CnX71rVy-DeisypVQ.js","assets/pako.esm-kdyKjGUN-DtszV1FA.js","assets/packbits-DtqNFEAn-CqAYduWl.js","assets/lerc-CbspyELb-DoAaifyZ.js","assets/index-Cny9o_Pn.js","assets/index-DAHO7mNK.css","assets/webimage-POyqdea6-DrbzZhC4.js"])))=>i.map(i=>d[i]);
import{_ as Bl}from"./index-Cny9o_Pn.js";var VR={},rz=Object.defineProperty,sz=(n,e,t)=>e in n?rz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,wn=(n,e,t)=>sz(n,typeof e!="symbol"?e+"":e,t);function oz(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}class Ul{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const yp={PROPERTYCHANGE:"propertychange"};class p0{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function az(n,e,t){let i,r;t=t||Cl;let s=0,o=n.length,a=!1;for(;s<o;)i=s+(o-s>>1),r=+t(n[i],e),r<0?s=i+1:(o=i,a=!r);return a?s:~s}function Cl(n,e){return n>e?1:n<e?-1:0}function lz(n,e){return n<e?1:n>e?-1:0}function gb(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let r=1;r<i;++r){const s=n[r];if(s===e)return r;if(s<e)return t(e,n[r-1],s)>0?r-1:r}return i-1}if(t>0){for(let r=1;r<i;++r)if(n[r]<e)return r-1;return i-1}if(t<0){for(let r=1;r<i;++r)if(n[r]<=e)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==e)return r;if(n[r]<e)return n[r-1]-e<e-n[r]?r-1:r}return i-1}function cz(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function ra(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let r=0;r<i;r++)n[n.length]=t[r]}function lu(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function uz(n,e,t){const i=e||Cl;return n.every(function(r,s){if(s===0)return!0;const o=i(n[s-1],r);return!(o>0||o===0)})}function dy(){return!0}function g0(){return!1}function fy(){}function hz(n){let e=!1,t,i,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!lu(s,i))&&(e=!0,r=this,i=s,t=n.apply(this,arguments)),t}}function dz(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function kd(n){for(const e in n)delete n[e]}function m0(n){let e;for(e in n)return!1;return!e}class tg extends p0{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=t?new Ul(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let c=0,u=r.length;c<u;++c)if("handleEvent"in r[c]?l=r[c].handleEvent(s):l=r[c].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let c=a[i];for(delete a[i];c--;)this.removeEventListener(i,fy);delete o[i]}return l}disposeInternal(){this.listeners_&&kd(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const i=this.listeners_&&this.listeners_[e];if(i){const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=fy,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}}const yt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function qt(n,e,t,i,r){if(i&&i!==n&&(t=t.bind(i)),r){const o=t;t=function(){n.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:n,type:e,listener:t};return n.addEventListener(e,t),s}function py(n,e,t,i){return qt(n,e,t,i,!0)}function mi(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),kd(n))}class ig extends tg{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(yt.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=qt(this,e[s],t);return r}return qt(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=py(this,e[s],t)}else i=py(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)fz(i);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}ig.prototype.on;ig.prototype.once;ig.prototype.un;function fz(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)mi(n[e]);else mi(n)}function Et(){throw new Error("Unimplemented abstract method.")}let pz=0;function Mt(n){return n.ol_uid||(n.ol_uid=String(++pz))}class jR extends Ul{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class Eo extends ig{constructor(e){super(),this.on,this.once,this.un,Mt(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new jR(i,e,t)),i=yp.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new jR(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],m0(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const es={ADD:"add",REMOVE:"remove"},WR={LENGTH:"length"};class Hm extends Ul{constructor(e,t,i){super(e),this.element=t,this.index=i}}class na extends Eo{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(WR.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Hm(es.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Hm(es.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Hm(es.REMOVE,r,e)),this.dispatchEvent(new Hm(es.ADD,t,e))}updateLength_(){this.set(WR.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}function Kt(n,e){if(!n)throw new Error(e)}class mb extends Eo{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new mb(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(mi(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=qt(e,yt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?gz(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function gz(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(Kt(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}const Rl=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",mz=Rl.includes("firefox"),vz=Rl.includes("safari")&&!Rl.includes("chrom"),yz=vz&&(Rl.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Rl)),_z=Rl.includes("webkit")&&!Rl.includes("edge"),iO=Rl.includes("macintosh"),nO=typeof devicePixelRatio<"u"?devicePixelRatio:1,vb=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,rO=typeof Image<"u"&&Image.prototype.decode,sO=function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n}(),yb=new Array(6);function Un(){return[1,0,0,1,0,0]}function IT(n){return y0(n,1,0,0,1,0,0)}function v0(n,e){const t=n[0],i=n[1],r=n[2],s=n[3],o=n[4],a=n[5],l=e[0],c=e[1],u=e[2],f=e[3],p=e[4],m=e[5];return n[0]=t*l+r*c,n[1]=i*l+s*c,n[2]=t*u+r*f,n[3]=i*u+s*f,n[4]=t*p+r*m+o,n[5]=i*p+s*m+a,n}function y0(n,e,t,i,r,s,o){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n[4]=s,n[5]=o,n}function Ez(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function Xi(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function wz(n,e){const t=Math.cos(e),i=Math.sin(e);return v0(n,y0(yb,t,i,-i,t,0,0))}function lp(n,e,t){return v0(n,y0(yb,e,0,0,t,0,0))}function oO(n,e,t){return v0(n,y0(yb,1,0,0,1,e,t))}function Ls(n,e,t,i,r,s,o,a){const l=Math.sin(s),c=Math.cos(s);return n[0]=i*c,n[1]=r*l,n[2]=-i*l,n[3]=r*c,n[4]=o*i*c-a*i*l+e,n[5]=o*r*l+a*r*c+t,n}function aO(n,e){const t=Tz(e);Kt(t!==0,"Transformation matrix cannot be inverted");const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return n[0]=o/t,n[1]=-r/t,n[2]=-s/t,n[3]=i/t,n[4]=(s*l-o*a)/t,n[5]=-(i*l-r*a)/t,n}function Tz(n){return n[0]*n[3]-n[1]*n[2]}let qR;function Sz(n){const e="matrix("+n.join(", ")+")";if(vb)return e;const t=qR||(qR=document.createElement("div"));return t.style.transform=e,t.style.transform}const ln={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function gy(n){const e=wo();for(let t=0,i=n.length;t<i;++t)cp(e,n[t]);return e}function bz(n,e,t){const i=Math.min.apply(null,n),r=Math.min.apply(null,e),s=Math.max.apply(null,n),o=Math.max.apply(null,e);return Al(i,r,s,o,t)}function Vc(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function lO(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function cu(n,e,t){let i,r;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?r=n[1]-t:n[3]<t?r=t-n[3]:r=0,i*i+r*r}function sd(n,e){return _b(n,e[0],e[1])}function cO(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function _b(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function PT(n,e){const t=n[0],i=n[1],r=n[2],s=n[3],o=e[0],a=e[1];let l=ln.UNKNOWN;return o<t?l=l|ln.LEFT:o>r&&(l=l|ln.RIGHT),a<i?l=l|ln.BELOW:a>s&&(l=l|ln.ABOVE),l===ln.UNKNOWN&&(l=ln.INTERSECTING),l}function wo(){return[1/0,1/0,-1/0,-1/0]}function Al(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function Md(n){return Al(1/0,1/0,-1/0,-1/0,n)}function uO(n,e){const t=n[0],i=n[1];return Al(t,i,t,i,e)}function Eb(n,e,t,i,r){const s=Md(r);return dO(s,n,e,t,i)}function my(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function hO(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function cp(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function dO(n,e,t,i,r){for(;t<i;t+=r)xz(n,e[t],e[t+1]);return n}function xz(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function fO(n,e){let t;return t=e(_0(n)),t||(t=e(E0(n)),t)||(t=e(w0(n)),t)||(t=e(zl(n)),t)?t:!1}function _p(n){let e=0;return Nd(n)||(e=fn(n)*ns(n)),e}function _0(n){return[n[0],n[1]]}function E0(n){return[n[2],n[1]]}function Ll(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Cz(n,e){let t;if(e==="bottom-left")t=_0(n);else if(e==="bottom-right")t=E0(n);else if(e==="top-left")t=zl(n);else if(e==="top-right")t=w0(n);else throw new Error("Invalid corner");return t}function DT(n,e,t,i,r){const[s,o,a,l,c,u,f,p]=OT(n,e,t,i);return Al(Math.min(s,a,c,f),Math.min(o,l,u,p),Math.max(s,a,c,f),Math.max(o,l,u,p),r)}function OT(n,e,t,i){const r=e*i[0]/2,s=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,c=r*a,u=s*o,f=s*a,p=n[0],m=n[1];return[p-l+f,m-c-u,p-l-f,m-c+u,p+l-f,m+c+u,p+l+f,m+c-u,p-l+f,m-c-u]}function ns(n){return n[3]-n[1]}function mr(n,e,t){const i=t||wo();return Ji(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):Md(i),i}function zl(n){return[n[0],n[3]]}function w0(n){return[n[2],n[3]]}function fn(n){return n[2]-n[0]}function Ji(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function Nd(n){return n[2]<n[0]||n[3]<n[1]}function Rz(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function Az(n,e,t){let i=!1;const r=PT(n,e),s=PT(n,t);if(r===ln.INTERSECTING||s===ln.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],c=n[3],u=e[0],f=e[1],p=t[0],m=t[1],y=(m-f)/(p-u);let _,w;s&ln.ABOVE&&!(r&ln.ABOVE)&&(_=p-(m-c)/y,i=_>=o&&_<=l),!i&&s&ln.RIGHT&&!(r&ln.RIGHT)&&(w=m-(p-l)*y,i=w>=a&&w<=c),!i&&s&ln.BELOW&&!(r&ln.BELOW)&&(_=p-(m-a)/y,i=_>=o&&_<=l),!i&&s&ln.LEFT&&!(r&ln.LEFT)&&(w=m-(p-o)*y,i=w>=a&&w<=c)}return i}function Lz(n,e,t,i){if(Nd(n))return Md(t);let r=[];r=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]],e(r,r,2);const s=[],o=[];for(let a=0,l=r.length;a<l;a+=2)s.push(r[a]),o.push(r[a+1]);return bz(s,o,t)}const Iz={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function KR(n){return Iz[n]}const wb={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Ep{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||wb[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ng=6378137,Gh=Math.PI*ng,Pz=[-Gh,-Gh,Gh,Gh],Dz=[-180,-85,180,85],$m=ng*Math.log(Math.tan(Math.PI/2));class oh extends Ep{constructor(e){super({code:e,units:"m",extent:Pz,global:!0,worldExtent:Dz,getPointResolution:function(t,i){return t/Math.cosh(i[1]/ng)}})}}const ZR=[new oh("EPSG:3857"),new oh("EPSG:102100"),new oh("EPSG:102113"),new oh("EPSG:900913"),new oh("http://www.opengis.net/def/crs/EPSG/0/3857"),new oh("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Oz(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t){e[r]=Gh*n[r]/180;let s=ng*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));s>$m?s=$m:s<-$m&&(s=-$m),e[r+1]=s}return e}function kz(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t)e[r]=180*n[r]/Gh,e[r+1]=360*Math.atan(Math.exp(n[r+1]/ng))/Math.PI-90;return e}const Mz=6378137,YR=[-180,-90,180,90],Nz=Math.PI*Mz/180;class Sc extends Ep{constructor(e,t){super({code:e,units:"degrees",extent:YR,axisOrientation:t,global:!0,metersPerUnit:Nz,worldExtent:YR})}}const XR=[new Sc("CRS:84"),new Sc("EPSG:4326","neu"),new Sc("urn:ogc:def:crs:OGC:1.3:CRS84"),new Sc("urn:ogc:def:crs:OGC:2:84"),new Sc("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Sc("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Sc("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let kT={};function Fz(n){return kT[n]||kT[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Bz(n,e){kT[n]=e}let Kh={};function vy(n,e,t){const i=n.getCode(),r=e.getCode();i in Kh||(Kh[i]={}),Kh[i][r]=t}function Uz(n,e){let t;return n in Kh&&e in Kh[n]&&(t=Kh[n][e]),t}function Ii(n,e,t){return Math.min(Math.max(n,e),t)}function zz(n,e,t,i,r,s){const o=r-t,a=s-i;if(o!==0||a!==0){const l=((n-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=r,i=s):l>0&&(t+=o*l,i+=a*l)}return jc(n,e,t,i)}function jc(n,e,t,i){const r=t-n,s=i-e;return r*r+s*s}function Gz(n){const e=n.length;for(let i=0;i<e;i++){let r=i,s=Math.abs(n[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(n[a][i]);l>s&&(s=l,r=a)}if(s===0)return null;const o=n[r];n[r]=n[i],n[i]=o;for(let a=i+1;a<e;a++){const l=-n[a][i]/n[i][i];for(let c=i;c<e+1;c++)i==c?n[a][c]=0:n[a][c]+=l*n[i][c]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let r=i-1;r>=0;r--)n[r][e]-=n[r][i]*t[i]}return t}function jv(n){return n*Math.PI/180}function Zh(n,e){const t=n%e;return t*e<0?t+e:t}function Ir(n,e,t){return n+t*(e-n)}function Tb(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Vm(n,e){return Math.floor(Tb(n,e))}function jm(n,e){return Math.ceil(Tb(n,e))}function Hz(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function yy(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function Sb(n,e){const t=Math.cos(e),i=Math.sin(e),r=n[0]*t-n[1]*i,s=n[1]*t+n[0]*i;return n[0]=r,n[1]=s,n}function $z(n,e){return n[0]*=e,n[1]*=e,n}function pO(n,e){if(e.canWrapX()){const t=fn(e.getExtent()),i=Vz(n,e,t);i&&(n[0]-=i*t)}return n}function Vz(n,e,t){const i=e.getExtent();let r=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||fn(i),r=Math.floor((n[0]-i[0])/t)),r}const jz=63710088e-1;function JR(n,e,t){t=t||jz;const i=jv(n[1]),r=jv(e[1]),s=(r-i)/2,o=jv(e[0]-n[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function gO(...n){console.warn(...n)}function QR(...n){console.error(...n)}let MT=!0;function Wz(n){MT=!1}function bb(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function mO(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function qz(n){Bz(n.getCode(),n),vy(n,n,bb)}function Kz(n){n.forEach(qz)}function Ti(n){return typeof n=="string"?Fz(n):n||null}function eA(n,e,t,i){n=Ti(n);let r;const s=n.getPointResolutionFunc();if(s)r=s(e,t);else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")r=e;else{const a=Cb(n,Ti("EPSG:4326"));if(a===mO&&o!=="degrees")r=e*n.getMetersPerUnit();else{let c=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];c=a(c,c,2);const u=JR(c.slice(0,2),c.slice(2,4)),f=JR(c.slice(4,6),c.slice(6,8));r=(u+f)/2}const l=n.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function tA(n){Kz(n),n.forEach(function(e){n.forEach(function(t){e!==t&&vy(e,t,bb)})})}function Zz(n,e,t,i){n.forEach(function(r){e.forEach(function(s){vy(r,s,t),vy(s,r,i)})})}function xb(n,e){return n?typeof n=="string"?Ti(n):n:Ti(e)}function As(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||Cb(n,e)===bb)&&t}function Cb(n,e){const t=n.getCode(),i=e.getCode();let r=Uz(t,i);return r||(r=mO),r}function wp(n,e){const t=Ti(n),i=Ti(e);return Cb(t,i)}function Rb(n,e,t){return wp(e,t)(n,void 0,n.length)}function vO(n,e,t,i){const r=wp(e,t);return Lz(n,r,void 0)}let po=null;function Yz(n){po=Ti(n)}function Xz(){return po}function Jz(){Yz("EPSG:4326")}function _y(n,e){return po?Rb(n,e,po):n}function Yo(n,e){return po?Rb(n,po,e):(MT&&!yy(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(MT=!1,gO("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n)}function yO(n,e){return po?vO(n,e,po):n}function ml(n,e){return po?vO(n,po,e):n}function Qz(){tA(ZR),tA(XR),Zz(XR,ZR,Oz,kz)}Qz();function Tl(n,e,t,i,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=i){const l=n[a],c=n[a+1];s[o++]=r[0]*l+r[2]*c+r[4],s[o++]=r[1]*l+r[3]*c+r[5]}return s&&s.length!=o&&(s.length=o),s}function _O(n,e,t,i,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),c=s[0],u=s[1];let f=0;for(let p=e;p<t;p+=i){const m=n[p]-c,y=n[p+1]-u;o[f++]=c+m*a-y*l,o[f++]=u+m*l+y*a;for(let _=p+2;_<p+i;++_)o[f++]=n[_]}return o&&o.length!=f&&(o.length=f),o}function eG(n,e,t,i,r,s,o,a){a=a||[];const l=o[0],c=o[1];let u=0;for(let f=e;f<t;f+=i){const p=n[f]-l,m=n[f+1]-c;a[u++]=l+r*p,a[u++]=c+s*m;for(let y=f+2;y<f+i;++y)a[u++]=n[y]}return a&&a.length!=u&&(a.length=u),a}function tG(n,e,t,i,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=n[l]+r,o[a++]=n[l+1]+s;for(let c=l+2;c<l+i;++c)o[a++]=n[c]}return o&&o.length!=a&&(o.length=a),o}const iA=Un();class EO extends Eo{constructor(){super(),this.extent_=wo(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=hz(function(e,t,i){if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Et()}closestPointXY(e,t,i,r){return Et()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Et()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Md(t),this.extentRevision_=this.getRevision()}return Rz(this.extent_,e)}rotate(e,t){Et()}scale(e,t,i){Et()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Et()}getType(){return Et()}applyTransform(e){Et()}intersectsExtent(e){return Et()}translate(e,t){Et()}transform(e,t){const i=Ti(e),r=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),c=i.getWorldExtent(),u=ns(c)/ns(l);return Ls(iA,c[0],c[3],u,-u,0,0,0),Tl(s,0,s.length,a,iA,o),wp(i,t)(s,o,a)}:wp(i,t);return this.applyTransform(r),this}}class uu extends EO{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return Eb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Et()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=nA(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Et()}setLayout(e,t,i){let r;if(e)r=nA(e);else{for(let s=0;s<i;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=iG(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();_O(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Ll(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();eG(r,0,r.length,s,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();tG(i,0,i.length,r,e,t,i),this.changed()}}}function iG(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function nA(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function nG(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return Tl(i,0,i.length,r,e,t)}function rA(n,e,t,i,r,s,o){const a=n[e],l=n[e+1],c=n[t]-a,u=n[t+1]-l;let f;if(c===0&&u===0)f=e;else{const p=((r-a)*c+(s-l)*u)/(c*c+u*u);if(p>1)f=t;else if(p>0){for(let m=0;m<i;++m)o[m]=Ir(n[e+m],n[t+m],p);o.length=i;return}else f=e}for(let p=0;p<i;++p)o[p]=n[f+p];o.length=i}function Ab(n,e,t,i,r){let s=n[e],o=n[e+1];for(e+=i;e<t;e+=i){const a=n[e],l=n[e+1],c=jc(s,o,a,l);c>r&&(r=c),s=a,o=l}return r}function Lb(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=Ab(n,e,a,i,r),e=a}return r}function rG(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=Lb(n,e,a,i,r),e=a[a.length-1]}return r}function Ib(n,e,t,i,r,s,o,a,l,c,u){if(e==t)return c;let f,p;if(r===0){if(p=jc(o,a,n[e],n[e+1]),p<c){for(f=0;f<i;++f)l[f]=n[e+f];return l.length=i,p}return c}u=u||[NaN,NaN];let m=e+i;for(;m<t;)if(rA(n,m-i,m,i,o,a,u),p=jc(o,a,u[0],u[1]),p<c){for(c=p,f=0;f<i;++f)l[f]=u[f];l.length=i,m+=i}else m+=i*Math.max((Math.sqrt(p)-Math.sqrt(c))/r|0,1);if(s&&(rA(n,t-i,e,i,o,a,u),p=jc(o,a,u[0],u[1]),p<c)){for(c=p,f=0;f<i;++f)l[f]=u[f];l.length=i}return c}function Pb(n,e,t,i,r,s,o,a,l,c,u){u=u||[NaN,NaN];for(let f=0,p=t.length;f<p;++f){const m=t[f];c=Ib(n,e,m,i,r,s,o,a,l,c,u),e=m}return c}function sG(n,e,t,i,r,s,o,a,l,c,u){u=u||[NaN,NaN];for(let f=0,p=t.length;f<p;++f){const m=t[f];c=Pb(n,e,m,i,r,s,o,a,l,c,u),e=m[m.length-1]}return c}function oG(n,e,t,i){for(let r=0,s=t.length;r<s;++r)n[e++]=t[r];return e}function T0(n,e,t,i){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<i;++a)n[e++]=o[a]}return e}function Db(n,e,t,i,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=T0(n,e,t[o],i);r[s++]=l,e=l}return r.length=s,r}function aG(n,e,t,i,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Db(n,e,t[o],i,r[s]);l.length===0&&(l[0]=e),r[s++]=l,e=l[l.length-1]}return r.length=s,r}function Ob(n,e,t,i,r,s,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)s[o++]=n[e],s[o++]=n[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[e,t-i];let u=0;for(;c.length>0;){const f=c.pop(),p=c.pop();let m=0;const y=n[p],_=n[p+1],w=n[f],T=n[f+1];for(let x=p+i;x<f;x+=i){const C=n[x],I=n[x+1],D=zz(C,I,y,_,w,T);D>m&&(u=x,m=D)}m>r&&(l[(u-e)/i]=1,p+i<u&&c.push(p,u),u+i<f&&c.push(u,f))}for(let f=0;f<a;++f)l[f]&&(s[o++]=n[e+f*i],s[o++]=n[e+f*i+1]);return o}function lG(n,e,t,i,r,s,o,a){for(let l=0,c=t.length;l<c;++l){const u=t[l];o=Ob(n,e,u,i,r,s,o),a.push(o),e=u}return o}function Pc(n,e){return e*Math.round(n/e)}function cG(n,e,t,i,r,s,o){if(e==t)return o;let a=Pc(n[e],r),l=Pc(n[e+1],r);e+=i,s[o++]=a,s[o++]=l;let c,u;do if(c=Pc(n[e],r),u=Pc(n[e+1],r),e+=i,e==t)return s[o++]=c,s[o++]=u,o;while(c==a&&u==l);for(;e<t;){const f=Pc(n[e],r),p=Pc(n[e+1],r);if(e+=i,f==c&&p==u)continue;const m=c-a,y=u-l,_=f-a,w=p-l;if(m*w==y*_&&(m<0&&_<m||m==_||m>0&&_>m)&&(y<0&&w<y||y==w||y>0&&w>y)){c=f,u=p;continue}s[o++]=c,s[o++]=u,a=c,l=u,c=f,u=p}return s[o++]=c,s[o++]=u,o}function wO(n,e,t,i,r,s,o,a){for(let l=0,c=t.length;l<c;++l){const u=t[l];o=cG(n,e,u,i,r,s,o),a.push(o),e=u}return o}function uG(n,e,t,i,r,s,o,a){for(let l=0,c=t.length;l<c;++l){const u=t[l],f=[];o=wO(n,e,u,i,r,s,o,f),a.push(f),e=u[u.length-1]}return o}function vl(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=i)r[s++]=n.slice(o,o+i);return r.length=s,r}function Tp(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=vl(n,e,l,i,r[s]),e=l}return r.length=s,r}function NT(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=l.length===1&&l[0]===e?[]:Tp(n,e,l,i,r[s]),e=l[l.length-1]}return r.length=s,r}function TO(n,e,t,i){let r=0,s=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function SO(n,e,t,i){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=TO(n,e,a,i),e=a}return r}function hG(n,e,t,i){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=SO(n,e,a,i),e=a[a.length-1]}return r}class Sp extends uu{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Sp(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,r){return r<cu(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ab(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ib(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,r))}getArea(){return TO(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return vl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Ob(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Sp(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=T0(this.flatCoordinates,0,e,this.stride),this.changed()}}class Jc extends uu{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Jc(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,o=jc(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return uO(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return _b(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oG(this.flatCoordinates,0,e,this.stride),this.changed()}}function dG(n,e,t,i,r){return!fO(r,function(o){return!Nc(n,e,t,i,o[0],o[1])})}function Nc(n,e,t,i,r,s){let o=0,a=n[t-i],l=n[t-i+1];for(;e<t;e+=i){const c=n[e],u=n[e+1];l<=s?u>s&&(c-a)*(s-l)-(r-a)*(u-l)>0&&o++:u<=s&&(c-a)*(s-l)-(r-a)*(u-l)<0&&o--,a=c,l=u}return o!==0}function kb(n,e,t,i,r,s){if(t.length===0||!Nc(n,e,t[0],i,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(Nc(n,t[o-1],t[o],i,r,s))return!1;return!0}function fG(n,e,t,i,r,s){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(kb(n,e,l,i,r,s))return!0;e=l[l.length-1]}return!1}function Mb(n,e,t,i,r,s,o){let a,l,c,u,f,p,m;const y=r[s+1],_=[];for(let x=0,C=t.length;x<C;++x){const I=t[x];for(u=n[I-i],p=n[I-i+1],a=e;a<I;a+=i)f=n[a],m=n[a+1],(y<=p&&m<=y||p<=y&&y<=m)&&(c=(y-p)/(m-p)*(f-u)+u,_.push(c)),u=f,p=m}let w=NaN,T=-1/0;for(_.sort(Cl),u=_[0],a=1,l=_.length;a<l;++a){f=_[a];const x=Math.abs(f-u);x>T&&(c=(u+f)/2,kb(n,e,t,i,c,y)&&(w=c,T=x)),u=f}return isNaN(w)&&(w=r[s]),o?(o.push(w,y,T),o):[w,y,T]}function bO(n,e,t,i,r){let s=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];s=Mb(n,e,l,i,r,2*o,s),e=l[l.length-1]}return s}function xO(n,e,t,i,r){let s;for(e+=i;e<t;e+=i)if(s=r(n.slice(e-i,e),n.slice(e,e+i)),s)return s;return!1}function S0(n,e,t,i,r){const s=dO(wo(),n,e,t,i);return Ji(r,s)?cO(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:xO(n,e,t,i,function(o,a){return Az(r,o,a)}):!1}function pG(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){if(S0(n,e,t[s],i,r))return!0;e=t[s]}return!1}function CO(n,e,t,i,r){return!!(S0(n,e,t,i,r)||Nc(n,e,t,i,r[0],r[1])||Nc(n,e,t,i,r[0],r[3])||Nc(n,e,t,i,r[2],r[1])||Nc(n,e,t,i,r[2],r[3]))}function RO(n,e,t,i,r){if(!CO(n,e,t[0],i,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(dG(n,t[s-1],t[s],i,r)&&!S0(n,t[s-1],t[s],i,r))return!1;return!0}function gG(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(RO(n,e,a,i,r))return!0;e=a[a.length-1]}return!1}function mG(n,e,t,i){for(;e<t-i;){for(let r=0;r<i;++r){const s=n[e+r];n[e+r]=n[t-i+r],n[t-i+r]=s}e+=i,t-=i}}function Nb(n,e,t,i){let r=0,s=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],l=n[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function AO(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Nb(n,e,a,i);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function vG(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(!AO(n,e,a,i,r))return!1;a.length&&(e=a[a.length-1])}return!0}function FT(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Nb(n,e,a,i);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&mG(n,e,a,i),e=a}return e}function sA(n,e,t,i,r){for(let s=0,o=t.length;s<o;++s)e=FT(n,e,t[s],i,r);return e}function yG(n,e){const t=[];let i=0,r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!Nb(n,i,a,2))t.push(e.slice(r,s+1));else{if(t.length===0)continue;t[t.length-1].push(e[r])}r=s+1,i=a}return t}class ha extends uu{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?ra(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ha(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<cu(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Lb(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pb(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return kb(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return SO(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),FT(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Tp(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Ll(this.getExtent());this.flatInteriorPoint_=Mb(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Jc(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Sp(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],c=new Sp(t.slice(s,l),e);r.push(c),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;AO(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=FT(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=wO(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new ha(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return RO(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Db(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function oA(n){if(Nd(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],r=n[3],s=[e,t,e,r,i,r,i,t,e,t];return new ha(s,"XY",[s.length])}const ur={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Qc{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new Qc({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}function Ey(n,e,t,i,r,s,o){let a,l;const c=(t-e)/i;if(c===1)a=e;else if(c===2)a=e,l=r;else if(c!==0){let u=n[e],f=n[e+1],p=0;const m=[0];for(let w=e+i;w<t;w+=i){const T=n[w],x=n[w+1];p+=Math.sqrt((T-u)*(T-u)+(x-f)*(x-f)),m.push(p),u=T,f=x}const y=r*p,_=az(m,y);_<0?(l=(y-m[-_-2])/(m[-_-1]-m[-_-2]),a=e+(-_-2)*i):a=e+_*i}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?n[a+u]:Ir(n[a+u],n[a+i+u],l);return s}function BT(n,e,t,i,r,s){if(t==e)return null;let o;if(r<n[e+i-1])return s?(o=n.slice(e,e+i),o[i-1]=r,o):null;if(n[t-1]<r)return s?(o=n.slice(t-i,t),o[i-1]=r,o):null;if(r==n[e+i-1])return n.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const p=a+l>>1;r<n[(p+1)*i-1]?l=p:a=p+1}const c=n[a*i-1];if(r==c)return n.slice((a-1)*i,(a-1)*i+i);const u=n[(a+1)*i-1],f=(r-c)/(u-c);o=[];for(let p=0;p<i-1;++p)o.push(Ir(n[(a-1)*i+p],n[a*i+p],f));return o.push(r),o}function _G(n,e,t,i,r,s,o){if(o)return BT(n,e,t[t.length-1],i,r,s);let a;if(r<n[i-1])return s?(a=n.slice(0,i),a[i-1]=r,a):null;if(n[n.length-1]<r)return s?(a=n.slice(n.length-i),a[i-1]=r,a):null;for(let l=0,c=t.length;l<c;++l){const u=t[l];if(e!=u){if(r<n[e+i-1])return null;if(r<=n[u-1])return BT(n,e,u,i,r,!1);e=u}}return null}function LO(n,e,t,i){let r=n[e],s=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=n[a],c=n[a+1];o+=Math.sqrt((l-r)*(l-r)+(c-s)*(c-s)),r=l,s=c}return o}class eu extends uu{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){this.flatCoordinates?ra(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new eu(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<cu(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ab(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ib(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,r))}forEachSegment(e){return xO(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,BT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return vl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return Ey(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return LO(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Ob(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new eu(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return S0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=T0(this.flatCoordinates,0,e,this.stride),this.changed()}}class od{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new od({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const gi={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function aA(n){return n[0]>0&&n[1]>0}function EG(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function Bi(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class b0{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Bi(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new b0({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Et()}getImage(e){return Et()}getHitDetectionImage(){return Et()}getPixelRatio(e){return 1}getImageState(){return Et()}getImageSize(){return Et()}getOrigin(){return Et()}getSize(){return Et()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Bi(e)}listenImageChange(e){Et()}load(){Et()}unlistenImageChange(e){Et()}}const IO=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,PO=/^([a-z]*)$|^hsla?\(.*\)$/i;function DO(n){return typeof n=="string"?n:MO(n)}function OO(n){const e=document.createElement("div");if(e.style.color=n,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const kO=function(){const e={};let t=0;return function(i){let r;if(e.hasOwnProperty(i))r=e[i];else{if(t>=1024){let s=0;for(const o in e)s++&3||(delete e[o],--t)}r=wG(i),e[i]=r,++t}return r}}();function bp(n){return Array.isArray(n)?n:kO(n)}function wG(n){let e,t,i,r,s;if(PO.exec(n)&&(n=OO(n)),IO.exec(n)){const o=n.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(n.substr(1+0*a,a),16),t=parseInt(n.substr(1+1*a,a),16),i=parseInt(n.substr(1+2*a,a),16),l?r=parseInt(n.substr(1+3*a,a),16):r=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,l&&(r=(r<<4)+r)),s=[e,t,i,r/255]}else if(n.startsWith("rgba("))s=n.slice(5,-1).split(",").map(Number),lA(s);else if(n.startsWith("rgb("))s=n.slice(4,-1).split(",").map(Number),s.push(1),lA(s);else throw new Error("Invalid color");return s}function lA(n){return n[0]=Ii(n[0]+.5|0,0,255),n[1]=Ii(n[1]+.5|0,0,255),n[2]=Ii(n[2]+.5|0,0,255),n[3]=Ii(n[3],0,1),n}function MO(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*100)/100;return"rgba("+e+","+t+","+i+","+r+")"}function TG(n){return PO.test(n)&&(n=OO(n)),IO.test(n)||n.startsWith("rgba(")||n.startsWith("rgb(")}function so(n){return Array.isArray(n)?MO(n):n}function pn(n,e,t,i){let r;return t&&t.length?r=t.shift():vb?r=new OffscreenCanvas(n||300,e||300):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}function ad(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function wy(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function UT(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function SG(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function bG(n,e){const t=n.childNodes;for(let i=0;;++i){const r=t[i],s=e[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}const Wm="ol-hidden",rg="ol-unselectable",cA="ol-unsupported",x0="ol-control",uA="ol-collapsed",xG=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),hA=["style","variant","weight","size","lineHeight","family"],NO=function(n){const e=n.match(xG);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=hA.length;i<r;++i){const s=e[i+1];s!==void 0&&(t[hA[i]]=s)}return t.families=t.family.split(/,\s?/),t},FO="10px sans-serif",hr="#000",ld="round",sa=[],oa=0,cd="round",xp=10,Cp="#000",Rp="center",Ty="middle",Fc=[0,0,0,0],Ap=1,Xo=new Eo;let Dh=null,zT;const GT={},CG=function(){const e="32px ",t=["monospace","serif"],i=t.length,r="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(c,u,f){let p=!0;for(let m=0;m<i;++m){const y=t[m];if(o=Sy(c+" "+u+" "+e+y,r),f!=y){const _=Sy(c+" "+u+" "+e+f+","+y,r);p=p&&_!=o}}return!!p}function l(){let c=!0;const u=Xo.getKeys();for(let f=0,p=u.length;f<p;++f){const m=u[f];Xo.get(m)<100&&(a.apply(this,m.split(`
`))?(kd(GT),Dh=null,zT=void 0,Xo.set(m,100)):(Xo.set(m,Xo.get(m)+1,!0),c=!1))}c&&(clearInterval(s),s=void 0)}return function(c){const u=NO(c);if(!u)return;const f=u.families;for(let p=0,m=f.length;p<m;++p){const y=f[p],_=u.style+`
`+u.weight+`
`+y;Xo.get(_)===void 0&&(Xo.set(_,100,!0),a(u.style,u.weight,y)||(Xo.set(_,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),RG=function(){let n;return function(e){let t=GT[e];if(t==null){if(vb){const i=NO(e),r=BO(e,"Žg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);GT[e]=t}return t}}();function BO(n,e){return Dh||(Dh=pn(1,1)),n!=zT&&(Dh.font=n,zT=Dh.font),Dh.measureText(e)}function Sy(n,e){return BO(n,e).width}function dA(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((r,s)=>Math.max(r,Sy(n,s)),0);return t[e]=i,i}function AG(n,e){const t=[],i=[],r=[];let s=0,o=0,a=0,l=0;for(let c=0,u=e.length;c<=u;c+=2){const f=e[c];if(f===`
`||c===u){s=Math.max(s,o),r.push(o),o=0,a+=l;continue}const p=e[c+1]||n.font,m=Sy(p,f);t.push(m),o+=m;const y=RG(p);i.push(y),l=Math.max(l,y)}return{width:s,height:a,widths:t,heights:i,lineWidths:r}}function LG(n,e,t,i,r,s,o,a,l,c,u){n.save(),t!==1&&(n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(l,c),n.scale(u[0],u[1]),IG(i,n)):u[0]<0||u[1]<0?(n.translate(l,c),n.scale(u[0],u[1]),n.drawImage(i,r,s,o,a,0,0,o,a)):n.drawImage(i,r,s,o,a,l,c,o*u[0],a*u[1]),n.restore()}function IG(n,e){const t=n.contextInstructions;for(let i=0,r=t.length;i<r;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class C0 extends b0{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new C0({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const i=this.renderOptions_,r=pn(i.size*e,i.size*e);this.draw_(i,r,e),t=r.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return gi.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const B=r;r=s,s=B}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),c=Math.sqrt(s*s-l*l),u=r-c,f=Math.sqrt(l*l+u*u),p=f/l;if(e==="miter"&&p<=i)return p*t;const m=t/2/p,y=t/2*(u/f),w=Math.sqrt((r+m)*(r+m)+y*y)-r;if(this.radius2_===void 0||e==="bevel")return w*2;const T=r*Math.sin(a),x=Math.sqrt(r*r-T*T),C=s-x,D=Math.sqrt(T*T+C*C)/T;if(D<=i){const B=D*t/2-s-r;return 2*Math.max(w,B)}return w*2}createRenderOptions(){let e=ld,t=cd,i=0,r=null,s=0,o,a=0;this.stroke_&&(o=this.stroke_.getColor(),o===null&&(o=Cp),o=so(o),a=this.stroke_.getWidth(),a===void 0&&(a=Ap),r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=cd),e=this.stroke_.getLineCap(),e===void 0&&(e=ld),i=this.stroke_.getMiterLimit(),i===void 0&&(i=xp));const l=this.calculateLineJoinSize_(t,a,i),c=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*c+l);return{strokeStyle:o,strokeWidth:a,size:u,lineCap:e,lineDash:r,lineDashOffset:s,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=hr),t.fillStyle=so(r),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),i=0;if(typeof t=="string"&&(t=bp(t)),t===null?i=1:Array.isArray(t)&&(i=t.length===4?t[3]:1),i===0){const r=pn(e.size,e.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(e,r)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=s+a*o,c=a%2===0?i:r;e.lineTo(c*Math.cos(l),c*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=hr,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}class sg extends C0{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new sg({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}let Yh=class UO{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=fA,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new UO({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=fA,this.geometry_=e}setZIndex(e){this.zIndex_=e}};function PG(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(Kt(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let ZE=null;function DG(n,e){if(!ZE){const t=new Qc({color:"rgba(255,255,255,0.4)"}),i=new od({color:"#3399CC",width:1.25});ZE=[new Yh({image:new sg({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return ZE}function fA(n){return n.getGeometry()}const OG="#333";let kG=class zO{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Bi(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Qc({color:OG}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new zO({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Bi(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}};const Jt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class GO extends Eo{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Jt.OPACITY]=e.opacity!==void 0?e.opacity:1,Kt(typeof t[Jt.OPACITY]=="number","Layer opacity must be a number"),t[Jt.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Jt.Z_INDEX]=e.zIndex,t[Jt.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Jt.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Jt.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Jt.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=Ii(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Et()}getLayerStatesArray(e){return Et()}getExtent(){return this.get(Jt.EXTENT)}getMaxResolution(){return this.get(Jt.MAX_RESOLUTION)}getMinResolution(){return this.get(Jt.MIN_RESOLUTION)}getMinZoom(){return this.get(Jt.MIN_ZOOM)}getMaxZoom(){return this.get(Jt.MAX_ZOOM)}getOpacity(){return this.get(Jt.OPACITY)}getSourceState(){return Et()}getVisible(){return this.get(Jt.VISIBLE)}getZIndex(){return this.get(Jt.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Jt.EXTENT,e)}setMaxResolution(e){this.set(Jt.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Jt.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Jt.MAX_ZOOM,e)}setMinZoom(e){this.set(Jt.MIN_ZOOM,e)}setOpacity(e){Kt(typeof e=="number","Layer opacity must be a number"),this.set(Jt.OPACITY,e)}setVisible(e){this.set(Jt.VISIBLE,e)}setZIndex(e){this.set(Jt.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const un={ANIMATING:0,INTERACTING:1},ws={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},HO=42,Fb=256;function pA(n,e,t){return function(i,r,s,o,a){if(!i)return;if(!r&&!e)return i;const l=e?0:s[0]*r,c=e?0:s[1]*r,u=a?a[0]:0,f=a?a[1]:0;let p=n[0]+l/2+u,m=n[2]-l/2+u,y=n[1]+c/2+f,_=n[3]-c/2+f;p>m&&(p=(m+p)/2,m=p),y>_&&(y=(_+y)/2,_=y);let w=Ii(i[0],p,m),T=Ii(i[1],y,_);if(o&&t&&r){const x=30*r;w+=-x*Math.log(1+Math.max(0,p-i[0])/x)+x*Math.log(1+Math.max(0,i[0]-m)/x),T+=-x*Math.log(1+Math.max(0,y-i[1])/x)+x*Math.log(1+Math.max(0,i[1]-_)/x)}return[w,T]}}function MG(n){return n}function Bb(n,e,t,i){const r=fn(e)/t[0],s=ns(e)/t[1];return i?Math.min(n,Math.max(r,s)):Math.min(n,Math.min(r,s))}function Ub(n,e,t){let i=Math.min(n,e);const r=50;return i*=Math.log(1+r*Math.max(0,n/e-1))/r+1,t&&(i=Math.max(i,t),i/=Math.log(1+r*Math.max(0,t/n-1))/r+1),Ii(i,t/2,e*2)}function NG(n,e,t,i){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=n[0],c=n[n.length-1],u=t?Bb(l,t,o,i):l;if(a)return e?Ub(r,u,c):Ii(r,c,u);const f=Math.min(u,r),p=Math.floor(gb(n,f,s));return n[p]>u&&p<n.length-1?n[p+1]:n[p]}}}function FG(n,e,t,i,r,s){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,c){if(o!==void 0){const u=r?Bb(e,r,l,s):e;if(c)return i?Ub(o,u,t):Ii(o,t,u);const f=1e-9,p=Math.ceil(Math.log(e/u)/Math.log(n)-f),m=-a*(.5-f)+.5,y=Math.min(u,o),_=Math.floor(Math.log(e/y)/Math.log(n)+m),w=Math.max(p,_),T=e/Math.pow(n,w);return Ii(T,t,u)}}}function gA(n,e,t,i,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const c=i?Bb(n,i,a,r):n;return!t||!l?Ii(s,e,c):Ub(s,c,e)}}}function zb(n){if(n!==void 0)return 0}function mA(n){if(n!==void 0)return n}function BG(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function UG(n){return n=n||jv(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=n?0:e}}function $O(n){return Math.pow(n,3)}function Fd(n){return 1-$O(1-n)}function zG(n){return 3*n*n-2*n*n*n}function GG(n){return n}const YE=0;class ia extends Eo{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=xb(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Wz(),e.center&&(e.center=Yo(e.center,this.projection_)),e.extent&&(e.extent=ml(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in ws)delete t[a];this.setProperties(t,!0);const i=$G(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const r=HG(e),s=i.constraint,o=VG(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=Yo(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=Yo(r.anchor,this.getProjection())),t[i]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const u=arguments[r];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(r===t){i&&qm(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const c=[];for(;r<t;++r){const u=arguments[r],f={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||zG,callback:i};if(u.center&&(f.sourceCenter=o,f.targetCenter=u.center.slice(),o=f.targetCenter),u.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(u.zoom),a=f.targetResolution):u.resolution&&(f.sourceResolution=a,f.targetResolution=u.resolution,a=f.targetResolution),u.rotation!==void 0){f.sourceRotation=l;const p=Zh(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=l+p,l=f.targetRotation}jG(f)?f.complete=!0:s+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(un.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[un.ANIMATING]>0}getInteracting(){return this.hints_[un.INTERACTING]>0}cancelAnimations(){this.setHint(un.ANIMATING,-this.hints_[un.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const r=this.animations_[t];if(r[0].callback&&qm(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const c=e-l.start;let u=l.duration>0?c/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const f=l.easing(u);if(l.sourceCenter){const p=l.sourceCenter[0],m=l.sourceCenter[1],y=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const w=p+f*(y-p),T=m+f*(_-m);this.targetCenter_=[w,T]}if(l.sourceResolution&&l.targetResolution){const p=f===1?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){const m=this.getViewportSize_(this.getRotation()),y=this.constraints_.resolution(p,0,m,!0);this.targetCenter_=this.calculateCenterZoom(y,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=p,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const p=f===1?Zh(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){const m=this.constraints_.rotation(p,!0);this.targetCenter_=this.calculateCenterRotate(m,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=p}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(un.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&qm(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-t[0],r[1]-t[1]],Sb(i,e-this.getRotation()),Hz(i,t)),i}calculateCenterZoom(e,t){let i;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],r=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&_y(e,this.getProjection())}getCenterInternal(){return this.get(ws.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return yO(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Kt(t,"The view center is not defined");const i=this.getResolution();Kt(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return Kt(r!==void 0,"The view rotation is not defined"),DT(t,i,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(ws.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ml(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=fn(e)/t[0],r=ns(e)/t[1];return Math.max(i,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(t/i)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(ws.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(i/r)/t;return function(o){return Math.log(i/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=XE(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,i)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,r;if(this.resolutions_){const s=gb(this.resolutions_,e,1);t=s,i=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=i/this.resolutions_[s+1]}else i=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(i/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=Ii(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,Ii(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(Kt(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Kt(!Nd(e),"Cannot fit empty extent provided as `geometry`");const r=ml(e,this.getProjection());i=oA(r)}else if(e.getType()==="Circle"){const r=ml(e.getExtent(),this.getProjection());i=oA(r),i.rotate(this.getRotation(),Ll(r))}else{const r=Xz();r?i=e.clone().transform(r,this.getProjection()):i=e}this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,c=-1/0,u=-1/0;for(let f=0,p=s.length;f<p;f+=o){const m=s[f]*i-s[f+1]*r,y=s[f]*r+s[f+1]*i;a=Math.min(a,m),l=Math.min(l,y),c=Math.max(c,m),u=Math.max(u,y)}return[a,l,c,u]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const c=this.getRotation(),u=Math.sin(c),f=Math.cos(c),p=Ll(a);p[0]+=(r[1]-r[3])/2*l,p[1]+=(r[0]-r[2])/2*l;const m=p[0]*f-p[1]*u,y=p[1]*f+p[0]*u,_=this.getConstrainedCenter([m,y],l),w=t.callback?t.callback:fy;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},w):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),qm(w,!0))}centerOn(e,t,i){this.centerOnInternal(Yo(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(XE(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=XE(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,i);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=_y(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Yo(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,i);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Yo(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Yo(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(ws.ROTATION)!==r&&this.set(ws.ROTATION,r),this.get(ws.RESOLUTION)!==o&&(this.set(ws.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(ws.CENTER)||!yy(this.get(ws.CENTER),a))&&this.set(ws.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!yy(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:Fd,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(un.INTERACTING,1)}endInteraction(e,t,i){i=i&&Yo(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(un.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function qm(n,e){setTimeout(function(){n(e)},0)}function HG(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return pA(n.extent,n.constrainOnlyCenter,t)}const e=xb(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,pA(t,!1,!1)}return MG}function $G(n){let e,t,i,o=n.minZoom!==void 0?n.minZoom:YE,a=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,c=n.multiWorld!==void 0?n.multiWorld:!1,u=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,f=n.showFullExtent!==void 0?n.showFullExtent:!1,p=xb(n.projection,"EPSG:3857"),m=p.getExtent();let y=n.constrainOnlyCenter,_=n.extent;if(!c&&!_&&p.isGlobal()&&(y=!1,_=m),n.resolutions!==void 0){const w=n.resolutions;t=w[o],i=w[a]!==void 0?w[a]:w[w.length-1],n.constrainResolution?e=NG(w,u,!y&&_,f):e=gA(t,i,u,!y&&_,f)}else{const T=(m?Math.max(fn(m),ns(m)):360*wb.degrees/p.getMetersPerUnit())/Fb/Math.pow(2,YE),x=T/Math.pow(2,28-YE);t=n.maxResolution,t!==void 0?o=0:t=T/Math.pow(l,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(l,a):i=T/Math.pow(l,a):i=x),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),n.constrainResolution?e=FG(l,t,i,u,!y&&_,f):e=gA(t,i,u,!y&&_,f)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function VG(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?UG():t===!1?mA:typeof t=="number"?BG(t):mA}return zb}function jG(n){return!(n.sourceCenter&&n.targetCenter&&!yy(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function XE(n,e,t,i,r){const s=Math.cos(-r);let o=Math.sin(-r),a=n[0]*s-n[1]*o,l=n[1]*s+n[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const c=a*s-l*o,u=l*s+a*o;return[c,u]}class WG extends GO{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Jt.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Jt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(mi(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=qt(e,yt.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof ia?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return Gb(r,t.viewState)&&(!s||Ji(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const r=e instanceof ia?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(Jt.MAP,e)}getMapInternal(){return this.get(Jt.MAP)}setMap(e){this.mapPrecomposeKey_&&(mi(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(mi(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=qt(e,ur.PRECOMPOSE,function(t){const r=t.frameState.layerStatesArray,s=this.getLayerState(!1);Kt(!r.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=qt(this,yt.CHANGE,e.render,e),this.changed())}setSource(e){this.set(Jt.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Gb(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}const R0=WG;function qG(n,e,t,i,r){VO(n,e,t||0,i||n.length-1,r||KG)}function VO(n,e,t,i,r){for(;i>t;){if(i-t>600){var s=i-t+1,o=e-t+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(t,Math.floor(e-o*l/s+c)),f=Math.min(i,Math.floor(e+(s-o)*l/s+c));VO(n,e,u,f,r)}var p=n[e],m=t,y=i;for(jf(n,t,e),r(n[i],p)>0&&jf(n,t,i);m<y;){for(jf(n,m,y),m++,y--;r(n[m],p)<0;)m++;for(;r(n[y],p)>0;)y--}r(n[t],p)===0?jf(n,t,y):(y++,jf(n,y,i)),y<=e&&(t=y+1),e<=y&&(i=y-1)}}function jf(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function KG(n,e){return n<e?-1:n>e?1:0}class ZG{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Zm(e,t))return i;const r=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?r(a):a;Zm(e,l)&&(t.leaf?i.push(a):QE(e,l)?this._all(a,i):s.push(a))}t=s.pop()}return i}collides(e){let t=this.data;if(!Zm(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const s=t.children[r],o=t.leaf?this.toBBox(s):s;if(Zm(e,o)){if(t.leaf||QE(e,o))return!0;i.push(s)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Oh([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),s=[],o=[];let a,l,c;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),i.leaf){const u=YG(e,i.children,t);if(u!==-1)return i.children.splice(u,1),s.push(i),this._condense(s),this}!c&&!i.leaf&&QE(i,r)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],c=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const s=i-t+1;let o=this._maxEntries,a;if(s<=o)return a=Oh(e.slice(t,i+1)),ah(a,this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),a=Oh([]),a.leaf=!1,a.height=r;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));vA(e,t,i,c,this.compareMinX);for(let u=t;u<=i;u+=c){const f=Math.min(u+c-1,i);vA(e,u,f,l,this.compareMinY);for(let p=u;p<=f;p+=l){const m=Math.min(p+l-1,f);a.children.push(this._build(e,p,m,r-1))}}return ah(a,this.toBBox),a}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const c=t.children[l],u=JE(c),f=QG(e,c)-u;f<o?(o=f,s=u<s?u:s,a=c):f===o&&u<s&&(s=u,a=c)}t=a||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),s=[],o=this._chooseSubtree(r,this.data,t,s);for(o.children.push(e),np(o,r);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(r,s,t)}_split(e,t){const i=e[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);const o=this._chooseSplitIndex(i,s,r),a=Oh(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,ah(i,this.toBBox),ah(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Oh([e,t]),this.data.height=e.height+1,this.data.leaf=!1,ah(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,s=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=ip(e,0,a,this.toBBox),c=ip(e,a,i,this.toBBox),u=e6(l,c),f=JE(l)+JE(c);u<s?(s=u,r=a,o=f<o?f:o):u===s&&f<o&&(o=f,r=a)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:XG,s=e.leaf?this.compareMinY:JG,o=this._allDistMargin(e,t,i,r),a=this._allDistMargin(e,t,i,s);o<a&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const s=this.toBBox,o=ip(e,0,t,s),a=ip(e,i-t,i,s);let l=Km(o)+Km(a);for(let c=t;c<i-t;c++){const u=e.children[c];np(o,e.leaf?s(u):u),l+=Km(o)}for(let c=i-t-1;c>=t;c--){const u=e.children[c];np(a,e.leaf?s(u):u),l+=Km(a)}return l}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)np(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():ah(e[t],this.toBBox)}}function YG(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function ah(n,e){ip(n,0,n.children.length,e,n)}function ip(n,e,t,i,r){r||(r=Oh(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=e;s<t;s++){const o=n.children[s];np(r,n.leaf?i(o):o)}return r}function np(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function XG(n,e){return n.minX-e.minX}function JG(n,e){return n.minY-e.minY}function JE(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Km(n){return n.maxX-n.minX+(n.maxY-n.minY)}function QG(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function e6(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,s-i)}function QE(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Zm(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function Oh(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vA(n,e,t,i,r){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;qG(n,o,e,t,r),s.push(e,o,o,t)}}function t6(n,e,t){const i=n;let r=!0,s=!1,o=!1;const a=[py(i,yt.LOAD,function(){o=!0,s||e()})];return i.src&&rO?(s=!0,i.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(py(i,yt.ERROR,t)),function(){r=!1,a.forEach(mi)}}function i6(n,e){return new Promise((t,i)=>{function r(){o(),t(n)}function s(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s)})}function n6(n,e){return e&&(n.src=e),rO?new Promise((t,i)=>n.decode().then(()=>t(n),i)):i6(n)}class r6{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const r=yA(e,t,i);return r in this.cache_?this.cache_[r]:null}set(e,t,i,r){const s=yA(e,t,i);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function yA(n,e,t){const i=t?DO(t):"null";return e+":"+n+":"+i}const by=new r6;let Wf=null;class s6 extends tg{constructor(e,t,i,r,s){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=r===void 0?gi.IDLE:r,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===gi.LOADED){Wf||(Wf=pn(1,1,void 0,{willReadFrequently:!0})),Wf.drawImage(this.image_,0,0);try{Wf.getImageData(0,0,1,1),this.tainted_=!1}catch{Wf=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(yt.CHANGE)}handleImageError_(){this.imageState_=gi.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=gi.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=pn(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===gi.IDLE){this.image_||this.initializeImage_(),this.imageState_=gi.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&n6(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==gi.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const r=i.getContext("2d");r.scale(e,e),r.drawImage(t,0,0),r.globalCompositeOperation="multiply",r.fillStyle=DO(this.color_),r.fillRect(0,0,i.width/e,i.height/e),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),this.canvas_[e]=i}}function o6(n,e,t,i,r){let s=e===void 0?void 0:by.get(e,t,r);return s||(s=new s6(n,n instanceof HTMLImageElement?n.src||void 0:e,t,i,r),by.set(e,t,r,s)),s}function _A(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class A0 extends b0{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;Kt(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Mt(o)),Kt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Kt(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=gi.IDLE:o!==void 0&&(o instanceof HTMLImageElement?o.complete?l=o.src?gi.LOADED:gi.IDLE:l=gi.LOADING:l=gi.LOADED),this.color_=e.color!==void 0?bp(e.color):null,this.iconImage_=o6(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let c,u;if(e.size)[c,u]=e.size;else{const f=this.getImage(1);if(f.width&&f.height)c=f.width,u=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=e;const p=()=>{if(this.unlistenImageChange(p),!this.initialOptions_)return;const m=this.iconImage_.getSize();this.setScale(_A(m[0],m[1],e.width,e.height))};this.listenImageChange(p);return}}c!==void 0&&this.setScale(_A(c,u,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new A0({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==gi.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==gi.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(yt.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(yt.CHANGE,e)}}let Bd=0;const kn=1<<Bd++,Ut=1<<Bd++,ud=1<<Bd++,Hb=1<<Bd++,og=1<<Bd++,Ts=Math.pow(2,Bd)-1,jO={[kn]:"boolean",[Ut]:"number",[ud]:"string",[Hb]:"color",[og]:"number[]"},a6=Object.keys(jO).map(Number).sort(Cl);function xy(n){const e=[];for(const t of a6)l6(n,t)&&e.push(jO[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function l6(n,e){return(n&e)===e}function WO(n,e){return!!(n&e)}class yl{constructor(e,t){this.type=e,this.value=t}}class c6{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function qO(){return{variables:new Set,properties:new Set}}function L0(n,e){switch(typeof n){case"boolean":return new yl(kn,n);case"number":return new yl(Ut,n);case"string":return new yl(ud,n)}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(n.length===0)throw new Error("Empty expression");if(typeof n[0]=="string")return p6(n,e);for(const i of n)if(typeof i!="number")throw new Error("Expected an array of numbers");let t=og;return(n.length===3||n.length===4)&&(t|=Hb),new yl(t,n)}const $e={Number:"number",String:"string",Get:"get",Var:"var",Any:"any",All:"all",Not:"!",Resolution:"resolution",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match"},u6={[$e.Number]:ti(ui(1,1/0,Ts),Ut),[$e.String]:ti(ui(1,1/0,Ts),ud),[$e.Get]:ti(h6,Ts),[$e.Var]:ti(d6,Ts),[$e.Resolution]:ti(f6,Ut),[$e.Any]:ti(ui(2,1/0,kn),kn),[$e.All]:ti(ui(2,1/0,kn),kn),[$e.Not]:ti(ui(1,1,kn),kn),[$e.Equal]:ti(ui(2,2,Ts),kn),[$e.NotEqual]:ti(ui(2,2,Ts),kn),[$e.GreaterThan]:ti(ui(2,2,Ts),kn),[$e.GreaterThanOrEqualTo]:ti(ui(2,2,Ts),kn),[$e.LessThan]:ti(ui(2,2,Ts),kn),[$e.LessThanOrEqualTo]:ti(ui(2,2,Ts),kn),[$e.Multiply]:ti(ui(2,1/0,Ut),Ut),[$e.Divide]:ti(ui(2,2,Ut),Ut),[$e.Add]:ti(ui(2,1/0,Ut),Ut),[$e.Subtract]:ti(ui(2,2,Ut),Ut),[$e.Clamp]:ti(ui(3,3,Ut),Ut),[$e.Mod]:ti(ui(2,2,Ut),Ut),[$e.Pow]:ti(ui(2,2,Ut),Ut),[$e.Abs]:ti(ui(1,1,Ut),Ut),[$e.Floor]:ti(ui(1,1,Ut),Ut),[$e.Ceil]:ti(ui(1,1,Ut),Ut),[$e.Round]:ti(ui(1,1,Ut),Ut),[$e.Sin]:ti(ui(1,1,Ut),Ut),[$e.Cos]:ti(ui(1,1,Ut),Ut),[$e.Atan]:ti(ui(1,2,Ut),Ut),[$e.Sqrt]:ti(ui(1,1,Ut),Ut),[$e.Match]:ti(ui(4,1/0,ud|Ut),Ts)};function h6(n,e){if(n.length!==2)throw new Error("Expected 1 argument for get operation");const t=L0(n[1],e);if(!(t instanceof yl))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.properties.add(t.value),[t]}function d6(n,e){if(n.length!==2)throw new Error("Expected 1 argument for var operation");const t=L0(n[1],e);if(!(t instanceof yl))throw new Error("Expected a literal argument for var operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.variables.add(t.value),[t]}function f6(n,e){const t=n[0];if(n.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function ui(n,e,t){return function(i,r){const s=i[0],o=i.length-1;if(n===e){if(o!==n){const l=n===1?"":"s";throw new Error(`Expected ${n} argument${l} for operation ${s}, got ${o}`)}}else if(o<n||o>e)throw new Error(`Expected ${n} to ${e} arguments for operation ${s}, got ${o}`);const a=new Array(o);for(let l=0;l<o;++l){const c=L0(i[l+1],r);if(!WO(t,c.type)){const u=xy(t),f=xy(c.type);throw new Error(`Unexpected type for argument ${l} of ${s} operation : got ${u} but expected ${f}`)}a[l]=c}return a}}function ti(n,e){return function(t,i){const r=t[0],s=n(t,i);return new c6(e,r,...s)}}function p6(n,e){const t=n[0],i=u6[t];if(!i)throw new Error(`Unknown operator: ${t}`);return i(n,e)}function KO(){return{variables:{},properties:{},resolution:NaN}}function Gl(n,e,t){const i=L0(n,t);if(!WO(e,i.type)){const r=xy(e),s=xy(i.type);throw new Error(`Expected expression to be of type ${r}, got ${s}`)}return tu(i)}function tu(n,e){if(n instanceof yl)return function(){return n.value};const t=n.operator;switch(t){case $e.Number:case $e.String:return g6(n);case $e.Get:case $e.Var:return m6(n);case $e.Resolution:return i=>i.resolution;case $e.Any:case $e.All:case $e.Not:return y6(n);case $e.Equal:case $e.NotEqual:case $e.LessThan:case $e.LessThanOrEqualTo:case $e.GreaterThan:case $e.GreaterThanOrEqualTo:return v6(n);case $e.Multiply:case $e.Divide:case $e.Add:case $e.Subtract:case $e.Clamp:case $e.Mod:case $e.Pow:case $e.Abs:case $e.Floor:case $e.Ceil:case $e.Round:case $e.Sin:case $e.Cos:case $e.Atan:case $e.Sqrt:return _6(n);case $e.Match:return E6(n);default:throw new Error(`Unsupported operator ${t}`)}}function g6(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=tu(n.args[s]);switch(t){case $e.Number:case $e.String:return s=>{for(let o=0;o<i;++o){const a=r[o](s);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function m6(n,e){const t=n.args[0];if(!(t instanceof yl))throw new Error("Expected literal name");const i=t.value;if(typeof i!="string")throw new Error("Expected string name");switch(n.operator){case $e.Get:return r=>r.properties[i];case $e.Var:return r=>r.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function v6(n,e){const t=n.operator,i=tu(n.args[0]),r=tu(n.args[1]);switch(t){case $e.Equal:return s=>i(s)===r(s);case $e.NotEqual:return s=>i(s)!==r(s);case $e.LessThan:return s=>i(s)<r(s);case $e.LessThanOrEqualTo:return s=>i(s)<=r(s);case $e.GreaterThan:return s=>i(s)>r(s);case $e.GreaterThanOrEqualTo:return s=>i(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${t}`)}}function y6(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=tu(n.args[s]);switch(t){case $e.Any:return s=>{for(let o=0;o<i;++o)if(r[o](s))return!0;return!1};case $e.All:return s=>{for(let o=0;o<i;++o)if(!r[o](s))return!1;return!0};case $e.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${t}`)}}function _6(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=tu(n.args[s]);switch(t){case $e.Multiply:return s=>{let o=1;for(let a=0;a<i;++a)o*=r[a](s);return o};case $e.Divide:return s=>r[0](s)/r[1](s);case $e.Add:return s=>{let o=0;for(let a=0;a<i;++a)o+=r[a](s);return o};case $e.Subtract:return s=>r[0](s)-r[1](s);case $e.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case $e.Mod:return s=>r[0](s)%r[1](s);case $e.Pow:return s=>Math.pow(r[0](s),r[1](s));case $e.Abs:return s=>Math.abs(r[0](s));case $e.Floor:return s=>Math.floor(r[0](s));case $e.Ceil:return s=>Math.ceil(r[0](s));case $e.Round:return s=>Math.round(r[0](s));case $e.Sin:return s=>Math.sin(r[0](s));case $e.Cos:return s=>Math.cos(r[0](s));case $e.Atan:return i===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case $e.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${t}`)}}function E6(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=tu(n.args[r]);return r=>{const s=i[0](r);for(let o=1;o<t;o+=2)if(s===i[o](r))return i[o+1](r);return i[t-1](r)}}function w6(n){return!0}function T6(n){const e=qO(),t=S6(n,e),i=KO();return function(r,s){return i.properties=r.getPropertiesInternal(),i.resolution=s,t(i)}}function EA(n){const e=qO(),t=n.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=HT(n[o],e);const r=KO(),s=new Array(t);return function(o,a){r.properties=o.getPropertiesInternal(),r.resolution=a;for(let l=0;l<t;++l)s[l]=i[l](r);return s}}function S6(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r){const s=n[r],o="filter"in s?Gl(s.filter,kn,e):w6;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let c=0;c<l;++c)a[c]=HT(s.style[c],e)}else a=[HT(s.style,e)];i[r]={filter:o,styles:a}}return function(r){const s=[];let o=!1;for(let a=0;a<t;++a){const l=i[a].filter;if(l(r)&&!(n[a].else&&o)){o=!0;for(const c of i[a].styles){const u=c(r);u&&s.push(u)}}}return s}}function HT(n,e){const t=Lp(n,"",e),i=Ip(n,"",e),r=b6(n,e),s=x6(n,e),o=pr(n,"z-index",e),a=new Yh;return function(l){let c=!0;if(t){const u=t(l);u&&(c=!1),a.setFill(u)}if(i){const u=i(l);u&&(c=!1),a.setStroke(u)}if(r){const u=r(l);u&&(c=!1),a.setText(u)}if(s){const u=s(l);u&&(c=!1),a.setImage(u)}return o&&a.setZIndex(o(l)),c?null:a}}function Lp(n,e,t){const i=ZO(n,e+"fill-color",t);if(!i)return null;const r=new Qc;return function(s){const o=i(s);return o==="none"?null:(r.setColor(o),r)}}function Ip(n,e,t){const i=pr(n,e+"stroke-width",t),r=ZO(n,e+"stroke-color",t);if(!i&&!r)return null;const s=fl(n,e+"stroke-line-cap",t),o=fl(n,e+"stroke-line-join",t),a=YO(n,e+"stroke-line-dash",t),l=pr(n,e+"stroke-line-dash-offset",t),c=pr(n,e+"stroke-miter-limit",t),u=new od;return function(f){if(r){const p=r(f);if(p==="none")return null;u.setColor(p)}if(i&&u.setWidth(i(f)),s){const p=s(f);if(p!=="butt"&&p!=="round"&&p!=="square")throw new Error("Expected butt, round, or square line cap");u.setLineCap(p)}if(o){const p=o(f);if(p!=="bevel"&&p!=="round"&&p!=="miter")throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(p)}return a&&u.setLineDash(a(f)),l&&u.setLineDashOffset(l(f)),c&&u.setMiterLimit(c(f)),u}}function b6(n,e){const t="text-",i=fl(n,t+"value",e);if(!i)return null;const r=Lp(n,t,e),s=Lp(n,t+"background-",e),o=Ip(n,t,e),a=Ip(n,t+"background-",e),l=fl(n,t+"font",e),c=pr(n,t+"max-angle",e),u=pr(n,t+"offset-x",e),f=pr(n,t+"offset-y",e),p=Pp(n,t+"overflow",e),m=fl(n,t+"placement",e),y=pr(n,t+"repeat",e),_=I0(n,t+"scale",e),w=Pp(n,t+"rotate-with-view",e),T=pr(n,t+"rotation",e),x=fl(n,t+"align",e),C=fl(n,t+"justify",e),I=fl(n,t+"baseline",e),D=YO(n,t+"padding",e),B=new kG({});return function(N){if(B.setText(i(N)),r&&B.setFill(r(N)),s&&B.setBackgroundFill(s(N)),o&&B.setStroke(o(N)),a&&B.setBackgroundStroke(a(N)),l&&B.setFont(l(N)),c&&B.setMaxAngle(c(N)),u&&B.setOffsetX(u(N)),f&&B.setOffsetY(f(N)),p&&B.setOverflow(p(N)),m){const z=m(N);if(z!=="point"&&z!=="line")throw new Error("Expected point or line for text-placement");B.setPlacement(z)}if(y&&B.setRepeat(y(N)),_&&B.setScale(_(N)),w&&B.setRotateWithView(w(N)),T&&B.setRotation(T(N)),x){const z=x(N);if(z!=="left"&&z!=="center"&&z!=="right"&&z!=="end"&&z!=="start")throw new Error("Expected left, right, center, start, or end for text-align");B.setTextAlign(z)}if(C){const z=C(N);if(z!=="left"&&z!=="right"&&z!=="center")throw new Error("Expected left, right, or center for text-justify");B.setJustify(z)}if(I){const z=I(N);if(z!=="bottom"&&z!=="top"&&z!=="middle"&&z!=="alphabetic"&&z!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");B.setTextBaseline(z)}return D&&B.setPadding(D(N)),B}}function x6(n,e){return"icon-src"in n?C6(n,e):"shape-points"in n?R6(n,e):"circle-radius"in n?A6(n,e):null}function C6(n,e){const t="icon-",i=t+"src",r=XO(n[i],i),s=Cy(n,t+"anchor",e),o=I0(n,t+"scale",e),a=pr(n,t+"opacity",e),l=Cy(n,t+"displacement",e),c=pr(n,t+"rotation",e),u=Pp(n,t+"rotate-with-view",e),f=wA(n,t+"anchor-origin"),p=TA(n,t+"anchor-x-units"),m=TA(n,t+"anchor-y-units"),y=D6(n,t+"color"),_=I6(n,t+"cross-origin"),w=P6(n,t+"offset"),T=wA(n,t+"offset-origin"),x=Hh(n,t+"width"),C=Hh(n,t+"height"),I=L6(n,t+"size"),D=$b(n,t+"declutter"),B=new A0({src:r,anchorOrigin:f,anchorXUnits:p,anchorYUnits:m,color:y,crossOrigin:_,offset:w,offsetOrigin:T,height:C,width:x,size:I,declutterMode:D});return function(N){return a&&B.setOpacity(a(N)),l&&B.setDisplacement(l(N)),c&&B.setRotation(c(N)),u&&B.setRotateWithView(u(N)),o&&B.setScale(o(N)),s&&B.setAnchor(s(N)),B}}function R6(n,e){const t="shape-",i=t+"points",r=JO(n[i],i),s=Lp(n,t,e),o=Ip(n,t,e),a=I0(n,t+"scale",e),l=Cy(n,t+"displacement",e),c=pr(n,t+"rotation",e),u=Pp(n,t+"rotate-with-view",e),f=Hh(n,t+"radius"),p=Hh(n,t+"radius1"),m=Hh(n,t+"radius2"),y=Hh(n,t+"angle"),_=$b(n,t+"declutter-mode"),w=new C0({points:r,radius:f,radius1:p,radius2:m,angle:y,declutterMode:_});return function(T){return s&&w.setFill(s(T)),o&&w.setStroke(o(T)),l&&w.setDisplacement(l(T)),c&&w.setRotation(c(T)),u&&w.setRotateWithView(u(T)),a&&w.setScale(a(T)),w}}function A6(n,e){const t="circle-",i=Lp(n,t,e),r=Ip(n,t,e),s=pr(n,t+"radius",e),o=I0(n,t+"scale",e),a=Cy(n,t+"displacement",e),l=pr(n,t+"rotation",e),c=Pp(n,t+"rotate-with-view",e),u=$b(n,t+"declutter-mode"),f=new sg({radius:5,declutterMode:u});return function(p){return s&&f.setRadius(s(p)),i&&f.setFill(i(p)),r&&f.setStroke(r(p)),a&&f.setDisplacement(a(p)),l&&f.setRotation(l(p)),c&&f.setRotateWithView(c(p)),o&&f.setScale(o(p)),f}}function pr(n,e,t){if(!(e in n))return;const i=Gl(n[e],Ut,t);return function(r){return JO(i(r),e)}}function fl(n,e,t){if(!(e in n))return null;const i=Gl(n[e],ud,t);return function(r){return XO(i(r),e)}}function Pp(n,e,t){if(!(e in n))return null;const i=Gl(n[e],kn,t);return function(r){const s=i(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${e}`);return s}}function ZO(n,e,t){if(!(e in n))return null;const i=Gl(n[e],Hb|ud,t);return function(r){return QO(i(r),e)}}function YO(n,e,t){if(!(e in n))return null;const i=Gl(n[e],og,t);return function(r){return ag(i(r),e)}}function Cy(n,e,t){if(!(e in n))return null;const i=Gl(n[e],og,t);return function(r){const s=ag(i(r),e);if(s.length!==2)throw new Error(`Expected two numbers for ${e}`);return s}}function I0(n,e,t){if(!(e in n))return null;const i=Gl(n[e],og|Ut,t);return function(r){return O6(i(r),e)}}function Hh(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function L6(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return Bi(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function I6(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function wA(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function TA(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function P6(n,e){const t=n[e];if(t!==void 0)return ag(t,e)}function $b(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function D6(n,e){const t=n[e];if(t!==void 0)return QO(t,e)}function ag(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function XO(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function JO(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function QO(n,e){if(typeof n=="string")return n;const t=ag(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function O6(n,e){if(typeof n=="number")return n;const t=ag(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}const SA={RENDER_ORDER:"renderOrder"};class k6 extends R0{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(SA.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new ZG(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(SA.RENDER_ORDER,e)}setStyle(e){this.style_=M6(e),this.styleFunction_=e===null?void 0:PG(this.style_),this.changed()}}function M6(n){if(n===void 0)return DG;if(!n)return null;if(typeof n=="function"||n instanceof Yh)return n;if(!Array.isArray(n))return EA([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof Yh){const r=new Array(e);for(let s=0;s<e;++s){const o=n[s];if(!(o instanceof Yh))throw new Error("Expected a list of style instances");r[s]=o}return r}if("style"in t){const r=new Array(e);for(let s=0;s<e;++s){const o=n[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");r[s]=o}return T6(r)}return EA(n)}const ht={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ym=[ht.FILL],_l=[ht.STROKE],Bc=[ht.BEGIN_PATH],bA=[ht.CLOSE_PATH];class ek{drawCustom(e,t,i,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}class lg extends ek{constructor(e,t,i,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)r[0]=e[a],r[1]=e[a+1],sd(i,r)&&(s[o++]=r[0],s[o++]=r[1]);return o}appendFlatLineCoordinates(e,t,i,r,s,o){const a=this.coordinates;let l=a.length;const c=this.getBufferedMaxExtent();o&&(t+=r);let u=e[t],f=e[t+1];const p=this.tmpCoordinate_;let m=!0,y,_,w;for(y=t+r;y<i;y+=r)p[0]=e[y],p[1]=e[y+1],w=PT(c,p),w!==_?(m&&(a[l++]=u,a[l++]=f,m=!1),a[l++]=p[0],a[l++]=p[1]):w===ln.INTERSECTING?(a[l++]=p[0],a[l++]=p[1],m=!1):m=!0,u=p[0],f=p[1],_=w;return(s&&m||y===t+r)&&(a[l++]=u,a[l++]=f),l}drawCustomCoordinates_(e,t,i,r,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],c=this.appendFlatLineCoordinates(e,t,l,r,!1,!1);s.push(c),t=l}return t}drawCustom(e,t,i,r){this.beginGeometry(e,t);const s=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,c,u,f,p;switch(s){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),f=[];const m=e.getEndss();p=0;for(let y=0,_=m.length;y<_;++y){const w=[];p=this.drawCustomCoordinates_(l,p,m[y],o,w),f.push(w)}this.instructions.push([ht.CUSTOM,a,f,e,i,NT]),this.hitDetectionInstructions.push([ht.CUSTOM,a,f,e,r||i,NT]);break;case"Polygon":case"MultiLineString":u=[],l=s=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),p=this.drawCustomCoordinates_(l,0,e.getEnds(),o,u),this.instructions.push([ht.CUSTOM,a,u,e,i,Tp]),this.hitDetectionInstructions.push([ht.CUSTOM,a,u,e,r||i,Tp]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([ht.CUSTOM,a,c,e,i,vl]),this.hitDetectionInstructions.push([ht.CUSTOM,a,c,e,r||i,vl]);break;case"MultiPoint":l=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(l,o),c>a&&(this.instructions.push([ht.CUSTOM,a,c,e,i,vl]),this.hitDetectionInstructions.push([ht.CUSTOM,a,c,e,r||i,vl]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),c=this.coordinates.length,this.instructions.push([ht.CUSTOM,a,c,e,i]),this.hitDetectionInstructions.push([ht.CUSTOM,a,c,e,r||i]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[ht.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ht.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let r,s,o=-1;for(t=0;t<i;++t)r=e[t],s=r[0],s==ht.END_GEOMETRY?o=t:s==ht.BEGIN_GEOMETRY&&(r[2]=t,cz(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const r=e.getColor();i.fillStyle=so(r||hr)}else i.fillStyle=void 0;if(t){const r=t.getColor();i.strokeStyle=so(r||Cp);const s=t.getLineCap();i.lineCap=s!==void 0?s:ld;const o=t.getLineDash();i.lineDash=o?o.slice():sa;const a=t.getLineDashOffset();i.lineDashOffset=a||oa;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:cd;const c=t.getWidth();i.lineWidth=c!==void 0?c:Ap;const u=t.getMiterLimit();i.miterLimit=u!==void 0?u:xp,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[ht.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(!0),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[ht.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,r=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,c=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=r||s!=e.currentLineDash&&!lu(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=c)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=r,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=c)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[ht.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=lO(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Vc(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class N6 extends lg{constructor(e,t,i,r){super(e,t,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),r=e.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,r);this.instructions.push([ht.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ht.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),r=e.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,r);this.instructions.push([ht.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ht.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),r=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class F6 extends lg{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinates_(e,t,i,r){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,r,!1,!1),a=[ht.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t){const i=this.state,r=i.strokeStyle,s=i.lineWidth;if(r===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([ht.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,sa,oa],Bc);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(_l),this.endGeometry(t)}drawMultiLineString(e,t){const i=this.state,r=i.strokeStyle,s=i.lineWidth;if(r===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([ht.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,sa,oa],Bc);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let c=0;for(let u=0,f=o.length;u<f;++u)c=this.drawFlatCoordinates_(a,c,o[u],l);this.hitDetectionInstructions.push(_l),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(_l),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(_l),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Bc)}}class xA extends lg{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinatess_(e,t,i,r){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(Bc),this.hitDetectionInstructions.push(Bc);for(let c=0;c<l;++c){const u=i[c],f=this.coordinates.length,p=this.appendFlatLineCoordinates(e,t,u,r,!0,!a),m=[ht.MOVE_TO_LINE_TO,f,p];this.instructions.push(m),this.hitDetectionInstructions.push(m),a&&(this.instructions.push(bA),this.hitDetectionInstructions.push(bA)),t=u}return o&&(this.instructions.push(Ym),this.hitDetectionInstructions.push(Ym)),a&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),t}drawCircle(e,t){const i=this.state,r=i.fillStyle,s=i.strokeStyle;if(r===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_FILL_STYLE,hr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,sa,oa]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const c=[ht.CIRCLE,l];this.instructions.push(Bc,c),this.hitDetectionInstructions.push(Bc,c),i.fillStyle!==void 0&&(this.instructions.push(Ym),this.hitDetectionInstructions.push(Ym)),i.strokeStyle!==void 0&&(this.instructions.push(_l),this.hitDetectionInstructions.push(_l)),this.endGeometry(t)}drawPolygon(e,t){const i=this.state,r=i.fillStyle,s=i.strokeStyle;if(r===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_FILL_STYLE,hr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,sa,oa]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const i=this.state,r=i.fillStyle,s=i.strokeStyle;if(r===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_FILL_STYLE,hr]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ht.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,sa,oa]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let c=0;for(let u=0,f=o.length;u<f;++u)c=this.drawFlatCoordinatess_(a,c,o[u],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,r=t.length;i<r;++i)t[i]=Pc(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}function B6(n,e,t,i,r){const s=[];let o=t,a=0,l=e.slice(t,2);for(;a<n&&o+r<i;){const[c,u]=l.slice(-2),f=e[o+r],p=e[o+r+1],m=Math.sqrt((f-c)*(f-c)+(p-u)*(p-u));if(a+=m,a>=n){const y=(n-a+m)/m,_=Ir(c,f,y),w=Ir(u,p,y);l.push(_,w),s.push(l),l=[_,w],a==n&&(o+=r),a=0}else if(a<n)l.push(e[o+r],e[o+r+1]),o+=r;else{const y=m-a,_=Ir(c,f,y/m),w=Ir(u,p,y/m);l.push(_,w),s.push(l),l=[_,w],a=0,o+=r}}return a>0&&s.push(l),s}function U6(n,e,t,i,r){let s=t,o=t,a=0,l=0,c=t,u,f,p,m,y,_,w,T,x,C;for(f=t;f<i;f+=r){const I=e[f],D=e[f+1];y!==void 0&&(x=I-y,C=D-_,m=Math.sqrt(x*x+C*C),w!==void 0&&(l+=p,u=Math.acos((w*x+T*C)/(p*m)),u>n&&(l>a&&(a=l,s=c,o=f),l=0,c=f-r)),p=m,w=x,T=C),y=I,_=D}return l+=m,l>a?[c,f]:[s,o]}const Ry={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class z6 extends lg{constructor(e,t,i,r){super(e,t,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[hr]={fillStyle:hr},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const i=this.textFillState_,r=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!r)return;const o=this.coordinates;let a=o.length;const l=e.getType();let c=null,u=e.getStride();if(s.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!Ji(this.getBufferedMaxExtent(),e.getExtent()))return;let f;if(c=e.getFlatCoordinates(),l=="LineString")f=[c.length];else if(l=="MultiLineString")f=e.getEnds();else if(l=="Polygon")f=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const _=e.getEndss();f=[];for(let w=0,T=_.length;w<T;++w)f.push(_[w][0])}this.beginGeometry(e,t);const p=s.repeat,m=p?void 0:s.textAlign;let y=0;for(let _=0,w=f.length;_<w;++_){let T;p?T=B6(p*this.resolution,c,y,f[_],u):T=[c.slice(y,f[_])];for(let x=0,C=T.length;x<C;++x){const I=T[x];let D=0,B=I.length;if(m==null){const z=U6(s.maxAngle,I,0,I.length,2);D=z[0],B=z[1]}for(let z=D;z<B;z+=u)o.push(I[z],I[z+1]);const N=o.length;y=f[_],this.drawChars_(a,N),a=N}}this.endGeometry(t)}else{let f=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),s.overflow||f.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const T=e.getFlatInteriorPoints();c=[];for(let x=0,C=T.length;x<C;x+=3)s.overflow||f.push(T[x+2]/this.resolution),c.push(T[x],T[x+1]);if(c.length===0)return;u=2;break}const p=this.appendFlatPointCoordinates(c,u);if(p===a)return;if(f&&(p-a)/2!==c.length/u){let T=a/2;f=f.filter((x,C)=>{const I=o[(T+C)*2]===c[C*u]&&o[(T+C)*2+1]===c[C*u+1];return I||--T,I})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&this.updateFillStyle(this.state,this.createFill),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let m=s.padding;if(m!=Fc&&(s.scale[0]<0||s.scale[1]<0)){let T=s.padding[0],x=s.padding[1],C=s.padding[2],I=s.padding[3];s.scale[0]<0&&(x=-x,I=-I),s.scale[1]<0&&(T=-T,C=-C),m=[T,x,C,I]}const y=this.pixelRatio;this.instructions.push([ht.DRAW_IMAGE,a,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,m==Fc?Fc:m.map(function(T){return T*y}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const _=1/y,w=this.state.fillStyle;s.backgroundFill&&(this.state.fillStyle=hr,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([ht.DRAW_IMAGE,a,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,void 0,this.declutterImageWithText_,m,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?hr:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),s.backgroundFill&&(this.state.fillStyle=w,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||Rp,justify:t.justify,textBaseline:t.textBaseline||Ty,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,c=Ry[r.textBaseline],u=this.textOffsetY_*l,f=this.text_,p=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([ht.DRAW_CHARS,e,t,c,r.overflow,a,r.maxAngle,l,u,s,p*l,f,o,1]),this.hitDetectionInstructions.push([ht.DRAW_CHARS,e,t,c,r.overflow,a&&hr,r.maxAngle,l,u,s,p*l,f,o,1/l])}setTextStyle(e,t){let i,r,s;if(!e)this.text_="";else{const o=e.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=so(o.getColor()||hr)):(r=null,this.textFillState_=r);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const y=a.getLineDash(),_=a.getLineDashOffset(),w=a.getWidth(),T=a.getMiterLimit();s.lineCap=a.getLineCap()||ld,s.lineDash=y?y.slice():sa,s.lineDashOffset=_===void 0?oa:_,s.lineJoin=a.getLineJoin()||cd,s.lineWidth=w===void 0?Ap:w,s.miterLimit=T===void 0?xp:T,s.strokeStyle=so(a.getColor()||Cp)}i=this.textState_;const l=e.getFont()||FO;CG(l);const c=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||Ty,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Fc,i.scale=c===void 0?[1,1]:c;const u=e.getOffsetX(),f=e.getOffsetY(),p=e.getRotateWithView(),m=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=p===void 0?!1:p,this.textRotation_=m===void 0?0:m,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Mt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r?typeof r.fillStyle=="string"?r.fillStyle:"|"+Mt(r.fillStyle):""}this.declutterImageWithText_=t}}const G6={Circle:xA,Default:lg,Image:N6,LineString:F6,Polygon:xA,Text:z6};class CA{constructor(e,t,i,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const r in i){const s=i[r].finish();e[t][r]=s}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let s=r[t];if(s===void 0){const o=G6[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=s}return s}}class tk extends ig{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return Et()}getData(e){return null}prepareFrame(e){return Et()}renderFrame(e,t){return Et()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(r,s)=>{const o=this.loadedTileCallback.bind(this,i,r);return e.forEachLoadedTile(t,r,s,o)}}forEachFeatureAtCoordinate(e,t,i,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===gi.LOADED||t.getState()===gi.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=gi.LOADED&&t!=gi.ERROR&&e.addEventListener(yt.CHANGE,this.boundHandleImageChange_),t==gi.IDLE&&(e.load(),t=e.getState()),t==gi.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class up extends Ul{constructor(e,t,i,r){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=r}}let kh=null;function H6(){kh=pn(1,1,void 0,{willReadFrequently:!0})}class $6 extends tk{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Un(),this.pixelTransform=Un(),this.inversePixelTransform=Un(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){kh||H6(),kh.clearRect(0,0,1,1);let r;try{kh.drawImage(e,t,i,1,1,0,0,1,1),r=kh.getImageData(0,0,1,1).data}catch{return kh=null,null}return r}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!i||e&&e.style.backgroundColor&&lu(bp(e.style.backgroundColor),bp(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=pn();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const r=zl(i),s=w0(i),o=E0(i),a=_0(i);Xi(t.coordinateToPixelTransform,r),Xi(t.coordinateToPixelTransform,s),Xi(t.coordinateToPixelTransform,o),Xi(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Xi(l,r),Xi(l,s),Xi(l,o),Xi(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){const s=new up(e,this.inversePixelTransform,i,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(ur.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(ur.POSTRENDER,e,t)}getRenderTransform(e,t,i,r,s,o,a){const l=s/2,c=o/2,u=r/t,f=-u,p=-e[0]+a,m=-e[1];return Ls(this.tempTransform,l,c,u,f,-i,p,m)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function V6(n,e,t,i,r,s,o,a,l,c,u,f){let p=n[e],m=n[e+1],y=0,_=0,w=0,T=0;function x(){y=p,_=m,e+=i,p=n[e],m=n[e+1],T+=w,w=Math.sqrt((p-y)*(p-y)+(m-_)*(m-_))}do x();while(e<t-i&&T+w<s);let C=w===0?0:(s-T)/w;const I=Ir(y,p,C),D=Ir(_,m,C),B=e-i,N=T,z=s+a*l(c,r,u);for(;e<t-i&&T+w<z;)x();C=w===0?0:(z-T)/w;const Z=Ir(y,p,C),q=Ir(_,m,C);let H;if(f){const ie=[I,D,Z,q];_O(ie,0,4,2,f,ie,ie),H=ie[0]>ie[2]}else H=I>Z;const Y=Math.PI,ee=[],le=B+i===e;e=B,w=0,T=N,p=n[e],m=n[e+1];let W;if(le){x(),W=Math.atan2(m-_,p-y),H&&(W+=W>0?-Y:Y);const ie=(Z+I)/2,ne=(q+D)/2;return ee[0]=[ie,ne,(z-s)/2,W,r],ee}r=r.replace(/\n/g," ");for(let ie=0,ne=r.length;ie<ne;){x();let J=Math.atan2(m-_,p-y);if(H&&(J+=J>0?-Y:Y),W!==void 0){let fe=J-W;if(fe+=fe>Y?-2*Y:fe<-Y?2*Y:0,Math.abs(fe)>o)return null}W=J;const ce=ie;let se=0;for(;ie<ne;++ie){const fe=H?ne-ie-1:ie,pe=a*l(c,r[fe],u);if(e+i<t&&T+w<s+se+pe/2)break;se+=pe}if(ie===ce)continue;const te=H?r.substring(ne-ce,ne-ie):r.substring(ce,ie);C=w===0?0:(s+se/2-T)/w;const Q=Ir(y,p,C),_e=Ir(_,m,C);ee.push([Q,_e,se/2,J,te]),s+=se}return ee}const lh=wo(),nl=[],$o=[],Vo=[],rl=[];function RA(n){return n[3].declutterBox}const AA=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function ew(n,e){return e==="start"?e=AA.test(n)?"right":"left":e==="end"&&(e=AA.test(n)?"left":"right"),Ry[e]}function j6(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}class W6{constructor(e,t,i,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Un(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,i,r){const s=e+t+i+r;if(this.labels_[s])return this.labels_[s];const o=r?this.strokeStates[r]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],c=this.pixelRatio,u=[l.scale[0]*c,l.scale[1]*c],f=Array.isArray(e),p=l.justify?Ry[l.justify]:ew(Array.isArray(e)?e[0]:e,l.textAlign||Rp),m=r&&o.lineWidth?o.lineWidth:0,y=f?e:e.split(`
`).reduce(j6,[]),{width:_,height:w,widths:T,heights:x,lineWidths:C}=AG(l,y),I=_+m,D=[],B=(I+2)*u[0],N=(w+m)*u[1],z={width:B<0?Math.floor(B):Math.ceil(B),height:N<0?Math.floor(N):Math.ceil(N),contextInstructions:D};(u[0]!=1||u[1]!=1)&&D.push("scale",u),r&&(D.push("strokeStyle",o.strokeStyle),D.push("lineWidth",m),D.push("lineCap",o.lineCap),D.push("lineJoin",o.lineJoin),D.push("miterLimit",o.miterLimit),D.push("setLineDash",[o.lineDash]),D.push("lineDashOffset",o.lineDashOffset)),i&&D.push("fillStyle",a.fillStyle),D.push("textBaseline","middle"),D.push("textAlign","center");const Z=.5-p;let q=p*I+Z*m;const H=[],Y=[];let ee=0,le=0,W=0,ie=0,ne;for(let J=0,ce=y.length;J<ce;J+=2){const se=y[J];if(se===`
`){le+=ee,ee=0,q=p*I+Z*m,++ie;continue}const te=y[J+1]||l.font;te!==ne&&(r&&H.push("font",te),i&&Y.push("font",te),ne=te),ee=Math.max(ee,x[W]);const Q=[se,q+Z*T[W]+p*(T[W]-C[ie]),.5*(m+ee)+le];q+=T[W],r&&H.push("strokeText",Q),i&&Y.push("fillText",Q),++W}return Array.prototype.push.apply(D,H),Array.prototype.push.apply(D,Y),this.labels_[s]=z,z}replayTextBackground_(e,t,i,r,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,r,s,o,a,l,c,u,f,p,m,y,_,w){a*=p[0],l*=p[1];let T=i-a,x=r-l;const C=s+c>e?e-c:s,I=o+u>t?t-u:o,D=y[3]+C*p[0]+y[1],B=y[0]+I*p[1]+y[2],N=T-y[3],z=x-y[0];(_||f!==0)&&(nl[0]=N,rl[0]=N,nl[1]=z,$o[1]=z,$o[0]=N+D,Vo[0]=$o[0],Vo[1]=z+B,rl[1]=Vo[1]);let Z;return f!==0?(Z=Ls(Un(),i,r,1,1,f,-i,-r),Xi(Z,nl),Xi(Z,$o),Xi(Z,Vo),Xi(Z,rl),Al(Math.min(nl[0],$o[0],Vo[0],rl[0]),Math.min(nl[1],$o[1],Vo[1],rl[1]),Math.max(nl[0],$o[0],Vo[0],rl[0]),Math.max(nl[1],$o[1],Vo[1],rl[1]),lh)):Al(Math.min(N,N+D),Math.min(z,z+B),Math.max(N,N+D),Math.max(z,z+B),lh),m&&(T=Math.round(T),x=Math.round(x)),{drawImageX:T,drawImageY:x,drawImageW:C,drawImageH:I,originX:c,originY:u,declutterBox:{minX:lh[0],minY:lh[1],maxX:lh[2],maxY:lh[3],value:w},canvasTransform:Z,scale:p}}replayImageOrLabel_(e,t,i,r,s,o,a){const l=!!(o||a),c=r.declutterBox,u=e.canvas,f=a?a[2]*r.scale[0]/2:0;return c.minX-f<=u.width/t&&c.maxX+f>=0&&c.minY-f<=u.height/t&&c.maxY+f>=0&&(l&&this.replayTextBackground_(e,nl,$o,Vo,rl,o,a),LG(e,r.canvasTransform,s,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){if(this.alignFill_){const t=Xi(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,r){const s=this.textStates[t],o=this.createLabel(e,t,r,i),a=this.strokeStates[i],l=this.pixelRatio,c=ew(Array.isArray(e)?e[0]:e,s.textAlign||Rp),u=Ry[s.textBaseline||Ty],f=a&&a.lineWidth?a.lineWidth:0,p=o.width/l-2*s.scale[0],m=c*p+2*(.5-c)*f,y=u*o.height/l+2*(.5-u)*f;return{label:o,anchorX:m,anchorY:y}}execute_(e,t,i,r,s,o,a,l){let c;this.pixelCoordinates_&&lu(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Tl(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Ez(this.renderedTransform_,i));let u=0;const f=r.length;let p=0,m,y,_,w,T,x,C,I,D,B,N,z,Z=0,q=0,H=null,Y=null;const ee=this.coordinateCache_,le=this.viewRotation_,W=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,ie={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:le},ne=this.instructions!=r||this.overlaps?0:200;let J,ce,se,te;for(;u<f;){const Q=r[u];switch(Q[0]){case ht.BEGIN_GEOMETRY:J=Q[1],te=Q[3],J.getGeometry()?a!==void 0&&!Ji(a,te.getExtent())?u=Q[2]+1:++u:u=Q[2];break;case ht.BEGIN_PATH:Z>ne&&(this.fill_(e),Z=0),q>ne&&(e.stroke(),q=0),!Z&&!q&&(e.beginPath(),w=NaN,T=NaN),++u;break;case ht.CIRCLE:p=Q[1];const fe=c[p],pe=c[p+1],Ce=c[p+2],xe=c[p+3],Le=Ce-fe,je=xe-pe,Ke=Math.sqrt(Le*Le+je*je);e.moveTo(fe+Ke,pe),e.arc(fe,pe,Ke,0,2*Math.PI,!0),++u;break;case ht.CLOSE_PATH:e.closePath(),++u;break;case ht.CUSTOM:p=Q[1],m=Q[2];const lt=Q[3],ct=Q[4],Ht=Q.length==6?Q[5]:void 0;ie.geometry=lt,ie.feature=J,u in ee||(ee[u]=[]);const Vt=ee[u];Ht?Ht(c,p,m,2,Vt):(Vt[0]=c[p],Vt[1]=c[p+1],Vt.length=2),ct(Vt,ie),++u;break;case ht.DRAW_IMAGE:p=Q[1],m=Q[2],I=Q[3],y=Q[4],_=Q[5];let ii=Q[6];const Yt=Q[7],k=Q[8],X=Q[9],ve=Q[10];let Pe=Q[11];const Ae=Q[12];let Ve=Q[13];const ze=Q[14],vt=Q[15];if(!I&&Q.length>=20){D=Q[19],B=Q[20],N=Q[21],z=Q[22];const tn=this.drawLabelWithPointPlacement_(D,B,N,z);I=tn.label,Q[3]=I;const cs=Q[23];y=(tn.anchorX-cs)*this.pixelRatio,Q[4]=y;const mn=Q[24];_=(tn.anchorY-mn)*this.pixelRatio,Q[5]=_,ii=I.height,Q[6]=ii,Ve=I.width,Q[13]=Ve}let xt;Q.length>25&&(xt=Q[25]);let It,rt,Ot;Q.length>17?(It=Q[16],rt=Q[17],Ot=Q[18]):(It=Fc,rt=!1,Ot=!1),ve&&W?Pe+=le:!ve&&!W&&(Pe-=le);let G=0;for(;p<m;p+=2){if(xt&&xt[G++]<Ve/this.pixelRatio)continue;const tn=this.calculateImageOrLabelDimensions_(I.width,I.height,c[p],c[p+1],Ve,ii,y,_,k,X,Pe,Ae,s,It,rt||Ot,J),cs=[e,t,I,tn,Yt,rt?H:null,Ot?Y:null];if(l){if(ze==="none")continue;if(ze==="obstacle"){l.insert(tn.declutterBox);continue}else{let mn,zn;if(vt){const zi=m-p;if(!vt[zi]){vt[zi]=cs;continue}if(mn=vt[zi],delete vt[zi],zn=RA(mn),l.collides(zn))continue}if(l.collides(tn.declutterBox))continue;mn&&(l.insert(zn),this.replayImageOrLabel_.apply(this,mn)),l.insert(tn.declutterBox)}}this.replayImageOrLabel_.apply(this,cs)}++u;break;case ht.DRAW_CHARS:const U=Q[1],K=Q[2],re=Q[3],Re=Q[4];z=Q[5];const Me=Q[6],ot=Q[7],Nt=Q[8];N=Q[9];const tt=Q[10];D=Q[11],B=Q[12];const Di=[Q[13],Q[13]],si=this.textStates[B],ji=si.font,Qi=[si.scale[0]*ot,si.scale[1]*ot];let en;ji in this.widths_?en=this.widths_[ji]:(en={},this.widths_[ji]=en);const Fs=LO(c,U,K,2),Yl=Math.abs(Qi[0])*dA(ji,D,en);if(Re||Yl<=Fs){const tn=this.textStates[B].textAlign,cs=(Fs-Yl)*ew(D,tn),mn=V6(c,U,K,2,D,cs,Me,Math.abs(Qi[0]),dA,ji,en,W?0:this.viewRotation_);e:if(mn){const zn=[];let zi,Ur,Bs,Oi,xn;if(N)for(zi=0,Ur=mn.length;zi<Ur;++zi){xn=mn[zi],Bs=xn[4],Oi=this.createLabel(Bs,B,"",N),y=xn[2]+(Qi[0]<0?-tt:tt),_=re*Oi.height+(.5-re)*2*tt*Qi[1]/Qi[0]-Nt;const hi=this.calculateImageOrLabelDimensions_(Oi.width,Oi.height,xn[0],xn[1],Oi.width,Oi.height,y,_,0,0,xn[3],Di,!1,Fc,!1,J);if(l&&l.collides(hi.declutterBox))break e;zn.push([e,t,Oi,hi,1,null,null])}if(z)for(zi=0,Ur=mn.length;zi<Ur;++zi){xn=mn[zi],Bs=xn[4],Oi=this.createLabel(Bs,B,z,""),y=xn[2],_=re*Oi.height-Nt;const hi=this.calculateImageOrLabelDimensions_(Oi.width,Oi.height,xn[0],xn[1],Oi.width,Oi.height,y,_,0,0,xn[3],Di,!1,Fc,!1,J);if(l&&l.collides(hi.declutterBox))break e;zn.push([e,t,Oi,hi,1,null,null])}l&&l.load(zn.map(RA));for(let hi=0,nt=zn.length;hi<nt;++hi)this.replayImageOrLabel_.apply(this,zn[hi])}}++u;break;case ht.END_GEOMETRY:if(o!==void 0){J=Q[1];const tn=o(J,te);if(tn)return tn}++u;break;case ht.FILL:ne?Z++:this.fill_(e),++u;break;case ht.MOVE_TO_LINE_TO:for(p=Q[1],m=Q[2],ce=c[p],se=c[p+1],x=ce+.5|0,C=se+.5|0,(x!==w||C!==T)&&(e.moveTo(ce,se),w=x,T=C),p+=2;p<m;p+=2)ce=c[p],se=c[p+1],x=ce+.5|0,C=se+.5|0,(p==m-2||x!==w||C!==T)&&(e.lineTo(ce,se),w=x,T=C);++u;break;case ht.SET_FILL_STYLE:H=Q,this.alignFill_=Q[2],Z&&(this.fill_(e),Z=0,q&&(e.stroke(),q=0)),e.fillStyle=Q[1],++u;break;case ht.SET_STROKE_STYLE:Y=Q,q&&(e.stroke(),q=0),this.setStrokeStyle_(e,Q),++u;break;case ht.STROKE:ne?q++:e.stroke(),++u;break;default:++u;break}}Z&&this.fill_(e),q&&e.stroke()}execute(e,t,i,r,s,o){this.viewRotation_=r,this.execute_(e,t,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,i,r,s){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,r,s)}}const tw=["Polygon","Circle","LineString","Image","Text","Default"];class LA{constructor(e,t,i,r,s,o){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Un(),this.createExecutors_(s)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e){for(const t in e){let i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);const r=e[t];for(const s in r){const o=r[s];i[s]=new W6(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let r=0,s=e.length;r<s;++r)if(e[r]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,r,s,o){r=Math.round(r);const a=r*2+1,l=Ls(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-i,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=pn(a,a,void 0,{willReadFrequently:!0}));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):c||u.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=wo(),cp(f,e),Vc(f,t*(this.renderBuffer_+r),f));const p=q6(r);let m;function y(D,B){const N=u.getImageData(0,0,a,a).data;for(let z=0,Z=p.length;z<Z;z++)if(N[p[z]]>0){if(!o||m!=="Image"&&m!=="Text"||o.includes(D)){const q=(p[z]-3)/4,H=r-q%a,Y=r-(q/a|0),ee=s(D,B,H*H+Y*Y);if(ee)return ee}u.clearRect(0,0,a,a);break}}const _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(Cl);let w,T,x,C,I;for(w=_.length-1;w>=0;--w){const D=_[w].toString();for(x=this.executorsByZIndex_[D],T=tw.length-1;T>=0;--T)if(m=tw[T],C=x[m],C!==void 0&&(I=C.executeHitDetection(u,l,i,y,f),I))return I}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],r=t[1],s=t[2],o=t[3],a=[i,r,i,o,s,o,s,r];return Tl(a,0,8,2,e,a),a}isEmpty(){return m0(this.executorsByZIndex_)}execute(e,t,i,r,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(Cl),this.maxExtent_&&(e.save(),this.clip(e,i)),o=o||tw;let c,u,f,p,m,y;for(a&&l.reverse(),c=0,u=l.length;c<u;++c){const _=l[c].toString();for(m=this.executorsByZIndex_[_],f=0,p=o.length;f<p;++f){const w=o[f];y=m[w],y!==void 0&&y.execute(e,t,i,r,s,a)}}this.maxExtent_&&e.restore()}}const iw={};function q6(n){if(iw[n]!==void 0)return iw[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let s=0;s<=n;++s)for(let o=0;o<=n;++o){const a=s*s+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+s)*e+(n+o))*4+3),s>0&&l.push(((n-s)*e+(n+o))*4+3),o>0&&(l.push(((n+s)*e+(n-o))*4+3),s>0&&l.push(((n-s)*e+(n-o))*4+3))}const r=[];for(let s=0,o=i.length;s<o;++s)i[s]&&r.push(...i[s]);return iw[n]=r,r}class K6 extends ek{constructor(e,t,i,r,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?Tb(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Un()}drawImages_(e,t,i,r){if(!this.image_)return;const s=Tl(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let u=0,f=s.length;u<f;u+=2){const p=s[u]-this.imageAnchorX_,m=s[u+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const y=p+this.imageAnchorX_,_=m+this.imageAnchorY_;Ls(a,y,_,1,1,c,-y,-_),o.save(),o.transform.apply(o,a),o.translate(y,_),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,m,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Tl(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=r){const l=s[t]+this.textOffsetX_,c=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(e,t,i,r,s){const o=this.context_,a=Tl(e,t,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return s&&o.closePath(),i}drawRings_(e,t,i,r){for(let s=0,o=i.length;s<o;++s)t=this.moveToLineTo_(e,t,i[s],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ji(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=nG(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],s=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ji(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Ji(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,c=o.length;l<c;++l)s=this.moveToLineTo_(r,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ji(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Ji(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const c=s[a];r=this.drawRings_(i,r,c,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),lu(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:Rp;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:so(i||hr)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),c=t.getMiterLimit(),u=s||sa;this.strokeState_={lineCap:r!==void 0?r:ld,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(o||oa)*this.pixelRatio_,lineJoin:a!==void 0?a:cd,lineWidth:(l!==void 0?l:Ap)*this.pixelRatio_,miterLimit:c!==void 0?c:xp,strokeStyle:so(i||Cp)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const m=t.getColor();this.textFillState_={fillStyle:so(m||hr)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const m=i.getColor(),y=i.getLineCap(),_=i.getLineDash(),w=i.getLineDashOffset(),T=i.getLineJoin(),x=i.getWidth(),C=i.getMiterLimit();this.textStrokeState_={lineCap:y!==void 0?y:ld,lineDash:_||sa,lineDashOffset:w||oa,lineJoin:T!==void 0?T:cd,lineWidth:x!==void 0?x:Ap,miterLimit:C!==void 0?C:xp,strokeStyle:so(m||Cp)}}const r=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),c=e.getScaleArray(),u=e.getText(),f=e.getTextAlign(),p=e.getTextBaseline();this.textState_={font:r!==void 0?r:FO,textAlign:f!==void 0?f:Rp,textBaseline:p!==void 0?p:Ty},this.text_=u!==void 0?Array.isArray(u)?u.reduce((m,y,_)=>m+=_%2?" ":y,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const Sl=.5;function Z6(n,e,t,i,r,s,o){const a=n[0]*Sl,l=n[1]*Sl,c=pn(a,l);c.imageSmoothingEnabled=!1;const u=c.canvas,f=new K6(c,Sl,r,null,o),p=t.length,m=Math.floor((256*256*256-1)/p),y={};for(let w=1;w<=p;++w){const T=t[w-1],x=T.getStyleFunction()||i;if(!x)continue;let C=x(T,s);if(!C)continue;Array.isArray(C)||(C=[C]);const D=(w*m).toString(16).padStart(7,"#00000");for(let B=0,N=C.length;B<N;++B){const z=C[B],Z=z.getGeometryFunction()(T);if(!Z||!Ji(r,Z.getExtent()))continue;const q=z.clone(),H=q.getFill();H&&H.setColor(D);const Y=q.getStroke();Y&&(Y.setColor(D),Y.setLineDash(null)),q.setText(void 0);const ee=z.getImage();if(ee){const ne=ee.getImageSize();if(!ne)continue;const J=pn(ne[0],ne[1],void 0,{alpha:!1}),ce=J.canvas;J.fillStyle=D,J.fillRect(0,0,ce.width,ce.height),q.setImage(new A0({img:ce,anchor:ee.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:ee.getOrigin(),opacity:1,size:ee.getSize(),scale:ee.getScale(),rotation:ee.getRotation(),rotateWithView:ee.getRotateWithView()}))}const le=q.getZIndex()||0;let W=y[le];W||(W={},y[le]=W,W.Polygon=[],W.Circle=[],W.LineString=[],W.Point=[]);const ie=Z.getType();if(ie==="GeometryCollection"){const ne=Z.getGeometriesArrayRecursive();for(let J=0,ce=ne.length;J<ce;++J){const se=ne[J];W[se.getType().replace("Multi","")].push(se,q)}}else W[ie.replace("Multi","")].push(Z,q)}}const _=Object.keys(y).map(Number).sort(Cl);for(let w=0,T=_.length;w<T;++w){const x=y[_[w]];for(const C in x){const I=x[C];for(let D=0,B=I.length;D<B;D+=2){f.setStyle(I[D+1]);for(let N=0,z=e.length;N<z;++N)f.setTransform(e[N]),f.drawGeometry(I[D])}}}return c.getImageData(0,0,u.width,u.height)}function Y6(n,e,t){const i=[];if(t){const r=Math.floor(Math.round(n[0])*Sl),s=Math.floor(Math.round(n[1])*Sl),o=(Ii(r,0,t.width-1)+Ii(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],u=t.data[o+2]+256*(l+256*a),f=Math.floor((256*256*256-1)/e.length);u&&u%f===0&&i.push(e[u/f-1])}return i}const X6=.5,ik={Point:o8,LineString:n8,Polygon:l8,MultiPoint:a8,MultiLineString:r8,MultiPolygon:s8,GeometryCollection:i8,Circle:e8};function J6(n,e){const t=Q6(n,e);return t*t}function Q6(n,e){return X6*n/e}function e8(n,e,t,i,r){const s=t.getFill(),o=t.getStroke();if(s||o){const l=n.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(e,i)}const a=t.getText();if(a&&a.getText()){const l=(r||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function IA(n,e,t,i,r,s,o){let a=!1;const l=t.getImage();if(l){const c=l.getImageState();c==gi.LOADED||c==gi.ERROR?l.unlistenImageChange(r):(c==gi.IDLE&&l.load(),l.listenImageChange(r),a=!0)}return t8(n,e,t,i,s,o),a}function t8(n,e,t,i,r,s){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(i,r);if(t.getRenderer())nk(n,a,t,e);else{const c=ik[a.getType()];c(n,a,t,e,s)}}function nk(n,e,t,i){if(e.getType()=="GeometryCollection"){const s=e.getGeometries();for(let o=0,a=s.length;o<a;++o)nk(n,s[o],t,i);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer())}function i8(n,e,t,i,r){const s=e.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o){const l=ik[s[o].getType()];l(n,s[o],t,i,r)}}function n8(n,e,t,i,r){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(r||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function r8(n,e,t,i,r){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(r||n).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function s8(n,e,t,i,r){const s=t.getFill(),o=t.getStroke();if(o||s){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(r||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function o8(n,e,t,i,r){const s=t.getImage(),o=t.getText();let a;if(s){if(s.getImageState()!=gi.LOADED)return;let l=n;if(r){const u=s.getDeclutterMode();if(u!=="none")if(l=r,u==="obstacle"){const f=n.getBuilder(t.getZIndex(),"Image");f.setImageStyle(s,a),f.drawPoint(e,i)}else o&&o.getText()&&(a={})}const c=l.getBuilder(t.getZIndex(),"Image");c.setImageStyle(s,a),c.drawPoint(e,i)}if(o&&o.getText()){let l=n;r&&(l=r);const c=l.getBuilder(t.getZIndex(),"Text");c.setTextStyle(o,a),c.drawText(e,i)}}function a8(n,e,t,i,r){const s=t.getImage(),o=t.getText();let a;if(s){if(s.getImageState()!=gi.LOADED)return;let l=n;if(r){const u=s.getDeclutterMode();if(u!=="none")if(l=r,u==="obstacle"){const f=n.getBuilder(t.getZIndex(),"Image");f.setImageStyle(s,a),f.drawMultiPoint(e,i)}else o&&o.getText()&&(a={})}const c=l.getBuilder(t.getZIndex(),"Image");c.setImageStyle(s,a),c.drawMultiPoint(e,i)}if(o&&o.getText()){let l=n;r&&(l=r);const c=l.getBuilder(t.getZIndex(),"Text");c.setTextStyle(o,a),c.drawText(e,i)}}function l8(n,e,t,i,r){const s=t.getFill(),o=t.getStroke();if(s||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(r||n).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}class c8 extends Eo{constructor(e){super(),this.projection=Ti(e.projection),this.attributions_=PA(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,r){t.viewResolver=i,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=PA(e),this.changed()}setState(e){this.state_=e,this.changed()}}function PA(n){return n?Array.isArray(n)?function(e){return n}:typeof n=="function"?n:function(e){return[n]}:null}let u8=!1;function h8(n,e,t,i,r,s,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,r):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=u8,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();let u;c=="json"||c=="text"?u=a.responseText:c=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):c=="arraybuffer"&&(u=a.response),u?s(e.readFeatures(u,{extent:t,featureProjection:r}),e.readProjection(u)):o()}else o()},a.onerror=o,a.send()}const Ie={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class cg extends tg{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(yt.CHANGE)}release(){this.state===Ie.ERROR&&this.setState(Ie.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==Ie.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==Ie.LOADED){e.interimTile=null;break}else e.getState()==Ie.LOADING?t=e:e.getState()==Ie.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Ie.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Et()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const r=t-i+1e3/60;return r>=this.transition_?1:$O(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class P0 extends cg{constructor(e,t,i,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Ie.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Ie.ERROR,this.unlistenImage_(),this.image_=d8(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Ie.LOADED:this.state=Ie.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Ie.ERROR&&(this.state=Ie.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Ie.IDLE&&(this.state=Ie.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=t6(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function d8(){const n=pn(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}class f8{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const r=this.points_[t+2]-this.points_[i+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class p8 extends p0{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Et()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Ls(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),aO(r,i)}forEachFeatureAtCoordinate(e,t,i,r,s,o,a,l){let c;const u=t.viewState;function f(I,D,B,N){return s.call(o,D,I?B:null,N)}const p=u.projection,m=pO(e.slice(),p),y=[[0,0]];if(p.canWrapX()&&r){const I=p.getExtent(),D=fn(I);y.push([-D,0],[D,0])}const _=t.layerStatesArray,w=_.length,T=[],x=[];for(let I=0;I<y.length;I++)for(let D=w-1;D>=0;--D){const B=_[D],N=B.layer;if(N.hasRenderer()&&Gb(B,u)&&a.call(l,N)){const z=N.getRenderer(),Z=N.getSource();if(z&&Z){const q=Z.getWrapX()?m:e,H=f.bind(null,B.managed);x[0]=q[0]+y[I][0],x[1]=q[1]+y[I][1],c=z.forEachFeatureAtCoordinate(x,t,i,H,T)}if(c)return c}}if(T.length===0)return;const C=1/T.length;return T.forEach((I,D)=>I.distanceSq+=D*C),T.sort((I,D)=>I.distanceSq-D.distanceSq),T.some(I=>c=I.callback(I.feature,I.layer,I.geometry)),c}hasFeatureAtCoordinate(e,t,i,r,s,o){return this.forEachFeatureAtCoordinate(e,t,i,r,dy,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){Et()}flushDeclutterItems(e){}scheduleExpireIconCache(e){by.canExpireCache()&&e.postRenderFunctions.push(g8)}}function g8(n,e){by.expire()}class m8 extends p8{constructor(e){super(e),this.fontChangeListenerKey_=qt(Xo,yp.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=rg+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const r=new up(e,void 0,t);i.dispatchEvent(r)}}disposeInternal(){mi(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(ur.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const c=l.layer,u=c.getSourceState();if(!Gb(l,i)||u!="ready"&&u!="undefined"){c.unrender();continue}const f=c.render(e,s);f&&(f!==s&&(this.children_.push(f),s=f),"getDeclutter"in c&&r.push(c))}this.flushDeclutterItems(e),bG(this.element_,this.children_),this.dispatchRenderEvent(ur.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let i=t.length-1;i>=0;--i)t[i].renderDeclutter(e);t.length=0}}class pl extends Ul{constructor(e,t){super(e),this.layer=t}}const nw={LAYERS:"layers"};class Ud extends GO{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(nw.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new na(i.slice(),{unique:!0}):Kt(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new na(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(mi),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(qt(e,es.ADD,this.handleLayersAdd_,this),qt(e,es.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(mi);kd(this.listenerKeys_);const t=e.getArray();for(let i=0,r=t.length;i<r;i++){const s=t[i];this.registerLayerListeners_(s),this.dispatchEvent(new pl("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[qt(e,yp.PROPERTYCHANGE,this.handleLayerChange_,this),qt(e,yt.CHANGE,this.handleLayerChange_,this)];e instanceof Ud&&t.push(qt(e,"addlayer",this.handleLayerGroupAdd_,this),qt(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Mt(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new pl("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new pl("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new pl("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=Mt(t);this.listenerKeys_[i].forEach(mi),delete this.listenerKeys_[i],this.dispatchEvent(new pl("removelayer",t)),this.changed()}getLayers(){return this.get(nw.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new pl("removelayer",i[r]))}this.set(nw.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=mr(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class Mh extends Ul{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class cl extends Mh{constructor(e,t,i,r,s,o){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ni={SINGLECLICK:"singleclick",CLICK:yt.CLICK,DBLCLICK:yt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},$T={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class v8 extends tg{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=qt(i,$T.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=qt(i,$T.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(yt.TOUCHMOVE,this.boundHandleTouchMove_,sO?{passive:!1}:!1)}emulateClick_(e){let t=new cl(Ni.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new cl(Ni.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new cl(Ni.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Ni.POINTERUP||t.type==Ni.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Ni.POINTERDOWN||t.type==Ni.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new cl(Ni.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(mi),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new cl(Ni.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(qt(i,Ni.POINTERMOVE,this.handlePointerMove_,this),qt(i,Ni.POINTERUP,this.handlePointerUp_,this),qt(this.element_,Ni.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(qt(this.element_.getRootNode(),Ni.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new cl(Ni.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new cl(Ni.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(mi(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(yt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(mi(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(mi),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ul={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},an={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Ay=1/0;class y8{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,kd(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(e){Kt(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Ay?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,r=t.length,s=t[e],o=i[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),c=this.getRightChildIndex_(e),u=c<r&&i[c]<i[l]?c:l;t[e]=t[u],i[e]=i[u],e=u}t[e]=s,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,r=this.priorities_,s=i[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)i[t]=i[a],r[t]=r[a],t=a;else break}i[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==Ay?delete this.queuedElements_[this.keyFunction_(o)]:(i[r]=l,t[r++]=o);t.length=r,i.length=r,this.heapify_()}}class _8 extends y8{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(yt.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===Ie.LOADED||i===Ie.ERROR||i===Ie.EMPTY){i!==Ie.ERROR&&t.removeEventListener(yt.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,r,s,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===Ie.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}function E8(n,e,t,i,r){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return Ay;const s=n.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class D0 extends Eo{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){UT(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&UT(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)mi(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==fy&&this.listenerKeys.push(qt(e,ul.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class w8 extends D0{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(yt.CLICK,this.handleClick_.bind(this),!1);const c=t+" "+rg+" "+x0+(this.collapsed_&&this.collapsible_?" "+uA:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),i=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!lu(t,this.renderedAttributions_)){SG(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(uA),this.collapsed_?wy(this.collapseLabel_,this.label_):wy(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class T8 extends D0{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(yt.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+rg+" "+x0,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Wm)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Fd}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Wm);!s&&i===0?this.element.classList.add(Wm):s&&i!==0&&this.element.classList.remove(Wm)}this.label_.style.transform=r}this.rotation_=i}}class S8 extends D0{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",c=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(yt.CLICK,this.handleClick_.bind(this,i),!1);const f=document.createElement("button");f.className=s,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(yt.CLICK,this.handleClick_.bind(this,-i),!1);const p=t+" "+rg+" "+x0,m=this.element;m.className=p,m.appendChild(u),m.appendChild(f),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const s=i.getConstrainedZoom(r+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:Fd})):i.setZoom(s)}}}function rk(n){n=n||{};const e=new na;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new S8(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new T8(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new w8(n.attributionOptions)),e}const DA={ACTIVE:"active"};class ug extends Eo{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(DA.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(DA.ACTIVE,e)}setMap(e){this.map_=e}}function b8(n,e,t){const i=n.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:GG,center:n.getConstrainedCenter(r)})}}function Vb(n,e,t,i){const r=n.getZoom();if(r===void 0)return;const s=n.getConstrainedZoom(r+e),o=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:Fd})}class x8 extends ug{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Ni.DBLCLICK){const i=e.originalEvent,r=e.map,s=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=r.getView();Vb(a,o,s,this.duration_),i.preventDefault(),t=!0}return!t}}class hg extends ug{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Ni.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Ni.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Ni.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Ni.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function jb(n){const e=n.length;let t=0,i=0;for(let r=0;r<e;r++)t+=n[r].clientX,i+=n[r].clientY;return{clientX:t/e,clientY:i/e}}function VT(n){const e=arguments;return function(t){let i=!0;for(let r=0,s=e.length;r<s&&(i=i&&e[r](t),!!i);++r);return i}}const C8=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},R8=function(n){const e=n.map.getTargetElement(),t=n.map.getOwnerDocument().activeElement;return e.contains(t)},sk=function(n){return n.map.getTargetElement().hasAttribute("tabindex")?R8(n):!0},A8=dy,ok=function(n){const e=n.originalEvent;return e.button==0&&!(_z&&iO&&e.ctrlKey)},ak=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},L8=function(n){const e=n.originalEvent;return iO?e.metaKey:e.ctrlKey},I8=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},lk=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},rw=function(n){const e=n.originalEvent;return Kt(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},P8=function(n){const e=n.originalEvent;return Kt(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class D8 extends hg{constructor(e){super({stopDown:g0}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:VT(ak,P8);this.condition_=e.onFocusOnly?VT(sk,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,r=t.getEventPixel(jb(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=e.map.getView();$z(s,a.getResolution()),Sb(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Fd})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class O8 extends hg{constructor(e){e=e||{},super({stopDown:g0}),this.condition_=e.condition?e.condition:C8,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!rw(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===zb)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return rw(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return rw(e)&&ok(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class k8 extends p0{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+i,r.top=Math.min(e[1],t[1])+i,r.width=Math.abs(t[0]-e[0])+i,r.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new ha([r])}getGeometry(){return this.geometry_}}const Xm={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class sw extends Ul{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class M8 extends hg{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new k8(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:ok,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const r=i[0]-t[0],s=i[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new sw(Xm.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new sw(t?Xm.BOXEND:Xm.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new sw(Xm.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class N8 extends M8{constructor(e){e=e||{};const t=e.condition?e.condition:I8;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(r),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;r=r.clone(),r.scale(a*a)}i.fitInternal(r,{duration:this.duration_,easing:Fd})}}const bc={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class F8 extends ug{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return ak(t)&&lk(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==yt.KEYDOWN){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==bc.DOWN||r==bc.LEFT||r==bc.RIGHT||r==bc.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,c=0;r==bc.DOWN?c=-a:r==bc.LEFT?l=-a:r==bc.RIGHT?l=a:c=a;const u=[l,c];Sb(u,o.getRotation()),b8(o,u,this.duration_),i.preventDefault(),t=!0}}return!t}}class B8 extends ug{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!L8(t)&&lk(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==yt.KEYDOWN||e.type==yt.KEYPRESS){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();Vb(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}class U8 extends ug{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:A8;this.condition_=e.onFocusOnly?VT(sk,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==yt.WHEEL)return!0;const i=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==yt.WHEEL&&(s=r.deltaY,mz&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=nO),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Ii(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Vb(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class z8 extends hg{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=g0),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==zb&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(jb(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class G8 extends hg{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=g0),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],r=this.targetPointers[1],s=i.clientX-r.clientX,o=i.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,c=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(jb(this.targetPointers))),l.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function H8(n){n=n||{};const e=new na,t=new f8(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new O8),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new x8({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new D8({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new z8),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new G8({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new F8),e.push(new B8({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new U8({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new N8({duration:n.zoomDuration})),e}function ck(n){if(n instanceof R0){n.setMapInternal(null);return}n instanceof Ud&&n.getLayers().forEach(ck)}function uk(n,e){if(n instanceof R0){n.setMapInternal(e);return}if(n instanceof Ud){const t=n.getLayers().getArray();for(let i=0,r=t.length;i<r;++i)uk(t[i],e)}}let $8=class extends Eo{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=V8(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:nO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Un(),this.pixelToCoordinateTransform_=Un(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||rk(),this.interactions=t.interactions||H8({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new _8(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(an.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(an.VIEW,this.handleViewChanged_),this.addChangeListener(an.SIZE,this.handleSizeChanged_),this.addChangeListener(an.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof ia)&&e.view.then(function(r){i.setView(new ia(r))}),this.controls.addEventListener(es.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(es.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(es.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(es.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(es.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(es.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){uk(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:dy,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(r){i.push(r)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(r){r instanceof Ud?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:dy,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=i.width/r[0],o=i.height/r[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/s,(a.clientY-i.top)/o]}getTarget(){return this.get(an.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return _y(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Xi(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(an.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof na){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=Yo(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Xi(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(an.SIZE)}getView(){return this.get(an.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,r){return E8(this.frameState_,e,t,i,r)}handleBrowserEvent(e,t){t=t||e.type;const i=new cl(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===$T.POINTERDOWN||i===yt.WHEEL||i===yt.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===r?r.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,s=r;if(e){const o=e.viewHints;if(o[un.ANIMATING]||o[un.INTERACTING]){const a=Date.now()-e.time>8;r=a?0:8,s=a?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(ur.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ur.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Mh(ul.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Mh(ul.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let r=0,s=i.length;r<s;++r)i[r](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)mi(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(yt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(yt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,UT(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new m8(this)),this.mapBrowserEventHandler_=new v8(this,this.moveTolerance_);for(const s in Ni)this.mapBrowserEventHandler_.addEventListener(Ni[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(yt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(yt.WHEEL,this.boundHandleBrowserEvent_,sO?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[qt(i,yt.KEYDOWN,this.handleBrowserEvent,this),qt(i,yt.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(mi(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(mi(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=qt(e,yp.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=qt(e,yt.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(mi),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new pl("addlayer",e)),this.layerGroupPropertyListenerKeys_=[qt(e,yp.PROPERTYCHANGE,this.render,this),qt(e,yt.CHANGE,this.render,this),qt(e,"addlayer",this.handleLayerAdd_,this),qt(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ck(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),r=this.frameState_;let s=null;if(t!==void 0&&aA(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:DT(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Mt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=DT(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!Nd(this.previousExtent_)&&!my(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Mh(ul.MOVESTART,this,r)),this.previousExtent_=Md(this.previousExtent_)),this.previousExtent_&&!s.viewHints[un.ANIMATING]&&!s.viewHints[un.INTERACTING]&&!my(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Mh(ul.MOVEEND,this,s)),lO(s.extent,this.previousExtent_))),this.dispatchEvent(new Mh(ul.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(ul.LOADSTART)||this.hasListener(ul.LOADEND)||this.hasListener(ur.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new pl("removelayer",t)),this.set(an.LAYERGROUP,e)}setSize(e){this.set(an.SIZE,e)}setTarget(e){this.set(an.TARGET,e)}setView(e){if(!e||e instanceof ia){this.set(an.VIEW,e);return}this.set(an.VIEW,new ia);const t=this;e.then(function(i){t.setView(new ia(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),s=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[s,o],!aA(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&gO("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!lu(t,i))&&(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(t=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(t)}}};function V8(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Ud({layers:n.layers});t[an.LAYERGROUP]=i,t[an.TARGET]=n.target,t[an.VIEW]=n.view instanceof ia?n.view:new ia;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new na(n.controls.slice()):(Kt(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let s;n.interactions!==void 0&&(Array.isArray(n.interactions)?s=new na(n.interactions.slice()):(Kt(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new na(n.overlays.slice()):(Kt(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new na,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}class hk{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Kt(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Kt(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Kt(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Ly(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function Il(n,e,t){return n+"/"+e+"/"+t}function Uc(n){return Il(n[0],n[1],n[2])}function j8(n){const[e,t,i]=n.substring(n.lastIndexOf("/")+1,n.length).split(",").map(Number);return Il(e,t,i)}function dk(n){return n.split("/").map(Number)}function W8(n){return(n[1]<<n[0])+n[2]}function q8(n,e){const t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,r):!0}class O0 extends hk{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=dk(e)[0];this.forEach(r=>{r.tileCoord[0]!==i&&(this.remove(Uc(r.tileCoord)),r.release())})}}class k0{constructor(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function ch(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new k0(n,e,t,i)}const OA=[];class K8 extends cg{constructor(e,t,i,r){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=Mt(e);return t in this.context_||(this.context_[t]=pn(1,1,OA)),this.context_[t]}hasContext(e){return Mt(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=Mt(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];ad(t),OA.push(t.canvas),delete this.context_[e]}super.release()}}let Z8=class extends cg{constructor(e,t,i,r,s,o){super(e,t,o),this.extent=null,this.format_=r,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==Ie.IDLE&&(this.setState(Ie.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(Ie.ERROR)}setFeatures(e){this.features_=e,this.setState(Ie.LOADED)}setLoader(e){this.loader_=e}};const El={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class fk extends R0{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(El.PRELOAD)}setPreload(e){this.set(El.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(El.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(El.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const pk=.5,Y8=10,kA=.25;class gk{constructor(e,t,i,r,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=wp(this.targetProj_,this.sourceProj_);this.transformInv_=function(x){const C=x[0]+"/"+x[1];return a[C]||(a[C]=l(x)),a[C]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&fn(r)>=fn(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?fn(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?fn(this.targetProj_.getExtent()):null;const c=zl(i),u=w0(i),f=E0(i),p=_0(i),m=this.transformInv_(c),y=this.transformInv_(u),_=this.transformInv_(f),w=this.transformInv_(p),T=Y8+(o?Math.max(0,Math.ceil(Math.log2(_p(i)/(o*o*256*256)))):0);if(this.addQuad_(c,u,f,p,m,y,_,w,T),this.wrapsXInSource_){let x=1/0;this.triangles_.forEach(function(C,I,D){x=Math.min(x,C.source[0][0],C.source[1][0],C.source[2][0])}),this.triangles_.forEach(C=>{if(Math.max(C.source[0][0],C.source[1][0],C.source[2][0])-x>this.sourceWorldWidth_/2){const I=[[C.source[0][0],C.source[0][1]],[C.source[1][0],C.source[1][1]],[C.source[2][0],C.source[2][1]]];I[0][0]-x>this.sourceWorldWidth_/2&&(I[0][0]-=this.sourceWorldWidth_),I[1][0]-x>this.sourceWorldWidth_/2&&(I[1][0]-=this.sourceWorldWidth_),I[2][0]-x>this.sourceWorldWidth_/2&&(I[2][0]-=this.sourceWorldWidth_);const D=Math.min(I[0][0],I[1][0],I[2][0]);Math.max(I[0][0],I[1][0],I[2][0])-D<this.sourceWorldWidth_/2&&(C.source=I)}})}a={}}addTriangle_(e,t,i,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,i]})}addQuad_(e,t,i,r,s,o,a,l,c){const u=gy([s,o,a,l]),f=this.sourceWorldWidth_?fn(u)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,m=this.sourceProj_.canWrapX()&&f>.5&&f<1;let y=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const w=gy([e,t,i,r]);y=fn(w)/this.targetWorldWidth_>kA||y}!m&&this.sourceProj_.isGlobal()&&f&&(y=f>kA||y)}if(!y&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Ji(u,this.maxSourceExtent_))return;let _=0;if(!y&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)y=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(c>0){if(!y){const w=[(e[0]+i[0])/2,(e[1]+i[1])/2],T=this.transformInv_(w);let x;m?x=(Zh(s[0],p)+Zh(a[0],p))/2-Zh(T[0],p):x=(s[0]+a[0])/2-T[0];const C=(s[1]+a[1])/2-T[1];y=x*x+C*C>this.errorThresholdSquared_}if(y){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const w=[(t[0]+i[0])/2,(t[1]+i[1])/2],T=this.transformInv_(w),x=[(r[0]+e[0])/2,(r[1]+e[1])/2],C=this.transformInv_(x);this.addQuad_(e,t,w,x,s,o,T,C,c-1),this.addQuad_(x,w,i,r,C,T,a,l,c-1)}else{const w=[(e[0]+t[0])/2,(e[1]+t[1])/2],T=this.transformInv_(w),x=[(i[0]+r[0])/2,(i[1]+r[1])/2],C=this.transformInv_(x);this.addQuad_(e,w,x,r,s,T,C,l,c-1),this.addQuad_(w,t,i,x,T,o,a,C,c-1)}return}}if(m){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,i,r,s,a,l),_&14||this.addTriangle_(e,i,t,s,a,o),_&&(_&13||this.addTriangle_(t,r,e,o,l,s),_&7||this.addTriangle_(t,r,i,o,l,a))}calculateSourceExtent(){const e=wo();return this.triangles_.forEach(function(t,i,r){const s=t.source;cp(e,s[0]),cp(e,s[1]),cp(e,s[2])}),e}getTriangles(){return this.triangles_}}let ow;const aa=[];function MA(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function aw(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function X8(){if(ow===void 0){const n=pn(6,6,aa);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",MA(n,4,5,4,0),MA(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;ow=aw(e,0)||aw(e,4)||aw(e,8),ad(n),aa.push(n.canvas)}return ow}function NA(n,e,t,i){const r=Rb(t,e,n);let s=eA(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=n.getMetersPerUnit();a!==void 0&&(s/=a);const l=n.getExtent();if(!l||sd(l,r)){const c=eA(n,s,r)/s;isFinite(c)&&c>0&&(s/=c)}return s}function mk(n,e,t,i){const r=Ll(t);let s=NA(n,e,r,i);return(!isFinite(s)||s<=0)&&fO(t,function(o){return s=NA(n,e,o,i),isFinite(s)&&s>0}),s}function vk(n,e,t,i,r,s,o,a,l,c,u,f){const p=pn(Math.round(t*n),Math.round(t*e),aa);if(f||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(t,t);function m(I){return Math.round(I*t)/t}p.globalCompositeOperation="lighter";const y=wo();l.forEach(function(I,D,B){hO(y,I.extent)});const _=fn(y),w=ns(y),T=pn(Math.round(t*_/i),Math.round(t*w/i),aa);f||(T.imageSmoothingEnabled=!1);const x=t/i;l.forEach(function(I,D,B){const N=I.extent[0]-y[0],z=-(I.extent[3]-y[3]),Z=fn(I.extent),q=ns(I.extent);I.image.width>0&&I.image.height>0&&T.drawImage(I.image,c,c,I.image.width-2*c,I.image.height-2*c,N*x,z*x,Z*x,q*x)});const C=zl(o);return a.getTriangles().forEach(function(I,D,B){const N=I.source,z=I.target;let Z=N[0][0],q=N[0][1],H=N[1][0],Y=N[1][1],ee=N[2][0],le=N[2][1];const W=m((z[0][0]-C[0])/s),ie=m(-(z[0][1]-C[1])/s),ne=m((z[1][0]-C[0])/s),J=m(-(z[1][1]-C[1])/s),ce=m((z[2][0]-C[0])/s),se=m(-(z[2][1]-C[1])/s),te=Z,Q=q;Z=0,q=0,H-=te,Y-=Q,ee-=te,le-=Q;const _e=[[H,Y,0,0,ne-W],[ee,le,0,0,ce-W],[0,0,H,Y,J-ie],[0,0,ee,le,se-ie]],fe=Gz(_e);if(fe){if(p.save(),p.beginPath(),X8()||!f){p.moveTo(ne,J);const pe=4,Ce=W-ne,xe=ie-J;for(let Le=0;Le<pe;Le++)p.lineTo(ne+m((Le+1)*Ce/pe),J+m(Le*xe/(pe-1))),Le!=pe-1&&p.lineTo(ne+m((Le+1)*Ce/pe),J+m((Le+1)*xe/(pe-1)));p.lineTo(ce,se)}else p.moveTo(ne,J),p.lineTo(W,ie),p.lineTo(ce,se);p.clip(),p.transform(fe[0],fe[2],fe[1],fe[3],W,ie),p.translate(y[0]-te,y[3]-Q),p.scale(i/t,-i/t),p.drawImage(T.canvas,0,0),p.restore()}}),ad(T),aa.push(T.canvas),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(I,D,B){const N=I.target,z=(N[0][0]-C[0])/s,Z=-(N[0][1]-C[1])/s,q=(N[1][0]-C[0])/s,H=-(N[1][1]-C[1])/s,Y=(N[2][0]-C[0])/s,ee=-(N[2][1]-C[1])/s;p.beginPath(),p.moveTo(q,H),p.lineTo(z,Z),p.lineTo(Y,ee),p.closePath(),p.stroke()}),p.restore()),p.canvas}class hd extends cg{constructor(e,t,i,r,s,o,a,l,c,u,f,p){super(s,Ie.IDLE,{interpolate:!!p}),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const m=r.getTileCoordExtent(this.wrappedTileCoord_),y=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const w=y?mr(m,y):m;if(_p(w)===0){this.state=Ie.EMPTY;return}const T=e.getExtent();T&&(_?_=mr(_,T):_=T);const x=r.getResolution(this.wrappedTileCoord_[0]),C=mk(e,i,w,x);if(!isFinite(C)||C<=0){this.state=Ie.EMPTY;return}const I=u!==void 0?u:pk;if(this.triangulation_=new gk(e,i,w,_,C*I,x),this.triangulation_.getTriangles().length===0){this.state=Ie.EMPTY;return}this.sourceZ_=t.getZForResolution(C);let D=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(D[1]=Ii(D[1],_[1],_[3]),D[3]=Ii(D[3],_[1],_[3])):D=mr(D,_)),!_p(D))this.state=Ie.EMPTY;else{const B=t.getTileRangeForExtentAndZ(D,this.sourceZ_);for(let N=B.minX;N<=B.maxX;N++)for(let z=B.minY;z<=B.maxY;z++){const Z=c(this.sourceZ_,N,z,a);Z&&this.sourceTiles_.push(Z)}this.sourceTiles_.length===0&&(this.state=Ie.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==Ie.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=Ie.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=vk(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Ie.LOADED}this.changed()}load(){if(this.state==Ie.IDLE){this.state=Ie.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==Ie.IDLE||i==Ie.LOADING){e++;const r=qt(t,yt.CHANGE,function(s){const o=t.getState();(o==Ie.LOADED||o==Ie.ERROR||o==Ie.EMPTY)&&(mi(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,r){t.getState()==Ie.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(mi),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ad(this.canvas_.getContext("2d")),aa.push(this.canvas_),this.canvas_=null),super.release()}}class yk extends $6{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=wo(),this.tmpTileRange_=new k0(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),r=t.getUseInterimTilesOnError();return i==Ie.LOADED||i==Ie.EMPTY||i==Ie.ERROR&&!r}getTile(e,t,i,r){const s=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let c=a.getSource().getTile(e,t,i,s,o);return c.getState()==Ie.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Xi(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!sd(s,r))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,c=i.getRenderSource(),u=c.getTileGridForProjection(l.projection),f=c.getTilePixelRatio(t.pixelRatio);for(let p=u.getZForResolution(l.resolution);p>=u.getMinZoom();--p){const m=u.getTileCoordForCoordAndZ(r,p),y=c.getTile(p,m[1],m[2],o,a);if(!(y instanceof P0||y instanceof hd)||y instanceof hd&&y.getState()===Ie.EMPTY)return null;if(y.getState()!==Ie.LOADED)continue;const _=u.getOrigin(p),w=Bi(u.getTileSize(p)),T=u.getResolution(p),x=Math.floor(f*((r[0]-_[0])/T-m[1]*w[0])),C=Math.floor(f*((_[1]-r[1])/T-m[2]*w[1])),I=Math.round(f*c.getGutterForProjection(l.projection));return this.getImageData(y.getImage(),x+I,C+I)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],r=e.viewState,s=r.projection,o=r.resolution,a=r.center,l=r.rotation,c=e.pixelRatio,u=this.getLayer(),f=u.getSource(),p=f.getRevision(),m=f.getTileGridForProjection(s),y=m.getZForResolution(o,f.zDirection),_=m.getResolution(y);let w=e.extent;const T=e.viewState.resolution,x=f.getTilePixelRatio(c),C=Math.round(fn(w)/T*c),I=Math.round(ns(w)/T*c),D=i.extent&&ml(i.extent,s);D&&(w=mr(w,ml(i.extent,s)));const B=_*C/2/x,N=_*I/2/x,z=[a[0]-B,a[1]-N,a[0]+B,a[1]+N],Z=m.getTileRangeForExtentAndZ(w,y),q={};q[y]={};const H=this.createLoadedTileFinder(f,s,q),Y=this.tmpExtent,ee=this.tmpTileRange_;this.newTiles_=!1;const le=l?OT(r.center,T,l,e.size):void 0;for(let _e=Z.minX;_e<=Z.maxX;++_e)for(let fe=Z.minY;fe<=Z.maxY;++fe){if(l&&!m.tileCoordIntersectsViewport([y,_e,fe],le))continue;const pe=this.getTile(y,_e,fe,e);if(this.isDrawableTile(pe)){const Le=Mt(this);if(pe.getState()==Ie.LOADED){q[y][pe.tileCoord.toString()]=pe;let je=pe.inTransition(Le);je&&i.opacity!==1&&(pe.endTransition(Le),je=!1),!this.newTiles_&&(je||!this.renderedTiles.includes(pe))&&(this.newTiles_=!0)}if(pe.getAlpha(Le,e.time)===1)continue}const Ce=m.getTileCoordChildTileRange(pe.tileCoord,ee,Y);let xe=!1;Ce&&(xe=H(y+1,Ce)),xe||m.forEachTileCoordParentTileRange(pe.tileCoord,H,ee,Y)}const W=_/o*c/x;Ls(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,l,-C/2,-I/2);const ie=Sz(this.pixelTransform);this.useContainer(t,ie,this.getBackground(e));const ne=this.context,J=ne.canvas;aO(this.inversePixelTransform,this.pixelTransform),Ls(this.tempTransform,C/2,I/2,W,W,0,-C/2,-I/2),J.width!=C||J.height!=I?(J.width=C,J.height=I):this.containerReused||ne.clearRect(0,0,C,I),D&&this.clipUnrotated(ne,e,D),f.getInterpolate()||(ne.imageSmoothingEnabled=!1),this.preRender(ne,e),this.renderedTiles.length=0;let ce=Object.keys(q).map(Number);ce.sort(Cl);let se,te,Q;i.opacity===1&&(!this.containerReused||f.getOpaque(e.viewState.projection))?ce=ce.reverse():(se=[],te=[]);for(let _e=ce.length-1;_e>=0;--_e){const fe=ce[_e],pe=f.getTilePixelSize(fe,c,s),xe=m.getResolution(fe)/_,Le=pe[0]*xe*W,je=pe[1]*xe*W,Ke=m.getTileCoordForCoordAndZ(zl(z),fe),lt=m.getTileCoordExtent(Ke),ct=Xi(this.tempTransform,[x*(lt[0]-z[0])/_,x*(z[3]-lt[3])/_]),Ht=x*f.getGutterForProjection(s),Vt=q[fe];for(const ii in Vt){const Yt=Vt[ii],k=Yt.tileCoord,X=Ke[1]-k[1],ve=Math.round(ct[0]-(X-1)*Le),Pe=Ke[2]-k[2],Ae=Math.round(ct[1]-(Pe-1)*je),Ve=Math.round(ct[0]-X*Le),ze=Math.round(ct[1]-Pe*je),vt=ve-Ve,xt=Ae-ze,It=y===fe,rt=It&&Yt.getAlpha(Mt(this),e.time)!==1;let Ot=!1;if(!rt)if(se){Q=[Ve,ze,Ve+vt,ze,Ve+vt,ze+xt,Ve,ze+xt];for(let G=0,U=se.length;G<U;++G)if(y!==fe&&fe<te[G]){const K=se[G];Ji([Ve,ze,Ve+vt,ze+xt],[K[0],K[3],K[4],K[7]])&&(Ot||(ne.save(),Ot=!0),ne.beginPath(),ne.moveTo(Q[0],Q[1]),ne.lineTo(Q[2],Q[3]),ne.lineTo(Q[4],Q[5]),ne.lineTo(Q[6],Q[7]),ne.moveTo(K[6],K[7]),ne.lineTo(K[4],K[5]),ne.lineTo(K[2],K[3]),ne.lineTo(K[0],K[1]),ne.clip())}se.push(Q),te.push(fe)}else ne.clearRect(Ve,ze,vt,xt);this.drawTileImage(Yt,e,Ve,ze,vt,xt,Ht,It),se&&!rt?(Ot&&ne.restore(),this.renderedTiles.unshift(Yt)):this.renderedTiles.push(Yt),this.updateUsedTiles(e.usedTiles,f,Yt)}}return this.renderedRevision=p,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!my(this.renderedExtent_,z),this.renderedExtent_=z,this.renderedPixelRatio=c,this.renderedProjection=s,this.manageTilePyramid(e,f,m,c,s,w,y,u.getPreload()),this.scheduleExpireCache(e,f),this.postRender(ne,e),i.extent&&ne.restore(),ne.imageSmoothingEnabled=!0,ie!==J.style.transform&&(J.style.transform=ie),this.container}drawTileImage(e,t,i,r,s,o,a,l){const c=this.getTileImage(e);if(!c)return;const u=Mt(this),f=t.layerStatesArray[t.layerIndex],p=f.opacity*(l?e.getAlpha(u,t.time):1),m=p!==this.context.globalAlpha;m&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,r,s,o),m&&this.context.restore(),p!==f.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(r,s,o){const a=Mt(r);a in o.usedTiles&&r.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const r=Mt(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}manageTilePyramid(e,t,i,r,s,o,a,l,c){const u=Mt(t);u in e.wantedTiles||(e.wantedTiles[u]={});const f=e.wantedTiles[u],p=e.tileQueue,m=i.getMinZoom(),y=e.viewState.rotation,_=y?OT(e.viewState.center,e.viewState.resolution,y,e.size):void 0;let w=0,T,x,C,I,D,B;for(B=m;B<=a;++B)for(x=i.getTileRangeForExtentAndZ(o,B,x),C=i.getResolution(B),I=x.minX;I<=x.maxX;++I)for(D=x.minY;D<=x.maxY;++D)y&&!i.tileCoordIntersectsViewport([B,I,D],_)||(a-B<=l?(++w,T=t.getTile(B,I,D,r,s),T.getState()==Ie.IDLE&&(f[T.getKey()]=!0,p.isKeyQueued(T.getKey())||p.enqueue([T,u,i.getTileCoordCenter(T.tileCoord),C])),c!==void 0&&c(T)):t.useTile(B,I,D,s));t.updateCacheSize(w,s)}}class J8 extends fk{constructor(e){super(e)}createRenderer(){return new yk(this)}}const Xh={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},uh=[0,0,0],sl=5;class M0{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Kt(uz(this.resolutions_,function(r,s){return s-r}),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Kt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=zl(i)),Kt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Kt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Fb,Kt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(r,s){const o=new k0(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)i([t,s,a])}forEachTileCoordParentTileRange(e,t,i,r){let s,o,a,l=null,c=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);c>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=ch(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,c,i),t(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return ch(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return ch(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),c=Math.floor(s*l),u=Math.floor(o*l);if(t<r)return ch(c,c,u,u,i);const f=Math.floor(l*(s+1))-1,p=Math.floor(l*(o+1))-1;return ch(c,f,u,p,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,uh);const r=uh[1],s=uh[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,uh);const o=uh[1],a=uh[2];return ch(r,o,s,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=Bi(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=Bi(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*s[0]*r,a=i[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,c=a+s[1]*r;return Al(o,a,l,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),c=Bi(this.getTileSize(o),this.tmpSize_);let u=a*(e-l[0])/i/c[0],f=a*(l[1]-t)/i/c[1];return r?(u=jm(u,sl)-1,f=jm(f,sl)-1):(u=Vm(u,sl),f=Vm(f,sl)),Ly(o,u,f,s)}getTileCoordForXYAndZ_(e,t,i,r,s){const o=this.getOrigin(i),a=this.getResolution(i),l=Bi(this.getTileSize(i),this.tmpSize_);let c=(e-o[0])/a/l[0],u=(o[1]-t)/a/l[1];return r?(c=jm(c,sl)-1,u=jm(u,sl)-1):(c=Vm(c,sl),u=Vm(u,sl)),Ly(i,c,u,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=gb(this.resolutions_,e,t||0);return Ii(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return CO(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}function Wb(n){let e=n.getDefaultTileGrid();return e||(e=tH(n),n.setDefaultTileGrid(e)),e}function Q8(n,e,t){const i=e[0],r=n.getTileCoordCenter(e),s=dg(t);if(!sd(s,r)){const o=fn(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,n.getTileCoordForCoordAndZ(r,i)}return e}function eH(n,e,t,i){i=i!==void 0?i:"top-left";const r=_k(n,e,t);return new M0({extent:n,origin:Cz(n,i),resolutions:r,tileSize:t})}function qb(n){const e=n||{},t=e.extent||Ti("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:_k(t,e.maxZoom,e.tileSize,e.maxResolution)};return new M0(i)}function _k(n,e,t,i){e=e!==void 0?e:HO,t=Bi(t!==void 0?t:Fb);const r=ns(n),s=fn(n);i=i>0?i:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function tH(n,e,t,i){const r=dg(n);return eH(r,e,t,i)}function dg(n){n=Ti(n);let e=n.getExtent();if(!e){const t=180*wb.degrees/n.getMetersPerUnit();e=Al(-t,-t,t,t)}return e}class Ek extends c8{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Bi(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new O0(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,c;for(let u=i.minX;u<=i.maxX;++u)for(let f=i.minY;f<=i.maxY;++f)l=Il(t,u,f),c=!1,s.containsKey(l)&&(a=s.get(l),c=a.getState()===Ie.LOADED,c&&(c=r(a)!==!1)),c||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,s){return Et()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Wb(e)}getTileCacheForProjection(e){const t=this.getProjection();return Kt(t===null||As(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),o=Bi(r.getTileSize(e),this.tmpSize);return s==1?o:EG(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Q8(i,e,t)),q8(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,r){}}class wk extends Ul{constructor(e,t){super(e),this.tile=t}}function iH(n,e){const t=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return n.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const c=o[0],u=e.getFullTileRange(c);return Kt(u,"The {-y} placeholder requires a tile grid with extent"),(u.getHeight()-o[2]-1).toString()})}}function nH(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=iH(n[r],e);return rH(i)}function rH(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const r=W8(e),s=Zh(r,n.length);return n[s](e,t,i)}}function sH(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=i;s<=r;++s)e.push(n.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=i;r++)e.push(n.replace(t[0],r.toString()));return e}return e.push(n),e}class N0 extends Ek{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===N0.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=Mt(t),r=t.getState();let s;r==Ie.LOADING?(this.tileLoadingKeys_[i]=!0,s=Xh.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==Ie.ERROR?Xh.TILELOADERROR:r==Ie.LOADED?Xh.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new wk(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=sH(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(nH(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const r=Il(e,t,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class oH extends N0{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:aH,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:P0,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!As(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!As(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||As(t,e)))return this.tileGrid;const i=Mt(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Wb(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||As(t,e))return this.tileCache;const i=Mt(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new O0(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,r,s,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,s),c=l?this.tileUrlFunction(l,r,s):void 0,u=new this.tileClass(a,c!==void 0?Ie.IDLE:Ie.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(yt.CHANGE,this.handleTileChange.bind(this)),u}getTile(e,t,i,r,s){const o=this.getProjection();if(!o||!s||As(o,s))return this.getTileInternal(e,t,i,r,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,i];let c;const u=Uc(l);a.containsKey(u)&&(c=a.get(u));const f=this.getKey();if(c&&c.key==f)return c;const p=this.getTileGridForProjection(o),m=this.getTileGridForProjection(s),y=this.getTileCoordForTileUrlFunction(l,s),_=new hd(o,p,s,m,l,y,this.getTilePixelRatio(r),this.getGutter(),(w,T,x,C)=>this.getTileInternal(w,T,x,C,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return _.key=f,c?(_.interimTile=c,_.refreshInterimChain(),a.replace(u,_)):a.set(u,_),_}getTileInternal(e,t,i,r,s){let o=null;const a=Il(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const c=o;o=this.createTile_(e,t,i,r,s,l),c.getState()==Ie.IDLE?o.interimTile=c.interimTile:o.interimTile=c,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=Ti(e);if(i){const r=Mt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function aH(n,e){n.getImage().src=e}class lH extends oH{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:qb({extent:dg(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}class Iy extends EO{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(mi),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(qt(this.geometries_[e],yt.CHANGE,this.changed,this))}clone(){const e=new Iy(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<cu(this.getExtent(),e,t))return r;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)r=s[o].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){Md(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)hO(e,t[i].getExtent());return e}getGeometries(){return FA(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(r=!0)}if(r){const s=new Iy(null);return s.setGeometriesArray(t),s}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Ll(this.getExtent()));const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)r[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(FA(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function FA(n){const e=[];for(let t=0,i=n.length;t<i;++t)e.push(n[t].clone());return e}class Tk{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?Ti(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Ti(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return Et()}readFeature(e,t){return Et()}readFeatures(e,t){return Et()}readGeometry(e,t){return Et()}readProjection(e){return Et()}writeFeature(e,t){return Et()}writeFeatures(e,t){return Et()}writeGeometry(e,t){return Et()}}function Kb(n,e,t){const i=t?Ti(t.featureProjection):null,r=t?Ti(t.dataProjection):null;let s;if(i&&r&&!As(i,r)?s=(e?n.clone():n).transform(e?i:r,e?r:i):s=n,e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let c=0,u=l.length;c<u;++c)l[c]=Math.round(l[c]*o)/o;return l};s===n&&(s=n.clone()),s.applyTransform(a)}return s}class cH extends Tk{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Jm(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Jm(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Et()}readFeaturesFromObject(e,t){return Et()}readGeometry(e,t){return this.readGeometryFromObject(Jm(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Et()}readProjection(e){return this.readProjectionFromObject(Jm(e))}readProjectionFromObject(e){return Et()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Et()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Et()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Et()}}function Jm(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class Dp extends uu{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{let r=this.getLayout();const s=e,o=[],a=[];for(let l=0,c=s.length;l<c;++l){const u=s[l];l===0&&(r=u.getLayout()),ra(o,u.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(r,o),this.ends_=a}}appendLineString(e){this.flatCoordinates?ra(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Dp(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<cu(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Lb(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pb(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,_G(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Tp(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new eu(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],c=new eu(e.slice(s,l),i);r.push(c),s=l}return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],c=Ey(t,i,l,s,.5);ra(e,c),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=lG(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Dp(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return pG(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Db(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class fg extends uu{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?ra(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new fg(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<cu(this.getExtent(),e,t))return r;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const c=jc(e,t,s[a],s[a+1]);if(c<r){r=c;for(let u=0;u<o;++u)i[u]=s[a+u];i.length=o}}return r}getCoordinates(){return vl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new Jc(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let s=0,o=e.length;s<o;s+=i){const a=new Jc(e.slice(s,s+i),t);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,s=t.length;r<s;r+=i){const o=t[r],a=t[r+1];if(_b(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=T0(this.flatCoordinates,0,e,this.stride),this.changed()}}function Sk(n,e,t,i){const r=[];let s=wo();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=Eb(n,e,l[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return r}class Op extends uu{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){let r=this.getLayout();const s=e,o=[],a=[];for(let l=0,c=s.length;l<c;++l){const u=s[l];l===0&&(r=u.getLayout());const f=o.length,p=u.getEnds();for(let m=0,y=p.length;m<y;++m)p[m]+=f;ra(o,u.getFlatCoordinates()),a.push(p)}t=r,e=o,i=a}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ra(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,s=t.length;r<s;++r)t[r]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new Op(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<cu(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(rG(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sG(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return fG(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return hG(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),sA(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,NT(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Sk(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=bO(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new fg(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;vG(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=sA(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=uG(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Op(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(t!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=t;return new ha(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),c=l[l.length-1];if(s!==0)for(let f=0,p=l.length;f<p;++f)l[f]-=s;const u=new ha(t.slice(s,c),e,l);r.push(u),s=c}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return gG(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=aG(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}class uH extends cH{constructor(e){e=e||{},super(),this.dataProjection=Ti(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=Ti(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const r=jT(i.geometry,t),s=new mb;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(r),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(e,t){const i=e;let r=null;if(i.type==="FeatureCollection"){const s=e;r=[];const o=s.features;for(let a=0,l=o.length;a<l;++a)r.push(this.readFeatureFromObject(o[a],t))}else r=[this.readFeatureFromObject(e,t)];return r}readGeometryFromObject(e,t){return jT(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=Ti(t.properties.name);else if(t.type==="EPSG")i=Ti("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(r!==void 0&&(i.id=r),!e.hasProperties())return i;const s=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=WT(o,t),delete s[e.getGeometryName()]),m0(s)||(i.properties=s),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,s=e.length;r<s;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return WT(e,this.adaptOptions(t))}}function jT(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=dH(n);break}case"LineString":{t=fH(n);break}case"Polygon":{t=vH(n);break}case"MultiPoint":{t=gH(n);break}case"MultiLineString":{t=pH(n);break}case"MultiPolygon":{t=mH(n);break}case"GeometryCollection":{t=hH(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return Kb(t,!1,e)}function hH(n,e){const t=n.geometries.map(function(i){return jT(i,e)});return new Iy(t)}function dH(n){return new Jc(n.coordinates)}function fH(n){return new eu(n.coordinates)}function pH(n){return new Dp(n.coordinates)}function gH(n){return new fg(n.coordinates)}function mH(n){return new Op(n.coordinates)}function vH(n){return new ha(n.coordinates)}function WT(n,e){n=Kb(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=SH(n);break}case"LineString":{i=_H(n);break}case"Polygon":{i=bH(n,e);break}case"MultiPoint":{i=wH(n);break}case"MultiLineString":{i=EH(n);break}case"MultiPolygon":{i=TH(n,e);break}case"GeometryCollection":{i=yH(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function yH(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return WT(i,e)})}}function _H(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function EH(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function wH(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function TH(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function SH(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function bH(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const BA=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],UA={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class xH extends D0{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"⤢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"×";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(yt.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${rg} ${x0}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(zA(t))if(GA(t))RH(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?CH(i):bk(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=GA(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(wy(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(UA.ENTERFULLSCREEN)):(wy(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(UA.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(an.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(an.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,r=e.length;i<r;++i)mi(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();zA(i)?this.element.classList.remove(cA):this.element.classList.add(cA);for(let r=0,s=BA.length;r<s;++r)e.push(qt(i,BA[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function zA(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function GA(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function bk(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function CH(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():bk(n)}function RH(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const AH={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},LH={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class IH extends yk{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=Un()}prepareTile(e,t,i){let r;const s=e.getState();return(s===Ie.LOADED||s===Ie.ERROR)&&(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(r=!0)),r}getTile(e,t,i,r){const s=r.pixelRatio,o=r.viewState,a=o.resolution,l=o.projection,c=this.getLayer(),u=c.getSource().getTile(e,t,i,s,l),f=r.viewHints,p=!(f[un.ANIMATING]||f[un.INTERACTING]);return(p||!u.wantedResolution)&&(u.wantedResolution=a),this.prepareTile(u,s,l)&&(p||Date.now()-r.time<8)&&c.getRenderMode()!=="vector"&&this.renderTileImage_(u,r),super.getTile(e,t,i,r)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?Mt(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const r=this.getLayer(),s=r.getRevision(),o=r.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(r);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedRenderOrder==o)return;const c=r.getSource(),u=r.getDeclutter(),f=c.getTileGrid(),m=c.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),y=c.getSourceTiles(t,i,e),_=Mt(r);delete e.hitDetectionImageData[_],e.executorGroups[_]=[],u&&(e.declutterExecutorGroups[_]=[]),l.dirty=!1;for(let w=0,T=y.length;w<T;++w){const x=y[w];if(x.getState()!=Ie.LOADED)continue;const C=x.tileCoord,I=f.getTileCoordExtent(C),D=mr(m,I),B=Vc(D,r.getRenderBuffer()*a,this.tmpExtent),N=my(I,D)?null:B,z=new CA(0,B,a,t),Z=u?new CA(0,D,a,t):void 0,q=J6(a,t),H=function(ie){let ne;const J=ie.getStyleFunction()||r.getStyleFunction();if(J&&(ne=J(ie,a)),ne){const ce=this.renderFeature(ie,q,ne,z,Z);l.dirty=l.dirty||ce}},Y=x.getFeatures();o&&o!==l.renderedRenderOrder&&Y.sort(o);for(let ie=0,ne=Y.length;ie<ne;++ie){const J=Y[ie];(!N||Ji(N,J.getGeometry().getExtent()))&&H.call(this,J)}const ee=z.finish(),le=r.getRenderMode()!=="vector"&&u&&y.length===1?null:D,W=new LA(le,a,t,c.getOverlaps(),ee,r.getRenderBuffer());if(e.executorGroups[_].push(W),Z){const ie=new LA(null,a,t,c.getOverlaps(),Z.finish(),r.getRenderBuffer());e.declutterExecutorGroups[_].push(ie)}}l.renderedRevision=s,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,r,s){const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),u=l.getSource().getTileGridForProjection(t.viewState.projection),f=gy([e]);Vc(f,o*i,f);const p={},m=function(w,T,x){let C=w.getId();C===void 0&&(C=Mt(w));const I=p[C];if(I){if(I!==!0&&x<I.distanceSq){if(x===0)return p[C]=!0,s.splice(s.lastIndexOf(I),1),r(w,l,T);I.geometry=T,I.distanceSq=x}}else{if(x===0)return p[C]=!0,r(w,l,T);s.push(p[C]={feature:w,layer:l,geometry:T,distanceSq:x,callback:r})}},y=this.renderedTiles;let _;for(let w=0,T=y.length;!_&&w<T;++w){const x=y[w],C=u.getTileCoordExtent(x.wrappedTileCoord);if(!Ji(C,f))continue;const I=Mt(l),D=[x.executorGroups[I]],B=x.declutterExecutorGroups[I];B&&D.push(B),D.some(N=>{const z=N===B?t.declutterTree.all().map(Z=>Z.value):null;for(let Z=0,q=N.length;Z<q;++Z)if(_=N[Z].forEachFeatureAtCoordinate(e,o,a,i,m,z),_)return!0})}return _}getFeatures(e){return new Promise((t,i)=>{const r=this.getLayer(),s=Mt(r),o=r.getSource(),a=this.renderedProjection,l=a.getExtent(),c=this.renderedResolution,u=o.getTileGridForProjection(a),f=Xi(this.renderedPixelToCoordinateTransform_,e.slice()),p=u.getTileCoordForCoordAndResolution(f,c);let m;for(let C=0,I=this.renderedTiles.length;C<I;++C)if(p.toString()===this.renderedTiles[C].tileCoord.toString()){if(m=this.renderedTiles[C],m.getState()===Ie.LOADED){const D=u.getTileCoordExtent(m.tileCoord);o.getWrapX()&&a.canWrapX()&&!cO(l,D)&&pO(f,a);break}m=void 0}if(!m||m.loadingSourceTiles>0){t([]);return}const y=u.getTileCoordExtent(m.wrappedTileCoord),_=zl(y),w=[(f[0]-_[0])/c,(_[1]-f[1])/c],T=m.getSourceTiles().reduce(function(C,I){return C.concat(I.getFeatures())},[]);let x=m.hitDetectionImageData[s];if(!x){const C=Bi(u.getTileSize(u.getZForResolution(c,o.zDirection))),I=this.renderedRotation_,D=[this.getRenderTransform(u.getTileCoordCenter(m.wrappedTileCoord),c,0,Sl,C[0]*Sl,C[1]*Sl,0)];x=Z6(C,D,T,r.getStyleFunction(),u.getTileCoordExtent(m.wrappedTileCoord),m.getReplayState(r).renderedResolution,I),m.hitDetectionImageData[s]=x}t(Y6(w,T,x))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,i=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const r=e.viewHints,s=!(r[un.ANIMATING]||r[un.INTERACTING]),o=this.renderedTiles;for(let a=0,l=o.length;a<l;++a){const c=o[a],u=c.declutterExecutorGroups[Mt(this.getLayer())];if(u)for(let f=u.length-1;f>=0;--f)u[f].execute(this.context,1,this.getTileRenderTransform(c,e),e.viewState.rotation,s,void 0,e.declutterTree)}t.globalAlpha=i}getTileRenderTransform(e,t){const i=t.pixelRatio,r=t.viewState,s=r.center,o=r.resolution,a=r.rotation,l=t.size,c=Math.round(l[0]*i),u=Math.round(l[1]*i),p=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),m=e.tileCoord,y=p.getTileCoordExtent(e.wrappedTileCoord),_=p.getTileCoordExtent(m,this.tmpExtent)[0]-y[0];return v0(lp(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(s,o,a,i,c,u,_))}postRender(e,t){const i=t.viewHints,r=!(i[un.ANIMATING]||i[un.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=s.getOpacity();const l=LH[o],c=t.viewState,u=c.rotation,f=s.getSource(),m=f.getTileGridForProjection(c.projection).getZForResolution(c.resolution,f.zDirection),y=this.renderedTiles,_=[],w=[];let T=!0;for(let x=y.length-1;x>=0;--x){const C=y[x];T=T&&!C.getReplayState(s).dirty;const I=C.executorGroups[Mt(s)].filter(Z=>Z.hasExecutors(l));if(I.length===0)continue;const D=this.getTileRenderTransform(C,t),B=C.tileCoord[0];let N=!1;const z=I[0].getClipCoords(D);if(z){for(let Z=0,q=_.length;Z<q;++Z)if(m!==B&&B<w[Z]){const H=_[Z];Ji([z[0],z[3],z[4],z[7]],[H[0],H[3],H[4],H[7]])&&(N||(e.save(),N=!0),e.beginPath(),e.moveTo(z[0],z[1]),e.lineTo(z[2],z[3]),e.lineTo(z[4],z[5]),e.lineTo(z[6],z[7]),e.moveTo(H[6],H[7]),e.lineTo(H[4],H[5]),e.lineTo(H[2],H[3]),e.lineTo(H[0],H[1]),e.clip())}_.push(z),w.push(B)}for(let Z=0,q=I.length;Z<q;++Z)I[Z].execute(e,1,D,u,r,l);N&&e.restore()}e.globalAlpha=a,this.ready=T,super.postRender(e,t)}renderFeature(e,t,i,r,s){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=IA(r,e,i[a],t,this.boundHandleStyleImageChange_,void 0,s)||o;else o=IA(r,e,i,t,this.boundHandleStyleImageChange_,void 0,s);return o}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),r=t.getRevision(),s=e.wantedResolution;return i.renderedTileResolution!==s||i.renderedTileRevision!==r}renderTileImage_(e,t){const i=this.getLayer(),r=e.getReplayState(i),s=i.getRevision(),o=e.executorGroups[Mt(i)];r.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],c=i.getSource();let u=t.pixelRatio;const p=t.viewState.projection,m=c.getTileGridForProjection(p),y=m.getResolution(e.tileCoord[0]),_=t.pixelRatio/e.wantedResolution*y,w=m.getResolution(l),T=e.getContext(i);u=Math.round(Math.max(u,_/u));const x=c.getTilePixelSize(l,u,p);T.canvas.width=x[0],T.canvas.height=x[1];const C=u/_;if(C!==1){const N=IT(this.tmpTransform_);lp(N,C,C),T.setTransform.apply(T,N)}const I=m.getTileCoordExtent(a,this.tmpExtent),D=_/w,B=IT(this.tmpTransform_);lp(B,D,-D),oO(B,-I[0],-I[3]);for(let N=0,z=o.length;N<z;++N)o[N].execute(T,C,B,0,!0,AH[i.getRenderMode()]);r.renderedTileResolution=e.wantedResolution}}class PH extends k6{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";Kt(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new IH(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(El.PRELOAD)}getUseInterimTilesOnError(){return this.get(El.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(El.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(El.USE_INTERIM_TILES_ON_ERROR,e)}}function Py(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}function qT(n){return n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Float32Array||n instanceof DataView?n:null}let hh=null;function DH(n){hh||(hh=pn(n.width,n.height,void 0,{willReadFrequently:!0}));const e=hh.canvas,t=n.width;e.width!==t&&(e.width=t);const i=n.height;return e.height!==i&&(e.height=i),hh.clearRect(0,0,t,i),hh.drawImage(n,0,0),hh.getImageData(0,0,t,i).data}const OH=[256,256];class Zb extends cg{constructor(e){const t=Ie.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Py(this.data_);return e?[e.width,e.height]:OH}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Ie.IDLE&&this.state!==Ie.ERROR)return;this.state=Ie.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Ie.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Ie.ERROR,e.changed()})}}class Yb extends Zb{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=i?mr(t,i):t;if(_p(s)===0){this.state=Ie.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(r?r=mr(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,u=mk(o,c,s,l);if(!isFinite(u)||u<=0){this.state=Ie.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:pk;if(this.triangulation_=new gk(o,c,s,r,u*f,l),this.triangulation_.getTriangles().length===0){this.state=Ie.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let p=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(p[1]=Ii(p[1],r[1],r[3]),p[3]=Ii(p[3],r[1],r[3])):p=mr(p,r)),!_p(p))this.state=Ie.EMPTY;else{const m=this.sourceTileGrid_.getTileRangeForExtentAndZ(p,this.sourceZ_),y=e.getTileFunction;for(let _=m.minX;_<=m.maxX;_++)for(let w=m.minY;w<=m.maxY;w++){const T=y(this.sourceZ_,_,w,this.pixelRatio_);T&&this.sourceTiles_.push(T)}this.sourceTiles_.length===0&&(this.state=Ie.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==Ie.LOADED)return;const i=t.getSize(),r=this.gutter_;let s;const o=qT(t.getData());o?s=o:s=DH(Py(t.getData()));const a=[i[0]+2*r,i[1]+2*r],l=s instanceof Float32Array,c=a[0]*a[1],u=l?Float32Array:Uint8Array,f=new u(s.buffer),p=u.BYTES_PER_ELEMENT,m=p*f.length/c,y=f.byteLength/a[1],_=Math.floor(y/p/a[0]),w=c*_;let T=f;if(f.length!==w){T=new u(w);let x=0,C=0;const I=a[0]*_;for(let D=0;D<a[1];++D){for(let B=0;B<I;++B)T[x++]=f[C+B];C+=y/p}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(T.buffer),dataType:u,bytesPerPixel:m,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=Ie.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let c,u;const f=e[0].bytesPerPixel,p=Math.ceil(f/3);for(let m=p-1;m>=0;--m){const y=[];for(let I=0,D=e.length;I<D;++I){const B=e[I],N=B.data,z=B.pixelSize,Z=z[0],q=z[1],H=pn(Z,q,aa),Y=H.createImageData(Z,q),ee=Y.data;let le=m*3;for(let W=0,ie=ee.length;W<ie;W+=4)ee[W]=N[le],ee[W+1]=N[le+1],ee[W+2]=N[le+2],ee[W+3]=255,le+=f;H.putImageData(Y,0,0),y.push({extent:B.extent,image:H.canvas})}const _=vk(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,y,this.gutter_,!1,!1);for(let I=0,D=y.length;I<D;++I){const N=y[I].image.getContext("2d");ad(N),aa.push(N.canvas)}const w=_.getContext("2d"),T=w.getImageData(0,0,_.width,_.height);ad(w),aa.push(_),c||(u=new Uint8Array(f*T.width*T.height),c=new e[0].dataType(u.buffer));const x=T.data;let C=m*3;for(let I=0,D=x.length;I<D;I+=4)x[I+3]===255?(u[C]=x[I],u[C+1]=x[I+1],u[C+2]=x[I+2]):(u[C]=0,u[C+1]=0,u[C+2]=0),C+=f}this.reprojData_=c,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=Ie.LOADED}this.changed()}load(){if(this.state!==Ie.IDLE&&this.state!==Ie.ERROR)return;this.state=Ie.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i!==Ie.IDLE&&i!==Ie.LOADING)return;e++;const r=qt(t,yt.CHANGE,function(){const s=t.getState();(s==Ie.LOADED||s==Ie.ERROR||s==Ie.EMPTY)&&(mi(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==Ie.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(mi),this.sourcesListenerKeys_=null}}class kH extends Ek{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=qb({extent:dg(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Bi(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Bi(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||As(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,r,s){const o=this.getTileCacheForProjection(r),a=Il(e,t,i);if(o.containsKey(a)){const w=o.get(a);if(w&&w.key==this.getKey())return w}const l=this.getTileGrid(),c=Math.max.apply(null,l.getResolutions().map((w,T)=>{const x=Bi(l.getTileSize(T)),C=this.getTileSize(T);return Math.max(C[0]/x[0],C[1]/x[1])})),u=this.getTileGridForProjection(s),f=this.getTileGridForProjection(r),p=[e,t,i],m=this.getTileCoordForTileUrlFunction(p,r),y=Object.assign({sourceProj:s,sourceTileGrid:u,targetProj:r,targetTileGrid:f,tileCoord:p,wrappedTileCoord:m,pixelRatio:c,gutter:this.getGutterForProjection(s),getTileFunction:(w,T,x,C)=>this.getTile(w,T,x,C,s)},this.tileOptions),_=new Yb(y);return _.key=this.getKey(),_}getTile(e,t,i,r,s){const o=this.getProjection();if(o&&s&&!As(o,s))return this.getReprojTile_(e,t,i,s,o);const a=this.getTileSize(e),l=Il(e,t,i);if(this.tileCache.containsKey(l))return this.tileCache.get(l);const c=this.loader_;function u(){return dz(function(){return c(e,t,i)})}const f=Object.assign({tileCoord:[e,t,i],loader:u,size:a},this.tileOptions),p=new Zb(f);return p.key=this.getKey(),p.addEventListener(yt.CHANGE,this.handleTileChange_),this.tileCache.set(l,p),p}handleTileChange_(e){const t=e.target,i=Mt(t),r=t.getState();let s;r==Ie.LOADING?(this.tileLoadingKeys_[i]=!0,s=Xh.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==Ie.ERROR?Xh.TILELOADERROR:r==Ie.LOADED?Xh.TILELOADEND:void 0),s&&this.dispatchEvent(new wk(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||As(t,e)))return this.tileGrid;const i=Mt(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=Wb(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=Ti(e);if(i){const r=Mt(i);r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||As(t,e))return this.tileCache;const i=Mt(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new O0(.1)),this.tileCacheForProjection_[i]}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const r in this.tileCacheForProjection_){const s=this.tileCacheForProjection_[r];s.expireCache(s==i?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}class MH extends N0{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||dg(t),r=e.tileGrid||qb({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:NH,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new O0(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Z8,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(i.getCount()===0)return t;const r=dk(i.peekFirstKey())[0],s=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==r||o.getState()!==Ie.LOADED)return;const a=o.getSourceTiles();for(let l=0,c=a.length;l<c;++l){const u=a[l],f=u.tileCoord;if(Ji(e,s.getTileCoordExtent(f))){const p=u.getFeatures();if(p)for(let m=0,y=p.length;m<y;++m){const _=p[m],w=_.getGeometry();Ji(e,w.getExtent())&&t.push(_)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),r=Object.keys(t).reduce((s,o)=>{const a=j8(o),l=i.peek(a);if(l){const c=l.sourceTiles;for(let u=0,f=c.length;u<f;++u)s[c[u].getKey()]=!0}return s},{});super.expireCache(e,t),this.sourceTileCache.expireCache(r)}getSourceTiles(e,t,i){if(i.getState()===Ie.IDLE){i.setState(Ie.LOADING);const r=i.wrappedTileCoord,s=this.getTileGridForProjection(t),o=s.getTileCoordExtent(r),a=r[0],l=s.getResolution(a);Vc(o,-l,o);const c=this.tileGrid,u=c.getExtent();u&&mr(o,u,o);const f=c.getZForResolution(l,this.zDirection);c.forEachTileCoord(o,f,p=>{const m=this.tileUrlFunction(p,e,t),y=this.sourceTileCache.containsKey(m)?this.sourceTileCache.get(m):new this.tileClass(p,m?Ie.IDLE:Ie.EMPTY,m,this.format_,this.tileLoadFunction);i.sourceTiles.push(y);const _=y.getState();if(_<Ie.LOADED){const w=T=>{this.handleTileChange(T);const x=y.getState();if(x===Ie.LOADED||x===Ie.ERROR){const C=y.getKey();C in i.errorTileKeys?y.getState()===Ie.LOADED&&delete i.errorTileKeys[C]:i.loadingSourceTiles--,x===Ie.ERROR?i.errorTileKeys[C]=!0:y.removeEventListener(yt.CHANGE,w),i.loadingSourceTiles===0&&i.setState(m0(i.errorTileKeys)?Ie.LOADED:Ie.ERROR)}};y.addEventListener(yt.CHANGE,w),i.loadingSourceTiles++}_===Ie.IDLE&&(y.extent=c.getTileCoordExtent(p),y.projection=t,y.resolution=c.getResolution(p[0]),this.sourceTileCache.set(m,y),y.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(p=>p.getState()===Ie.ERROR)?Ie.ERROR:Ie.LOADED)}return i.sourceTiles}getTile(e,t,i,r,s){const o=Il(e,t,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const c=[e,t,i];let u=this.getTileCoordForTileUrlFunction(c,s);const f=this.getTileGrid().getExtent(),p=this.getTileGridForProjection(s);if(u&&f){const _=p.getTileCoordExtent(u);Vc(_,-p.getResolution(e),_),Ji(f,_)||(u=null)}let m=!0;if(u!==null){const _=this.tileGrid,w=p.getResolution(e),T=_.getZForResolution(w,1),x=p.getTileCoordExtent(u);Vc(x,-w,x),_.forEachTileCoord(x,T,C=>{m=m&&!this.tileUrlFunction(C,r,s)})}const y=new K8(c,m?Ie.EMPTY:Ie.IDLE,u,this.getSourceTiles.bind(this,r,s));return y.key=a,l?(y.interimTile=l,y.refreshInterimChain(),this.tileCache.replace(o,y)):this.tileCache.set(o,y),y}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const r=this.tileGrid,s=r.getResolutions().slice(),o=s.map(function(c,u){return r.getOrigin(u)}),a=s.map(function(c,u){return r.getTileSize(u)}),l=HO+1;for(let c=s.length;c<l;++c)s.push(s[c-1]/2),o.push(o[c-1]),a.push(a[c-1]);i=new M0({extent:r.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),s=Bi(r.getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(e*2,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}function NH(n,e){n.setLoader(function(t,i,r){h8(e,n.getFormat(),t,i,r,n.onLoad.bind(n),n.onError.bind(n))})}var wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function FH(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var Xb={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Xb.read=function(n,e,t,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,c=l>>1,u=-7,f=t?r-1:0,p=t?-1:1,m=n[e+f];for(f+=p,s=m&(1<<-u)-1,m>>=-u,u+=a;u>0;s=s*256+n[e+f],f+=p,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+n[e+f],f+=p,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-c}return(m?-1:1)*o*Math.pow(2,s-i)};Xb.write=function(n,e,t,i,r,s){var o,a,l,c=s*8-r-1,u=(1<<c)-1,f=u>>1,p=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=i?0:s-1,y=i?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?e+=p/l:e+=p*Math.pow(2,1-f),e*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*l-1)*Math.pow(2,r),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;n[t+m]=a&255,m+=y,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;n[t+m]=o&255,m+=y,o/=256,c-=8);n[t+m-y]|=_*128};var BH=Xt,Qm=Xb;function Xt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Xt.Varint=0;Xt.Fixed64=1;Xt.Bytes=2;Xt.Fixed32=5;var KT=65536*65536,HA=1/KT,UH=12,xk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Xt.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,n(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=ev(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=VA(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=ev(this.buf,this.pos)+ev(this.buf,this.pos+4)*KT;return this.pos+=8,n},readSFixed64:function(){var n=ev(this.buf,this.pos)+VA(this.buf,this.pos+4)*KT;return this.pos+=8,n},readFloat:function(){var n=Qm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Qm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,zH(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=UH&&xk?e$(this.buf,e,n):QH(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Xt.Bytes)return n.push(this.readVarint(e));var t=jo(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Xt.Bytes)return n.push(this.readSVarint());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Xt.Bytes)return n.push(this.readBoolean());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Xt.Bytes)return n.push(this.readFloat());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Xt.Bytes)return n.push(this.readDouble());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Xt.Bytes)return n.push(this.readFixed32());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Xt.Bytes)return n.push(this.readSFixed32());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Xt.Bytes)return n.push(this.readFixed64());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Xt.Bytes)return n.push(this.readSFixed64());var e=jo(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===Xt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xt.Fixed32)this.pos+=4;else if(e===Xt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),fh(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),fh(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),fh(this.buf,n&-1,this.pos),fh(this.buf,Math.floor(n*HA),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),fh(this.buf,n&-1,this.pos),fh(this.buf,Math.floor(n*HA),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){GH(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=t$(this.buf,n,this.pos);var t=this.pos-e;t>=128&&$A(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),Qm.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Qm.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&$A(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,Xt.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,VH,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,jH,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,KH,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,WH,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,qH,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,ZH,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,YH,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,XH,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,JH,e)},writeBytesField:function(n,e){this.writeTag(n,Xt.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Xt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Xt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Xt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Xt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Xt.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Xt.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Xt.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Xt.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Xt.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function zH(n,e,t){var i=t.buf,r,s;if(s=i[t.pos++],r=(s&112)>>4,s<128||(s=i[t.pos++],r|=(s&127)<<3,s<128)||(s=i[t.pos++],r|=(s&127)<<10,s<128)||(s=i[t.pos++],r|=(s&127)<<17,s<128)||(s=i[t.pos++],r|=(s&127)<<24,s<128)||(s=i[t.pos++],r|=(s&1)<<31,s<128))return dh(n,r,e);throw new Error("Expected varint not more than 10 bytes")}function jo(n){return n.type===Xt.Bytes?n.readVarint()+n.pos:n.pos+1}function dh(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function GH(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),HH(t,i,e),$H(i,e)}function HH(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function $H(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function $A(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var r=t.pos-1;r>=n;r--)t.buf[r+i]=t.buf[r]}function VH(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function jH(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function WH(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function qH(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function KH(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function ZH(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function YH(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function XH(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function JH(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function ev(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function fh(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function VA(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function QH(n,e,t){for(var i="",r=e;r<t;){var s=n[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>t)break;var l,c,u;a===1?s<128&&(o=s):a===2?(l=n[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=n[r+1],c=n[r+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=n[r+1],c=n[r+2],u=n[r+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function e$(n,e,t){return xk.decode(n.subarray(e,t))}function t$(n,e,t){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){n[t++]=239,n[t++]=191,n[t++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):s=r;continue}else s&&(n[t++]=239,n[t++]=191,n[t++]=189,s=null);r<128?n[t++]=r:(r<2048?n[t++]=r>>6|192:(r<65536?n[t++]=r>>12|224:(n[t++]=r>>18|240,n[t++]=r>>12&63|128),n[t++]=r>>6&63|128),n[t++]=r&63|128)}return t}const i$=hu(BH),jA=Un();class dd{constructor(e,t,i,r,s){this.styleFunction,this.extent_,this.id_=s,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i,this.properties_=r}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?uO(this.flatCoordinates_):Eb(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Ll(this.getExtent());this.flatInteriorPoints_=Mb(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=Sk(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=bO(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ey(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,s=i.length;r<s;++r){const o=i[r],a=Ey(e,t,o,2,.5);ra(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=Ti(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const r=ns(i)/ns(t);Ls(jA,i[0],i[3],r,-r,0,0,0),Tl(this.flatCoordinates_,0,this.flatCoordinates_.length,2,jA,this.flatCoordinates_)}}getEnds(){return this.ends_}}dd.prototype.getEndss=dd.prototype.getEnds;dd.prototype.getFlatCoordinates=dd.prototype.getOrientedFlatCoordinates;class n$ extends Tk{constructor(e){super(),e=e||{},this.dataProjection=new Ep({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:dd,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,r){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,c=0,u=0,f=0;for(;e.pos<s;){if(!a){const p=e.readVarint();o=p&7,a=p>>3}if(a--,o===1||o===2)l+=e.readSVarint(),c+=e.readSVarint(),o===1&&u>f&&(r.push(u),f=u),i.push(l,c),u+=2;else if(o===7)u>f&&(i.push(i[f],i[f+1]),u+=2);else throw new Error("Invalid command found in the PBF")}u>f&&(r.push(u),f=u)}createFeature_(e,t,i){const r=t.type;if(r===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],c=[];this.readRawGeometry_(e,t,l,c);const u=l$(r,c.length);if(this.featureClass_===dd)s=new this.featureClass_(u,l,c,o,a),s.transform(i.dataProjection);else{let f;if(u=="Polygon"){const y=yG(l,c);f=y.length>1?new Op(l,"XY",y):new ha(l,"XY",c)}else f=u==="Point"?new Jc(l,"XY"):u==="LineString"?new eu(l,"XY"):u==="MultiPoint"?new fg(l,"XY"):u==="MultiLineString"?new Dp(l,"XY",c):null;const p=this.featureClass_;s=new p,this.geometryName_&&s.setGeometryName(this.geometryName_);const m=Kb(f,!1,i);s.setGeometry(m),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const r=Ti(t.dataProjection);r.setWorldExtent(t.extent),t.dataProjection=r;const s=new i$(e),o=s.readFields(r$,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const c=o[l],u=c?[0,0,c.extent,c.extent]:null;r.setExtent(u);for(let f=0,p=c.length;f<p;++f){const m=a$(s,c,f),y=this.createFeature_(s,m,t);y!==null&&a.push(y)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function r$(n,e,t){if(n===3){const i={keys:[],values:[],features:[]},r=t.readVarint()+t.pos;t.readFields(s$,i,r),i.length=i.features.length,i.length&&(e[i.name]=i)}}function s$(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let i=null;const r=t.readVarint()+t.pos;for(;t.pos<r;)n=t.readVarint()>>3,i=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(i)}}function o$(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const r=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[r]=s}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function a$(n,e,t){n.pos=e.features[t];const i=n.readVarint()+n.pos,r={layer:e,type:0,properties:{}};return n.readFields(o$,r,i),r}function l$(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}var Kn=(n,e,t)=>new Promise((i,r)=>{var s=l=>{try{a(t.next(l))}catch(c){r(c)}},o=l=>{try{a(t.throw(l))}catch(c){r(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),Dr=Uint8Array,hp=Uint16Array,c$=Int32Array,Ck=new Dr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rk=new Dr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u$=new Dr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ak=function(n,e){for(var t=new hp(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var r=new c$(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)r[s]=s-t[i]<<5|i;return{b:t,r}},Lk=Ak(Ck,2),Ik=Lk.b,h$=Lk.r;Ik[28]=258,h$[258]=28;var d$=Ak(Rk,0),f$=d$.b,Pk=new hp(32768);for(Qt=0;Qt<32768;++Qt)Wo=(Qt&43690)>>1|(Qt&21845)<<1,Wo=(Wo&52428)>>2|(Wo&13107)<<2,Wo=(Wo&61680)>>4|(Wo&3855)<<4,Pk[Qt]=((Wo&65280)>>8|(Wo&255)<<8)>>1;var Wo,Qt,dp=function(n,e,t){for(var i=n.length,r=0,s=new hp(e);r<i;++r)n[r]&&++s[n[r]-1];var o=new hp(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;{a=new hp(1<<e);var l=15-e;for(r=0;r<i;++r)if(n[r])for(var c=r<<4|n[r],u=e-n[r],f=o[n[r]-1]++<<u,p=f|(1<<u)-1;f<=p;++f)a[Pk[f]>>l]=c}return a},pg=new Dr(288);for(Qt=0;Qt<144;++Qt)pg[Qt]=8;var Qt;for(Qt=144;Qt<256;++Qt)pg[Qt]=9;var Qt;for(Qt=256;Qt<280;++Qt)pg[Qt]=7;var Qt;for(Qt=280;Qt<288;++Qt)pg[Qt]=8;var Qt,Dk=new Dr(32);for(Qt=0;Qt<32;++Qt)Dk[Qt]=5;var Qt,p$=dp(pg,9),g$=dp(Dk,5),lw=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Ss=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},cw=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},m$=function(n){return(n+7)/8|0},v$=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var i=new Dr(t-e);return i.set(n.subarray(e,t)),i},y$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lr=function(n,e,t){var i=new Error(e||y$[n]);if(i.code=n,Error.captureStackTrace&&Error.captureStackTrace(i,Lr),!t)throw i;return i},Jb=function(n,e,t,i){var r=n.length,s=0;if(!r||e.f&&!e.l)return t||new Dr(0);var o=!t||e.i!=2,a=e.i;t||(t=new Dr(r*3));var l=function(Ke){var lt=t.length;if(Ke>lt){var ct=new Dr(Math.max(lt*2,Ke));ct.set(t),t=ct}},c=e.f||0,u=e.p||0,f=e.b||0,p=e.l,m=e.d,y=e.m,_=e.n,w=r*8;do{if(!p){c=Ss(n,u,1);var T=Ss(n,u+1,3);if(u+=3,T)if(T==1)p=p$,m=g$,y=9,_=5;else if(T==2){var D=Ss(n,u,31)+257,B=Ss(n,u+10,15)+4,N=D+Ss(n,u+5,31)+1;u+=14;for(var z=new Dr(N),Z=new Dr(19),q=0;q<B;++q)Z[u$[q]]=Ss(n,u+q*3,7);u+=B*3;for(var H=lw(Z),Y=(1<<H)-1,ee=dp(Z,H),q=0;q<N;){var le=ee[Ss(n,u,Y)];u+=le&15;var x=le>>4;if(x<16)z[q++]=x;else{var W=0,ie=0;for(x==16?(ie=3+Ss(n,u,3),u+=2,W=z[q-1]):x==17?(ie=3+Ss(n,u,7),u+=3):x==18&&(ie=11+Ss(n,u,127),u+=7);ie--;)z[q++]=W}}var ne=z.subarray(0,D),J=z.subarray(D);y=lw(ne),_=lw(J),p=dp(ne,y),m=dp(J,_)}else Lr(1);else{var x=m$(u)+4,C=n[x-4]|n[x-3]<<8,I=x+C;if(I>r){a&&Lr(0);break}o&&l(f+C),t.set(n.subarray(x,I),f),e.b=f+=C,e.p=u=I*8,e.f=c;continue}if(u>w){a&&Lr(0);break}}o&&l(f+131072);for(var ce=(1<<y)-1,se=(1<<_)-1,te=u;;te=u){var W=p[cw(n,u)&ce],Q=W>>4;if(u+=W&15,u>w){a&&Lr(0);break}if(W||Lr(2),Q<256)t[f++]=Q;else if(Q==256){te=u,p=null;break}else{var _e=Q-254;if(Q>264){var q=Q-257,fe=Ck[q];_e=Ss(n,u,(1<<fe)-1)+Ik[q],u+=fe}var pe=m[cw(n,u)&se],Ce=pe>>4;pe||Lr(3),u+=pe&15;var J=f$[Ce];if(Ce>3){var fe=Rk[Ce];J+=cw(n,u)&(1<<fe)-1,u+=fe}if(u>w){a&&Lr(0);break}o&&l(f+131072);var xe=f+_e;if(f<J){var Le=s-J,je=Math.min(J,xe);for(Le+f<0&&Lr(3);f<je;++f)t[f]=i[Le+f]}for(;f<xe;f+=4)t[f]=t[f-J],t[f+1]=t[f+1-J],t[f+2]=t[f+2-J],t[f+3]=t[f+3-J];f=xe}}e.l=p,e.p=te,e.b=f,e.f=c,p&&(c=1,e.m=y,e.d=m,e.n=_)}while(!c);return f==t.length?t:v$(t,0,f)},_$=new Dr(0),E$=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Lr(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},w$=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},T$=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Lr(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&Lr(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function S$(n,e){return Jb(n,{i:2},e,e)}function b$(n,e){var t=E$(n);return t+8>n.length&&Lr(6,"invalid gzip data"),Jb(n.subarray(t,-8),{i:2},new Dr(w$(n)),e)}function x$(n,e){return Jb(n.subarray(T$(n,e),-4),{i:2},e,e)}function ZT(n,e){return n[0]==31&&n[1]==139&&n[2]==8?b$(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?S$(n,e):x$(n,e)}var C$=typeof TextDecoder<"u"&&new TextDecoder,R$=0;try{C$.decode(_$,{stream:!0}),R$=1}catch{}var Ok=(n,e)=>n*Math.pow(2,e),qf=(n,e)=>Math.floor(n/Math.pow(2,e)),Dy=(n,e)=>Ok(n.getUint16(e+1,!0),8)+n.getUint8(e),kk=(n,e)=>Ok(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),A$=(n,e,t,i,r)=>{if(n!=i.getUint8(r))return n-i.getUint8(r);const s=Dy(i,r+1);if(e!=s)return e-s;const o=Dy(i,r+4);return t!=o?t-o:0},L$=(n,e,t,i)=>{const r=Mk(n,e|128,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],is_dir:!0}:null},WA=(n,e,t,i)=>{const r=Mk(n,e,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],is_dir:!1}:null},Mk=(n,e,t,i)=>{let r=0,s=n.byteLength/17-1;for(;r<=s;){const o=s+r>>1,a=A$(e,t,i,n,o*17);if(a>0)r=o+1;else if(a<0)s=o-1;else return[kk(n,o*17+7),n.getUint32(o*17+13,!0)]}return null},I$=(n,e)=>n.is_dir&&!e.is_dir?1:!n.is_dir&&e.is_dir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,Nk=(n,e)=>{const t=n.getUint8(e*17);return{z:t&127,x:Dy(n,e*17+1),y:Dy(n,e*17+4),offset:kk(n,e*17+7),length:n.getUint32(e*17+13,!0),is_dir:t>>7===1}},qA=n=>{const e=[],t=new DataView(n);for(let i=0;i<t.byteLength/17;i++)e.push(Nk(t,i));return P$(e)},P$=n=>{n.sort(I$);const e=new ArrayBuffer(17*n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++){const r=n[i];let s=r.z;r.is_dir&&(s=s|128),t[i*17]=s,t[i*17+1]=r.x&255,t[i*17+2]=r.x>>8&255,t[i*17+3]=r.x>>16&255,t[i*17+4]=r.y&255,t[i*17+5]=r.y>>8&255,t[i*17+6]=r.y>>16&255,t[i*17+7]=r.offset&255,t[i*17+8]=qf(r.offset,8)&255,t[i*17+9]=qf(r.offset,16)&255,t[i*17+10]=qf(r.offset,24)&255,t[i*17+11]=qf(r.offset,32)&255,t[i*17+12]=qf(r.offset,48)&255,t[i*17+13]=r.length&255,t[i*17+14]=r.length>>8&255,t[i*17+15]=r.length>>16&255,t[i*17+16]=r.length>>24&255}return e},D$=(n,e)=>{if(n.byteLength<17)return null;const t=n.byteLength/17,i=Nk(n,t-1);if(i.is_dir){const r=i.z,s=e.z-r,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:r,x:o,y:a}}return null};function O$(n){return Kn(this,null,function*(){const e=yield n.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),r=t.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,i)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let c=0;"maxzoom"in o&&(c=+o.maxzoom);let u=0,f=0,p=0,m=-180,y=-85,_=180,w=85;if(o.bounds){const x=o.bounds.split(",");m=+x[0],y=+x[1],_=+x[2],w=+x[3]}if(o.center){const x=o.center.split(",");u=+x[0],f=+x[1],p=+x[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:r*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:c,minLon:m,minLat:y,maxLon:_,maxLat:w,centerZoom:p,centerLon:u,centerLat:f,etag:e.etag}})}function k$(n,e,t,i,r,s,o){return Kn(this,null,function*(){let a=yield t.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(a=qA(a));const l=WA(new DataView(a),i,r,s);if(l){let f=(yield e.getBytes(l.offset,l.length,o)).data;const p=new DataView(f);return p.getUint8(0)==31&&p.getUint8(1)==139&&(f=ZT(new Uint8Array(f))),{data:f}}const c=D$(new DataView(a),{z:i,x:r,y:s});if(c){const u=L$(new DataView(a),c.z,c.x,c.y);if(u){let f=yield t.getArrayBuffer(e,u.offset,u.length,n);n.specVersion===1&&(f=qA(f));const p=WA(new DataView(f),i,r,s);if(p){let y=(yield e.getBytes(p.offset,p.length,o)).data;const _=new DataView(y);return _.getUint8(0)==31&&_.getUint8(1)==139&&(y=ZT(new Uint8Array(y))),{data:y}}}}})}var Fk={getHeader:O$,getZxy:k$};function ph(n,e){return(e>>>0)*4294967296+(n>>>0)}function M$(n,e){const t=e.buf;let i,r;if(r=t[e.pos++],i=(r&112)>>4,r<128||(r=t[e.pos++],i|=(r&127)<<3,r<128)||(r=t[e.pos++],i|=(r&127)<<10,r<128)||(r=t[e.pos++],i|=(r&127)<<17,r<128)||(r=t[e.pos++],i|=(r&127)<<24,r<128)||(r=t[e.pos++],i|=(r&1)<<31,r<128))return ph(n,i);throw new Error("Expected varint not more than 10 bytes")}function Kf(n){const e=n.buf;let t,i;return i=e[n.pos++],t=i&127,i<128||(i=e[n.pos++],t|=(i&127)<<7,i<128)||(i=e[n.pos++],t|=(i&127)<<14,i<128)||(i=e[n.pos++],t|=(i&127)<<21,i<128)?t:(i=e[n.pos],t|=(i&15)<<28,M$(t,n))}function N$(n,e,t,i){if(i==0){t==1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}var F$=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function B$(n,e,t){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,n)-1||t>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const i=F$[n],r=Math.pow(2,n);let s=0,o=0,a=0;const l=[e,t];let c=r/2;for(;c>0;)s=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*s^o),N$(c,l,s,o),c=c/2;return i+a}function Bk(n,e){return Kn(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return ZT(new Uint8Array(n));{let i=new Response(n).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}}else throw Error("Compression method not supported")})}var U$=127;function z$(n,e){let t=0,i=n.length-1;for(;t<=i;){const r=i+t>>1,s=e-n[r].tileId;if(s>0)t=r+1;else if(s<0)i=r-1;else return n[r]}return i>=0&&(n[i].runLength===0||e-n[i].tileId<n[i].runLength)?n[i]:null}var Uk=class{constructor(n,e=new Headers){this.url=n,this.customHeaders=e}getKey(){return this.url}setHeaders(n){this.customHeaders=n}getBytes(n,e,t){return Kn(this,null,function*(){let i;t||(i=new AbortController,t=i.signal);const r=new Headers(this.customHeaders);r.set("Range","bytes="+n+"-"+(n+e-1));let s=yield fetch(this.url,{signal:t,headers:r});if(s.status===416&&n===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const c=+l.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(c-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function bs(n,e){const t=n.getUint32(e+4,!0),i=n.getUint32(e+0,!0);return t*Math.pow(2,32)+i}function G$(n,e){const t=new DataView(n),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:bs(t,8),rootDirectoryLength:bs(t,16),jsonMetadataOffset:bs(t,24),jsonMetadataLength:bs(t,32),leafDirectoryOffset:bs(t,40),leafDirectoryLength:bs(t,48),tileDataOffset:bs(t,56),tileDataLength:bs(t,64),numAddressedTiles:bs(t,72),numTileEntries:bs(t,80),numTileContents:bs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function zk(n){const e={buf:new Uint8Array(n),pos:0},t=Kf(e),i=[];let r=0;for(let s=0;s<t;s++){const o=Kf(e);i.push({tileId:r+o,offset:0,length:0,runLength:1}),r+=o}for(let s=0;s<t;s++)i[s].runLength=Kf(e);for(let s=0;s<t;s++)i[s].length=Kf(e);for(let s=0;s<t;s++){const o=Kf(e);o===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=o-1}return i}function H$(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var $h=class extends Error{};function $$(n,e,t,i){return Kn(this,null,function*(){const r=yield n.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(H$(r.data)<3)return[yield Fk.getHeader(n)];const o=r.data.slice(0,U$);let a=r.etag;i&&r.etag!=i&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),a=void 0);const l=G$(o,a);if(t){const c=r.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=n.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,f=zk(yield e(c,l.internalCompression));return[l,[u,f.length,f]]}return[l,void 0]})}function V$(n,e,t,i,r){return Kn(this,null,function*(){const s=yield n.getBytes(t,i);if(r.etag&&r.etag!==s.etag)throw new $h(s.etag);const o=yield e(s.data,r.internalCompression),a=zk(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var j$=class{constructor(n=100,e=!0,t=Bk){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(n,e){return Kn(this,null,function*(){const t=n.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const i=new Promise((r,s)=>{$$(n,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),r(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(n,e,t,i){return Kn(this,null,function*(){const r=n.getKey()+"|"+(i.etag||"")+"|"+e+"|"+t;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const s=new Promise((o,a)=>{V$(n,this.decompress,e,t,i).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(n,e,t,i){return Kn(this,null,function*(){const r=n.getKey()+"|"+(i.etag||"")+"|"+e+"|"+t;if(this.cache.has(r))return this.cache.get(r).lastUsed=this.counter++,yield this.cache.get(r).data;const s=new Promise((o,a)=>{n.getBytes(e,t).then(l=>{if(i.etag&&i.etag!==l.etag)throw new $h(l.etag);o(l.data),this.cache.has(r),this.prune()}).catch(l=>{a(l)})});return this.cache.set(r,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<n&&(n=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(n,e){return Kn(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,e)})}},W$=class{constructor(n,e,t){typeof n=="string"?this.source=new Uk(n):this.source=n,t?this.decompress=t:this.decompress=Bk,e?this.cache=e:this.cache=new j$}getHeader(){return Kn(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,t,i){return Kn(this,null,function*(){const r=B$(n,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Fk.getZxy(s,this.source,this.cache,n,e,t,i);if(n<s.minZoom||n>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const c=yield this.cache.getDirectory(this.source,o,a,s),u=z$(c,r);if(u)if(u.runLength>0){const f=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,i);if(s.etag&&s.etag!==f.etag)throw new $h(f.etag);return{data:yield this.decompress(f.data,s.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}else o=s.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,t,i){return Kn(this,null,function*(){try{return yield this.getZxyAttempt(n,e,t,i)}catch(r){if(r instanceof $h)return this.cache.invalidate(this.source,r.message),yield this.getZxyAttempt(n,e,t,i);throw r}})}getMetadataAttempt(){return Kn(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==e.etag)throw new $h(e.etag);const t=yield this.decompress(e.data,n.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return Kn(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof $h)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};class q$ extends MH{constructor(e){super({...e,state:"loading",url:"pmtiles://"+e.url+"/{z}/{x}/{y}",format:new n$}),wn(this,"tileLoadFunction",(i,r)=>{const s=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),o=r.match(s),a=+o[2],l=+o[3],c=+o[4];i.setLoader((u,f,p)=>{i.setState(Ie.LOADING),this.pmtiles_.getZxy(a,l,c).then(m=>{if(m){const y=i.getFormat();i.setFeatures(y.readFeatures(m.data,{extent:u,featureProjection:p})),i.setState(Ie.LOADED)}else i.setFeatures([]),i.setState(Ie.EMPTY)}).catch(m=>{i.setFeatures([]),i.setState(Ie.ERROR)})})});const t=new Uk(e.url,new Headers(e.headers));this.pmtiles_=new W$(t),this.pmtiles_.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}function Sn(n){return(e,...t)=>K$(n,e,t)}function zd(n,e){return Sn(Gk(n,e).get)}const{apply:K$,construct:Wge,defineProperty:qge,get:Kge,getOwnPropertyDescriptor:Gk,getPrototypeOf:Qb,has:Zge,ownKeys:Z$,set:Yge,setPrototypeOf:Xge}=Reflect,{iterator:gg,species:Jge,toStringTag:Y$,for:Qge}=Symbol,X$=Object,{create:ex,defineProperty:J$,freeze:eme,is:tme}=X$,Q$=Array,eV=Q$.prototype,Hk=eV[gg],tV=Sn(Hk),$k=ArrayBuffer,iV=$k.prototype;zd(iV,"byteLength");const KA=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;KA&&zd(KA.prototype,"byteLength");const Vk=Qb(Uint8Array);Vk.from;const Jn=Vk.prototype;Jn[gg];Sn(Jn.keys);Sn(Jn.values);Sn(Jn.entries);Sn(Jn.set);Sn(Jn.reverse);Sn(Jn.fill);Sn(Jn.copyWithin);Sn(Jn.sort);Sn(Jn.slice);Sn(Jn.subarray);zd(Jn,"buffer");zd(Jn,"byteOffset");zd(Jn,"length");zd(Jn,Y$);const nV=Uint8Array,jk=Uint16Array,tx=Uint32Array,rV=Float32Array,kp=Qb([][gg]()),Wk=Sn(kp.next),sV=Sn(function*(){}().next),oV=Qb(kp),aV=DataView.prototype,lV=Sn(aV.getUint16),ix=WeakMap,qk=ix.prototype,Kk=Sn(qk.get),cV=Sn(qk.set),Zk=new ix,uV=ex(null,{next:{value:function(){const e=Kk(Zk,this);return Wk(e)}},[gg]:{value:function(){return this}}});function hV(n){if(n[gg]===Hk&&kp.next===Wk)return n;const e=ex(uV);return cV(Zk,e,tV(n)),e}const dV=new ix,fV=ex(oV,{next:{value:function(){const e=Kk(dV,this);return sV(e)},writable:!0,configurable:!0}});for(const n of Z$(kp))n!=="next"&&J$(fV,n,Gk(kp,n));const Yk=new $k(4),pV=new rV(Yk),gV=new tx(Yk),Xs=new jk(512),Js=new nV(512);for(let n=0;n<256;++n){const e=n-127;e<-24?(Xs[n]=0,Xs[n|256]=32768,Js[n]=24,Js[n|256]=24):e<-14?(Xs[n]=1024>>-e-14,Xs[n|256]=1024>>-e-14|32768,Js[n]=-e-1,Js[n|256]=-e-1):e<=15?(Xs[n]=e+15<<10,Xs[n|256]=e+15<<10|32768,Js[n]=13,Js[n|256]=13):e<128?(Xs[n]=31744,Xs[n|256]=64512,Js[n]=24,Js[n|256]=24):(Xs[n]=31744,Xs[n|256]=64512,Js[n]=13,Js[n|256]=13)}const nx=new tx(2048);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,nx[n]=e|t}for(let n=1024;n<2048;++n)nx[n]=939524096+(n-1024<<13);const Gd=new tx(64);for(let n=1;n<31;++n)Gd[n]=n<<23;Gd[31]=1199570944;Gd[32]=2147483648;for(let n=33;n<63;++n)Gd[n]=2147483648+(n-32<<23);Gd[63]=3347054592;const Xk=new jk(64);for(let n=1;n<64;++n)n!==32&&(Xk[n]=1024);function mV(n){const e=n>>10;return gV[0]=nx[Xk[e]+(n&1023)]+Gd[e],pV[0]}function Jk(n,e,...t){return mV(lV(n,e,...hV(t)))}var rx={exports:{}};function Qk(n,e,t){const i=t&&t.debug||!1;i&&console.log("[xml-utils] getting "+e+" in "+n);const r=typeof n=="object"?n.outer:n,s=r.slice(0,r.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],c=e+"\\="+l+"([^"+l+"]*)"+l;i&&console.log("[xml-utils] pattern:",c);const f=new RegExp(c).exec(s);if(i&&console.log("[xml-utils] match:",f),f)return f[1]}}rx.exports=Qk;rx.exports.default=Qk;var vV=rx.exports;const uw=hu(vV);var sx={exports:{}},ox={exports:{}},ax={exports:{}};function eM(n,e,t){const r=new RegExp(e).exec(n.slice(t));return r?t+r.index:-1}ax.exports=eM;ax.exports.default=eM;var yV=ax.exports,lx={exports:{}};function tM(n,e,t){const r=new RegExp(e).exec(n.slice(t));return r?t+r.index+r[0].length-1:-1}lx.exports=tM;lx.exports.default=tM;var _V=lx.exports,cx={exports:{}};function iM(n,e){const t=new RegExp(e,"g"),i=n.match(t);return i?i.length:0}cx.exports=iM;cx.exports.default=iM;var EV=cx.exports;const wV=yV,hw=_V,ZA=EV;function nM(n,e,t){const i=t&&t.debug||!1,r=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=wV(n,`<${e}[ 
>/]`,s);if(i&&console.log("[xml-utils] start:",o),o===-1)return;const a=n.slice(o+e.length);let l=hw(a,"^[^<]*[ /]>",0);const c=l!==-1&&a[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",c),c===!1)if(r){let m=0,y=1,_=0;for(;(l=hw(a,"[ /]"+e+">",m))!==-1;){const w=a.substring(m,l+1);if(y+=ZA(w,"<"+e+`[ 
	>]`),_+=ZA(w,"</"+e+">"),_>=y)break;m=l}}else l=hw(a,"[ /]"+e+">",0);const u=o+e.length+l+1;if(i&&console.log("[xml-utils] end:",u),u===-1)return;const f=n.slice(o,u);let p;return c?p=null:p=f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:p,outer:f,start:o,end:u}}ox.exports=nM;ox.exports.default=nM;var TV=ox.exports;const SV=TV;function rM(n,e,t){const i=[],r=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=SV(n,e,{debug:r,startIndex:o});)s?o=a.start+1+e.length:o=a.end,i.push(a);return r&&console.log("findTagsByName found",i.length,"tags"),i}sx.exports=rM;sx.exports.default=rM;var bV=sx.exports;const xV=hu(bV),fp={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},eo={};for(const n in fp)fp.hasOwnProperty(n)&&(eo[fp[n]]=parseInt(n,10));const CV=[eo.BitsPerSample,eo.ExtraSamples,eo.SampleFormat,eo.StripByteCounts,eo.StripOffsets,eo.StripRowCounts,eo.TileByteCounts,eo.TileOffsets,eo.SubIFDs],dw={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},kt={};for(const n in dw)dw.hasOwnProperty(n)&&(kt[dw[n]]=parseInt(n,10));const ar={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},RV={Unspecified:0,Assocalpha:1,Unassalpha:2},ime={Version:0,AddCompression:1},nme={None:0,Deflate:1,Zstandard:2},AV={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function LV(n,e){const{width:t,height:i}=n,r=new Uint8Array(t*i*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=256-n[o]/e*256,r[a]=s,r[a+1]=s,r[a+2]=s;return r}function IV(n,e){const{width:t,height:i}=n,r=new Uint8Array(t*i*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=n[o]/e*256,r[a]=s,r[a+1]=s,r[a+2]=s;return r}function PV(n,e){const{width:t,height:i}=n,r=new Uint8Array(t*i*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<n.length;++a,l+=3){const c=n[a];r[l]=e[c]/65536*256,r[l+1]=e[c+s]/65536*256,r[l+2]=e[c+o]/65536*256}return r}function DV(n){const{width:e,height:t}=n,i=new Uint8Array(e*t*3);for(let r=0,s=0;r<n.length;r+=4,s+=3){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3];i[s]=255*((255-o)/256)*((255-c)/256),i[s+1]=255*((255-a)/256)*((255-c)/256),i[s+2]=255*((255-l)/256)*((255-c)/256)}return i}function OV(n){const{width:e,height:t}=n,i=new Uint8ClampedArray(e*t*3);for(let r=0,s=0;r<n.length;r+=3,s+=3){const o=n[r],a=n[r+1],l=n[r+2];i[s]=o+1.402*(l-128),i[s+1]=o-.34414*(a-128)-.71414*(l-128),i[s+2]=o+1.772*(a-128)}return i}const kV=.95047,MV=1,NV=1.08883;function FV(n){const{width:e,height:t}=n,i=new Uint8Array(e*t*3);for(let r=0,s=0;r<n.length;r+=3,s+=3){const o=n[r+0],a=n[r+1]<<24>>24,l=n[r+2]<<24>>24;let c=(o+16)/116,u=a/500+c,f=c-l/200,p,m,y;u=kV*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=MV*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),f=NV*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),p=u*3.2406+c*-1.5372+f*-.4986,m=u*-.9689+c*1.8758+f*.0415,y=u*.0557+c*-.204+f*1.057,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,i[s]=Math.max(0,Math.min(1,p))*255,i[s+1]=Math.max(0,Math.min(1,m))*255,i[s+2]=Math.max(0,Math.min(1,y))*255}return i}const sM=new Map;function Hl(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>sM.set(t,e))}async function oM(n){const e=sM.get(n.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const t=await e();return new t(n)}Hl([void 0,1],()=>Bl(()=>import("./raw-D3z6yJ8o-DpkYBZ3-.js"),__vite__mapDeps([0,1])).then(n=>n.default));Hl(5,()=>Bl(()=>import("./lzw-CZKlmdgF-BzLpCAJq.js"),__vite__mapDeps([2,1])).then(n=>n.default));Hl(6,()=>{throw new Error("old style JPEG compression is not supported.")});Hl(7,()=>Bl(()=>import("./jpeg-CHs-Yi-F-DtJaof_w.js"),__vite__mapDeps([3,1])).then(n=>n.default));Hl([8,32946],()=>Bl(()=>import("./deflate-CnX71rVy-DeisypVQ.js"),__vite__mapDeps([4,5,1])).then(n=>n.default));Hl(32773,()=>Bl(()=>import("./packbits-DtqNFEAn-CqAYduWl.js"),__vite__mapDeps([6,1])).then(n=>n.default));Hl(34887,()=>Bl(()=>import("./lerc-CbspyELb-DoAaifyZ.js"),__vite__mapDeps([7,5,1,8,9])).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));Hl(50001,()=>Bl(()=>import("./webimage-POyqdea6-DrbzZhC4.js"),__vite__mapDeps([10,1])).then(n=>n.default));function F0(n,e,t,i=1){return new(Object.getPrototypeOf(n)).constructor(e*t*i)}function BV(n,e,t,i,r){const s=e/i,o=t/r;return n.map(a=>{const l=F0(a,i,r);for(let c=0;c<r;++c){const u=Math.min(Math.round(o*c),t-1);for(let f=0;f<i;++f){const p=Math.min(Math.round(s*f),e-1),m=a[u*e+p];l[c*i+f]=m}}return l})}function Jh(n,e,t){return(1-t)*n+t*e}function UV(n,e,t,i,r){const s=e/i,o=t/r;return n.map(a=>{const l=F0(a,i,r);for(let c=0;c<r;++c){const u=o*c,f=Math.floor(u),p=Math.min(Math.ceil(u),t-1);for(let m=0;m<i;++m){const y=s*m,_=y%1,w=Math.floor(y),T=Math.min(Math.ceil(y),e-1),x=a[f*e+w],C=a[f*e+T],I=a[p*e+w],D=a[p*e+T],B=Jh(Jh(x,C,_),Jh(I,D,_),u%1);l[c*i+m]=B}}return l})}function zV(n,e,t,i,r,s="nearest"){switch(s.toLowerCase()){case"nearest":return BV(n,e,t,i,r);case"bilinear":case"linear":return UV(n,e,t,i,r);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function GV(n,e,t,i,r,s){const o=e/i,a=t/r,l=F0(n,i,r,s);for(let c=0;c<r;++c){const u=Math.min(Math.round(a*c),t-1);for(let f=0;f<i;++f){const p=Math.min(Math.round(o*f),e-1);for(let m=0;m<s;++m){const y=n[u*e*s+p*s+m];l[c*i*s+f*s+m]=y}}}return l}function HV(n,e,t,i,r,s){const o=e/i,a=t/r,l=F0(n,i,r,s);for(let c=0;c<r;++c){const u=a*c,f=Math.floor(u),p=Math.min(Math.ceil(u),t-1);for(let m=0;m<i;++m){const y=o*m,_=y%1,w=Math.floor(y),T=Math.min(Math.ceil(y),e-1);for(let x=0;x<s;++x){const C=n[f*e*s+w*s+x],I=n[f*e*s+T*s+x],D=n[p*e*s+w*s+x],B=n[p*e*s+T*s+x],N=Jh(Jh(C,I,_),Jh(D,B,_),u%1);l[c*i*s+m*s+x]=N}}}return l}function $V(n,e,t,i,r,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return GV(n,e,t,i,r,s);case"bilinear":case"linear":return HV(n,e,t,i,r,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function VV(n,e,t){let i=0;for(let r=e;r<t;++r)i+=n[r];return i}function YT(n,e,t){switch(n){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function jV(n,e){return(n===1||n===2)&&e<=32&&e%8===0?!1:!(n===3&&(e===16||e===32||e===64))}function WV(n,e,t,i,r,s,o){const a=new DataView(n),l=t===2?o*s:o*s*i,c=t===2?1:i,u=YT(e,r,l),f=parseInt("1".repeat(r),2);if(e===1){let p;t===1?p=i*r:p=r;let m=s*p;m&7&&(m=m+7&-8);for(let y=0;y<o;++y){const _=y*m;for(let w=0;w<s;++w){const T=_+w*c*r;for(let x=0;x<c;++x){const C=T+x*r,I=(y*s+w)*c+x,D=Math.floor(C/8),B=C%8;if(B+r<=8)u[I]=a.getUint8(D)>>8-r-B&f;else if(B+r<=16)u[I]=a.getUint16(D)>>16-r-B&f;else if(B+r<=24){const N=a.getUint16(D)<<8|a.getUint8(D+2);u[I]=N>>24-r-B&f}else u[I]=a.getUint32(D)>>32-r-B&f}}}}return u.buffer}class aM{constructor(e,t,i,r,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=r,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(r,s){return Jk(this,r,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),r=this.getBitsPerSample(e);return YT(i,r,t)}async getTileOrStrip(e,t,i,r,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=i*o*a+t*o+e);let u,f;this.isTiled?(u=this.fileDirectory.TileOffsets[l],f=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],f=this.fileDirectory.StripByteCounts[l]);const p=(await this.source.fetch([{offset:u,length:f}],s))[0];let m;return c===null||!c[l]?(m=(async()=>{let y=await r.decode(this.fileDirectory,p);const _=this.getSampleFormat(),w=this.getBitsPerSample();return jV(_,w)&&(y=WV(y,_,this.planarConfiguration,this.getSamplesPerPixel(),w,this.getTileWidth(),this.getBlockHeight(t))),y})(),c!==null&&(c[l]=m)):m=c[l],{x:e,y:t,sample:i,data:await m}}async _readRaster(e,t,i,r,s,o,a,l,c){const u=this.getTileWidth(),f=this.getTileHeight(),p=this.getWidth(),m=this.getHeight(),y=Math.max(Math.floor(e[0]/u),0),_=Math.min(Math.ceil(e[2]/u),Math.ceil(p/u)),w=Math.max(Math.floor(e[1]/f),0),T=Math.min(Math.ceil(e[3]/f),Math.ceil(m/f)),x=e[2]-e[0];let C=this.getBytesPerPixel();const I=[],D=[];for(let z=0;z<t.length;++z)this.planarConfiguration===1?I.push(VV(this.fileDirectory.BitsPerSample,0,t[z])/8):I.push(0),D.push(this.getReaderForSample(t[z]));const B=[],{littleEndian:N}=this;for(let z=w;z<T;++z)for(let Z=y;Z<_;++Z){let q;this.planarConfiguration===1&&(q=this.getTileOrStrip(Z,z,0,s,c));for(let H=0;H<t.length;++H){const Y=H,ee=t[H];this.planarConfiguration===2&&(C=this.getSampleByteSize(ee),q=this.getTileOrStrip(Z,z,ee,s,c));const le=q.then(W=>{const ie=W.data,ne=new DataView(ie),J=this.getBlockHeight(W.y),ce=W.y*f,se=W.x*u,te=ce+J,Q=(W.x+1)*u,_e=D[Y],fe=Math.min(J,J-(te-e[3]),m-ce),pe=Math.min(u,u-(Q-e[2]),p-se);for(let Ce=Math.max(0,e[1]-ce);Ce<fe;++Ce)for(let xe=Math.max(0,e[0]-se);xe<pe;++xe){const Le=(Ce*u+xe)*C,je=_e.call(ne,Le+I[Y],N);let Ke;r?(Ke=(Ce+ce-e[1])*x*t.length+(xe+se-e[0])*t.length+Y,i[Ke]=je):(Ke=(Ce+ce-e[1])*x+xe+se-e[0],i[Y][Ke]=je)}});B.push(le)}}if(await Promise.all(B),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let z;return r?z=$V(i,e[2]-e[0],e[3]-e[1],o,a,t.length,l):z=zV(i,e[2]-e[0],e[3]-e[1],o,a,l),z.width=o,z.height=a,z}return i.width=o||e[2]-e[0],i.height=a||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:r=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:c}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const f=u[2]-u[0],p=u[3]-u[1],m=f*p,y=this.getSamplesPerPixel();if(!t||!t.length)for(let x=0;x<y;++x)t.push(x);else for(let x=0;x<t.length;++x)if(t[x]>=y)return Promise.reject(new RangeError(`Invalid sample index '${t[x]}'.`));let _;if(i){const x=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,C=Math.max.apply(null,this.fileDirectory.BitsPerSample);_=YT(x,C,m*t.length),l&&_.fill(l)}else{_=[];for(let x=0;x<t.length;++x){const C=this.getArrayForSample(t[x],m);Array.isArray(l)&&x<l.length?C.fill(l[x]):l&&!Array.isArray(l)&&C.fill(l),_.push(C)}}const w=r||await oM(this.fileDirectory);return await this._readRaster(u,t,_,i,w,s,o,a,c)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:r,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===ar.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==RV.Unspecified&&a){T=[];for(let x=0;x<this.fileDirectory.BitsPerSample.length;x+=1)T.push(x)}return this.readRasters({window:e,interleave:t,samples:T,pool:i,width:r,height:s,resampleMethod:o,signal:l})}let f;switch(u){case ar.WhiteIsZero:case ar.BlackIsZero:case ar.Palette:f=[0];break;case ar.CMYK:f=[0,1,2,3];break;case ar.YCbCr:case ar.CIELab:f=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const p={window:c,interleave:!0,samples:f,pool:i,width:r,height:s,resampleMethod:o,signal:l},{fileDirectory:m}=this,y=await this.readRasters(p),_=2**this.fileDirectory.BitsPerSample[0];let w;switch(u){case ar.WhiteIsZero:w=LV(y,_);break;case ar.BlackIsZero:w=IV(y,_);break;case ar.Palette:w=PV(y,m.ColorMap);break;case ar.CMYK:w=DV(y);break;case ar.YCbCr:w=OV(y);break;case ar.CIELab:w=FV(y);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const T=new Uint8Array(w.length/3),x=new Uint8Array(w.length/3),C=new Uint8Array(w.length/3);for(let I=0,D=0;I<w.length;I+=3,++D)T[D]=w[I],x[D]=w[I+1],C[D]=w[I+2];w=[T,x,C]}return w.width=y.width,w.height=y.height,w}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let r=xV(i,"Item");e===null?r=r.filter(s=>uw(s,"sample")===void 0):r=r.filter(s=>Number(uw(s,"sample"))===e);for(let s=0;s<r.length;++s){const o=r[s];t[uw(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return i[1]===0&&i[4]===0?[i[0],-i[5],i[10]]:[Math.sqrt(i[0]*i[0]+i[4]*i[4]),-Math.sqrt(i[1]*i[1]+i[5]*i[5]),i[10]];if(e){const[r,s,o]=e.getResolution();return[r*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),i=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[r,s,o,a,l,c,u,f]=this.fileDirectory.ModelTransformation,m=[[0,0],[0,t],[i,0],[i,t]].map(([w,T])=>[a+r*w+s*T,f+l*w+c*T]),y=m.map(w=>w[0]),_=m.map(w=>w[1]);return[Math.min(...y),Math.min(..._),Math.max(...y),Math.max(..._)]}else{const r=this.getOrigin(),s=this.getResolution(),o=r[0],a=r[1],l=o+s[0]*i,c=a+s[1]*t;return[Math.min(o,l),Math.min(a,c),Math.max(o,l),Math.max(a,c)]}}}class qV{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),r=this.getUint32(e+4,t);let s;if(t){if(s=i+2**32*r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+r,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let i=0;const r=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));r&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),i+=a*256**o}return r&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Jk(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class KV{constructor(e,t,i,r){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=r}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let r;if(this._littleEndian){if(r=t+2**32*i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*t+i,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let r=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));i&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),t+=o*256**s}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const ZV=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class YV{constructor(e=ZV,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{Bl(()=>import("./decoder-ASF8yMr9-CaSv2t6h.js"),[]).then(r=>{i(r.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<e;r++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?oM(e).then(i=>i.decode(e,t)):new Promise(i=>{const r=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(r.idle=!0,i(a.data.decoded),r.worker.removeEventListener("message",o))};r.worker.addEventListener("message",o),r.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const YA=`\r
\r
`;function lM(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const e={};for(const[t,i]of n)e[t.toLowerCase()]=i;return e}function XV(n){const e=n.split(`\r
`).map(t=>{const i=t.split(":").map(r=>r.trim());return i[0]=i[0].toLowerCase(),i});return lM(e)}function JV(n){const[e,...t]=n.split(";").map(r=>r.trim()),i=t.map(r=>r.split("="));return{type:e,params:lM(i)}}function XT(n){let e,t,i;return n&&([,e,t,i]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function QV(n,e){let t=null;const i=new TextDecoder("ascii"),r=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(n,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<n.byteLength;){const a=i.decode(new Uint8Array(n,t,Math.min(s.length+1024,n.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const c=l.indexOf(YA),u=XV(l.substr(0,c)),{start:f,end:p,total:m}=XT(u["content-range"]),y=t+s.length+c+YA.length,_=parseInt(p,10)+1-parseInt(f,10);r.push({headers:u,data:n.slice(y,y+_),offset:f,length:_,fileSize:m}),t=y+_+4}return r}class ux{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class e9 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,i]of e)this.onEviction(t,i.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const i=t.get(e);return this._getItemValue(e,i)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield e)}for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:i=this.maxAge}={}){const r=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],i=t.length-e;i<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(i>0&&this._emitEvictions(t.slice(0,i)),this.oldCache=new Map(t.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,i]=e;this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}for(const e of this.oldCache){const[t,i]=e;this.cache.has(t)||this._deleteIfExpired(t,i)===!1&&(yield[t,i.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,s]=i;this.cache.has(r)||this._deleteIfExpired(r,s)===!1&&(yield[r,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,r]of this.entriesAscending())e.call(t,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function t9(n){return new Promise(e=>setTimeout(e,n))}function i9(n,e){const t=Array.isArray(n)?n:Array.from(n),i=Array.isArray(e)?e:Array.from(e);return t.map((r,s)=>[r,i[s]])}class fd extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,fd),this.name="AbortError"}}class n9 extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const r9=n9;class s9{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class XA{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class o9 extends ux{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new e9({maxSize:i,onEviction:(r,s)=>{this.evictedBlocks.set(r,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=[],r=[],s=[];this.evictedBlocks.clear();for(const{offset:p,length:m}of e){let y=p+m;const{fileSize:_}=this;_!==null&&(y=Math.min(y,_));const w=Math.floor(p/this.blockSize)*this.blockSize;for(let T=w;T<y;T+=this.blockSize){const x=Math.floor(T/this.blockSize);!this.blockCache.has(x)&&!this.blockRequests.has(x)&&(this.blockIdsToFetch.add(x),r.push(x)),this.blockRequests.has(x)&&i.push(this.blockRequests.get(x)),s.push(x)}}await t9(),this.fetchBlocks(t);const o=[];for(const p of r)this.blockRequests.has(p)&&o.push(this.blockRequests.get(p));await Promise.allSettled(i),await Promise.allSettled(o);const a=[],l=s.filter(p=>this.abortedBlockIds.has(p)||!this.blockCache.has(p));if(l.forEach(p=>this.blockIdsToFetch.add(p)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const p of l){const m=this.blockRequests.get(p);if(!m)throw new Error(`Block ${p} is not in the block requests`);a.push(m)}await Promise.allSettled(a)}if(t&&t.aborted)throw new fd("Request was aborted");const c=s.map(p=>this.blockCache.get(p)||this.evictedBlocks.get(p)),u=c.filter(p=>!p);if(u.length)throw new r9(u,"Request failed");const f=new Map(i9(s,c));return this.readSliceData(e,f)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let r=0;r<t.length;++r){const s=t[r];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await i)[r],l=o*this.blockSize,c=l-a.offset,u=Math.min(c+this.blockSize,a.data.byteLength),f=a.data.slice(c,u),p=new s9(l,f.byteLength,f,o);this.blockCache.set(o,p),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let i=[],r=null;const s=[];for(const o of t)r===null||r+1===o?(i.push(o),r=o):(s.push(new XA(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],r=o);return s.push(new XA(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(e,t){return e.map(i=>{let r=i.offset+i.length;this.fileSize!==null&&(r=Math.min(this.fileSize,r));const s=Math.floor(i.offset/this.blockSize),o=Math.floor(r/this.blockSize),a=new ArrayBuffer(i.length),l=new Uint8Array(a);for(let c=s;c<=o;++c){const u=t.get(c),f=u.offset-i.offset,p=u.top-r;let m=0,y=0,_;f<0?m=-f:f>0&&(y=f),p<0?_=u.length-m:_=r-u.offset-m;const w=new Uint8Array(u.data,m,_);l.set(w,y)}return a})}}class hx{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class dx{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class a9 extends hx{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class l9 extends dx{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const i=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new a9(i)}}class c9 extends hx{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class u9 extends dx{constructRequest(e,t){return new Promise((i,r)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;i(new c9(s,o))},s.onerror=r,s.onabort=()=>r(new fd("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Wv={},h9=Object.freeze(Object.defineProperty({__proto__:null,default:Wv},Symbol.toStringTag,{value:"Module"}));class d9 extends hx{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class f9 extends dx{constructor(e){super(e),this.parsedUrl=Wv.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Wv)}constructRequest(e,t){return new Promise((i,r)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const c=[];o.on("data",u=>{c.push(u)}),o.on("end",()=>{const u=Buffer.concat(c).buffer;l(u)}),o.on("error",r)});i(new d9(o,a))});s.on("error",r),t&&(t.aborted&&s.destroy(new fd("Request aborted")),t.addEventListener("abort",()=>s.destroy(new fd("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class fx extends ux{constructor(e,t,i,r){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=r,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:r,length:s})=>`${r}-${r+s}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:r,params:s}=JV(i.getHeader("content-type"));if(r==="multipart/byteranges"){const f=QV(await i.getData(),s.boundary);return this._fileSize=f[0].fileSize||null,f}const o=await i.getData(),{start:a,end:l,total:c}=XT(i.getHeader("content-range"));this._fileSize=c||null;const u=[{data:o,offset:a,length:l-a}];if(e.length>1){const f=await Promise.all(e.slice(1).map(p=>this.fetchSlice(p,t)));return u.concat(f)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const r=await i.getData();return this._fileSize=r.byteLength,[{data:r,offset:0,length:r.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:r}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+r}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=XT(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:r}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function px(n,{blockSize:e,cacheSize:t}){return e===null?n:new o9(n,{blockSize:e,cacheSize:t})}function p9(n,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:r=!1,...s}={}){const o=new l9(n,t),a=new fx(o,e,i,r);return px(a,s)}function g9(n,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...r}={}){const s=new u9(n),o=new fx(s,e,t,i);return px(o,r)}function m9(n,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...r}={}){const s=new f9(n),o=new fx(s,e,t,i);return px(o,r)}function JT(n,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?p9(n,t):typeof XMLHttpRequest<"u"?g9(n,t):m9(n,t)}class v9 extends ux{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,r)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=r,o.onabort=r,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function y9(n){return new v9(n)}function QT(n){switch(n){case kt.BYTE:case kt.ASCII:case kt.SBYTE:case kt.UNDEFINED:return 1;case kt.SHORT:case kt.SSHORT:return 2;case kt.LONG:case kt.SLONG:case kt.FLOAT:case kt.IFD:return 4;case kt.RATIONAL:case kt.SRATIONAL:case kt.DOUBLE:case kt.LONG8:case kt.SLONG8:case kt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function _9(n){const e=n.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const r=AV[e[i]],s=e[i+1]?fp[e[i+1]]:null,o=e[i+2],a=e[i+3];let l=null;if(!s)l=a;else{if(l=n[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${r}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[r]=l}return t}function gh(n,e,t,i){let r=null,s=null;const o=QT(e);switch(e){case kt.BYTE:case kt.ASCII:case kt.UNDEFINED:r=new Uint8Array(t),s=n.readUint8;break;case kt.SBYTE:r=new Int8Array(t),s=n.readInt8;break;case kt.SHORT:r=new Uint16Array(t),s=n.readUint16;break;case kt.SSHORT:r=new Int16Array(t),s=n.readInt16;break;case kt.LONG:case kt.IFD:r=new Uint32Array(t),s=n.readUint32;break;case kt.SLONG:r=new Int32Array(t),s=n.readInt32;break;case kt.LONG8:case kt.IFD8:r=new Array(t),s=n.readUint64;break;case kt.SLONG8:r=new Array(t),s=n.readInt64;break;case kt.RATIONAL:r=new Uint32Array(t*2),s=n.readUint32;break;case kt.SRATIONAL:r=new Int32Array(t*2),s=n.readInt32;break;case kt.FLOAT:r=new Float32Array(t),s=n.readFloat32;break;case kt.DOUBLE:r=new Float64Array(t),s=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===kt.RATIONAL||e===kt.SRATIONAL)for(let a=0;a<t;a+=2)r[a]=s.call(n,i+a*o),r[a+1]=s.call(n,i+(a*o+4));else for(let a=0;a<t;++a)r[a]=s.call(n,i+a*o);return e===kt.ASCII?new TextDecoder("utf-8").decode(r):r}class E9{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class tv extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class cM{async readRasters(e={}){const{window:t,width:i,height:r}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let c=l;const u=await this.getImageCount(),f=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(i||r){if(t){const[y,_]=l.getOrigin(),[w,T]=l.getResolution();a=[y+t[0]*w,_+t[1]*T,y+t[2]*w,_+t[3]*T]}const m=a||f;if(i){if(s)throw new Error("Both width and resX passed");s=(m[2]-m[0])/i}if(r){if(o)throw new Error("Both width and resY passed");o=(m[3]-m[1])/r}}if(s||o){const m=[];for(let y=0;y<u;++y){const _=await this.getImage(y),{SubfileType:w,NewSubfileType:T}=_.fileDirectory;(y===0||w===2||T&1)&&m.push(_)}m.sort((y,_)=>y.getWidth()-_.getWidth());for(let y=0;y<m.length;++y){const _=m[y],w=(f[2]-f[0])/_.getWidth(),T=(f[3]-f[1])/_.getHeight();if(c=_,s&&s>w||o&&o>T)break}}let p=t;if(a){const[m,y]=l.getOrigin(),[_,w]=c.getResolution(l);p=[Math.round((a[0]-m)/_),Math.round((a[1]-y)/w),Math.round((a[2]-m)/_),Math.round((a[3]-y)/w)],p=[Math.min(p[0],p[2]),Math.min(p[1],p[3]),Math.max(p[0],p[2]),Math.max(p[1],p[3])]}return c.readRasters({...e,window:p})}}class pd extends cM{constructor(e,t,i,r,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=r,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new KV((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let r=await this.getSlice(e);const s=this.bigTiff?r.readUint64(e):r.readUint16(e),o=s*t+(this.bigTiff?16:6);r.covers(e,o)||(r=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let f=0;f<s;l+=t,++f){const p=r.readUint16(l),m=r.readUint16(l+2),y=this.bigTiff?r.readUint64(l+4):r.readUint32(l+4);let _,w;const T=QT(m),x=l+(this.bigTiff?12:8);if(T*y<=(this.bigTiff?8:4))_=gh(r,m,y,x);else{const C=r.readOffset(x),I=QT(m)*y;if(r.covers(C,I))_=gh(r,m,y,C);else{const D=await this.getSlice(C,I);_=gh(D,m,y,C)}}y===1&&CV.indexOf(p)===-1&&!(m===kt.RATIONAL||m===kt.SRATIONAL)?w=_[0]:w=_,a[fp[p]]=w}const c=_9(a),u=r.readOffset(e+i+t*s);return new E9(a,c,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof tv?new tv(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new tv(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new aM(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof tv)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let r=await this.getSlice(e,i);if(t===gh(r,kt.ASCII,t.length,e)){const o=gh(r,kt.ASCII,i,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>i&&(r=await this.getSlice(e,a));const l=gh(r,kt.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,u])=>{this.ghostValues[c]=u})}return this.ghostValues}static async fromSource(e,t,i){const r=(await e.fetch([{offset:0,length:1024}],i))[0],s=new qV(r),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=c?s.getUint64(8,a):s.getUint32(4,a);return new pd(e,a,c,u,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class w9 extends cM{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let r=0;r<this.imageFiles.length;r++){const s=this.imageFiles[r];for(let o=0;o<this.imageCounts[r];o++){if(e===t){const a=await s.requestIFD(i);return new aM(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function T9(n,e={},t){return pd.fromSource(JT(n,e),t)}async function S9(n,e){return pd.fromSource(y9(n),e)}async function b9(n,e=[],t={},i){const r=await pd.fromSource(JT(n,t),i),s=await Promise.all(e.map(o=>pd.fromSource(JT(o,t))));return new w9(r,s)}function x9(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function C9(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,i=ar;return t===i.CMYK||t===i.YCbCr||t===i.CIELab||t===i.ICCLab}const JA="STATISTICS_MAXIMUM",QA="STATISTICS_MINIMUM",fw=256;let pw;function R9(){return pw||(pw=new YV),pw}function A9(n){try{return n.getBoundingBox()}catch{return[0,0,n.getWidth(),n.getHeight()]}}function L9(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function I9(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}function P9(n){const e=n.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let i=Ti(t);if(!i){const r=KR(e.ProjLinearUnitsGeoKey);r&&(i=new Ep({code:t,units:r}))}return i}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let i=Ti(t);if(!i){const r=KR(e.GeogAngularUnitsGeoKey);r&&(i=new Ep({code:t,units:r}))}return i}return null}function D9(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let i=0;i<e;++i)t[i]=n.getImage(i);return Promise.all(t)})}function O9(n,e){let t;return n.blob?t=S9(n.blob):n.overviews?t=b9(n.url,n.overviews,e):t=T9(n.url,e),t.then(D9)}function rp(n,e,t,i,r){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(i);throw r(o),o}for(let o=0;o<s;++o)rp(n[o],e[o],t,i,r);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(i)}function k9(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function M9(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class N9 extends kH{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const i=this,r=new Array(t);for(let s=0;s<t;++s)r[s]=O9(this.sourceInfo_[s],this.sourceOptions_);Promise.all(r).then(function(s){i.configure_(s)}).catch(function(s){QR(s),i.error_=s,i.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let i=t.length-1;i>=0;--i){const r=t[i],s=P9(r);if(s){this.projection=s;break}}}configure_(e){let t,i,r,s,o;const a=new Array(e.length),l=new Array(e.length),c=new Array(e.length);let u=0;const f=e.length;for(let _=0;_<f;++_){const w=[],T=[];e[_].forEach(z=>{x9(z)?T.push(z):w.push(z)});const x=w.length;if(T.length>0&&T.length!==x)throw new Error(`Expected one mask per image found ${T.length} masks and ${x} images`);let C,I;const D=new Array(x),B=new Array(x),N=new Array(x);l[_]=new Array(x),c[_]=new Array(x);for(let z=0;z<x;++z){const Z=w[z],q=Z.getGDALNoData();c[_][z]=Z.getGDALMetadata(0),l[_][z]=q;const H=this.sourceInfo_[_].bands;a[_]=H?H.length:Z.getSamplesPerPixel();const Y=x-(z+1);C||(C=A9(Z)),I||(I=L9(Z));const ee=I9(Z,w[0]);N[Y]=ee[0];const le=[Z.getTileWidth(),Z.getTileHeight()];le[0]!==le[1]&&le[1]<fw&&(le[0]=fw,le[1]=fw),D[Y]=le;const W=ee[0]/Math.abs(ee[1]);B[Y]=[le[0],le[1]/W]}if(t?mr(t,C,t):t=C,!i)i=I;else{const z=`Origin mismatch for source ${_}, got [${I}] but expected [${i}]`;rp(i,I,0,z,this.viewRejector)}if(!o)o=N,this.resolutionFactors_[_]=1;else{o.length-u>N.length&&(u=o.length-N.length);const z=o[o.length-1]/N[N.length-1];this.resolutionFactors_[_]=z;const Z=N.map(H=>H*=z),q=`Resolution mismatch for source ${_}, got [${Z}] but expected [${o}]`;rp(o.slice(u,o.length),Z,.02,q,this.viewRejector)}r?rp(r.slice(u,r.length),B,.01,`Tile size mismatch for source ${_}`,this.viewRejector):r=B,s?rp(s.slice(u,s.length),D,0,`Tile size mismatch for source ${_}`,this.viewRejector):s=D,this.sourceImagery_[_]=w.reverse(),this.sourceMasks_[_]=T.reverse()}for(let _=0,w=this.sourceImagery_.length;_<w;++_){const T=this.sourceImagery_[_];for(;T.length<o.length;)T.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=c;e:for(let _=0;_<f;++_){if(this.sourceInfo_[_].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[_].length){this.addAlpha_=!0;break}const w=l[_],T=this.sourceInfo_[_].bands;if(T){for(let x=0;x<T.length;++x)if(w[T[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<w.length;++x)if(w[x]!==null){this.addAlpha_=!0;break e}}let p=this.addAlpha_?1:0;for(let _=0;_<f;++_)p+=a[_];this.bandCount=p;const m=new M0({extent:t,minZoom:u,origin:i,resolutions:o,tileSizes:r});this.tileGrid=m,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const y=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:_y(Ll(t),this.projection),extent:yO(t,this.projection),zoom:y})}loadTile_(e,t,i){const r=this.getTileSize(e),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,c=R9();for(let u=0;u<s;++u){const f=l[u],p=this.resolutionFactors_[u],m=[Math.round(t*(r[0]*p)),Math.round(i*(r[1]*p)),Math.round((t+1)*(r[0]*p)),Math.round((i+1)*(r[1]*p))],y=this.sourceImagery_[u][e];let _;f.bands&&(_=f.bands.map(function(I){return I-1}));let w;"nodata"in f&&f.nodata!==null?w=f.nodata:_?w=_.map(function(I){return a[u][I]}):w=a[u];const T={window:m,width:r[0],height:r[1],samples:_,fillValue:w,pool:c,interleave:!1};C9(this.convertToRGB_,y)?o[u]=y.readRGB(T):o[u]=y.readRasters(T);const x=s+u,C=this.sourceMasks_[u][e];if(!C){o[x]=Promise.resolve(null);continue}o[x]=C.readRasters({window:m,width:r[0],height:r[1],samples:[0],pool:c,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,r)).catch(function(u){throw QR(u),u})}composeTile_(e,t){const i=this.metadata_,r=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,c=this.normalize_,u=this.addAlpha_,f=e[0]*e[1],p=f*o;let m;c?m=new Uint8Array(p):m=new Float32Array(p);let y=0;for(let _=0;_<f;++_){let w=u;for(let T=0;T<s;++T){const x=r[T];let C=x.min,I=x.max,D,B;if(c){const N=i[T][0];C===void 0&&(N&&QA in N?C=parseFloat(N[QA]):C=k9(t[T][0])),I===void 0&&(N&&JA in N?I=parseFloat(N[JA]):I=M9(t[T][0])),D=255/(I-C),B=-C*D}for(let N=0;N<a[T];++N){const z=t[T][N][_];let Z;if(c?Z=Ii(D*z+B,0,255):Z=z,!u)m[y]=Z;else{let q=x.nodata;if(q===void 0){let Y;x.bands?Y=x.bands[N]-1:Y=N,q=l[T][Y]}const H=isNaN(q);(!H&&z!==q||H&&!isNaN(z))&&(w=!1,m[y]=Z)}y++}if(!w){const N=s+T,z=t[N];z&&!z[0][_]&&(w=!0)}}u&&(w||(m[y]=255),y++)}return m}}class F9 extends tg{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(yt.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===Ie.LOADED,this.loaded)this.uploadTile();else{if(e instanceof P0){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(yt.CHANGE,this.handleTileChange_)}}uploadTile(){Et()}setReady(){this.ready=!0,this.dispatchEvent(yt.CHANGE)}handleTileChange_(){this.tile.getState()===Ie.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(yt.CHANGE,this.handleTileChange_)}}const gx=34962,mx=34963,B9=35040,vx=35044,U9=35048,z9=5121,G9=5123,H9=5125,uM=5126,eL=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function $9(n,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!yz},e);const t=eL.length;for(let i=0;i<t;++i)try{const r=n.getContext(eL[i],e);if(r)return r}catch{}return null}const V9={STATIC_DRAW:vx,STREAM_DRAW:B9,DYNAMIC_DRAW:U9};class hM{constructor(e,t){this.array=null,this.type=e,Kt(e===gx||e===mx,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage=t!==void 0?t:V9.STATIC_DRAW}ofSize(e){return this.array=new(gw(this.type))(e),this}fromArray(e){return this.array=gw(this.type).from(e),this}fromArrayBuffer(e){return this.array=new(gw(this.type))(e),this}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}}function gw(n){switch(n){case gx:return Float32Array;case mx:return Uint32Array;default:return Float32Array}}function dM(n,e,t){const i=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i)}function j9(n,e,t,i){dM(n,e,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}function tL(n,e,t,i,r,s){const o=n.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,n.getExtension("OES_texture_float"),l=n.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),dM(o,e,s&&l);const c=t.byteLength/i[1];let u=1;c%8===0?u=8:c%4===0?u=4:c%2===0&&(u=2);let f;switch(r){case 1:{f=o.LUMINANCE;break}case 2:{f=o.LUMINANCE_ALPHA;break}case 3:{f=o.RGB;break}case 4:{f=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const p=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,f,i[0],i[1],0,f,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,p)}let Nh=null;function W9(){Nh=pn(1,1,void 0,{willReadFrequently:!0})}class q9 extends F9{constructor(e){super(e),this.textures=[],this.renderSize_=Bi(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new hM(gx,vx);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),i=this.tile;this.textures.length=0;let r;i instanceof P0||i instanceof hd?r=i.getImage():r=i.getData();const s=Py(r);if(s){const x=t.createTexture();this.textures.push(x),this.bandCount=4,j9(t,x,s,i.interpolate),this.setReady();return}r=qT(r);const o=i.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,c=a[0]*a[1],u=l?Float32Array:Uint8Array,f=u.BYTES_PER_ELEMENT,p=r.byteLength/a[1];this.bandCount=Math.floor(p/f/a[0]);const m=Math.ceil(this.bandCount/4);if(m===1){const x=t.createTexture();this.textures.push(x),tL(e,x,r,a,this.bandCount,i.interpolate),this.setReady();return}const y=new Array(m);for(let x=0;x<m;++x){const C=t.createTexture();this.textures.push(C);const I=x<m-1?4:(this.bandCount-1)%4+1;y[x]=new u(c*I)}let _=0,w=0;const T=a[0]*this.bandCount;for(let x=0;x<a[1];++x){for(let C=0;C<T;++C){const I=r[w+C],D=Math.floor(_/this.bandCount),B=C%this.bandCount,N=Math.floor(B/4),z=y[N],Z=z.length/c,q=B%4;z[D*Z+q]=I,++_}w+=p/f}for(let x=0;x<m;++x){const C=this.textures[x],I=y[x],D=I.length/c;tL(e,C,I,a,D,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(yt.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,i){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];Nh||W9(),Nh.clearRect(0,0,1,1);const a=e.width,l=e.height,c=a-2*r,u=l-2*r,f=r+Math.floor(c*(t/s)),p=r+Math.floor(u*(i/o));let m;try{Nh.drawImage(e,f,p,1,1,0,0,1,1),m=Nh.getImageData(0,0,1,1).data}catch{return Nh=null,null}return m}getArrayPixelData_(e,t,i,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],c=t[1],u=l+2*s,f=c+2*s,p=s+Math.floor(l*(i/o)),m=s+Math.floor(c*(r/a));if(e instanceof DataView){const _=e.byteLength/(u*f),w=_*(m*u+p),T=e.buffer.slice(w,w+_);return new DataView(T)}const y=this.bandCount*(m*u+p);return e.slice(y,y+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Zb){const i=this.tile.getData(),r=qT(i);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,e,t)}return this.getImagePixelData_(Py(i),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const iv={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},K9=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Z9=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class iL{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vertexShader||K9),t.compileShader(i);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fragmentShader||Z9),t.compileShader(r),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,i),t.attachShader(this.renderTargetProgram_,r),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),i=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const r=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,c=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,r,s,i[0],i[1],o,a,l,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i[0],i[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,i,r){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Mt(s.canvas);if(!e.renderTargets[l]){const c=s.getContextAttributes();c&&c.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),i&&i(s,e),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let i,r=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,i.width,i.height,0,t.UNSIGNED_BYTE,new Uint8Array(i.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(s.location,r++);else if(Array.isArray(i))switch(i.length){case 2:t.uniform2f(s.location,i[0],i[1]);return;case 3:t.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:t.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(s.location,i)})}}function fM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pM(n,e){return n[0]=e[0],n[1]=e[1],n[4]=e[2],n[5]=e[3],n[12]=e[4],n[13]=e[5],n}const ol={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},sp={UNSIGNED_BYTE:z9,UNSIGNED_SHORT:G9,UNSIGNED_INT:H9,FLOAT:uM},Oy={};function nL(n){return"shared/"+n}let rL=0;function Y9(){const n="unique/"+rL;return rL+=1,n}function X9(n){let e=Oy[n];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:$9(t)},Oy[n]=e}return e.users+=1,e.context}function J9(n){const e=Oy[n];if(!e||(e.users-=1,e.users>0))return;const t=e.context,i=t.getExtension("WEBGL_lose_context");i&&i.loseContext();const r=t.canvas;r.width=1,r.height=1,delete Oy[n]}class Q9 extends p0{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?nL(e.canvasCacheKey):Y9(),this.gl_=X9(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(iv.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(iv.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Un(),this.offsetScaleMatrix_=Un(),this.tmpMat4_=fM(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(i=>new iL({webGlContext:this.gl_,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})):[new iL({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===nL(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,i=Mt(e);let r=this.bufferCache_[i];if(!r){const s=t.createBuffer();r={buffer:e,webGlBuffer:s},this.bufferCache_[i]=r}t.bindBuffer(e.getType(),r.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,i=Mt(e),r=this.bufferCache_[i];r&&!t.isContextLost()&&t.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(iv.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(iv.RESTORED,this.boundHandleWebGLContextRestored_),J9(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,i){const r=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),i?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(e,t,i){const r=this.gl_;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.getUniformLocation(i),t)}prepareDrawToRenderTarget(e,t,i,r){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,i?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const i=this.gl_;this.getExtension("OES_element_index_uint");const r=i.UNSIGNED_INT,s=4,o=t-e,a=e*s;i.drawElements(i.TRIANGLES,o,r,a)}finalizeDraw(e,t,i){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(e,null,t,i):this.postProcessPasses_[r].apply(e,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,i=e.viewState.rotation,r=e.pixelRatio;this.setUniformFloatValue(ol.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(ol.ZOOM,e.viewState.zoom),this.setUniformFloatValue(ol.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(ol.PIXEL_RATIO,r),this.setUniformFloatVec2(ol.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(ol.ROTATION,i)}applyHitDetectionUniform(e){const t=this.getUniformLocation(ol.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(ol.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let i,r=0;this.uniforms_.forEach(s=>{if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,r,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&s.prevValue!==i&&(s.prevValue=i,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)),r++;else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,pM(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:t.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(this.getUniformLocation(s.name),i)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const i=this.gl_,r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}getProgram(e,t){const i=this.gl_,r=this.compileShader(e,i.FRAGMENT_SHADER),s=this.compileShader(t,i.VERTEX_SHADER),o=i.createProgram();if(i.attachShader(o,r),i.attachShader(o,s),i.linkProgram(o),!i.getShaderParameter(r,i.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(a)}if(i.deleteShader(r),!i.getShaderParameter(s,i.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(a)}if(i.deleteShader(s),!i.getProgramParameter(o,i.LINK_STATUS)){const a=`GL program linking failed: ${i.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Mt(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Mt(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const i=e.size,r=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Ls(t,0,0,2/(s*i[0]),2/(s*i[1]),-r,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,i,r,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,i,!1,r,s))}enableAttributes(e){const t=ej(e);let i=0;for(let r=0;r<e.length;r++){const s=e[r];this.enableAttributeArray_(s.name,s.size,s.type||uM,t,i),i+=s.size*gM(s.type)}}handleWebGLContextLost(e){kd(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,i){const r=this.gl_;i=i||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,c=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,i),t?r.texImage2D(r.TEXTURE_2D,s,o,l,c,t):r.texImage2D(r.TEXTURE_2D,s,o,e[0],e[1],a,l,c,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i}}function ej(n){let e=0;for(let t=0;t<n.length;t++){const i=n[t];e+=i.size*gM(i.type)}return e}function gM(n){switch(n){case sp.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case sp.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case sp.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case sp.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class yx extends tk{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Un(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(Jt.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(ur.PRECOMPOSE)){const r=new up(ur.PRECOMPOSE,void 0,t,e);i.dispatchEvent(r)}}dispatchPostComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(ur.POSTCOMPOSE)){const r=new up(ur.POSTCOMPOSE,void 0,t,e);i.dispatchEvent(r)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,i=-1,r;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,c=l.getRenderer();if(!(c instanceof yx)){t=!0;continue}const u=l.getClassName();if((t||u!==r)&&(i+=1,t=!1),r=u,c===this)break}const s="map/"+e.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Q9({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){Ls(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new up(e,this.inversePixelTransform_,i,t);r.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(ur.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(ur.POSTRENDER,e,t)}}const tj={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},ij={};function nj(n){return 1/(n+2)}function rj(){return{tileIds:new Set,representationsByZ:{}}}function sL(n,e){return n.tileIds.has(Mt(e))}function oL(n,e,t){const i=n.representationsByZ;t in i||(i[t]=new Set),i[t].add(e),n.tileIds.add(Mt(e.tile))}function mw(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=mr(e,ml(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(n.viewState.projection).getExtent();r&&(e=mr(e,r))}return e}function eS(n,e){return`${n.getKey()},${Uc(e)}`}class sj extends yx{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=Un(),this.tempMat4=fM(),this.tempTileRange_=new k0(0,0,0,0),this.tempTileCoord_=Ly(0,0,0),this.tempSize_=[0,0];const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new hk(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),i=e.getState(),r=t.getUseInterimTilesOnError();return i==Ie.LOADED||i==Ie.EMPTY||i==Ie.ERROR&&!r}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const i=this.getLayer().getRenderSource();return!i||Nd(mw(e,e.extent))?!1:i.getState()==="ready"}createTileRepresentation(e){return Et()}enqueueTiles(e,t,i,r,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),u=l.getGutterForProjection(o.projection),f=Mt(l);f in e.wantedTiles||(e.wantedTiles[f]={});const p=e.wantedTiles[f],m=this.tileRepresentationCache,y=a.getMapInternal(),_=Math.max(i-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),y?y.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection));for(let w=i;w>=_;--w){const T=c.getTileRangeForExtentAndZ(t,w,this.tempTileRange_),x=c.getResolution(w);for(let C=T.minX;C<=T.maxX;++C)for(let I=T.minY;I<=T.maxY;++I){const D=Ly(w,C,I,this.tempTileCoord_),B=eS(l,D);let N,z;if(m.containsKey(B)&&(N=m.get(B),z=N.tile),(!N||N.tile.key!==l.getKey())&&(z=l.getTile(w,C,I,e.pixelRatio,o.projection)),sL(r,z))continue;if(!N)N=this.createTileRepresentation({tile:z,grid:c,helper:this.helper,gutter:u}),m.set(B,N);else if(this.isDrawableTile_(z))N.setTile(z);else{const q=z.getInterimTile();N.setTile(q)}oL(r,N,w);const Z=z.getKey();p[Z]=!0,z.getState()===Ie.IDLE&&(e.tileQueue.isKeyQueued(Z)||e.tileQueue.enqueue([z,f,c.getTileCoordCenter(D),x]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}renderTile(e,t,i,r,s,o,a,l,c,u,f){}drawTile_(e,t,i,r,s,o,a){if(!t.loaded)return;const c=t.tile.tileCoord,u=Uc(c),f=u in o?o[u]:1,p=a.getResolution(i),m=Bi(a.getTileSize(i),this.tempSize_),y=a.getOrigin(i),_=a.getTileCoordExtent(c),w=f<1?-1:nj(i);f<1&&(e.animate=!0);const T=e.viewState,x=T.center[0],C=T.center[1],I=m[0]+2*r,D=m[1]+2*r,B=I/D,N=(x-y[0])/(m[0]*p),z=(y[1]-C)/(m[1]*p),Z=T.resolution/p,q=c[1],H=c[2];IT(this.tileTransform_),lp(this.tileTransform_,2/(e.size[0]*Z/I),-2/(e.size[1]*Z/I)),wz(this.tileTransform_,T.rotation),lp(this.tileTransform_,1,1/B),oO(this.tileTransform_,(m[0]*(q-N)-r)/I,(m[1]*(H-z)-r)/D),this.renderTile(t,this.tileTransform_,e,s,p,m,y,_,w,r,f)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const i=e.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(i.projection),a=s.getGutterForProjection(i.projection),l=mw(e,e.extent),c=o.getZForResolution(i.resolution,s.zDirection),u=rj(),f=r.getPreload();if(e.nextExtent){const D=o.getZForResolution(i.nextResolution,s.zDirection),B=mw(e,e.nextExtent);this.enqueueTiles(e,B,D,u,f)}this.enqueueTiles(e,l,c,u,0),f>0&&setTimeout(()=>{this.enqueueTiles(e,l,c-1,u,f-1)},0);const p={},m=Mt(this),y=e.time;let _=!1;for(const D of u.representationsByZ[c]){const B=D.tile;if((B instanceof hd||B instanceof Yb)&&B.getState()===Ie.EMPTY)continue;const N=B.tileCoord;if(D.loaded){const q=B.getAlpha(m,y);if(q===1){B.endTransition(m);continue}_=!0;const H=Uc(N);p[H]=q}if(this.renderComplete=!1,this.findAltTiles_(o,N,c+1,u))continue;const Z=o.getMinZoom();for(let q=c-1;q>=Z&&!this.findAltTiles_(o,N,q,u);--q);}this.beforeTilesRender(e,_);const w=u.representationsByZ,T=Object.keys(w).map(Number).sort(lz);for(let D=0,B=T.length;D<B;++D){const N=T[D];for(const z of w[N]){const Z=z.tile.tileCoord;Uc(Z)in p||this.drawTile_(e,z,N,a,l,p,o)}}for(const D of w[c]){const B=D.tile.tileCoord;Uc(B)in p&&this.drawTile_(e,D,c,a,l,p,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const x=this.helper.getCanvas(),C=this.tileRepresentationCache;for(;C.canExpireCache();)C.pop().dispose();const I=function(D,B){s.updateCacheSize(.1,B.viewState.projection),s.expireCache(B.viewState.projection,ij)};return e.postRenderFunctions.push(I),this.postRender(t,e),x}findAltTiles_(e,t,i,r){const s=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let c=s.minX;c<=s.maxX;++c)for(let u=s.minY;u<=s.maxY;++u){const f=eS(l,[i,c,u]);let p=!1;if(a.containsKey(f)){const m=a.get(f);m.loaded&&!sL(r,m.tile)&&(oL(r,m,i),p=!0)}p||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const At={...tj,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},qv={TEXTURE_COORD:"a_textureCoord"},oj=[{name:qv.TEXTURE_COORD,size:2,type:sp.FLOAT}];class aj extends sj{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new hM(mx,vx),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new q9(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,i,r,s,o,a,l,c,u,f){const p=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(oj);let m=0;for(;m<e.textures.length;){const B=`${At.TILE_TEXTURE_ARRAY}[${m}]`;this.helper.bindTexture(e.textures[m],m,B),++m}for(let B=0;B<this.paletteTextures_.length;++B){const N=this.paletteTextures_[B],z=N.getTexture(p);this.helper.bindTexture(z,m,N.name),++m}const y=i.viewState,_=o[0]+2*u,w=o[1]+2*u,x=e.tile.tileCoord,C=x[1],I=x[2];this.helper.setUniformMatrixValue(At.TILE_TRANSFORM,pM(this.tempMat4,t)),this.helper.setUniformFloatValue(At.TRANSITION_ALPHA,f),this.helper.setUniformFloatValue(At.DEPTH,c);let D=r;u>0&&(D=l,mr(D,r,D)),this.helper.setUniformFloatVec4(At.RENDER_EXTENT,D),this.helper.setUniformFloatValue(At.RESOLUTION,y.resolution),this.helper.setUniformFloatValue(At.ZOOM,y.zoom),this.helper.setUniformFloatValue(At.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(At.TEXTURE_PIXEL_HEIGHT,w),this.helper.setUniformFloatValue(At.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(At.TEXTURE_ORIGIN_X,a[0]+C*o[0]*s-u*s),this.helper.setUniformFloatValue(At.TEXTURE_ORIGIN_Y,a[1]-I*o[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const i=this.frameState;if(!i)return null;const r=this.getLayer(),s=Xi(i.pixelToCoordinateTransform,e.slice()),o=i.viewState,a=r.getExtent();if(a&&!sd(ml(a,o.projection),s))return null;const l=r.getSources(gy([s]),o.resolution);let c,u,f;for(c=l.length-1;c>=0;--c)if(u=l[c],u.getState()==="ready"){if(f=u.getTileGridForProjection(o.projection),u.getWrapX())break;const m=f.getExtent();if(!m||sd(m,s))break}if(c<0)return null;const p=this.tileRepresentationCache;for(let m=f.getZForResolution(o.resolution);m>=f.getMinZoom();--m){const y=f.getTileCoordForCoordAndZ(s,m),_=eS(u,y);if(!p.containsKey(_))continue;const w=p.get(_),T=w.tile;if((T instanceof hd||T instanceof Yb)&&T.getState()===Ie.EMPTY)return null;if(!w.loaded)continue;const x=f.getOrigin(m),C=Bi(f.getTileSize(m)),I=f.getResolution(m),D=(s[0]-x[0])/I-y[1]*C[0],B=(x[1]-s[1])/I-y[2]*C[1];return w.getPixelData(D,B)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}class lj{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}const Ue={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0};function cj(n){switch(n){case"string":return Ue.STRING;case"color":return Ue.COLOR;case"number":return Ue.NUMBER;case"boolean":return Ue.BOOLEAN;case"number[]":return Ue.NUMBER_ARRAY;default:throw new Error(`Unrecognized type hint: ${n}`)}}const Ct={};function Tn(n){if(typeof n=="number")return Ue.NUMBER;if(typeof n=="boolean")return Ue.BOOLEAN;if(typeof n=="string")return TG(n)?Ue.COLOR|Ue.STRING:Ue.STRING;if(!Array.isArray(n))throw new Error(`Unhandled value type: ${JSON.stringify(n)}`);const e=n;if(e.every(function(r){return typeof r=="number"}))return e.length===3||e.length===4?Ue.COLOR|Ue.NUMBER_ARRAY:Ue.NUMBER_ARRAY;if(typeof e[0]!="string")throw new Error(`Expected an expression operator but received: ${JSON.stringify(e)}`);const i=Ct[e[0]];if(i===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return i.getReturnType(e.slice(1))}function uj(n){return Math.log2(n)%1===0}function Pl(n){const e=[];return(n&Ue.NUMBER)>0&&e.push("number"),(n&Ue.COLOR)>0&&e.push("color"),(n&Ue.BOOLEAN)>0&&e.push("boolean"),(n&Ue.NUMBER_ARRAY)>0&&e.push("number[]"),(n&Ue.STRING)>0&&e.push("string"),e.length>0?e.join(", "):"(no type)"}function hj(n,e){return`operator_${n}_${Object.keys(e.functions).length}`}function B0(n){const e=n.toString();return e.includes(".")?e:e+".0"}function mM(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(B0).join(", ")})`}function dj(n){const e=bp(n),t=e.length>3?e[3]:1;return mM([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const vw={};let fj=0;function vM(n){return n in vw||(vw[n]=fj++),vw[n]}function pj(n){return B0(vM(n))}function et(n,e,t){const i=t!==void 0?t:Ue.NUMBER;if(Array.isArray(e)&&typeof e[0]=="string"){const s=Ct[e[0]];if(s===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return s.toGlsl(n,e.slice(1),i)}const r=Tn(e)&i;if(wM(e,r,""),(r&Ue.NUMBER)>0)return B0(e);if((r&Ue.BOOLEAN)>0)return e.toString();if((r&Ue.STRING)>0)return pj(e.toString());if((r&Ue.COLOR)>0)return dj(e);if((r&Ue.NUMBER_ARRAY)>0)return mM(e);throw new Error(`Unexpected expression ${e} (expected type ${Pl(i)})`)}function yM(n){if(!(Tn(n)&Ue.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(n)} instead`)}function Ui(n){for(let e=0;e<n.length;e++)yM(n[e])}function _M(n){if(!(Tn(n)&Ue.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(n)} instead`)}function _x(n){if(!(Tn(n)&Ue.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(n)} instead`)}function yi(n,e){if(n.length!==e)throw new Error(`Exactly ${e} arguments were expected, got ${n.length} instead`)}function Ds(n,e){if(n.length<e)throw new Error(`At least ${e} arguments were expected, got ${n.length} instead`)}function mg(n,e){if(n.length>e)throw new Error(`At most ${e} arguments were expected, got ${n.length} instead`)}function EM(n){if(n.length%2!==0)throw new Error(`An even amount of arguments was expected, got ${JSON.stringify(n)} instead`)}function gj(n){if(n.length%2===0)throw new Error(`An odd amount of arguments was expected, got ${JSON.stringify(n)} instead`)}function wM(n,e,t){if(e===Ue.NONE)throw new Error(`No matching type was found for the following expression ${t}: ${JSON.stringify(n)}`)}function vg(n,e,t){if(wM(n,e,t),!uj(e))throw new Error(`Expected to have a unique type for the following expression ${t}: ${JSON.stringify(n)}
Got the following types instead: ${Pl(e)}`)}function Ex(n,e,t,i){if((e&t)===Ue.NONE)throw new Error(`Expected the ${i} type of the following expression: ${JSON.stringify(n)} to be of the following types: ${Pl(t)}
Got these types instead: ${Pl(e)}`)}Ct.get={getReturnType:function(n){if(n.length===2){const e=n[1];return cj(e)}return Ue.ANY},toGlsl:function(n,e,t){Ds(e,1),mg(e,2),_M(e[0]);const i=t&Ct.get.getReturnType(e);vg(["get",...e],i,"");const r=e[0].toString(),s=n.attributes.find(a=>a.name===r);if(!s)n.attributes.push({name:r,type:i});else if(i!==s.type)throw new Error(`The following attribute was used in different places with incompatible types: ${r}
Types were: ${Pl(s.type)} and ${Pl(i)}`);return(n.inFragmentShader?"v_":"a_")+r}};function TM(n){return"u_var_"+n}Ct.var={getReturnType:function(){return Ue.ANY},toGlsl:function(n,e,t){yi(e,1),_M(e[0]);const i=e[0].toString();if(!n.style.variables||n.style.variables[i]===void 0)throw new Error(`The following variable is missing from the style: ${i}`);const r=n.style.variables[i],s=t&Tn(r);vg(["var",...e],s,"");const o=n.variables.find(a=>a.name===i);if(!o)n.variables.push({name:i,type:s});else if(s!==o.type)throw new Error(`The following variable was used in different places with incompatible types: ${i}
Types were: ${Pl(o.type)} and ${Pl(s)}`);return TM(i)}};const SM="u_paletteTextures";Ct.palette={getReturnType:function(){return Ue.COLOR},toGlsl:function(n,e){yi(e,2),yM(e[0]);const t=et(n,e[0]),i=e[1];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const r=i.length,s=new Uint8Array(r*4);for(let l=0;l<r;l++){const c=i[l];let u;if(typeof c=="string")u=kO(c);else{if(!Array.isArray(c))throw new Error("The second argument of palette must be an array of strings or colors");const p=c.length;if(p===4)u=c;else{if(p!==3)throw new Error(`Expected palette color to have 3 or 4 values, got ${p}`);u=[c[0],c[1],c[2],1]}}const f=l*4;s[f]=u[0],s[f+1]=u[1],s[f+2]=u[2],s[f+3]=u[3]*255}n.paletteTextures||(n.paletteTextures=[]);const o=`${SM}[${n.paletteTextures.length}]`,a=new lj(o,s);return n.paletteTextures.push(a),`texture2D(${o}, vec2((${t} + 0.5) / ${r}.0, 0.5))`}};const yw="getBandValue";Ct.band={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){Ds(e,1),mg(e,3);const t=e[0];if(!(yw in n.functions)){let o="";const a=n.bandCount||1;for(let l=0;l<a;l++){const c=Math.floor(l/4);let u=l%4;l===a-1&&u===1&&(u=3);const f=`${At.TILE_TEXTURE_ARRAY}[${c}]`;o+=`
          if (band == ${l+1}.0) {
            return texture2D(${f}, v_textureCoord + vec2(dx, dy))[${u}];
          }
        `}n.functions[yw]=`
        float getBandValue(float band, float xOffset, float yOffset) {
          float dx = xOffset / ${At.TEXTURE_PIXEL_WIDTH};
          float dy = yOffset / ${At.TEXTURE_PIXEL_HEIGHT};
          ${o}
        }
      `}const i=et(n,t),r=et(n,e[1]||0),s=et(n,e[2]||0);return`${yw}(${i}, ${r}, ${s})`}};Ct.time={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,0),"u_time"}};Ct.zoom={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,0),"u_zoom"}};Ct.resolution={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,0),"u_resolution"}};Ct["geometry-type"]={getReturnType:function(){return Ue.STRING},toGlsl:function(n,e){yi(e,0);const t="geometryType",i=o=>{const a=o.getType();switch(a){case"Point":case"LineString":case"Polygon":return a;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return a.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return i(o.getGeometries()[0])}};return n.attributes.find(o=>o.name===t)||n.attributes.push({name:t,type:Ue.STRING,callback:o=>i(o.getGeometry())}),(n.inFragmentShader?"v_":"a_")+t}};Ct["*"]={getReturnType:function(n){let e=Ue.NUMBER|Ue.COLOR;for(let t=0;t<n.length;t++)e=e&Tn(n[t]);return e},toGlsl:function(n,e,t){Ds(e,2);let i=t;for(let r=0;r<e.length;r++)i=i&Tn(e[r]);return Ex(e,i,Ue.NUMBER|Ue.COLOR,"output"),`(${e.map(r=>et(n,r,i)).join(" * ")})`}};Ct["/"]={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} / ${et(n,e[1])})`}};Ct["+"]={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return Ds(e,2),Ui(e),`(${e.map(t=>et(n,t)).join(" + ")})`}};Ct["-"]={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} - ${et(n,e[1])})`}};Ct.clamp={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){yi(e,3),Ui(e);const t=et(n,e[1]),i=et(n,e[2]);return`clamp(${et(n,e[0])}, ${t}, ${i})`}};Ct["%"]={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,2),Ui(e),`mod(${et(n,e[0])}, ${et(n,e[1])})`}};Ct["^"]={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,2),Ui(e),`pow(${et(n,e[0])}, ${et(n,e[1])})`}};Ct.abs={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`abs(${et(n,e[0])})`}};Ct.floor={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`floor(${et(n,e[0])})`}};Ct.round={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`floor(${et(n,e[0])} + 0.5)`}};Ct.ceil={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`ceil(${et(n,e[0])})`}};Ct.sin={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`sin(${et(n,e[0])})`}};Ct.cos={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`cos(${et(n,e[0])})`}};Ct.atan={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return Ds(e,1),mg(e,2),Ui(e),e.length===2?`atan(${et(n,e[0])}, ${et(n,e[1])})`:`atan(${et(n,e[0])})`}};Ct.sqrt={getReturnType:function(){return Ue.NUMBER},toGlsl:function(n,e){return yi(e,1),Ui(e),`sqrt(${et(n,e[0])})`}};Ct[">"]={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} > ${et(n,e[1])})`}};Ct[">="]={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} >= ${et(n,e[1])})`}};Ct["<"]={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} < ${et(n,e[1])})`}};Ct["<="]={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){return yi(e,2),Ui(e),`(${et(n,e[0])} <= ${et(n,e[1])})`}};function bM(n){return{getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(e,t){yi(t,2);let i=Ue.ANY;for(let r=0;r<t.length;r++)i&=Tn(t[r]);if(i===Ue.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(t)} instead`);return i&=~Ue.COLOR,`(${et(e,t[0],i)} ${n} ${et(e,t[1],i)})`}}}Ct["=="]=bM("==");Ct["!="]=bM("!=");Ct["!"]={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){return yi(e,1),_x(e[0]),`(!${et(n,e[0],Ue.BOOLEAN)})`}};function xM(n){return{getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(e,t){Ds(t,2);for(let r=0;r<t.length;r++)_x(t[r]);let i=t.map(r=>et(e,r,Ue.BOOLEAN)).join(` ${n} `);return i=`(${i})`,i}}}Ct.all=xM("&&");Ct.any=xM("||");Ct.between={getReturnType:function(){return Ue.BOOLEAN},toGlsl:function(n,e){yi(e,3),Ui(e);const t=et(n,e[1]),i=et(n,e[2]),r=et(n,e[0]);return`(${r} >= ${t} && ${r} <= ${i})`}};Ct.array={getReturnType:function(){return Ue.NUMBER_ARRAY},toGlsl:function(n,e){Ds(e,2),mg(e,4),Ui(e);const t=e.map(function(i){return et(n,i)});return`vec${e.length}(${t.join(", ")})`}};Ct.color={getReturnType:function(){return Ue.COLOR},toGlsl:function(n,e){Ds(e,3),mg(e,4),Ui(e);const t=e.slice(0,3).map(r=>`${et(n,r)} / 255.0`);return e.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${et(n,e[3])} * vec4(${t.join(", ")}, 1.0))`}};Ct.interpolate={getReturnType:function(n){let e=Ue.COLOR|Ue.NUMBER;for(let t=3;t<n.length;t+=2)e=e&Tn(n[t]);return e},toGlsl:function(n,e,t){EM(e),Ds(e,6);const i=e[0];let r;switch(i[0]){case"linear":r=1;break;case"exponential":r=i[1];break;default:r=null}if(!r)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(i)}`);const s=Ue.NUMBER,o=Ct.interpolate.getReturnType(e)&t;vg(["interpolate",...e],o,"output");const a=et(n,e[1],s),l=B0(r);let c="";for(let u=2;u<e.length-2;u+=2){const f=et(n,e[u],s),p=c||et(n,e[u+1],o),m=et(n,e[u+2],s),y=et(n,e[u+3],o);let _;r===1?_=`(${a} - ${f}) / (${m} - ${f})`:_=`(pow(${l}, (${a} - ${f})) - 1.0) / (pow(${l}, (${m} - ${f})) - 1.0)`,c=`mix(${p}, ${y}, clamp(${_}, 0.0, 1.0))`}return c}};Ct.match={getReturnType:function(n){let e=Ue.ANY;for(let t=2;t<n.length;t+=2)e=e&Tn(n[t]);return e=e&Tn(n[n.length-1]),e},toGlsl:function(n,e,t){EM(e),Ds(e,4);let i=Tn(e[0]);for(let l=1;l<e.length-1;l+=2)i=i&Tn(e[l]);Ex(["match",...e],i,Ue.STRING|Ue.NUMBER|Ue.BOOLEAN,"input"),i=(Ue.STRING|Ue.NUMBER|Ue.BOOLEAN)&i;const r=Ct.match.getReturnType(e)&t;vg(["match",...e],r,"output");const s=et(n,e[0],i),o=et(n,e[e.length-1],r);let a=null;for(let l=e.length-3;l>=1;l-=2){const c=et(n,e[l],i),u=et(n,e[l+1],r);a=`(${s} == ${c} ? ${u} : ${a||o})`}return a}};Ct.case={getReturnType:function(n){let e=Ue.ANY;for(let t=1;t<n.length;t+=2)e=e&Tn(n[t]);return e=e&Tn(n[n.length-1]),e},toGlsl:function(n,e,t){gj(e),Ds(e,3);const i=Ct.case.getReturnType(e)&t;vg(["case",...e],i,"output");for(let o=0;o<e.length-1;o+=2)_x(e[o]);const r=et(n,e[e.length-1],i);let s=null;for(let o=e.length-3;o>=0;o-=2){const a=et(n,e[o],Ue.BOOLEAN),l=et(n,e[o+1],i);s=`(${a} ? ${l} : ${s||r})`}return s}};Ct.in={getReturnType:function(n){return Ue.BOOLEAN},toGlsl:function(n,e){yi(e,2);const t=e[0];let i=e[1];if(!Array.isArray(i))throw new Error('The "in" operator expects an array literal as its second argument.');if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(i[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');i=i[1]}let r=Tn(t);for(let a=0;a<i.length-1;a+=1)r=r&Tn(i[a]);Ex(["match",...e],r,Ue.STRING|Ue.NUMBER|Ue.BOOLEAN,"input"),r=(Ue.STRING|Ue.NUMBER|Ue.BOOLEAN)&r;const s=hj("in",n),o=[];for(let a=0;a<i.length;a+=1)o.push(`  if (inputValue == ${et(n,i[a],r)}) { return true; }`);return n.functions[s]=`bool ${s}(float inputValue) {
${o.join(`
`)}
  return false;
}`,`${s}(${et(n,t,r)})`}};function aL(n,e){const t=`
    attribute vec2 ${qv.TEXTURE_COORD};
    uniform mat4 ${At.TILE_TRANSFORM};
    uniform float ${At.TEXTURE_PIXEL_WIDTH};
    uniform float ${At.TEXTURE_PIXEL_HEIGHT};
    uniform float ${At.TEXTURE_RESOLUTION};
    uniform float ${At.TEXTURE_ORIGIN_X};
    uniform float ${At.TEXTURE_ORIGIN_Y};
    uniform float ${At.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${qv.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${At.TEXTURE_ORIGIN_X} + ${At.TEXTURE_RESOLUTION} * ${At.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${At.TEXTURE_ORIGIN_Y} - ${At.TEXTURE_RESOLUTION} * ${At.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${At.TILE_TRANSFORM} * vec4(${qv.TEXTURE_COORD}, ${At.DEPTH}, 1.0);
    }
  `,i={inFragmentShader:!0,variables:[],attributes:[],functions:{},bandCount:e,style:n},r=[];if(n.color!==void 0){const f=et(i,n.color,Ue.COLOR);r.push(`color = ${f};`)}if(n.contrast!==void 0){const f=et(i,n.contrast,Ue.NUMBER);r.push(`color.rgb = clamp((${f} + 1.0) * color.rgb - (${f} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const f=et(i,n.exposure,Ue.NUMBER);r.push(`color.rgb = clamp((${f} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const f=et(i,n.saturation,Ue.NUMBER);r.push(`
      float saturation = ${f} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const f=et(i,n.gamma,Ue.NUMBER);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${f}));`)}if(n.brightness!==void 0){const f=et(i,n.brightness,Ue.NUMBER);r.push(`color.rgb = clamp(color.rgb + ${f}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=i.variables.length;if(o>1&&!n.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let f=0;f<o;++f){const p=i.variables[f];if(!(p.name in n.variables))throw new Error(`Missing '${p.name}' in style variables`);const m=TM(p.name);s[m]=function(){let y=n.variables[p.name];return typeof y=="string"&&(y=vM(y)),y!==void 0?y:-9999999}}const a=Object.keys(s).map(function(f){return`uniform float ${f};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${At.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&a.push(`uniform sampler2D ${SM}[${i.paletteTextures.length}];`);const c=Object.keys(i.functions).map(function(f){return i.functions[f]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${At.RENDER_EXTENT};
    uniform float ${At.TRANSITION_ALPHA};
    uniform float ${At.TEXTURE_PIXEL_WIDTH};
    uniform float ${At.TEXTURE_PIXEL_HEIGHT};
    uniform float ${At.RESOLUTION};
    uniform float ${At.ZOOM};

    ${a.join(`
`)}

    ${c.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${At.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${At.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${At.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${At.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${At.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${At.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:u,uniforms:s,paletteTextures:i.paletteTextures}}class CM extends fk{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Jt.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=aL(this.style_,this.getSourceBandCount_());return new aj(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const i=this.getRenderer();let r;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],i.prepareFrame(e)&&(r=i.renderFrame(e));return r}render(e,t){this.rendered=!0;const i=e.viewState,r=this.getSources(e.extent,i.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const c=r[a],u=c.getState();if(u=="loading"){const f=()=>{c.getState()=="ready"&&(c.removeEventListener("change",f),this.changed())};c.addEventListener("change",f)}s=s&&u=="ready"}const o=this.renderSources(e,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=i.resolution,o;if(this.renderedResolution_>.5*i.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=aL(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}CM.prototype.dispose;const mj=n=>(Jz(),new PH({declutter:!0,source:new q$({url:n}),style:new Yh({stroke:new od({color:"#7070B3",width:1}),fill:new Qc({color:"#FFFFFF"}),image:new sg({radius:7,fill:new Qc({color:"#7070B3"}),stroke:new od({color:"#FFFFFF",width:2})})})})),vj=n=>new CM({source:new N9({sources:[{url:n}],convertToRGB:!0})}),RM={darkMatter:{url:"https://{a-d}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},positron:{url:"https://{a-d}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},positronLite:{url:"https://{a-d}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},worldAntique:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-antique/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},worldEco:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-eco/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},flatBlue:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-flatblue/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},midnightCommander:{url:"https://cartocdn_{a-d}.global.ssl.fastly.net/base-midnight/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributionss">Carto</a>',maxZoom:18},openstreetmapHot:{url:"https://{a-c}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>',maxZoom:19},openstreetmapStandard:{url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attributions:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}};function AM(n){return n.replace(/(?:[_-])([a-z0-9])/g,(e,t)=>t.toUpperCase())}function yj(n){return AM(n.replace(/--/g,"-").replace(/__/g,"_"))}function U0(n){return n.charAt(0).toUpperCase()+n.slice(1)}function _j(n){return n.replace(/([A-Z])/g,(e,t)=>`-${t.toLowerCase()}`)}function lL(n){return n!=null}function cL(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function wx(n,e){const t=LM(n);return Array.from(t.reduce((i,r)=>(wj(r,e).forEach(s=>i.add(s)),i),new Set))}function Ej(n,e){return LM(n).reduce((i,r)=>(i.push(...Tj(r,e)),i),[])}function LM(n){const e=[];for(;n;)e.push(n),n=Object.getPrototypeOf(n);return e.reverse()}function wj(n,e){const t=n[e];return Array.isArray(t)?t:[]}function Tj(n,e){const t=n[e];return t?Object.keys(t).map(i=>[i,t[i]]):[]}(()=>{function n(t){function i(){return Reflect.construct(t,arguments,new.target)}return i.prototype=Object.create(t.prototype,{constructor:{value:i}}),Reflect.setPrototypeOf(i,t),i}function e(){const i=n(function(){this.a.call(this)});return i.prototype.a=function(){},new i}try{return e(),n}catch{return i=>class extends i{}}})();Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},uL("abcdefghijklmnopqrstuvwxyz".split("").map(n=>[n,n]))),uL("0123456789".split("").map(n=>[n,n])));function uL(n){return n.reduce((e,[t,i])=>Object.assign(Object.assign({},e),{[t]:i}),{})}function Sj(n){return wx(n,"classes").reduce((t,i)=>Object.assign(t,bj(i)),{})}function bj(n){return{[`${n}Class`]:{get(){const{classes:e}=this;if(e.has(n))return e.get(n);{const t=e.getAttributeName(n);throw new Error(`Missing attribute "${t}"`)}}},[`${n}Classes`]:{get(){return this.classes.getAll(n)}},[`has${U0(n)}Class`]:{get(){return this.classes.has(n)}}}}function xj(n){return wx(n,"outlets").reduce((t,i)=>Object.assign(t,Cj(i)),{})}function hL(n,e,t){return n.application.getControllerForElementAndIdentifier(e,t)}function dL(n,e,t){let i=hL(n,e,t);if(i||(n.application.router.proposeToConnectScopeForElementAndIdentifier(e,t),i=hL(n,e,t),i))return i}function Cj(n){const e=yj(n);return{[`${e}Outlet`]:{get(){const t=this.outlets.find(n),i=this.outlets.getSelectorForOutletName(n);if(t){const r=dL(this,t,n);if(r)return r;throw new Error(`The provided outlet element is missing an outlet controller "${n}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${n}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${i}".`)}},[`${e}Outlets`]:{get(){const t=this.outlets.findAll(n);return t.length>0?t.map(i=>{const r=dL(this,i,n);if(r)return r;console.warn(`The provided outlet element is missing an outlet controller "${n}" instance for host controller "${this.identifier}"`,i)}).filter(i=>i):[]}},[`${e}OutletElement`]:{get(){const t=this.outlets.find(n),i=this.outlets.getSelectorForOutletName(n);if(t)return t;throw new Error(`Missing outlet element "${n}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${i}".`)}},[`${e}OutletElements`]:{get(){return this.outlets.findAll(n)}},[`has${U0(e)}Outlet`]:{get(){return this.outlets.has(n)}}}}function Rj(n){return wx(n,"targets").reduce((t,i)=>Object.assign(t,Aj(i)),{})}function Aj(n){return{[`${n}Target`]:{get(){const e=this.targets.find(n);if(e)return e;throw new Error(`Missing target element "${n}" for "${this.identifier}" controller`)}},[`${n}Targets`]:{get(){return this.targets.findAll(n)}},[`has${U0(n)}Target`]:{get(){return this.targets.has(n)}}}}function Lj(n){const e=Ej(n,"values"),t={valueDescriptorMap:{get(){return e.reduce((i,r)=>{const s=IM(r,this.identifier),o=this.data.getAttributeNameForKey(s.key);return Object.assign(i,{[o]:s})},{})}}};return e.reduce((i,r)=>Object.assign(i,Ij(r)),t)}function Ij(n,e){const t=IM(n,e),{key:i,name:r,reader:s,writer:o}=t;return{[r]:{get(){const a=this.data.get(i);return a!==null?s(a):t.defaultValue},set(a){a===void 0?this.data.delete(i):this.data.set(i,o(a))}},[`has${U0(r)}`]:{get(){return this.data.has(i)||t.hasCustomDefaultValue}}}}function IM([n,e],t){return kj({controller:t,token:n,typeDefinition:e})}function ky(n){switch(n){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function Mp(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(n))return"array";if(Object.prototype.toString.call(n)==="[object Object]")return"object"}function Pj(n){const{controller:e,token:t,typeObject:i}=n,r=lL(i.type),s=lL(i.default),o=r&&s,a=r&&!s,l=!r&&s,c=ky(i.type),u=Mp(n.typeObject.default);if(a)return c;if(l)return u;if(c!==u){const f=e?`${e}.${t}`:t;throw new Error(`The specified default value for the Stimulus Value "${f}" must match the defined type "${c}". The provided default value of "${i.default}" is of type "${u}".`)}if(o)return c}function Dj(n){const{controller:e,token:t,typeDefinition:i}=n,s=Pj({controller:e,token:t,typeObject:i}),o=Mp(i),a=ky(i),l=s||o||a;if(l)return l;const c=e?`${e}.${i}`:t;throw new Error(`Unknown value type "${c}" for "${t}" value`)}function Oj(n){const e=ky(n);if(e)return fL[e];const t=cL(n,"default"),i=cL(n,"type"),r=n;if(t)return r.default;if(i){const{type:s}=r,o=ky(s);if(o)return fL[o]}return n}function kj(n){const{token:e,typeDefinition:t}=n,i=`${_j(e)}-value`,r=Dj(n);return{type:r,key:i,name:AM(i),get defaultValue(){return Oj(t)},get hasCustomDefaultValue(){return Mp(t)!==void 0},reader:Mj[r],writer:pL[r]||pL.default}}const fL={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},Mj={array(n){const e=JSON.parse(n);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${n}" of type "${Mp(e)}"`);return e},boolean(n){return!(n=="0"||String(n).toLowerCase()=="false")},number(n){return Number(n.replace(/_/g,""))},object(n){const e=JSON.parse(n);if(e===null||typeof e!="object"||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${n}" of type "${Mp(e)}"`);return e},string(n){return n}},pL={default:Nj,array:gL,object:gL};function gL(n){return JSON.stringify(n)}function Nj(n){return`${n}`}class Os{constructor(e){this.context=e}static get shouldLoad(){return!0}static afterLoad(e,t){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(e,{target:t=this.element,detail:i={},prefix:r=this.identifier,bubbles:s=!0,cancelable:o=!0}={}){const a=r?`${r}:${e}`:e,l=new CustomEvent(a,{detail:i,bubbles:s,cancelable:o});return t.dispatchEvent(l),l}}Os.blessings=[Sj,Rj,Lj,xj];Os.targets=[];Os.outlets=[];Os.values={};class Tx extends Os{async connect(){this.basemap=this.getBasemap(),this.overlay=this.getPreviewOverlay(this.protocolValue,this.urlValue),await this.getBounds(),this.loadMap()}loadMap(){this.map=new $8({target:this.element,controls:rk().extend([new xH]),layers:[this.basemap,this.overlay]}),this.map.getView().fit(this.extent,this.map.getSize())}async getBounds(){if(this.protocolValue=="Cog"){const e=await this.overlay.getSource().getView();this.extent=e.extent}else this.extent=new uH().readFeatures(this.mapGeomValue)[0].getGeometry().getExtent()}getBasemap(){const e=RM[this.basemapValue||"positron"];return new J8({source:new lH(e)})}getPreviewOverlay(e,t){if(e==="Pmtiles")return mj(t);if(e==="Cog")return vj(t);console.error(`Unsupported protocol name: "${e}"`)}}wn(Tx,"values",{url:String,protocol:String,basemap:String,mapGeom:String});var PM={exports:{}},Ft={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mL;function Fj(){if(mL)return Ft;mL=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),f=Symbol.iterator;function p(te){return te===null||typeof te!="object"?null:(te=f&&te[f]||te["@@iterator"],typeof te=="function"?te:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,_={};function w(te,Q,_e){this.props=te,this.context=Q,this.refs=_,this.updater=_e||m}w.prototype.isReactComponent={},w.prototype.setState=function(te,Q){if(typeof te!="object"&&typeof te!="function"&&te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,te,Q,"setState")},w.prototype.forceUpdate=function(te){this.updater.enqueueForceUpdate(this,te,"forceUpdate")};function T(){}T.prototype=w.prototype;function x(te,Q,_e){this.props=te,this.context=Q,this.refs=_,this.updater=_e||m}var C=x.prototype=new T;C.constructor=x,y(C,w.prototype),C.isPureReactComponent=!0;var I=Array.isArray,D=Object.prototype.hasOwnProperty,B={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function z(te,Q,_e){var fe,pe={},Ce=null,xe=null;if(Q!=null)for(fe in Q.ref!==void 0&&(xe=Q.ref),Q.key!==void 0&&(Ce=""+Q.key),Q)D.call(Q,fe)&&!N.hasOwnProperty(fe)&&(pe[fe]=Q[fe]);var Le=arguments.length-2;if(Le===1)pe.children=_e;else if(1<Le){for(var je=Array(Le),Ke=0;Ke<Le;Ke++)je[Ke]=arguments[Ke+2];pe.children=je}if(te&&te.defaultProps)for(fe in Le=te.defaultProps,Le)pe[fe]===void 0&&(pe[fe]=Le[fe]);return{$$typeof:n,type:te,key:Ce,ref:xe,props:pe,_owner:B.current}}function Z(te,Q){return{$$typeof:n,type:te.type,key:Q,ref:te.ref,props:te.props,_owner:te._owner}}function q(te){return typeof te=="object"&&te!==null&&te.$$typeof===n}function H(te){var Q={"=":"=0",":":"=2"};return"$"+te.replace(/[=:]/g,function(_e){return Q[_e]})}var Y=/\/+/g;function ee(te,Q){return typeof te=="object"&&te!==null&&te.key!=null?H(""+te.key):Q.toString(36)}function le(te,Q,_e,fe,pe){var Ce=typeof te;(Ce==="undefined"||Ce==="boolean")&&(te=null);var xe=!1;if(te===null)xe=!0;else switch(Ce){case"string":case"number":xe=!0;break;case"object":switch(te.$$typeof){case n:case e:xe=!0}}if(xe)return xe=te,pe=pe(xe),te=fe===""?"."+ee(xe,0):fe,I(pe)?(_e="",te!=null&&(_e=te.replace(Y,"$&/")+"/"),le(pe,Q,_e,"",function(Ke){return Ke})):pe!=null&&(q(pe)&&(pe=Z(pe,_e+(!pe.key||xe&&xe.key===pe.key?"":(""+pe.key).replace(Y,"$&/")+"/")+te)),Q.push(pe)),1;if(xe=0,fe=fe===""?".":fe+":",I(te))for(var Le=0;Le<te.length;Le++){Ce=te[Le];var je=fe+ee(Ce,Le);xe+=le(Ce,Q,_e,je,pe)}else if(je=p(te),typeof je=="function")for(te=je.call(te),Le=0;!(Ce=te.next()).done;)Ce=Ce.value,je=fe+ee(Ce,Le++),xe+=le(Ce,Q,_e,je,pe);else if(Ce==="object")throw Q=String(te),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(te).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.");return xe}function W(te,Q,_e){if(te==null)return te;var fe=[],pe=0;return le(te,fe,"","",function(Ce){return Q.call(_e,Ce,pe++)}),fe}function ie(te){if(te._status===-1){var Q=te._result;Q=Q(),Q.then(function(_e){(te._status===0||te._status===-1)&&(te._status=1,te._result=_e)},function(_e){(te._status===0||te._status===-1)&&(te._status=2,te._result=_e)}),te._status===-1&&(te._status=0,te._result=Q)}if(te._status===1)return te._result.default;throw te._result}var ne={current:null},J={transition:null},ce={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:J,ReactCurrentOwner:B};function se(){throw Error("act(...) is not supported in production builds of React.")}return Ft.Children={map:W,forEach:function(te,Q,_e){W(te,function(){Q.apply(this,arguments)},_e)},count:function(te){var Q=0;return W(te,function(){Q++}),Q},toArray:function(te){return W(te,function(Q){return Q})||[]},only:function(te){if(!q(te))throw Error("React.Children.only expected to receive a single React element child.");return te}},Ft.Component=w,Ft.Fragment=t,Ft.Profiler=r,Ft.PureComponent=x,Ft.StrictMode=i,Ft.Suspense=l,Ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ce,Ft.act=se,Ft.cloneElement=function(te,Q,_e){if(te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+te+".");var fe=y({},te.props),pe=te.key,Ce=te.ref,xe=te._owner;if(Q!=null){if(Q.ref!==void 0&&(Ce=Q.ref,xe=B.current),Q.key!==void 0&&(pe=""+Q.key),te.type&&te.type.defaultProps)var Le=te.type.defaultProps;for(je in Q)D.call(Q,je)&&!N.hasOwnProperty(je)&&(fe[je]=Q[je]===void 0&&Le!==void 0?Le[je]:Q[je])}var je=arguments.length-2;if(je===1)fe.children=_e;else if(1<je){Le=Array(je);for(var Ke=0;Ke<je;Ke++)Le[Ke]=arguments[Ke+2];fe.children=Le}return{$$typeof:n,type:te.type,key:pe,ref:Ce,props:fe,_owner:xe}},Ft.createContext=function(te){return te={$$typeof:o,_currentValue:te,_currentValue2:te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},te.Provider={$$typeof:s,_context:te},te.Consumer=te},Ft.createElement=z,Ft.createFactory=function(te){var Q=z.bind(null,te);return Q.type=te,Q},Ft.createRef=function(){return{current:null}},Ft.forwardRef=function(te){return{$$typeof:a,render:te}},Ft.isValidElement=q,Ft.lazy=function(te){return{$$typeof:u,_payload:{_status:-1,_result:te},_init:ie}},Ft.memo=function(te,Q){return{$$typeof:c,type:te,compare:Q===void 0?null:Q}},Ft.startTransition=function(te){var Q=J.transition;J.transition={};try{te()}finally{J.transition=Q}},Ft.unstable_act=se,Ft.useCallback=function(te,Q){return ne.current.useCallback(te,Q)},Ft.useContext=function(te){return ne.current.useContext(te)},Ft.useDebugValue=function(){},Ft.useDeferredValue=function(te){return ne.current.useDeferredValue(te)},Ft.useEffect=function(te,Q){return ne.current.useEffect(te,Q)},Ft.useId=function(){return ne.current.useId()},Ft.useImperativeHandle=function(te,Q,_e){return ne.current.useImperativeHandle(te,Q,_e)},Ft.useInsertionEffect=function(te,Q){return ne.current.useInsertionEffect(te,Q)},Ft.useLayoutEffect=function(te,Q){return ne.current.useLayoutEffect(te,Q)},Ft.useMemo=function(te,Q){return ne.current.useMemo(te,Q)},Ft.useReducer=function(te,Q,_e){return ne.current.useReducer(te,Q,_e)},Ft.useRef=function(te){return ne.current.useRef(te)},Ft.useState=function(te){return ne.current.useState(te)},Ft.useSyncExternalStore=function(te,Q,_e){return ne.current.useSyncExternalStore(te,Q,_e)},Ft.useTransition=function(){return ne.current.useTransition()},Ft.version="18.3.1",Ft}PM.exports=Fj();var M=PM.exports;const F=hu(M),Bj=oz({__proto__:null,default:F},[M]);var DM={exports:{}},or={},_w={exports:{}},Ew={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vL;function Uj(){return vL||(vL=1,function(n){function e(J,ce){var se=J.length;J.push(ce);e:for(;0<se;){var te=se-1>>>1,Q=J[te];if(0<r(Q,ce))J[te]=ce,J[se]=Q,se=te;else break e}}function t(J){return J.length===0?null:J[0]}function i(J){if(J.length===0)return null;var ce=J[0],se=J.pop();if(se!==ce){J[0]=se;e:for(var te=0,Q=J.length,_e=Q>>>1;te<_e;){var fe=2*(te+1)-1,pe=J[fe],Ce=fe+1,xe=J[Ce];if(0>r(pe,se))Ce<Q&&0>r(xe,pe)?(J[te]=xe,J[Ce]=se,te=Ce):(J[te]=pe,J[fe]=se,te=fe);else if(Ce<Q&&0>r(xe,se))J[te]=xe,J[Ce]=se,te=Ce;else break e}}return ce}function r(J,ce){var se=J.sortIndex-ce.sortIndex;return se!==0?se:J.id-ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,p=3,m=!1,y=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(J){for(var ce=t(c);ce!==null;){if(ce.callback===null)i(c);else if(ce.startTime<=J)i(c),ce.sortIndex=ce.expirationTime,e(l,ce);else break;ce=t(c)}}function I(J){if(_=!1,C(J),!y)if(t(l)!==null)y=!0,ie(D);else{var ce=t(c);ce!==null&&ne(I,ce.startTime-J)}}function D(J,ce){y=!1,_&&(_=!1,T(z),z=-1),m=!0;var se=p;try{for(C(ce),f=t(l);f!==null&&(!(f.expirationTime>ce)||J&&!H());){var te=f.callback;if(typeof te=="function"){f.callback=null,p=f.priorityLevel;var Q=te(f.expirationTime<=ce);ce=n.unstable_now(),typeof Q=="function"?f.callback=Q:f===t(l)&&i(l),C(ce)}else i(l);f=t(l)}if(f!==null)var _e=!0;else{var fe=t(c);fe!==null&&ne(I,fe.startTime-ce),_e=!1}return _e}finally{f=null,p=se,m=!1}}var B=!1,N=null,z=-1,Z=5,q=-1;function H(){return!(n.unstable_now()-q<Z)}function Y(){if(N!==null){var J=n.unstable_now();q=J;var ce=!0;try{ce=N(!0,J)}finally{ce?ee():(B=!1,N=null)}}else B=!1}var ee;if(typeof x=="function")ee=function(){x(Y)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,W=le.port2;le.port1.onmessage=Y,ee=function(){W.postMessage(null)}}else ee=function(){w(Y,0)};function ie(J){N=J,B||(B=!0,ee())}function ne(J,ce){z=w(function(){J(n.unstable_now())},ce)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(J){J.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,ie(D))},n.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<J?Math.floor(1e3/J):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(J){switch(p){case 1:case 2:case 3:var ce=3;break;default:ce=p}var se=p;p=ce;try{return J()}finally{p=se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(J,ce){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var se=p;p=J;try{return ce()}finally{p=se}},n.unstable_scheduleCallback=function(J,ce,se){var te=n.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?te+se:te):se=te,J){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=se+Q,J={id:u++,callback:ce,priorityLevel:J,startTime:se,expirationTime:Q,sortIndex:-1},se>te?(J.sortIndex=se,e(c,J),t(l)===null&&J===t(c)&&(_?(T(z),z=-1):_=!0,ne(I,se-te))):(J.sortIndex=Q,e(l,J),y||m||(y=!0,ie(D))),J},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(J){var ce=p;return function(){var se=p;p=ce;try{return J.apply(this,arguments)}finally{p=se}}}}(Ew)),Ew}var yL;function zj(){return yL||(yL=1,_w.exports=Uj()),_w.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _L;function Gj(){if(_L)return or;_L=1;var n=M,e=zj();function t(h){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+h,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function s(h,g){o(h,g),o(h+"Capture",g)}function o(h,g){for(r[h]=g,h=0;h<g.length;h++)i.add(g[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},f={};function p(h){return l.call(f,h)?!0:l.call(u,h)?!1:c.test(h)?f[h]=!0:(u[h]=!0,!1)}function m(h,g,E,b){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return b?!1:E!==null?!E.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function y(h,g,E,b){if(g===null||typeof g>"u"||m(h,g,E,b))return!0;if(b)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function _(h,g,E,b,A,P,V){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=b,this.attributeNamespace=A,this.mustUseProperty=E,this.propertyName=h,this.type=g,this.sanitizeURL=P,this.removeEmptyString=V}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){w[h]=new _(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var g=h[0];w[g]=new _(g,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){w[h]=new _(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){w[h]=new _(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){w[h]=new _(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){w[h]=new _(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){w[h]=new _(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){w[h]=new _(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){w[h]=new _(h,5,!1,h.toLowerCase(),null,!1,!1)});var T=/[\-:]([a-z])/g;function x(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var g=h.replace(T,x);w[g]=new _(g,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var g=h.replace(T,x);w[g]=new _(g,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var g=h.replace(T,x);w[g]=new _(g,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){w[h]=new _(h,1,!1,h.toLowerCase(),null,!1,!1)}),w.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){w[h]=new _(h,1,!1,h.toLowerCase(),null,!0,!0)});function C(h,g,E,b){var A=w.hasOwnProperty(g)?w[g]:null;(A!==null?A.type!==0:b||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(y(g,E,A,b)&&(E=null),b||A===null?p(g)&&(E===null?h.removeAttribute(g):h.setAttribute(g,""+E)):A.mustUseProperty?h[A.propertyName]=E===null?A.type===3?!1:"":E:(g=A.attributeName,b=A.attributeNamespace,E===null?h.removeAttribute(g):(A=A.type,E=A===3||A===4&&E===!0?"":""+E,b?h.setAttributeNS(b,g,E):h.setAttribute(g,E))))}var I=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,D=Symbol.for("react.element"),B=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),H=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),J=Symbol.iterator;function ce(h){return h===null||typeof h!="object"?null:(h=J&&h[J]||h["@@iterator"],typeof h=="function"?h:null)}var se=Object.assign,te;function Q(h){if(te===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);te=g&&g[1]||""}return`
`+te+h}var _e=!1;function fe(h,g){if(!h||_e)return"";_e=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Se){var b=Se}Reflect.construct(h,[],g)}else{try{g.call()}catch(Se){b=Se}h.call(g.prototype)}else{try{throw Error()}catch(Se){b=Se}h()}}catch(Se){if(Se&&b&&typeof Se.stack=="string"){for(var A=Se.stack.split(`
`),P=b.stack.split(`
`),V=A.length-1,oe=P.length-1;1<=V&&0<=oe&&A[V]!==P[oe];)oe--;for(;1<=V&&0<=oe;V--,oe--)if(A[V]!==P[oe]){if(V!==1||oe!==1)do if(V--,oe--,0>oe||A[V]!==P[oe]){var ue=`
`+A[V].replace(" at new "," at ");return h.displayName&&ue.includes("<anonymous>")&&(ue=ue.replace("<anonymous>",h.displayName)),ue}while(1<=V&&0<=oe);break}}}finally{_e=!1,Error.prepareStackTrace=E}return(h=h?h.displayName||h.name:"")?Q(h):""}function pe(h){switch(h.tag){case 5:return Q(h.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 2:case 15:return h=fe(h.type,!1),h;case 11:return h=fe(h.type.render,!1),h;case 1:return h=fe(h.type,!0),h;default:return""}}function Ce(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case N:return"Fragment";case B:return"Portal";case Z:return"Profiler";case z:return"StrictMode";case ee:return"Suspense";case le:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case H:return(h.displayName||"Context")+".Consumer";case q:return(h._context.displayName||"Context")+".Provider";case Y:var g=h.render;return h=h.displayName,h||(h=g.displayName||g.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case W:return g=h.displayName||null,g!==null?g:Ce(h.type)||"Memo";case ie:g=h._payload,h=h._init;try{return Ce(h(g))}catch{}}return null}function xe(h){var g=h.type;switch(h.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=g.render,h=h.displayName||h.name||"",g.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ce(g);case 8:return g===z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Le(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function je(h){var g=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ke(h){var g=je(h)?"checked":"value",E=Object.getOwnPropertyDescriptor(h.constructor.prototype,g),b=""+h[g];if(!h.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var A=E.get,P=E.set;return Object.defineProperty(h,g,{configurable:!0,get:function(){return A.call(this)},set:function(V){b=""+V,P.call(this,V)}}),Object.defineProperty(h,g,{enumerable:E.enumerable}),{getValue:function(){return b},setValue:function(V){b=""+V},stopTracking:function(){h._valueTracker=null,delete h[g]}}}}function lt(h){h._valueTracker||(h._valueTracker=Ke(h))}function ct(h){if(!h)return!1;var g=h._valueTracker;if(!g)return!0;var E=g.getValue(),b="";return h&&(b=je(h)?h.checked?"true":"false":h.value),h=b,h!==E?(g.setValue(h),!0):!1}function Ht(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Vt(h,g){var E=g.checked;return se({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??h._wrapperState.initialChecked})}function ii(h,g){var E=g.defaultValue==null?"":g.defaultValue,b=g.checked!=null?g.checked:g.defaultChecked;E=Le(g.value!=null?g.value:E),h._wrapperState={initialChecked:b,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Yt(h,g){g=g.checked,g!=null&&C(h,"checked",g,!1)}function k(h,g){Yt(h,g);var E=Le(g.value),b=g.type;if(E!=null)b==="number"?(E===0&&h.value===""||h.value!=E)&&(h.value=""+E):h.value!==""+E&&(h.value=""+E);else if(b==="submit"||b==="reset"){h.removeAttribute("value");return}g.hasOwnProperty("value")?ve(h,g.type,E):g.hasOwnProperty("defaultValue")&&ve(h,g.type,Le(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(h.defaultChecked=!!g.defaultChecked)}function X(h,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var b=g.type;if(!(b!=="submit"&&b!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+h._wrapperState.initialValue,E||g===h.value||(h.value=g),h.defaultValue=g}E=h.name,E!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,E!==""&&(h.name=E)}function ve(h,g,E){(g!=="number"||Ht(h.ownerDocument)!==h)&&(E==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+E&&(h.defaultValue=""+E))}var Pe=Array.isArray;function Ae(h,g,E,b){if(h=h.options,g){g={};for(var A=0;A<E.length;A++)g["$"+E[A]]=!0;for(E=0;E<h.length;E++)A=g.hasOwnProperty("$"+h[E].value),h[E].selected!==A&&(h[E].selected=A),A&&b&&(h[E].defaultSelected=!0)}else{for(E=""+Le(E),g=null,A=0;A<h.length;A++){if(h[A].value===E){h[A].selected=!0,b&&(h[A].defaultSelected=!0);return}g!==null||h[A].disabled||(g=h[A])}g!==null&&(g.selected=!0)}}function Ve(h,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return se({},g,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function ze(h,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(t(92));if(Pe(E)){if(1<E.length)throw Error(t(93));E=E[0]}g=E}g==null&&(g=""),E=g}h._wrapperState={initialValue:Le(E)}}function vt(h,g){var E=Le(g.value),b=Le(g.defaultValue);E!=null&&(E=""+E,E!==h.value&&(h.value=E),g.defaultValue==null&&h.defaultValue!==E&&(h.defaultValue=E)),b!=null&&(h.defaultValue=""+b)}function xt(h){var g=h.textContent;g===h._wrapperState.initialValue&&g!==""&&g!==null&&(h.value=g)}function It(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rt(h,g){return h==null||h==="http://www.w3.org/1999/xhtml"?It(g):h==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var Ot,G=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,b,A){MSApp.execUnsafeLocalFunction(function(){return h(g,E,b,A)})}:h}(function(h,g){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=g;else{for(Ot=Ot||document.createElement("div"),Ot.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Ot.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;g.firstChild;)h.appendChild(g.firstChild)}});function U(h,g){if(g){var E=h.firstChild;if(E&&E===h.lastChild&&E.nodeType===3){E.nodeValue=g;return}}h.textContent=g}var K={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},re=["Webkit","ms","Moz","O"];Object.keys(K).forEach(function(h){re.forEach(function(g){g=g+h.charAt(0).toUpperCase()+h.substring(1),K[g]=K[h]})});function Re(h,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||K.hasOwnProperty(h)&&K[h]?(""+g).trim():g+"px"}function Me(h,g){h=h.style;for(var E in g)if(g.hasOwnProperty(E)){var b=E.indexOf("--")===0,A=Re(E,g[E],b);E==="float"&&(E="cssFloat"),b?h.setProperty(E,A):h[E]=A}}var ot=se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nt(h,g){if(g){if(ot[h]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function tt(h,g){if(h.indexOf("-")===-1)return typeof g.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Di=null;function si(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var ji=null,Qi=null,en=null;function Fs(h){if(h=ko(h)){if(typeof ji!="function")throw Error(t(280));var g=h.stateNode;g&&(g=ju(g),ji(h.stateNode,h.type,g))}}function Yl(h){Qi?en?en.push(h):en=[h]:Qi=h}function tn(){if(Qi){var h=Qi,g=en;if(en=Qi=null,Fs(h),g)for(h=0;h<g.length;h++)Fs(g[h])}}function cs(h,g){return h(g)}function mn(){}var zn=!1;function zi(h,g,E){if(zn)return h(g,E);zn=!0;try{return cs(h,g,E)}finally{zn=!1,(Qi!==null||en!==null)&&(mn(),tn())}}function Ur(h,g){var E=h.stateNode;if(E===null)return null;var b=ju(E);if(b===null)return null;E=b[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(h=h.type,b=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!b;break e;default:h=!1}if(h)return null;if(E&&typeof E!="function")throw Error(t(231,g,typeof E));return E}var Bs=!1;if(a)try{var Oi={};Object.defineProperty(Oi,"passive",{get:function(){Bs=!0}}),window.addEventListener("test",Oi,Oi),window.removeEventListener("test",Oi,Oi)}catch{Bs=!1}function xn(h,g,E,b,A,P,V,oe,ue){var Se=Array.prototype.slice.call(arguments,3);try{g.apply(E,Se)}catch(Ne){this.onError(Ne)}}var hi=!1,nt=null,Xl=!1,Eu=null,Lg={onError:function(h){hi=!0,nt=h}};function Ig(h,g,E,b,A,P,V,oe,ue){hi=!1,nt=null,xn.apply(Lg,arguments)}function tf(h,g,E,b,A,P,V,oe,ue){if(Ig.apply(this,arguments),hi){if(hi){var Se=nt;hi=!1,nt=null}else throw Error(t(198));Xl||(Xl=!0,Eu=Se)}}function Us(h){var g=h,E=h;if(h.alternate)for(;g.return;)g=g.return;else{h=g;do g=h,g.flags&4098&&(E=g.return),h=g.return;while(h)}return g.tag===3?E:null}function So(h){if(h.tag===13){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function nf(h){if(Us(h)!==h)throw Error(t(188))}function R_(h){var g=h.alternate;if(!g){if(g=Us(h),g===null)throw Error(t(188));return g!==h?null:h}for(var E=h,b=g;;){var A=E.return;if(A===null)break;var P=A.alternate;if(P===null){if(b=A.return,b!==null){E=b;continue}break}if(A.child===P.child){for(P=A.child;P;){if(P===E)return nf(A),h;if(P===b)return nf(A),g;P=P.sibling}throw Error(t(188))}if(E.return!==b.return)E=A,b=P;else{for(var V=!1,oe=A.child;oe;){if(oe===E){V=!0,E=A,b=P;break}if(oe===b){V=!0,b=A,E=P;break}oe=oe.sibling}if(!V){for(oe=P.child;oe;){if(oe===E){V=!0,E=P,b=A;break}if(oe===b){V=!0,b=P,E=A;break}oe=oe.sibling}if(!V)throw Error(t(189))}}if(E.alternate!==b)throw Error(t(190))}if(E.tag!==3)throw Error(t(188));return E.stateNode.current===E?h:g}function Pg(h){return h=R_(h),h!==null?Dg(h):null}function Dg(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var g=Dg(h);if(g!==null)return g;h=h.sibling}return null}var Og=e.unstable_scheduleCallback,rf=e.unstable_cancelCallback,A_=e.unstable_shouldYield,wu=e.unstable_requestPaint,xi=e.unstable_now,L_=e.unstable_getCurrentPriorityLevel,sf=e.unstable_ImmediatePriority,kg=e.unstable_UserBlockingPriority,Tu=e.unstable_NormalPriority,of=e.unstable_LowPriority,ba=e.unstable_IdlePriority,Jl=null,yr=null;function Ql(h){if(yr&&typeof yr.onCommitFiberRoot=="function")try{yr.onCommitFiberRoot(Jl,h,void 0,(h.current.flags&128)===128)}catch{}}var Rt=Math.clz32?Math.clz32:xa,_i=Math.log,Su=Math.LN2;function xa(h){return h>>>=0,h===0?32:31-(_i(h)/Su|0)|0}var us=64,Ca=4194304;function bt(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function di(h,g){var E=h.pendingLanes;if(E===0)return 0;var b=0,A=h.suspendedLanes,P=h.pingedLanes,V=E&268435455;if(V!==0){var oe=V&~A;oe!==0?b=bt(oe):(P&=V,P!==0&&(b=bt(P)))}else V=E&~A,V!==0?b=bt(V):P!==0&&(b=bt(P));if(b===0)return 0;if(g!==0&&g!==b&&!(g&A)&&(A=b&-b,P=g&-g,A>=P||A===16&&(P&4194240)!==0))return g;if(b&4&&(b|=E&16),g=h.entangledLanes,g!==0)for(h=h.entanglements,g&=b;0<g;)E=31-Rt(g),A=1<<E,b|=h[E],g&=~A;return b}function af(h,g){switch(h){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bu(h,g){for(var E=h.suspendedLanes,b=h.pingedLanes,A=h.expirationTimes,P=h.pendingLanes;0<P;){var V=31-Rt(P),oe=1<<V,ue=A[V];ue===-1?(!(oe&E)||oe&b)&&(A[V]=af(oe,g)):ue<=g&&(h.expiredLanes|=oe),P&=~oe}}function Cn(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function Mg(){var h=us;return us<<=1,!(us&4194240)&&(us=64),h}function Ra(h){for(var g=[],E=0;31>E;E++)g.push(h);return g}function _r(h,g,E){h.pendingLanes|=g,g!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,g=31-Rt(g),h[g]=E}function ki(h,g){var E=h.pendingLanes&~g;h.pendingLanes=g,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=g,h.mutableReadLanes&=g,h.entangledLanes&=g,g=h.entanglements;var b=h.eventTimes;for(h=h.expirationTimes;0<E;){var A=31-Rt(E),P=1<<A;g[A]=0,b[A]=-1,h[A]=-1,E&=~P}}function hs(h,g){var E=h.entangledLanes|=g;for(h=h.entanglements;E;){var b=31-Rt(E),A=1<<b;A&g|h[b]&g&&(h[b]|=g),E&=~A}}var $t=0;function Aa(h){return h&=-h,1<h?4<h?h&268435455?16:536870912:4:1}var xu,bo,Cu,Ru,ec,tc=!1,La=[],Er=null,ds=null,zr=null,ic=new Map,Tt=new Map,Wi=[],oi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lf(h,g){switch(h){case"focusin":case"focusout":Er=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":zr=null;break;case"pointerover":case"pointerout":ic.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tt.delete(g.pointerId)}}function xo(h,g,E,b,A,P){return h===null||h.nativeEvent!==P?(h={blockedOn:g,domEventName:E,eventSystemFlags:b,nativeEvent:P,targetContainers:[A]},g!==null&&(g=ko(g),g!==null&&bo(g)),h):(h.eventSystemFlags|=b,g=h.targetContainers,A!==null&&g.indexOf(A)===-1&&g.push(A),h)}function cf(h,g,E,b,A){switch(g){case"focusin":return Er=xo(Er,h,g,E,b,A),!0;case"dragenter":return ds=xo(ds,h,g,E,b,A),!0;case"mouseover":return zr=xo(zr,h,g,E,b,A),!0;case"pointerover":var P=A.pointerId;return ic.set(P,xo(ic.get(P)||null,h,g,E,b,A)),!0;case"gotpointercapture":return P=A.pointerId,Tt.set(P,xo(Tt.get(P)||null,h,g,E,b,A)),!0}return!1}function Au(h){var g=Oo(h.target);if(g!==null){var E=Us(g);if(E!==null){if(g=E.tag,g===13){if(g=So(E),g!==null){h.blockedOn=g,ec(h.priority,function(){Cu(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){h.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Gr(h){if(h.blockedOn!==null)return!1;for(var g=h.targetContainers;0<g.length;){var E=Pu(h.domEventName,h.eventSystemFlags,g[0],h.nativeEvent);if(E===null){E=h.nativeEvent;var b=new E.constructor(E.type,E);Di=b,E.target.dispatchEvent(b),Di=null}else return g=ko(E),g!==null&&bo(g),h.blockedOn=E,!1;g.shift()}return!0}function Lu(h,g,E){Gr(h)&&E.delete(g)}function nc(){tc=!1,Er!==null&&Gr(Er)&&(Er=null),ds!==null&&Gr(ds)&&(ds=null),zr!==null&&Gr(zr)&&(zr=null),ic.forEach(Lu),Tt.forEach(Lu)}function Ci(h,g){h.blockedOn===g&&(h.blockedOn=null,tc||(tc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,nc)))}function wr(h){function g(A){return Ci(A,h)}if(0<La.length){Ci(La[0],h);for(var E=1;E<La.length;E++){var b=La[E];b.blockedOn===h&&(b.blockedOn=null)}}for(Er!==null&&Ci(Er,h),ds!==null&&Ci(ds,h),zr!==null&&Ci(zr,h),ic.forEach(g),Tt.forEach(g),E=0;E<Wi.length;E++)b=Wi[E],b.blockedOn===h&&(b.blockedOn=null);for(;0<Wi.length&&(E=Wi[0],E.blockedOn===null);)Au(E),E.blockedOn===null&&Wi.shift()}var Co=I.ReactCurrentBatchConfig,rc=!0;function I_(h,g,E,b){var A=$t,P=Co.transition;Co.transition=null;try{$t=1,sc(h,g,E,b)}finally{$t=A,Co.transition=P}}function Ng(h,g,E,b){var A=$t,P=Co.transition;Co.transition=null;try{$t=4,sc(h,g,E,b)}finally{$t=A,Co.transition=P}}function sc(h,g,E,b){if(rc){var A=Pu(h,g,E,b);if(A===null)d(h,g,b,Iu,E),lf(h,b);else if(cf(A,h,g,E,b))b.stopPropagation();else if(lf(h,b),g&4&&-1<oi.indexOf(h)){for(;A!==null;){var P=ko(A);if(P!==null&&xu(P),P=Pu(h,g,E,b),P===null&&d(h,g,b,Iu,E),P===A)break;A=P}A!==null&&b.stopPropagation()}else d(h,g,b,null,E)}}var Iu=null;function Pu(h,g,E,b){if(Iu=null,h=si(b),h=Oo(h),h!==null)if(g=Us(h),g===null)h=null;else if(E=g.tag,E===13){if(h=So(g),h!==null)return h;h=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;h=null}else g!==h&&(h=null);return Iu=h,null}function Bt(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(L_()){case sf:return 1;case kg:return 4;case Tu:case of:return 16;case ba:return 536870912;default:return 16}default:return 16}}var zs=null,Gn=null,Gs=null;function uf(){if(Gs)return Gs;var h,g=Gn,E=g.length,b,A="value"in zs?zs.value:zs.textContent,P=A.length;for(h=0;h<E&&g[h]===A[h];h++);var V=E-h;for(b=1;b<=V&&g[E-b]===A[P-b];b++);return Gs=A.slice(h,1<b?1-b:void 0)}function Du(h){var g=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&g===13&&(h=13)):h=g,h===10&&(h=13),32<=h||h===13?h:0}function Ia(){return!0}function Fg(){return!1}function Rn(h){function g(E,b,A,P,V){this._reactName=E,this._targetInst=A,this.type=b,this.nativeEvent=P,this.target=V,this.currentTarget=null;for(var oe in h)h.hasOwnProperty(oe)&&(E=h[oe],this[oe]=E?E(P):P[oe]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Ia:Fg,this.isPropagationStopped=Fg,this}return se(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=Ia)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=Ia)},persist:function(){},isPersistent:Ia}),g}var Pa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hf=Rn(Pa),Ro=se({},Pa,{view:0,detail:0}),P_=Rn(Ro),Qn,df,Da,Tr=se({},Ro,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lo,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Da&&(Da&&h.type==="mousemove"?(Qn=h.screenX-Da.screenX,df=h.screenY-Da.screenY):df=Qn=0,Da=h),Qn)},movementY:function(h){return"movementY"in h?h.movementY:df}}),ff=Rn(Tr),Bg=se({},Tr,{dataTransfer:0}),pf=Rn(Bg),D_=se({},Ro,{relatedTarget:0}),Ou=Rn(D_),Ug=se({},Pa,{animationName:0,elapsedTime:0,pseudoElement:0}),O_=Rn(Ug),k_=se({},Pa,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),gf=Rn(k_),M_=se({},Pa,{data:0}),mf=Rn(M_),zg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ku={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ao={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function N_(h){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(h):(h=Ao[h])?!!g[h]:!1}function Lo(){return N_}var er=se({},Ro,{key:function(h){if(h.key){var g=zg[h.key]||h.key;if(g!=="Unidentified")return g}return h.type==="keypress"?(h=Du(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?ku[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lo,charCode:function(h){return h.type==="keypress"?Du(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?Du(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Gg=Rn(er),Hg=se({},Tr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$g=Rn(Hg),vf=se({},Ro,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lo}),yf=Rn(vf),F_=se({},Pa,{propertyName:0,elapsedTime:0,pseudoElement:0}),B_=Rn(F_),Vg=se({},Tr,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),U_=Rn(Vg),Sr=[9,13,27,32],Hs=a&&"CompositionEvent"in window,oc=null;a&&"documentMode"in document&&(oc=document.documentMode);var fs=a&&"TextEvent"in window&&!oc,jg=a&&(!Hs||oc&&8<oc&&11>=oc),Io=" ",Wg=!1;function Oa(h,g){switch(h){case"keyup":return Sr.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _f(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var ps=!1;function z_(h,g){switch(h){case"compositionend":return _f(g);case"keypress":return g.which!==32?null:(Wg=!0,Io);case"textInput":return h=g.data,h===Io&&Wg?null:h;default:return null}}function $s(h,g){if(ps)return h==="compositionend"||!Hs&&Oa(h,g)?(h=uf(),Gs=Gn=zs=null,ps=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return jg&&g.locale!=="ko"?null:g.data;default:return null}}var Mu={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qg(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g==="input"?!!Mu[h.type]:g==="textarea"}function Nu(h,g,E,b){Yl(b),g=S(g,"onChange"),0<g.length&&(E=new hf("onChange","change",null,E,b),h.push({event:E,listeners:g}))}var ac=null,Hn=null;function G_(h){Af(h,0)}function gs(h){var g=Mo(h);if(ct(g))return h}function H_(h,g){if(h==="change")return g}var Hr=!1;if(a){var ka;if(a){var Fu="oninput"in document;if(!Fu){var Bu=document.createElement("div");Bu.setAttribute("oninput","return;"),Fu=typeof Bu.oninput=="function"}ka=Fu}else ka=!1;Hr=ka&&(!document.documentMode||9<document.documentMode)}function lc(){ac&&(ac.detachEvent("onpropertychange",Uu),Hn=ac=null)}function Uu(h){if(h.propertyName==="value"&&gs(Hn)){var g=[];Nu(g,Hn,h,si(h)),zi(G_,g)}}function zu(h,g,E){h==="focusin"?(lc(),ac=g,Hn=E,ac.attachEvent("onpropertychange",Uu)):h==="focusout"&&lc()}function Ma(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return gs(Hn)}function Gu(h,g){if(h==="click")return gs(g)}function Ef(h,g){if(h==="input"||h==="change")return gs(g)}function Kg(h,g){return h===g&&(h!==0||1/h===1/g)||h!==h&&g!==g}var br=typeof Object.is=="function"?Object.is:Kg;function Vs(h,g){if(br(h,g))return!0;if(typeof h!="object"||h===null||typeof g!="object"||g===null)return!1;var E=Object.keys(h),b=Object.keys(g);if(E.length!==b.length)return!1;for(b=0;b<E.length;b++){var A=E[b];if(!l.call(g,A)||!br(h[A],g[A]))return!1}return!0}function Zg(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function wf(h,g){var E=Zg(h);h=0;for(var b;E;){if(E.nodeType===3){if(b=h+E.textContent.length,h<=g&&b>=g)return{node:E,offset:g-h};h=b}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Zg(E)}}function Yg(h,g){return h&&g?h===g?!0:h&&h.nodeType===3?!1:g&&g.nodeType===3?Yg(h,g.parentNode):"contains"in h?h.contains(g):h.compareDocumentPosition?!!(h.compareDocumentPosition(g)&16):!1:!1}function Tf(){for(var h=window,g=Ht();g instanceof h.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)h=g.contentWindow;else break;g=Ht(h.document)}return g}function Sf(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g&&(g==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||g==="textarea"||h.contentEditable==="true")}function $r(h){var g=Tf(),E=h.focusedElem,b=h.selectionRange;if(g!==E&&E&&E.ownerDocument&&Yg(E.ownerDocument.documentElement,E)){if(b!==null&&Sf(E)){if(g=b.start,h=b.end,h===void 0&&(h=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(h,E.value.length);else if(h=(g=E.ownerDocument||document)&&g.defaultView||window,h.getSelection){h=h.getSelection();var A=E.textContent.length,P=Math.min(b.start,A);b=b.end===void 0?P:Math.min(b.end,A),!h.extend&&P>b&&(A=b,b=P,P=A),A=wf(E,P);var V=wf(E,b);A&&V&&(h.rangeCount!==1||h.anchorNode!==A.node||h.anchorOffset!==A.offset||h.focusNode!==V.node||h.focusOffset!==V.offset)&&(g=g.createRange(),g.setStart(A.node,A.offset),h.removeAllRanges(),P>b?(h.addRange(g),h.extend(V.node,V.offset)):(g.setEnd(V.node,V.offset),h.addRange(g)))}}for(g=[],h=E;h=h.parentNode;)h.nodeType===1&&g.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)h=g[E],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Hu=a&&"documentMode"in document&&11>=document.documentMode,Na=null,Fa=null,cc=null,$u=!1;function Xg(h,g,E){var b=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;$u||Na==null||Na!==Ht(b)||(b=Na,"selectionStart"in b&&Sf(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),cc&&Vs(cc,b)||(cc=b,b=S(Fa,"onSelect"),0<b.length&&(g=new hf("onSelect","select",null,g,E),h.push({event:g,listeners:b}),g.target=Na)))}function js(h,g){var E={};return E[h.toLowerCase()]=g.toLowerCase(),E["Webkit"+h]="webkit"+g,E["Moz"+h]="moz"+g,E}var Ba={animationend:js("Animation","AnimationEnd"),animationiteration:js("Animation","AnimationIteration"),animationstart:js("Animation","AnimationStart"),transitionend:js("Transition","TransitionEnd")},Ws={},bf={};a&&(bf=document.createElement("div").style,"AnimationEvent"in window||(delete Ba.animationend.animation,delete Ba.animationiteration.animation,delete Ba.animationstart.animation),"TransitionEvent"in window||delete Ba.transitionend.transition);function uc(h){if(Ws[h])return Ws[h];if(!Ba[h])return h;var g=Ba[h],E;for(E in g)if(g.hasOwnProperty(E)&&E in bf)return Ws[h]=g[E];return h}var Jg=uc("animationend"),Vr=uc("animationiteration"),xf=uc("animationstart"),Cf=uc("transitionend"),Ua=new Map,Qg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xr(h,g){Ua.set(h,g),s(g,[h])}for(var Po=0;Po<Qg.length;Po++){var Vu=Qg[Po],em=Vu.toLowerCase(),$_=Vu[0].toUpperCase()+Vu.slice(1);xr(em,"on"+$_)}xr(Jg,"onAnimationEnd"),xr(Vr,"onAnimationIteration"),xr(xf,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(Cf,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var za="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tm=new Set("cancel close invalid load scroll toggle".split(" ").concat(za));function Rf(h,g,E){var b=h.type||"unknown-event";h.currentTarget=E,tf(b,g,void 0,h),h.currentTarget=null}function Af(h,g){g=(g&4)!==0;for(var E=0;E<h.length;E++){var b=h[E],A=b.event;b=b.listeners;e:{var P=void 0;if(g)for(var V=b.length-1;0<=V;V--){var oe=b[V],ue=oe.instance,Se=oe.currentTarget;if(oe=oe.listener,ue!==P&&A.isPropagationStopped())break e;Rf(A,oe,Se),P=ue}else for(V=0;V<b.length;V++){if(oe=b[V],ue=oe.instance,Se=oe.currentTarget,oe=oe.listener,ue!==P&&A.isPropagationStopped())break e;Rf(A,oe,Se),P=ue}}}if(Xl)throw h=Eu,Xl=!1,Eu=null,h}function ai(h,g){var E=g[Va];E===void 0&&(E=g[Va]=new Set);var b=h+"__bubble";E.has(b)||(im(g,h,2,!1),E.add(b))}function Lf(h,g,E){var b=0;g&&(b|=4),im(E,h,b,g)}var hc="_reactListening"+Math.random().toString(36).slice(2);function Ga(h){if(!h[hc]){h[hc]=!0,i.forEach(function(E){E!=="selectionchange"&&(tm.has(E)||Lf(E,!1,h),Lf(E,!0,h))});var g=h.nodeType===9?h:h.ownerDocument;g===null||g[hc]||(g[hc]=!0,Lf("selectionchange",!1,g))}}function im(h,g,E,b){switch(Bt(g)){case 1:var A=I_;break;case 4:A=Ng;break;default:A=sc}E=A.bind(null,g,E,h),A=void 0,!Bs||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(A=!0),b?A!==void 0?h.addEventListener(g,E,{capture:!0,passive:A}):h.addEventListener(g,E,!0):A!==void 0?h.addEventListener(g,E,{passive:A}):h.addEventListener(g,E,!1)}function d(h,g,E,b,A){var P=b;if(!(g&1)&&!(g&2)&&b!==null)e:for(;;){if(b===null)return;var V=b.tag;if(V===3||V===4){var oe=b.stateNode.containerInfo;if(oe===A||oe.nodeType===8&&oe.parentNode===A)break;if(V===4)for(V=b.return;V!==null;){var ue=V.tag;if((ue===3||ue===4)&&(ue=V.stateNode.containerInfo,ue===A||ue.nodeType===8&&ue.parentNode===A))return;V=V.return}for(;oe!==null;){if(V=Oo(oe),V===null)return;if(ue=V.tag,ue===5||ue===6){b=P=V;continue e}oe=oe.parentNode}}b=b.return}zi(function(){var Se=P,Ne=si(E),Be=[];e:{var ke=Ua.get(h);if(ke!==void 0){var qe=hf,it=h;switch(h){case"keypress":if(Du(E)===0)break e;case"keydown":case"keyup":qe=Gg;break;case"focusin":it="focus",qe=Ou;break;case"focusout":it="blur",qe=Ou;break;case"beforeblur":case"afterblur":qe=Ou;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qe=ff;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qe=pf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qe=yf;break;case Jg:case Vr:case xf:qe=O_;break;case Cf:qe=B_;break;case"scroll":qe=P_;break;case"wheel":qe=U_;break;case"copy":case"cut":case"paste":qe=gf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qe=$g}var st=(g&4)!==0,Fi=!st&&h==="scroll",ye=st?ke!==null?ke+"Capture":null:ke;st=[];for(var he=Se,we;he!==null;){we=he;var He=we.stateNode;if(we.tag===5&&He!==null&&(we=He,ye!==null&&(He=Ur(he,ye),He!=null&&st.push(v(he,He,we)))),Fi)break;he=he.return}0<st.length&&(ke=new qe(ke,it,null,E,Ne),Be.push({event:ke,listeners:st}))}}if(!(g&7)){e:{if(ke=h==="mouseover"||h==="pointerover",qe=h==="mouseout"||h==="pointerout",ke&&E!==Di&&(it=E.relatedTarget||E.fromElement)&&(Oo(it)||it[ei]))break e;if((qe||ke)&&(ke=Ne.window===Ne?Ne:(ke=Ne.ownerDocument)?ke.defaultView||ke.parentWindow:window,qe?(it=E.relatedTarget||E.toElement,qe=Se,it=it?Oo(it):null,it!==null&&(Fi=Us(it),it!==Fi||it.tag!==5&&it.tag!==6)&&(it=null)):(qe=null,it=Se),qe!==it)){if(st=ff,He="onMouseLeave",ye="onMouseEnter",he="mouse",(h==="pointerout"||h==="pointerover")&&(st=$g,He="onPointerLeave",ye="onPointerEnter",he="pointer"),Fi=qe==null?ke:Mo(qe),we=it==null?ke:Mo(it),ke=new st(He,he+"leave",qe,E,Ne),ke.target=Fi,ke.relatedTarget=we,He=null,Oo(Ne)===Se&&(st=new st(ye,he+"enter",it,E,Ne),st.target=we,st.relatedTarget=Fi,He=st),Fi=He,qe&&it)t:{for(st=qe,ye=it,he=0,we=st;we;we=R(we))he++;for(we=0,He=ye;He;He=R(He))we++;for(;0<he-we;)st=R(st),he--;for(;0<we-he;)ye=R(ye),we--;for(;he--;){if(st===ye||ye!==null&&st===ye.alternate)break t;st=R(st),ye=R(ye)}st=null}else st=null;qe!==null&&O(Be,ke,qe,st,!1),it!==null&&Fi!==null&&O(Be,Fi,it,st,!0)}}e:{if(ke=Se?Mo(Se):window,qe=ke.nodeName&&ke.nodeName.toLowerCase(),qe==="select"||qe==="input"&&ke.type==="file")var at=H_;else if(qg(ke))if(Hr)at=Ef;else{at=Ma;var ft=zu}else(qe=ke.nodeName)&&qe.toLowerCase()==="input"&&(ke.type==="checkbox"||ke.type==="radio")&&(at=Gu);if(at&&(at=at(h,Se))){Nu(Be,at,E,Ne);break e}ft&&ft(h,ke,Se),h==="focusout"&&(ft=ke._wrapperState)&&ft.controlled&&ke.type==="number"&&ve(ke,"number",ke.value)}switch(ft=Se?Mo(Se):window,h){case"focusin":(qg(ft)||ft.contentEditable==="true")&&(Na=ft,Fa=Se,cc=null);break;case"focusout":cc=Fa=Na=null;break;case"mousedown":$u=!0;break;case"contextmenu":case"mouseup":case"dragend":$u=!1,Xg(Be,E,Ne);break;case"selectionchange":if(Hu)break;case"keydown":case"keyup":Xg(Be,E,Ne)}var pt;if(Hs)e:{switch(h){case"compositionstart":var St="onCompositionStart";break e;case"compositionend":St="onCompositionEnd";break e;case"compositionupdate":St="onCompositionUpdate";break e}St=void 0}else ps?Oa(h,E)&&(St="onCompositionEnd"):h==="keydown"&&E.keyCode===229&&(St="onCompositionStart");St&&(jg&&E.locale!=="ko"&&(ps||St!=="onCompositionStart"?St==="onCompositionEnd"&&ps&&(pt=uf()):(zs=Ne,Gn="value"in zs?zs.value:zs.textContent,ps=!0)),ft=S(Se,St),0<ft.length&&(St=new mf(St,h,null,E,Ne),Be.push({event:St,listeners:ft}),pt?St.data=pt:(pt=_f(E),pt!==null&&(St.data=pt)))),(pt=fs?z_(h,E):$s(h,E))&&(Se=S(Se,"onBeforeInput"),0<Se.length&&(Ne=new mf("onBeforeInput","beforeinput",null,E,Ne),Be.push({event:Ne,listeners:Se}),Ne.data=pt))}Af(Be,g)})}function v(h,g,E){return{instance:h,listener:g,currentTarget:E}}function S(h,g){for(var E=g+"Capture",b=[];h!==null;){var A=h,P=A.stateNode;A.tag===5&&P!==null&&(A=P,P=Ur(h,E),P!=null&&b.unshift(v(h,P,A)),P=Ur(h,g),P!=null&&b.push(v(h,P,A))),h=h.return}return b}function R(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function O(h,g,E,b,A){for(var P=g._reactName,V=[];E!==null&&E!==b;){var oe=E,ue=oe.alternate,Se=oe.stateNode;if(ue!==null&&ue===b)break;oe.tag===5&&Se!==null&&(oe=Se,A?(ue=Ur(E,P),ue!=null&&V.unshift(v(E,ue,oe))):A||(ue=Ur(E,P),ue!=null&&V.push(v(E,ue,oe)))),E=E.return}V.length!==0&&h.push({event:g,listeners:V})}var j=/\r\n?/g,ae=/\u0000|\uFFFD/g;function me(h){return(typeof h=="string"?h:""+h).replace(j,`
`).replace(ae,"")}function Te(h,g,E){if(g=me(g),me(h)!==g&&E)throw Error(t(425))}function De(){}var We=null,ut=null;function Pt(h,g){return h==="textarea"||h==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var qi=typeof setTimeout=="function"?setTimeout:void 0,Gi=typeof clearTimeout=="function"?clearTimeout:void 0,$n=typeof Promise=="function"?Promise:void 0,An=typeof queueMicrotask=="function"?queueMicrotask:typeof $n<"u"?function(h){return $n.resolve(null).then(h).catch(Ha)}:qi;function Ha(h){setTimeout(function(){throw h})}function If(h,g){var E=g,b=0;do{var A=E.nextSibling;if(h.removeChild(E),A&&A.nodeType===8)if(E=A.data,E==="/$"){if(b===0){h.removeChild(A),wr(g);return}b--}else E!=="$"&&E!=="$?"&&E!=="$!"||b++;E=A}while(E);wr(g)}function qs(h){for(;h!=null;h=h.nextSibling){var g=h.nodeType;if(g===1||g===3)break;if(g===8){if(g=h.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return h}function nm(h){h=h.previousSibling;for(var g=0;h;){if(h.nodeType===8){var E=h.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return h;g--}else E==="/$"&&g++}h=h.previousSibling}return null}var Do=Math.random().toString(36).slice(2),jr="__reactFiber$"+Do,$a="__reactProps$"+Do,ei="__reactContainer$"+Do,Va="__reactEvents$"+Do,V_="__reactListeners$"+Do,j_="__reactHandles$"+Do;function Oo(h){var g=h[jr];if(g)return g;for(var E=h.parentNode;E;){if(g=E[ei]||E[jr]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(h=nm(h);h!==null;){if(E=h[jr])return E;h=nm(h)}return g}h=E,E=h.parentNode}return null}function ko(h){return h=h[jr]||h[ei],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function Mo(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function ju(h){return h[$a]||null}var W_=[],Wu=-1;function ja(h){return{current:h}}function Ei(h){0>Wu||(h.current=W_[Wu],W_[Wu]=null,Wu--)}function fi(h,g){Wu++,W_[Wu]=h.current,h.current=g}var Wa={},Ln=ja(Wa),tr=ja(!1),dc=Wa;function qu(h,g){var E=h.type.contextTypes;if(!E)return Wa;var b=h.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===g)return b.__reactInternalMemoizedMaskedChildContext;var A={},P;for(P in E)A[P]=g[P];return b&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=g,h.__reactInternalMemoizedMaskedChildContext=A),A}function ir(h){return h=h.childContextTypes,h!=null}function rm(){Ei(tr),Ei(Ln)}function dC(h,g,E){if(Ln.current!==Wa)throw Error(t(168));fi(Ln,g),fi(tr,E)}function fC(h,g,E){var b=h.stateNode;if(g=g.childContextTypes,typeof b.getChildContext!="function")return E;b=b.getChildContext();for(var A in b)if(!(A in g))throw Error(t(108,xe(h)||"Unknown",A));return se({},E,b)}function sm(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Wa,dc=Ln.current,fi(Ln,h),fi(tr,tr.current),!0}function pC(h,g,E){var b=h.stateNode;if(!b)throw Error(t(169));E?(h=fC(h,g,dc),b.__reactInternalMemoizedMergedChildContext=h,Ei(tr),Ei(Ln),fi(Ln,h)):Ei(tr),fi(tr,E)}var No=null,om=!1,q_=!1;function gC(h){No===null?No=[h]:No.push(h)}function S5(h){om=!0,gC(h)}function qa(){if(!q_&&No!==null){q_=!0;var h=0,g=$t;try{var E=No;for($t=1;h<E.length;h++){var b=E[h];do b=b(!0);while(b!==null)}No=null,om=!1}catch(A){throw No!==null&&(No=No.slice(h+1)),Og(sf,qa),A}finally{$t=g,q_=!1}}return null}var Ku=[],Zu=0,am=null,lm=0,Wr=[],qr=0,fc=null,Fo=1,Bo="";function pc(h,g){Ku[Zu++]=lm,Ku[Zu++]=am,am=h,lm=g}function mC(h,g,E){Wr[qr++]=Fo,Wr[qr++]=Bo,Wr[qr++]=fc,fc=h;var b=Fo;h=Bo;var A=32-Rt(b)-1;b&=~(1<<A),E+=1;var P=32-Rt(g)+A;if(30<P){var V=A-A%5;P=(b&(1<<V)-1).toString(32),b>>=V,A-=V,Fo=1<<32-Rt(g)+A|E<<A|b,Bo=P+h}else Fo=1<<P|E<<A|b,Bo=h}function K_(h){h.return!==null&&(pc(h,1),mC(h,1,0))}function Z_(h){for(;h===am;)am=Ku[--Zu],Ku[Zu]=null,lm=Ku[--Zu],Ku[Zu]=null;for(;h===fc;)fc=Wr[--qr],Wr[qr]=null,Bo=Wr[--qr],Wr[qr]=null,Fo=Wr[--qr],Wr[qr]=null}var Cr=null,Rr=null,Si=!1,ms=null;function vC(h,g){var E=Xr(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=h,g=h.deletions,g===null?(h.deletions=[E],h.flags|=16):g.push(E)}function yC(h,g){switch(h.tag){case 5:var E=h.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(h.stateNode=g,Cr=h,Rr=qs(g.firstChild),!0):!1;case 6:return g=h.pendingProps===""||g.nodeType!==3?null:g,g!==null?(h.stateNode=g,Cr=h,Rr=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=fc!==null?{id:Fo,overflow:Bo}:null,h.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Xr(18,null,null,0),E.stateNode=g,E.return=h,h.child=E,Cr=h,Rr=null,!0):!1;default:return!1}}function Y_(h){return(h.mode&1)!==0&&(h.flags&128)===0}function X_(h){if(Si){var g=Rr;if(g){var E=g;if(!yC(h,g)){if(Y_(h))throw Error(t(418));g=qs(E.nextSibling);var b=Cr;g&&yC(h,g)?vC(b,E):(h.flags=h.flags&-4097|2,Si=!1,Cr=h)}}else{if(Y_(h))throw Error(t(418));h.flags=h.flags&-4097|2,Si=!1,Cr=h}}}function _C(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Cr=h}function cm(h){if(h!==Cr)return!1;if(!Si)return _C(h),Si=!0,!1;var g;if((g=h.tag!==3)&&!(g=h.tag!==5)&&(g=h.type,g=g!=="head"&&g!=="body"&&!Pt(h.type,h.memoizedProps)),g&&(g=Rr)){if(Y_(h))throw EC(),Error(t(418));for(;g;)vC(h,g),g=qs(g.nextSibling)}if(_C(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,g=0;h;){if(h.nodeType===8){var E=h.data;if(E==="/$"){if(g===0){Rr=qs(h.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}h=h.nextSibling}Rr=null}}else Rr=Cr?qs(h.stateNode.nextSibling):null;return!0}function EC(){for(var h=Rr;h;)h=qs(h.nextSibling)}function Yu(){Rr=Cr=null,Si=!1}function J_(h){ms===null?ms=[h]:ms.push(h)}var b5=I.ReactCurrentBatchConfig;function Pf(h,g,E){if(h=E.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(t(309));var b=E.stateNode}if(!b)throw Error(t(147,h));var A=b,P=""+h;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===P?g.ref:(g=function(V){var oe=A.refs;V===null?delete oe[P]:oe[P]=V},g._stringRef=P,g)}if(typeof h!="string")throw Error(t(284));if(!E._owner)throw Error(t(290,h))}return h}function um(h,g){throw h=Object.prototype.toString.call(g),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":h))}function wC(h){var g=h._init;return g(h._payload)}function TC(h){function g(ye,he){if(h){var we=ye.deletions;we===null?(ye.deletions=[he],ye.flags|=16):we.push(he)}}function E(ye,he){if(!h)return null;for(;he!==null;)g(ye,he),he=he.sibling;return null}function b(ye,he){for(ye=new Map;he!==null;)he.key!==null?ye.set(he.key,he):ye.set(he.index,he),he=he.sibling;return ye}function A(ye,he){return ye=tl(ye,he),ye.index=0,ye.sibling=null,ye}function P(ye,he,we){return ye.index=we,h?(we=ye.alternate,we!==null?(we=we.index,we<he?(ye.flags|=2,he):we):(ye.flags|=2,he)):(ye.flags|=1048576,he)}function V(ye){return h&&ye.alternate===null&&(ye.flags|=2),ye}function oe(ye,he,we,He){return he===null||he.tag!==6?(he=$E(we,ye.mode,He),he.return=ye,he):(he=A(he,we),he.return=ye,he)}function ue(ye,he,we,He){var at=we.type;return at===N?Ne(ye,he,we.props.children,He,we.key):he!==null&&(he.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===ie&&wC(at)===he.type)?(He=A(he,we.props),He.ref=Pf(ye,he,we),He.return=ye,He):(He=km(we.type,we.key,we.props,null,ye.mode,He),He.ref=Pf(ye,he,we),He.return=ye,He)}function Se(ye,he,we,He){return he===null||he.tag!==4||he.stateNode.containerInfo!==we.containerInfo||he.stateNode.implementation!==we.implementation?(he=VE(we,ye.mode,He),he.return=ye,he):(he=A(he,we.children||[]),he.return=ye,he)}function Ne(ye,he,we,He,at){return he===null||he.tag!==7?(he=Tc(we,ye.mode,He,at),he.return=ye,he):(he=A(he,we),he.return=ye,he)}function Be(ye,he,we){if(typeof he=="string"&&he!==""||typeof he=="number")return he=$E(""+he,ye.mode,we),he.return=ye,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case D:return we=km(he.type,he.key,he.props,null,ye.mode,we),we.ref=Pf(ye,null,he),we.return=ye,we;case B:return he=VE(he,ye.mode,we),he.return=ye,he;case ie:var He=he._init;return Be(ye,He(he._payload),we)}if(Pe(he)||ce(he))return he=Tc(he,ye.mode,we,null),he.return=ye,he;um(ye,he)}return null}function ke(ye,he,we,He){var at=he!==null?he.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return at!==null?null:oe(ye,he,""+we,He);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case D:return we.key===at?ue(ye,he,we,He):null;case B:return we.key===at?Se(ye,he,we,He):null;case ie:return at=we._init,ke(ye,he,at(we._payload),He)}if(Pe(we)||ce(we))return at!==null?null:Ne(ye,he,we,He,null);um(ye,we)}return null}function qe(ye,he,we,He,at){if(typeof He=="string"&&He!==""||typeof He=="number")return ye=ye.get(we)||null,oe(he,ye,""+He,at);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case D:return ye=ye.get(He.key===null?we:He.key)||null,ue(he,ye,He,at);case B:return ye=ye.get(He.key===null?we:He.key)||null,Se(he,ye,He,at);case ie:var ft=He._init;return qe(ye,he,we,ft(He._payload),at)}if(Pe(He)||ce(He))return ye=ye.get(we)||null,Ne(he,ye,He,at,null);um(he,He)}return null}function it(ye,he,we,He){for(var at=null,ft=null,pt=he,St=he=0,sn=null;pt!==null&&St<we.length;St++){pt.index>St?(sn=pt,pt=null):sn=pt.sibling;var Zt=ke(ye,pt,we[St],He);if(Zt===null){pt===null&&(pt=sn);break}h&&pt&&Zt.alternate===null&&g(ye,pt),he=P(Zt,he,St),ft===null?at=Zt:ft.sibling=Zt,ft=Zt,pt=sn}if(St===we.length)return E(ye,pt),Si&&pc(ye,St),at;if(pt===null){for(;St<we.length;St++)pt=Be(ye,we[St],He),pt!==null&&(he=P(pt,he,St),ft===null?at=pt:ft.sibling=pt,ft=pt);return Si&&pc(ye,St),at}for(pt=b(ye,pt);St<we.length;St++)sn=qe(pt,ye,St,we[St],He),sn!==null&&(h&&sn.alternate!==null&&pt.delete(sn.key===null?St:sn.key),he=P(sn,he,St),ft===null?at=sn:ft.sibling=sn,ft=sn);return h&&pt.forEach(function(il){return g(ye,il)}),Si&&pc(ye,St),at}function st(ye,he,we,He){var at=ce(we);if(typeof at!="function")throw Error(t(150));if(we=at.call(we),we==null)throw Error(t(151));for(var ft=at=null,pt=he,St=he=0,sn=null,Zt=we.next();pt!==null&&!Zt.done;St++,Zt=we.next()){pt.index>St?(sn=pt,pt=null):sn=pt.sibling;var il=ke(ye,pt,Zt.value,He);if(il===null){pt===null&&(pt=sn);break}h&&pt&&il.alternate===null&&g(ye,pt),he=P(il,he,St),ft===null?at=il:ft.sibling=il,ft=il,pt=sn}if(Zt.done)return E(ye,pt),Si&&pc(ye,St),at;if(pt===null){for(;!Zt.done;St++,Zt=we.next())Zt=Be(ye,Zt.value,He),Zt!==null&&(he=P(Zt,he,St),ft===null?at=Zt:ft.sibling=Zt,ft=Zt);return Si&&pc(ye,St),at}for(pt=b(ye,pt);!Zt.done;St++,Zt=we.next())Zt=qe(pt,ye,St,Zt.value,He),Zt!==null&&(h&&Zt.alternate!==null&&pt.delete(Zt.key===null?St:Zt.key),he=P(Zt,he,St),ft===null?at=Zt:ft.sibling=Zt,ft=Zt);return h&&pt.forEach(function(nz){return g(ye,nz)}),Si&&pc(ye,St),at}function Fi(ye,he,we,He){if(typeof we=="object"&&we!==null&&we.type===N&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case D:e:{for(var at=we.key,ft=he;ft!==null;){if(ft.key===at){if(at=we.type,at===N){if(ft.tag===7){E(ye,ft.sibling),he=A(ft,we.props.children),he.return=ye,ye=he;break e}}else if(ft.elementType===at||typeof at=="object"&&at!==null&&at.$$typeof===ie&&wC(at)===ft.type){E(ye,ft.sibling),he=A(ft,we.props),he.ref=Pf(ye,ft,we),he.return=ye,ye=he;break e}E(ye,ft);break}else g(ye,ft);ft=ft.sibling}we.type===N?(he=Tc(we.props.children,ye.mode,He,we.key),he.return=ye,ye=he):(He=km(we.type,we.key,we.props,null,ye.mode,He),He.ref=Pf(ye,he,we),He.return=ye,ye=He)}return V(ye);case B:e:{for(ft=we.key;he!==null;){if(he.key===ft)if(he.tag===4&&he.stateNode.containerInfo===we.containerInfo&&he.stateNode.implementation===we.implementation){E(ye,he.sibling),he=A(he,we.children||[]),he.return=ye,ye=he;break e}else{E(ye,he);break}else g(ye,he);he=he.sibling}he=VE(we,ye.mode,He),he.return=ye,ye=he}return V(ye);case ie:return ft=we._init,Fi(ye,he,ft(we._payload),He)}if(Pe(we))return it(ye,he,we,He);if(ce(we))return st(ye,he,we,He);um(ye,we)}return typeof we=="string"&&we!==""||typeof we=="number"?(we=""+we,he!==null&&he.tag===6?(E(ye,he.sibling),he=A(he,we),he.return=ye,ye=he):(E(ye,he),he=$E(we,ye.mode,He),he.return=ye,ye=he),V(ye)):E(ye,he)}return Fi}var Xu=TC(!0),SC=TC(!1),hm=ja(null),dm=null,Ju=null,Q_=null;function eE(){Q_=Ju=dm=null}function tE(h){var g=hm.current;Ei(hm),h._currentValue=g}function iE(h,g,E){for(;h!==null;){var b=h.alternate;if((h.childLanes&g)!==g?(h.childLanes|=g,b!==null&&(b.childLanes|=g)):b!==null&&(b.childLanes&g)!==g&&(b.childLanes|=g),h===E)break;h=h.return}}function Qu(h,g){dm=h,Q_=Ju=null,h=h.dependencies,h!==null&&h.firstContext!==null&&(h.lanes&g&&(nr=!0),h.firstContext=null)}function Kr(h){var g=h._currentValue;if(Q_!==h)if(h={context:h,memoizedValue:g,next:null},Ju===null){if(dm===null)throw Error(t(308));Ju=h,dm.dependencies={lanes:0,firstContext:h}}else Ju=Ju.next=h;return g}var gc=null;function nE(h){gc===null?gc=[h]:gc.push(h)}function bC(h,g,E,b){var A=g.interleaved;return A===null?(E.next=E,nE(g)):(E.next=A.next,A.next=E),g.interleaved=E,Uo(h,b)}function Uo(h,g){h.lanes|=g;var E=h.alternate;for(E!==null&&(E.lanes|=g),E=h,h=h.return;h!==null;)h.childLanes|=g,E=h.alternate,E!==null&&(E.childLanes|=g),E=h,h=h.return;return E.tag===3?E.stateNode:null}var Ka=!1;function rE(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xC(h,g){h=h.updateQueue,g.updateQueue===h&&(g.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function zo(h,g){return{eventTime:h,lane:g,tag:0,payload:null,callback:null,next:null}}function Za(h,g,E){var b=h.updateQueue;if(b===null)return null;if(b=b.shared,Wt&2){var A=b.pending;return A===null?g.next=g:(g.next=A.next,A.next=g),b.pending=g,Uo(h,E)}return A=b.interleaved,A===null?(g.next=g,nE(b)):(g.next=A.next,A.next=g),b.interleaved=g,Uo(h,E)}function fm(h,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var b=g.lanes;b&=h.pendingLanes,E|=b,g.lanes=E,hs(h,E)}}function CC(h,g){var E=h.updateQueue,b=h.alternate;if(b!==null&&(b=b.updateQueue,E===b)){var A=null,P=null;if(E=E.firstBaseUpdate,E!==null){do{var V={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};P===null?A=P=V:P=P.next=V,E=E.next}while(E!==null);P===null?A=P=g:P=P.next=g}else A=P=g;E={baseState:b.baseState,firstBaseUpdate:A,lastBaseUpdate:P,shared:b.shared,effects:b.effects},h.updateQueue=E;return}h=E.lastBaseUpdate,h===null?E.firstBaseUpdate=g:h.next=g,E.lastBaseUpdate=g}function pm(h,g,E,b){var A=h.updateQueue;Ka=!1;var P=A.firstBaseUpdate,V=A.lastBaseUpdate,oe=A.shared.pending;if(oe!==null){A.shared.pending=null;var ue=oe,Se=ue.next;ue.next=null,V===null?P=Se:V.next=Se,V=ue;var Ne=h.alternate;Ne!==null&&(Ne=Ne.updateQueue,oe=Ne.lastBaseUpdate,oe!==V&&(oe===null?Ne.firstBaseUpdate=Se:oe.next=Se,Ne.lastBaseUpdate=ue))}if(P!==null){var Be=A.baseState;V=0,Ne=Se=ue=null,oe=P;do{var ke=oe.lane,qe=oe.eventTime;if((b&ke)===ke){Ne!==null&&(Ne=Ne.next={eventTime:qe,lane:0,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null});e:{var it=h,st=oe;switch(ke=g,qe=E,st.tag){case 1:if(it=st.payload,typeof it=="function"){Be=it.call(qe,Be,ke);break e}Be=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=st.payload,ke=typeof it=="function"?it.call(qe,Be,ke):it,ke==null)break e;Be=se({},Be,ke);break e;case 2:Ka=!0}}oe.callback!==null&&oe.lane!==0&&(h.flags|=64,ke=A.effects,ke===null?A.effects=[oe]:ke.push(oe))}else qe={eventTime:qe,lane:ke,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Ne===null?(Se=Ne=qe,ue=Be):Ne=Ne.next=qe,V|=ke;if(oe=oe.next,oe===null){if(oe=A.shared.pending,oe===null)break;ke=oe,oe=ke.next,ke.next=null,A.lastBaseUpdate=ke,A.shared.pending=null}}while(!0);if(Ne===null&&(ue=Be),A.baseState=ue,A.firstBaseUpdate=Se,A.lastBaseUpdate=Ne,g=A.shared.interleaved,g!==null){A=g;do V|=A.lane,A=A.next;while(A!==g)}else P===null&&(A.shared.lanes=0);yc|=V,h.lanes=V,h.memoizedState=Be}}function RC(h,g,E){if(h=g.effects,g.effects=null,h!==null)for(g=0;g<h.length;g++){var b=h[g],A=b.callback;if(A!==null){if(b.callback=null,b=E,typeof A!="function")throw Error(t(191,A));A.call(b)}}}var Df={},Ks=ja(Df),Of=ja(Df),kf=ja(Df);function mc(h){if(h===Df)throw Error(t(174));return h}function sE(h,g){switch(fi(kf,g),fi(Of,h),fi(Ks,Df),h=g.nodeType,h){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:rt(null,"");break;default:h=h===8?g.parentNode:g,g=h.namespaceURI||null,h=h.tagName,g=rt(g,h)}Ei(Ks),fi(Ks,g)}function eh(){Ei(Ks),Ei(Of),Ei(kf)}function AC(h){mc(kf.current);var g=mc(Ks.current),E=rt(g,h.type);g!==E&&(fi(Of,h),fi(Ks,E))}function oE(h){Of.current===h&&(Ei(Ks),Ei(Of))}var Ri=ja(0);function gm(h){for(var g=h;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if(g.flags&128)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var aE=[];function lE(){for(var h=0;h<aE.length;h++)aE[h]._workInProgressVersionPrimary=null;aE.length=0}var mm=I.ReactCurrentDispatcher,cE=I.ReactCurrentBatchConfig,vc=0,Ai=null,Ki=null,nn=null,vm=!1,Mf=!1,Nf=0,x5=0;function In(){throw Error(t(321))}function uE(h,g){if(g===null)return!1;for(var E=0;E<g.length&&E<h.length;E++)if(!br(h[E],g[E]))return!1;return!0}function hE(h,g,E,b,A,P){if(vc=P,Ai=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,mm.current=h===null||h.memoizedState===null?L5:I5,h=E(b,A),Mf){P=0;do{if(Mf=!1,Nf=0,25<=P)throw Error(t(301));P+=1,nn=Ki=null,g.updateQueue=null,mm.current=P5,h=E(b,A)}while(Mf)}if(mm.current=Em,g=Ki!==null&&Ki.next!==null,vc=0,nn=Ki=Ai=null,vm=!1,g)throw Error(t(300));return h}function dE(){var h=Nf!==0;return Nf=0,h}function Zs(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?Ai.memoizedState=nn=h:nn=nn.next=h,nn}function Zr(){if(Ki===null){var h=Ai.alternate;h=h!==null?h.memoizedState:null}else h=Ki.next;var g=nn===null?Ai.memoizedState:nn.next;if(g!==null)nn=g,Ki=h;else{if(h===null)throw Error(t(310));Ki=h,h={memoizedState:Ki.memoizedState,baseState:Ki.baseState,baseQueue:Ki.baseQueue,queue:Ki.queue,next:null},nn===null?Ai.memoizedState=nn=h:nn=nn.next=h}return nn}function Ff(h,g){return typeof g=="function"?g(h):g}function fE(h){var g=Zr(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=h;var b=Ki,A=b.baseQueue,P=E.pending;if(P!==null){if(A!==null){var V=A.next;A.next=P.next,P.next=V}b.baseQueue=A=P,E.pending=null}if(A!==null){P=A.next,b=b.baseState;var oe=V=null,ue=null,Se=P;do{var Ne=Se.lane;if((vc&Ne)===Ne)ue!==null&&(ue=ue.next={lane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),b=Se.hasEagerState?Se.eagerState:h(b,Se.action);else{var Be={lane:Ne,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null};ue===null?(oe=ue=Be,V=b):ue=ue.next=Be,Ai.lanes|=Ne,yc|=Ne}Se=Se.next}while(Se!==null&&Se!==P);ue===null?V=b:ue.next=oe,br(b,g.memoizedState)||(nr=!0),g.memoizedState=b,g.baseState=V,g.baseQueue=ue,E.lastRenderedState=b}if(h=E.interleaved,h!==null){A=h;do P=A.lane,Ai.lanes|=P,yc|=P,A=A.next;while(A!==h)}else A===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function pE(h){var g=Zr(),E=g.queue;if(E===null)throw Error(t(311));E.lastRenderedReducer=h;var b=E.dispatch,A=E.pending,P=g.memoizedState;if(A!==null){E.pending=null;var V=A=A.next;do P=h(P,V.action),V=V.next;while(V!==A);br(P,g.memoizedState)||(nr=!0),g.memoizedState=P,g.baseQueue===null&&(g.baseState=P),E.lastRenderedState=P}return[P,b]}function LC(){}function IC(h,g){var E=Ai,b=Zr(),A=g(),P=!br(b.memoizedState,A);if(P&&(b.memoizedState=A,nr=!0),b=b.queue,gE(OC.bind(null,E,b,h),[h]),b.getSnapshot!==g||P||nn!==null&&nn.memoizedState.tag&1){if(E.flags|=2048,Bf(9,DC.bind(null,E,b,A,g),void 0,null),rn===null)throw Error(t(349));vc&30||PC(E,g,A)}return A}function PC(h,g,E){h.flags|=16384,h={getSnapshot:g,value:E},g=Ai.updateQueue,g===null?(g={lastEffect:null,stores:null},Ai.updateQueue=g,g.stores=[h]):(E=g.stores,E===null?g.stores=[h]:E.push(h))}function DC(h,g,E,b){g.value=E,g.getSnapshot=b,kC(g)&&MC(h)}function OC(h,g,E){return E(function(){kC(g)&&MC(h)})}function kC(h){var g=h.getSnapshot;h=h.value;try{var E=g();return!br(h,E)}catch{return!0}}function MC(h){var g=Uo(h,1);g!==null&&Es(g,h,1,-1)}function NC(h){var g=Zs();return typeof h=="function"&&(h=h()),g.memoizedState=g.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ff,lastRenderedState:h},g.queue=h,h=h.dispatch=A5.bind(null,Ai,h),[g.memoizedState,h]}function Bf(h,g,E,b){return h={tag:h,create:g,destroy:E,deps:b,next:null},g=Ai.updateQueue,g===null?(g={lastEffect:null,stores:null},Ai.updateQueue=g,g.lastEffect=h.next=h):(E=g.lastEffect,E===null?g.lastEffect=h.next=h:(b=E.next,E.next=h,h.next=b,g.lastEffect=h)),h}function FC(){return Zr().memoizedState}function ym(h,g,E,b){var A=Zs();Ai.flags|=h,A.memoizedState=Bf(1|g,E,void 0,b===void 0?null:b)}function _m(h,g,E,b){var A=Zr();b=b===void 0?null:b;var P=void 0;if(Ki!==null){var V=Ki.memoizedState;if(P=V.destroy,b!==null&&uE(b,V.deps)){A.memoizedState=Bf(g,E,P,b);return}}Ai.flags|=h,A.memoizedState=Bf(1|g,E,P,b)}function BC(h,g){return ym(8390656,8,h,g)}function gE(h,g){return _m(2048,8,h,g)}function UC(h,g){return _m(4,2,h,g)}function zC(h,g){return _m(4,4,h,g)}function GC(h,g){if(typeof g=="function")return h=h(),g(h),function(){g(null)};if(g!=null)return h=h(),g.current=h,function(){g.current=null}}function HC(h,g,E){return E=E!=null?E.concat([h]):null,_m(4,4,GC.bind(null,g,h),E)}function mE(){}function $C(h,g){var E=Zr();g=g===void 0?null:g;var b=E.memoizedState;return b!==null&&g!==null&&uE(g,b[1])?b[0]:(E.memoizedState=[h,g],h)}function VC(h,g){var E=Zr();g=g===void 0?null:g;var b=E.memoizedState;return b!==null&&g!==null&&uE(g,b[1])?b[0]:(h=h(),E.memoizedState=[h,g],h)}function jC(h,g,E){return vc&21?(br(E,g)||(E=Mg(),Ai.lanes|=E,yc|=E,h.baseState=!0),g):(h.baseState&&(h.baseState=!1,nr=!0),h.memoizedState=E)}function C5(h,g){var E=$t;$t=E!==0&&4>E?E:4,h(!0);var b=cE.transition;cE.transition={};try{h(!1),g()}finally{$t=E,cE.transition=b}}function WC(){return Zr().memoizedState}function R5(h,g,E){var b=Qa(h);if(E={lane:b,action:E,hasEagerState:!1,eagerState:null,next:null},qC(h))KC(g,E);else if(E=bC(h,g,E,b),E!==null){var A=jn();Es(E,h,b,A),ZC(E,g,b)}}function A5(h,g,E){var b=Qa(h),A={lane:b,action:E,hasEagerState:!1,eagerState:null,next:null};if(qC(h))KC(g,A);else{var P=h.alternate;if(h.lanes===0&&(P===null||P.lanes===0)&&(P=g.lastRenderedReducer,P!==null))try{var V=g.lastRenderedState,oe=P(V,E);if(A.hasEagerState=!0,A.eagerState=oe,br(oe,V)){var ue=g.interleaved;ue===null?(A.next=A,nE(g)):(A.next=ue.next,ue.next=A),g.interleaved=A;return}}catch{}finally{}E=bC(h,g,A,b),E!==null&&(A=jn(),Es(E,h,b,A),ZC(E,g,b))}}function qC(h){var g=h.alternate;return h===Ai||g!==null&&g===Ai}function KC(h,g){Mf=vm=!0;var E=h.pending;E===null?g.next=g:(g.next=E.next,E.next=g),h.pending=g}function ZC(h,g,E){if(E&4194240){var b=g.lanes;b&=h.pendingLanes,E|=b,g.lanes=E,hs(h,E)}}var Em={readContext:Kr,useCallback:In,useContext:In,useEffect:In,useImperativeHandle:In,useInsertionEffect:In,useLayoutEffect:In,useMemo:In,useReducer:In,useRef:In,useState:In,useDebugValue:In,useDeferredValue:In,useTransition:In,useMutableSource:In,useSyncExternalStore:In,useId:In,unstable_isNewReconciler:!1},L5={readContext:Kr,useCallback:function(h,g){return Zs().memoizedState=[h,g===void 0?null:g],h},useContext:Kr,useEffect:BC,useImperativeHandle:function(h,g,E){return E=E!=null?E.concat([h]):null,ym(4194308,4,GC.bind(null,g,h),E)},useLayoutEffect:function(h,g){return ym(4194308,4,h,g)},useInsertionEffect:function(h,g){return ym(4,2,h,g)},useMemo:function(h,g){var E=Zs();return g=g===void 0?null:g,h=h(),E.memoizedState=[h,g],h},useReducer:function(h,g,E){var b=Zs();return g=E!==void 0?E(g):g,b.memoizedState=b.baseState=g,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:g},b.queue=h,h=h.dispatch=R5.bind(null,Ai,h),[b.memoizedState,h]},useRef:function(h){var g=Zs();return h={current:h},g.memoizedState=h},useState:NC,useDebugValue:mE,useDeferredValue:function(h){return Zs().memoizedState=h},useTransition:function(){var h=NC(!1),g=h[0];return h=C5.bind(null,h[1]),Zs().memoizedState=h,[g,h]},useMutableSource:function(){},useSyncExternalStore:function(h,g,E){var b=Ai,A=Zs();if(Si){if(E===void 0)throw Error(t(407));E=E()}else{if(E=g(),rn===null)throw Error(t(349));vc&30||PC(b,g,E)}A.memoizedState=E;var P={value:E,getSnapshot:g};return A.queue=P,BC(OC.bind(null,b,P,h),[h]),b.flags|=2048,Bf(9,DC.bind(null,b,P,E,g),void 0,null),E},useId:function(){var h=Zs(),g=rn.identifierPrefix;if(Si){var E=Bo,b=Fo;E=(b&~(1<<32-Rt(b)-1)).toString(32)+E,g=":"+g+"R"+E,E=Nf++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=x5++,g=":"+g+"r"+E.toString(32)+":";return h.memoizedState=g},unstable_isNewReconciler:!1},I5={readContext:Kr,useCallback:$C,useContext:Kr,useEffect:gE,useImperativeHandle:HC,useInsertionEffect:UC,useLayoutEffect:zC,useMemo:VC,useReducer:fE,useRef:FC,useState:function(){return fE(Ff)},useDebugValue:mE,useDeferredValue:function(h){var g=Zr();return jC(g,Ki.memoizedState,h)},useTransition:function(){var h=fE(Ff)[0],g=Zr().memoizedState;return[h,g]},useMutableSource:LC,useSyncExternalStore:IC,useId:WC,unstable_isNewReconciler:!1},P5={readContext:Kr,useCallback:$C,useContext:Kr,useEffect:gE,useImperativeHandle:HC,useInsertionEffect:UC,useLayoutEffect:zC,useMemo:VC,useReducer:pE,useRef:FC,useState:function(){return pE(Ff)},useDebugValue:mE,useDeferredValue:function(h){var g=Zr();return Ki===null?g.memoizedState=h:jC(g,Ki.memoizedState,h)},useTransition:function(){var h=pE(Ff)[0],g=Zr().memoizedState;return[h,g]},useMutableSource:LC,useSyncExternalStore:IC,useId:WC,unstable_isNewReconciler:!1};function vs(h,g){if(h&&h.defaultProps){g=se({},g),h=h.defaultProps;for(var E in h)g[E]===void 0&&(g[E]=h[E]);return g}return g}function vE(h,g,E,b){g=h.memoizedState,E=E(b,g),E=E==null?g:se({},g,E),h.memoizedState=E,h.lanes===0&&(h.updateQueue.baseState=E)}var wm={isMounted:function(h){return(h=h._reactInternals)?Us(h)===h:!1},enqueueSetState:function(h,g,E){h=h._reactInternals;var b=jn(),A=Qa(h),P=zo(b,A);P.payload=g,E!=null&&(P.callback=E),g=Za(h,P,A),g!==null&&(Es(g,h,A,b),fm(g,h,A))},enqueueReplaceState:function(h,g,E){h=h._reactInternals;var b=jn(),A=Qa(h),P=zo(b,A);P.tag=1,P.payload=g,E!=null&&(P.callback=E),g=Za(h,P,A),g!==null&&(Es(g,h,A,b),fm(g,h,A))},enqueueForceUpdate:function(h,g){h=h._reactInternals;var E=jn(),b=Qa(h),A=zo(E,b);A.tag=2,g!=null&&(A.callback=g),g=Za(h,A,b),g!==null&&(Es(g,h,b,E),fm(g,h,b))}};function YC(h,g,E,b,A,P,V){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(b,P,V):g.prototype&&g.prototype.isPureReactComponent?!Vs(E,b)||!Vs(A,P):!0}function XC(h,g,E){var b=!1,A=Wa,P=g.contextType;return typeof P=="object"&&P!==null?P=Kr(P):(A=ir(g)?dc:Ln.current,b=g.contextTypes,P=(b=b!=null)?qu(h,A):Wa),g=new g(E,P),h.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=wm,h.stateNode=g,g._reactInternals=h,b&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=A,h.__reactInternalMemoizedMaskedChildContext=P),g}function JC(h,g,E,b){h=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,b),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,b),g.state!==h&&wm.enqueueReplaceState(g,g.state,null)}function yE(h,g,E,b){var A=h.stateNode;A.props=E,A.state=h.memoizedState,A.refs={},rE(h);var P=g.contextType;typeof P=="object"&&P!==null?A.context=Kr(P):(P=ir(g)?dc:Ln.current,A.context=qu(h,P)),A.state=h.memoizedState,P=g.getDerivedStateFromProps,typeof P=="function"&&(vE(h,g,P,E),A.state=h.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(g=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),g!==A.state&&wm.enqueueReplaceState(A,A.state,null),pm(h,E,A,b),A.state=h.memoizedState),typeof A.componentDidMount=="function"&&(h.flags|=4194308)}function th(h,g){try{var E="",b=g;do E+=pe(b),b=b.return;while(b);var A=E}catch(P){A=`
Error generating stack: `+P.message+`
`+P.stack}return{value:h,source:g,stack:A,digest:null}}function _E(h,g,E){return{value:h,source:null,stack:E??null,digest:g??null}}function EE(h,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var D5=typeof WeakMap=="function"?WeakMap:Map;function QC(h,g,E){E=zo(-1,E),E.tag=3,E.payload={element:null};var b=g.value;return E.callback=function(){Am||(Am=!0,ME=b),EE(h,g)},E}function eR(h,g,E){E=zo(-1,E),E.tag=3;var b=h.type.getDerivedStateFromError;if(typeof b=="function"){var A=g.value;E.payload=function(){return b(A)},E.callback=function(){EE(h,g)}}var P=h.stateNode;return P!==null&&typeof P.componentDidCatch=="function"&&(E.callback=function(){EE(h,g),typeof b!="function"&&(Xa===null?Xa=new Set([this]):Xa.add(this));var V=g.stack;this.componentDidCatch(g.value,{componentStack:V!==null?V:""})}),E}function tR(h,g,E){var b=h.pingCache;if(b===null){b=h.pingCache=new D5;var A=new Set;b.set(g,A)}else A=b.get(g),A===void 0&&(A=new Set,b.set(g,A));A.has(E)||(A.add(E),h=W5.bind(null,h,g,E),g.then(h,h))}function iR(h){do{var g;if((g=h.tag===13)&&(g=h.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return h;h=h.return}while(h!==null);return null}function nR(h,g,E,b,A){return h.mode&1?(h.flags|=65536,h.lanes=A,h):(h===g?h.flags|=65536:(h.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=zo(-1,1),g.tag=2,Za(E,g,1))),E.lanes|=1),h)}var O5=I.ReactCurrentOwner,nr=!1;function Vn(h,g,E,b){g.child=h===null?SC(g,null,E,b):Xu(g,h.child,E,b)}function rR(h,g,E,b,A){E=E.render;var P=g.ref;return Qu(g,A),b=hE(h,g,E,b,P,A),E=dE(),h!==null&&!nr?(g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~A,Go(h,g,A)):(Si&&E&&K_(g),g.flags|=1,Vn(h,g,b,A),g.child)}function sR(h,g,E,b,A){if(h===null){var P=E.type;return typeof P=="function"&&!HE(P)&&P.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=P,oR(h,g,P,b,A)):(h=km(E.type,null,b,g,g.mode,A),h.ref=g.ref,h.return=g,g.child=h)}if(P=h.child,!(h.lanes&A)){var V=P.memoizedProps;if(E=E.compare,E=E!==null?E:Vs,E(V,b)&&h.ref===g.ref)return Go(h,g,A)}return g.flags|=1,h=tl(P,b),h.ref=g.ref,h.return=g,g.child=h}function oR(h,g,E,b,A){if(h!==null){var P=h.memoizedProps;if(Vs(P,b)&&h.ref===g.ref)if(nr=!1,g.pendingProps=b=P,(h.lanes&A)!==0)h.flags&131072&&(nr=!0);else return g.lanes=h.lanes,Go(h,g,A)}return wE(h,g,E,b,A)}function aR(h,g,E){var b=g.pendingProps,A=b.children,P=h!==null?h.memoizedState:null;if(b.mode==="hidden")if(!(g.mode&1))g.memoizedState={baseLanes:0,cachePool:null,transitions:null},fi(nh,Ar),Ar|=E;else{if(!(E&1073741824))return h=P!==null?P.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:h,cachePool:null,transitions:null},g.updateQueue=null,fi(nh,Ar),Ar|=h,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=P!==null?P.baseLanes:E,fi(nh,Ar),Ar|=b}else P!==null?(b=P.baseLanes|E,g.memoizedState=null):b=E,fi(nh,Ar),Ar|=b;return Vn(h,g,A,E),g.child}function lR(h,g){var E=g.ref;(h===null&&E!==null||h!==null&&h.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function wE(h,g,E,b,A){var P=ir(E)?dc:Ln.current;return P=qu(g,P),Qu(g,A),E=hE(h,g,E,b,P,A),b=dE(),h!==null&&!nr?(g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~A,Go(h,g,A)):(Si&&b&&K_(g),g.flags|=1,Vn(h,g,E,A),g.child)}function cR(h,g,E,b,A){if(ir(E)){var P=!0;sm(g)}else P=!1;if(Qu(g,A),g.stateNode===null)Sm(h,g),XC(g,E,b),yE(g,E,b,A),b=!0;else if(h===null){var V=g.stateNode,oe=g.memoizedProps;V.props=oe;var ue=V.context,Se=E.contextType;typeof Se=="object"&&Se!==null?Se=Kr(Se):(Se=ir(E)?dc:Ln.current,Se=qu(g,Se));var Ne=E.getDerivedStateFromProps,Be=typeof Ne=="function"||typeof V.getSnapshotBeforeUpdate=="function";Be||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(oe!==b||ue!==Se)&&JC(g,V,b,Se),Ka=!1;var ke=g.memoizedState;V.state=ke,pm(g,b,V,A),ue=g.memoizedState,oe!==b||ke!==ue||tr.current||Ka?(typeof Ne=="function"&&(vE(g,E,Ne,b),ue=g.memoizedState),(oe=Ka||YC(g,E,oe,b,ke,ue,Se))?(Be||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(g.flags|=4194308)):(typeof V.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=b,g.memoizedState=ue),V.props=b,V.state=ue,V.context=Se,b=oe):(typeof V.componentDidMount=="function"&&(g.flags|=4194308),b=!1)}else{V=g.stateNode,xC(h,g),oe=g.memoizedProps,Se=g.type===g.elementType?oe:vs(g.type,oe),V.props=Se,Be=g.pendingProps,ke=V.context,ue=E.contextType,typeof ue=="object"&&ue!==null?ue=Kr(ue):(ue=ir(E)?dc:Ln.current,ue=qu(g,ue));var qe=E.getDerivedStateFromProps;(Ne=typeof qe=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(oe!==Be||ke!==ue)&&JC(g,V,b,ue),Ka=!1,ke=g.memoizedState,V.state=ke,pm(g,b,V,A);var it=g.memoizedState;oe!==Be||ke!==it||tr.current||Ka?(typeof qe=="function"&&(vE(g,E,qe,b),it=g.memoizedState),(Se=Ka||YC(g,E,Se,b,ke,it,ue)||!1)?(Ne||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(b,it,ue),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(b,it,ue)),typeof V.componentDidUpdate=="function"&&(g.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof V.componentDidUpdate!="function"||oe===h.memoizedProps&&ke===h.memoizedState||(g.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||oe===h.memoizedProps&&ke===h.memoizedState||(g.flags|=1024),g.memoizedProps=b,g.memoizedState=it),V.props=b,V.state=it,V.context=ue,b=Se):(typeof V.componentDidUpdate!="function"||oe===h.memoizedProps&&ke===h.memoizedState||(g.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||oe===h.memoizedProps&&ke===h.memoizedState||(g.flags|=1024),b=!1)}return TE(h,g,E,b,P,A)}function TE(h,g,E,b,A,P){lR(h,g);var V=(g.flags&128)!==0;if(!b&&!V)return A&&pC(g,E,!1),Go(h,g,P);b=g.stateNode,O5.current=g;var oe=V&&typeof E.getDerivedStateFromError!="function"?null:b.render();return g.flags|=1,h!==null&&V?(g.child=Xu(g,h.child,null,P),g.child=Xu(g,null,oe,P)):Vn(h,g,oe,P),g.memoizedState=b.state,A&&pC(g,E,!0),g.child}function uR(h){var g=h.stateNode;g.pendingContext?dC(h,g.pendingContext,g.pendingContext!==g.context):g.context&&dC(h,g.context,!1),sE(h,g.containerInfo)}function hR(h,g,E,b,A){return Yu(),J_(A),g.flags|=256,Vn(h,g,E,b),g.child}var SE={dehydrated:null,treeContext:null,retryLane:0};function bE(h){return{baseLanes:h,cachePool:null,transitions:null}}function dR(h,g,E){var b=g.pendingProps,A=Ri.current,P=!1,V=(g.flags&128)!==0,oe;if((oe=V)||(oe=h!==null&&h.memoizedState===null?!1:(A&2)!==0),oe?(P=!0,g.flags&=-129):(h===null||h.memoizedState!==null)&&(A|=1),fi(Ri,A&1),h===null)return X_(g),h=g.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?(g.mode&1?h.data==="$!"?g.lanes=8:g.lanes=1073741824:g.lanes=1,null):(V=b.children,h=b.fallback,P?(b=g.mode,P=g.child,V={mode:"hidden",children:V},!(b&1)&&P!==null?(P.childLanes=0,P.pendingProps=V):P=Mm(V,b,0,null),h=Tc(h,b,E,null),P.return=g,h.return=g,P.sibling=h,g.child=P,g.child.memoizedState=bE(E),g.memoizedState=SE,h):xE(g,V));if(A=h.memoizedState,A!==null&&(oe=A.dehydrated,oe!==null))return k5(h,g,V,b,oe,A,E);if(P){P=b.fallback,V=g.mode,A=h.child,oe=A.sibling;var ue={mode:"hidden",children:b.children};return!(V&1)&&g.child!==A?(b=g.child,b.childLanes=0,b.pendingProps=ue,g.deletions=null):(b=tl(A,ue),b.subtreeFlags=A.subtreeFlags&14680064),oe!==null?P=tl(oe,P):(P=Tc(P,V,E,null),P.flags|=2),P.return=g,b.return=g,b.sibling=P,g.child=b,b=P,P=g.child,V=h.child.memoizedState,V=V===null?bE(E):{baseLanes:V.baseLanes|E,cachePool:null,transitions:V.transitions},P.memoizedState=V,P.childLanes=h.childLanes&~E,g.memoizedState=SE,b}return P=h.child,h=P.sibling,b=tl(P,{mode:"visible",children:b.children}),!(g.mode&1)&&(b.lanes=E),b.return=g,b.sibling=null,h!==null&&(E=g.deletions,E===null?(g.deletions=[h],g.flags|=16):E.push(h)),g.child=b,g.memoizedState=null,b}function xE(h,g){return g=Mm({mode:"visible",children:g},h.mode,0,null),g.return=h,h.child=g}function Tm(h,g,E,b){return b!==null&&J_(b),Xu(g,h.child,null,E),h=xE(g,g.pendingProps.children),h.flags|=2,g.memoizedState=null,h}function k5(h,g,E,b,A,P,V){if(E)return g.flags&256?(g.flags&=-257,b=_E(Error(t(422))),Tm(h,g,V,b)):g.memoizedState!==null?(g.child=h.child,g.flags|=128,null):(P=b.fallback,A=g.mode,b=Mm({mode:"visible",children:b.children},A,0,null),P=Tc(P,A,V,null),P.flags|=2,b.return=g,P.return=g,b.sibling=P,g.child=b,g.mode&1&&Xu(g,h.child,null,V),g.child.memoizedState=bE(V),g.memoizedState=SE,P);if(!(g.mode&1))return Tm(h,g,V,null);if(A.data==="$!"){if(b=A.nextSibling&&A.nextSibling.dataset,b)var oe=b.dgst;return b=oe,P=Error(t(419)),b=_E(P,b,void 0),Tm(h,g,V,b)}if(oe=(V&h.childLanes)!==0,nr||oe){if(b=rn,b!==null){switch(V&-V){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=A&(b.suspendedLanes|V)?0:A,A!==0&&A!==P.retryLane&&(P.retryLane=A,Uo(h,A),Es(b,h,A,-1))}return GE(),b=_E(Error(t(421))),Tm(h,g,V,b)}return A.data==="$?"?(g.flags|=128,g.child=h.child,g=q5.bind(null,h),A._reactRetry=g,null):(h=P.treeContext,Rr=qs(A.nextSibling),Cr=g,Si=!0,ms=null,h!==null&&(Wr[qr++]=Fo,Wr[qr++]=Bo,Wr[qr++]=fc,Fo=h.id,Bo=h.overflow,fc=g),g=xE(g,b.children),g.flags|=4096,g)}function fR(h,g,E){h.lanes|=g;var b=h.alternate;b!==null&&(b.lanes|=g),iE(h.return,g,E)}function CE(h,g,E,b,A){var P=h.memoizedState;P===null?h.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:b,tail:E,tailMode:A}:(P.isBackwards=g,P.rendering=null,P.renderingStartTime=0,P.last=b,P.tail=E,P.tailMode=A)}function pR(h,g,E){var b=g.pendingProps,A=b.revealOrder,P=b.tail;if(Vn(h,g,b.children,E),b=Ri.current,b&2)b=b&1|2,g.flags|=128;else{if(h!==null&&h.flags&128)e:for(h=g.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&fR(h,E,g);else if(h.tag===19)fR(h,E,g);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===g)break e;for(;h.sibling===null;){if(h.return===null||h.return===g)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}b&=1}if(fi(Ri,b),!(g.mode&1))g.memoizedState=null;else switch(A){case"forwards":for(E=g.child,A=null;E!==null;)h=E.alternate,h!==null&&gm(h)===null&&(A=E),E=E.sibling;E=A,E===null?(A=g.child,g.child=null):(A=E.sibling,E.sibling=null),CE(g,!1,A,E,P);break;case"backwards":for(E=null,A=g.child,g.child=null;A!==null;){if(h=A.alternate,h!==null&&gm(h)===null){g.child=A;break}h=A.sibling,A.sibling=E,E=A,A=h}CE(g,!0,E,null,P);break;case"together":CE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Sm(h,g){!(g.mode&1)&&h!==null&&(h.alternate=null,g.alternate=null,g.flags|=2)}function Go(h,g,E){if(h!==null&&(g.dependencies=h.dependencies),yc|=g.lanes,!(E&g.childLanes))return null;if(h!==null&&g.child!==h.child)throw Error(t(153));if(g.child!==null){for(h=g.child,E=tl(h,h.pendingProps),g.child=E,E.return=g;h.sibling!==null;)h=h.sibling,E=E.sibling=tl(h,h.pendingProps),E.return=g;E.sibling=null}return g.child}function M5(h,g,E){switch(g.tag){case 3:uR(g),Yu();break;case 5:AC(g);break;case 1:ir(g.type)&&sm(g);break;case 4:sE(g,g.stateNode.containerInfo);break;case 10:var b=g.type._context,A=g.memoizedProps.value;fi(hm,b._currentValue),b._currentValue=A;break;case 13:if(b=g.memoizedState,b!==null)return b.dehydrated!==null?(fi(Ri,Ri.current&1),g.flags|=128,null):E&g.child.childLanes?dR(h,g,E):(fi(Ri,Ri.current&1),h=Go(h,g,E),h!==null?h.sibling:null);fi(Ri,Ri.current&1);break;case 19:if(b=(E&g.childLanes)!==0,h.flags&128){if(b)return pR(h,g,E);g.flags|=128}if(A=g.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),fi(Ri,Ri.current),b)break;return null;case 22:case 23:return g.lanes=0,aR(h,g,E)}return Go(h,g,E)}var gR,RE,mR,vR;gR=function(h,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)h.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},RE=function(){},mR=function(h,g,E,b){var A=h.memoizedProps;if(A!==b){h=g.stateNode,mc(Ks.current);var P=null;switch(E){case"input":A=Vt(h,A),b=Vt(h,b),P=[];break;case"select":A=se({},A,{value:void 0}),b=se({},b,{value:void 0}),P=[];break;case"textarea":A=Ve(h,A),b=Ve(h,b),P=[];break;default:typeof A.onClick!="function"&&typeof b.onClick=="function"&&(h.onclick=De)}Nt(E,b);var V;E=null;for(Se in A)if(!b.hasOwnProperty(Se)&&A.hasOwnProperty(Se)&&A[Se]!=null)if(Se==="style"){var oe=A[Se];for(V in oe)oe.hasOwnProperty(V)&&(E||(E={}),E[V]="")}else Se!=="dangerouslySetInnerHTML"&&Se!=="children"&&Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&Se!=="autoFocus"&&(r.hasOwnProperty(Se)?P||(P=[]):(P=P||[]).push(Se,null));for(Se in b){var ue=b[Se];if(oe=A!=null?A[Se]:void 0,b.hasOwnProperty(Se)&&ue!==oe&&(ue!=null||oe!=null))if(Se==="style")if(oe){for(V in oe)!oe.hasOwnProperty(V)||ue&&ue.hasOwnProperty(V)||(E||(E={}),E[V]="");for(V in ue)ue.hasOwnProperty(V)&&oe[V]!==ue[V]&&(E||(E={}),E[V]=ue[V])}else E||(P||(P=[]),P.push(Se,E)),E=ue;else Se==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,oe=oe?oe.__html:void 0,ue!=null&&oe!==ue&&(P=P||[]).push(Se,ue)):Se==="children"?typeof ue!="string"&&typeof ue!="number"||(P=P||[]).push(Se,""+ue):Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&(r.hasOwnProperty(Se)?(ue!=null&&Se==="onScroll"&&ai("scroll",h),P||oe===ue||(P=[])):(P=P||[]).push(Se,ue))}E&&(P=P||[]).push("style",E);var Se=P;(g.updateQueue=Se)&&(g.flags|=4)}},vR=function(h,g,E,b){E!==b&&(g.flags|=4)};function Uf(h,g){if(!Si)switch(h.tailMode){case"hidden":g=h.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?h.tail=null:E.sibling=null;break;case"collapsed":E=h.tail;for(var b=null;E!==null;)E.alternate!==null&&(b=E),E=E.sibling;b===null?g||h.tail===null?h.tail=null:h.tail.sibling=null:b.sibling=null}}function Pn(h){var g=h.alternate!==null&&h.alternate.child===h.child,E=0,b=0;if(g)for(var A=h.child;A!==null;)E|=A.lanes|A.childLanes,b|=A.subtreeFlags&14680064,b|=A.flags&14680064,A.return=h,A=A.sibling;else for(A=h.child;A!==null;)E|=A.lanes|A.childLanes,b|=A.subtreeFlags,b|=A.flags,A.return=h,A=A.sibling;return h.subtreeFlags|=b,h.childLanes=E,g}function N5(h,g,E){var b=g.pendingProps;switch(Z_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(g),null;case 1:return ir(g.type)&&rm(),Pn(g),null;case 3:return b=g.stateNode,eh(),Ei(tr),Ei(Ln),lE(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(h===null||h.child===null)&&(cm(g)?g.flags|=4:h===null||h.memoizedState.isDehydrated&&!(g.flags&256)||(g.flags|=1024,ms!==null&&(BE(ms),ms=null))),RE(h,g),Pn(g),null;case 5:oE(g);var A=mc(kf.current);if(E=g.type,h!==null&&g.stateNode!=null)mR(h,g,E,b,A),h.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!b){if(g.stateNode===null)throw Error(t(166));return Pn(g),null}if(h=mc(Ks.current),cm(g)){b=g.stateNode,E=g.type;var P=g.memoizedProps;switch(b[jr]=g,b[$a]=P,h=(g.mode&1)!==0,E){case"dialog":ai("cancel",b),ai("close",b);break;case"iframe":case"object":case"embed":ai("load",b);break;case"video":case"audio":for(A=0;A<za.length;A++)ai(za[A],b);break;case"source":ai("error",b);break;case"img":case"image":case"link":ai("error",b),ai("load",b);break;case"details":ai("toggle",b);break;case"input":ii(b,P),ai("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!P.multiple},ai("invalid",b);break;case"textarea":ze(b,P),ai("invalid",b)}Nt(E,P),A=null;for(var V in P)if(P.hasOwnProperty(V)){var oe=P[V];V==="children"?typeof oe=="string"?b.textContent!==oe&&(P.suppressHydrationWarning!==!0&&Te(b.textContent,oe,h),A=["children",oe]):typeof oe=="number"&&b.textContent!==""+oe&&(P.suppressHydrationWarning!==!0&&Te(b.textContent,oe,h),A=["children",""+oe]):r.hasOwnProperty(V)&&oe!=null&&V==="onScroll"&&ai("scroll",b)}switch(E){case"input":lt(b),X(b,P,!0);break;case"textarea":lt(b),xt(b);break;case"select":case"option":break;default:typeof P.onClick=="function"&&(b.onclick=De)}b=A,g.updateQueue=b,b!==null&&(g.flags|=4)}else{V=A.nodeType===9?A:A.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=It(E)),h==="http://www.w3.org/1999/xhtml"?E==="script"?(h=V.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof b.is=="string"?h=V.createElement(E,{is:b.is}):(h=V.createElement(E),E==="select"&&(V=h,b.multiple?V.multiple=!0:b.size&&(V.size=b.size))):h=V.createElementNS(h,E),h[jr]=g,h[$a]=b,gR(h,g,!1,!1),g.stateNode=h;e:{switch(V=tt(E,b),E){case"dialog":ai("cancel",h),ai("close",h),A=b;break;case"iframe":case"object":case"embed":ai("load",h),A=b;break;case"video":case"audio":for(A=0;A<za.length;A++)ai(za[A],h);A=b;break;case"source":ai("error",h),A=b;break;case"img":case"image":case"link":ai("error",h),ai("load",h),A=b;break;case"details":ai("toggle",h),A=b;break;case"input":ii(h,b),A=Vt(h,b),ai("invalid",h);break;case"option":A=b;break;case"select":h._wrapperState={wasMultiple:!!b.multiple},A=se({},b,{value:void 0}),ai("invalid",h);break;case"textarea":ze(h,b),A=Ve(h,b),ai("invalid",h);break;default:A=b}Nt(E,A),oe=A;for(P in oe)if(oe.hasOwnProperty(P)){var ue=oe[P];P==="style"?Me(h,ue):P==="dangerouslySetInnerHTML"?(ue=ue?ue.__html:void 0,ue!=null&&G(h,ue)):P==="children"?typeof ue=="string"?(E!=="textarea"||ue!=="")&&U(h,ue):typeof ue=="number"&&U(h,""+ue):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(r.hasOwnProperty(P)?ue!=null&&P==="onScroll"&&ai("scroll",h):ue!=null&&C(h,P,ue,V))}switch(E){case"input":lt(h),X(h,b,!1);break;case"textarea":lt(h),xt(h);break;case"option":b.value!=null&&h.setAttribute("value",""+Le(b.value));break;case"select":h.multiple=!!b.multiple,P=b.value,P!=null?Ae(h,!!b.multiple,P,!1):b.defaultValue!=null&&Ae(h,!!b.multiple,b.defaultValue,!0);break;default:typeof A.onClick=="function"&&(h.onclick=De)}switch(E){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Pn(g),null;case 6:if(h&&g.stateNode!=null)vR(h,g,h.memoizedProps,b);else{if(typeof b!="string"&&g.stateNode===null)throw Error(t(166));if(E=mc(kf.current),mc(Ks.current),cm(g)){if(b=g.stateNode,E=g.memoizedProps,b[jr]=g,(P=b.nodeValue!==E)&&(h=Cr,h!==null))switch(h.tag){case 3:Te(b.nodeValue,E,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Te(b.nodeValue,E,(h.mode&1)!==0)}P&&(g.flags|=4)}else b=(E.nodeType===9?E:E.ownerDocument).createTextNode(b),b[jr]=g,g.stateNode=b}return Pn(g),null;case 13:if(Ei(Ri),b=g.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Si&&Rr!==null&&g.mode&1&&!(g.flags&128))EC(),Yu(),g.flags|=98560,P=!1;else if(P=cm(g),b!==null&&b.dehydrated!==null){if(h===null){if(!P)throw Error(t(318));if(P=g.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(t(317));P[jr]=g}else Yu(),!(g.flags&128)&&(g.memoizedState=null),g.flags|=4;Pn(g),P=!1}else ms!==null&&(BE(ms),ms=null),P=!0;if(!P)return g.flags&65536?g:null}return g.flags&128?(g.lanes=E,g):(b=b!==null,b!==(h!==null&&h.memoizedState!==null)&&b&&(g.child.flags|=8192,g.mode&1&&(h===null||Ri.current&1?Zi===0&&(Zi=3):GE())),g.updateQueue!==null&&(g.flags|=4),Pn(g),null);case 4:return eh(),RE(h,g),h===null&&Ga(g.stateNode.containerInfo),Pn(g),null;case 10:return tE(g.type._context),Pn(g),null;case 17:return ir(g.type)&&rm(),Pn(g),null;case 19:if(Ei(Ri),P=g.memoizedState,P===null)return Pn(g),null;if(b=(g.flags&128)!==0,V=P.rendering,V===null)if(b)Uf(P,!1);else{if(Zi!==0||h!==null&&h.flags&128)for(h=g.child;h!==null;){if(V=gm(h),V!==null){for(g.flags|=128,Uf(P,!1),b=V.updateQueue,b!==null&&(g.updateQueue=b,g.flags|=4),g.subtreeFlags=0,b=E,E=g.child;E!==null;)P=E,h=b,P.flags&=14680066,V=P.alternate,V===null?(P.childLanes=0,P.lanes=h,P.child=null,P.subtreeFlags=0,P.memoizedProps=null,P.memoizedState=null,P.updateQueue=null,P.dependencies=null,P.stateNode=null):(P.childLanes=V.childLanes,P.lanes=V.lanes,P.child=V.child,P.subtreeFlags=0,P.deletions=null,P.memoizedProps=V.memoizedProps,P.memoizedState=V.memoizedState,P.updateQueue=V.updateQueue,P.type=V.type,h=V.dependencies,P.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),E=E.sibling;return fi(Ri,Ri.current&1|2),g.child}h=h.sibling}P.tail!==null&&xi()>rh&&(g.flags|=128,b=!0,Uf(P,!1),g.lanes=4194304)}else{if(!b)if(h=gm(V),h!==null){if(g.flags|=128,b=!0,E=h.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),Uf(P,!0),P.tail===null&&P.tailMode==="hidden"&&!V.alternate&&!Si)return Pn(g),null}else 2*xi()-P.renderingStartTime>rh&&E!==1073741824&&(g.flags|=128,b=!0,Uf(P,!1),g.lanes=4194304);P.isBackwards?(V.sibling=g.child,g.child=V):(E=P.last,E!==null?E.sibling=V:g.child=V,P.last=V)}return P.tail!==null?(g=P.tail,P.rendering=g,P.tail=g.sibling,P.renderingStartTime=xi(),g.sibling=null,E=Ri.current,fi(Ri,b?E&1|2:E&1),g):(Pn(g),null);case 22:case 23:return zE(),b=g.memoizedState!==null,h!==null&&h.memoizedState!==null!==b&&(g.flags|=8192),b&&g.mode&1?Ar&1073741824&&(Pn(g),g.subtreeFlags&6&&(g.flags|=8192)):Pn(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function F5(h,g){switch(Z_(g),g.tag){case 1:return ir(g.type)&&rm(),h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 3:return eh(),Ei(tr),Ei(Ln),lE(),h=g.flags,h&65536&&!(h&128)?(g.flags=h&-65537|128,g):null;case 5:return oE(g),null;case 13:if(Ei(Ri),h=g.memoizedState,h!==null&&h.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Yu()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 19:return Ei(Ri),null;case 4:return eh(),null;case 10:return tE(g.type._context),null;case 22:case 23:return zE(),null;case 24:return null;default:return null}}var bm=!1,Dn=!1,B5=typeof WeakSet=="function"?WeakSet:Set,Ye=null;function ih(h,g){var E=h.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(b){Mi(h,g,b)}else E.current=null}function AE(h,g,E){try{E()}catch(b){Mi(h,g,b)}}var yR=!1;function U5(h,g){if(We=rc,h=Tf(),Sf(h)){if("selectionStart"in h)var E={start:h.selectionStart,end:h.selectionEnd};else e:{E=(E=h.ownerDocument)&&E.defaultView||window;var b=E.getSelection&&E.getSelection();if(b&&b.rangeCount!==0){E=b.anchorNode;var A=b.anchorOffset,P=b.focusNode;b=b.focusOffset;try{E.nodeType,P.nodeType}catch{E=null;break e}var V=0,oe=-1,ue=-1,Se=0,Ne=0,Be=h,ke=null;t:for(;;){for(var qe;Be!==E||A!==0&&Be.nodeType!==3||(oe=V+A),Be!==P||b!==0&&Be.nodeType!==3||(ue=V+b),Be.nodeType===3&&(V+=Be.nodeValue.length),(qe=Be.firstChild)!==null;)ke=Be,Be=qe;for(;;){if(Be===h)break t;if(ke===E&&++Se===A&&(oe=V),ke===P&&++Ne===b&&(ue=V),(qe=Be.nextSibling)!==null)break;Be=ke,ke=Be.parentNode}Be=qe}E=oe===-1||ue===-1?null:{start:oe,end:ue}}else E=null}E=E||{start:0,end:0}}else E=null;for(ut={focusedElem:h,selectionRange:E},rc=!1,Ye=g;Ye!==null;)if(g=Ye,h=g.child,(g.subtreeFlags&1028)!==0&&h!==null)h.return=g,Ye=h;else for(;Ye!==null;){g=Ye;try{var it=g.alternate;if(g.flags&1024)switch(g.tag){case 0:case 11:case 15:break;case 1:if(it!==null){var st=it.memoizedProps,Fi=it.memoizedState,ye=g.stateNode,he=ye.getSnapshotBeforeUpdate(g.elementType===g.type?st:vs(g.type,st),Fi);ye.__reactInternalSnapshotBeforeUpdate=he}break;case 3:var we=g.stateNode.containerInfo;we.nodeType===1?we.textContent="":we.nodeType===9&&we.documentElement&&we.removeChild(we.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(He){Mi(g,g.return,He)}if(h=g.sibling,h!==null){h.return=g.return,Ye=h;break}Ye=g.return}return it=yR,yR=!1,it}function zf(h,g,E){var b=g.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var A=b=b.next;do{if((A.tag&h)===h){var P=A.destroy;A.destroy=void 0,P!==void 0&&AE(g,E,P)}A=A.next}while(A!==b)}}function xm(h,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&h)===h){var b=E.create;E.destroy=b()}E=E.next}while(E!==g)}}function LE(h){var g=h.ref;if(g!==null){var E=h.stateNode;switch(h.tag){case 5:h=E;break;default:h=E}typeof g=="function"?g(h):g.current=h}}function _R(h){var g=h.alternate;g!==null&&(h.alternate=null,_R(g)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(g=h.stateNode,g!==null&&(delete g[jr],delete g[$a],delete g[Va],delete g[V_],delete g[j_])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function ER(h){return h.tag===5||h.tag===3||h.tag===4}function wR(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||ER(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function IE(h,g,E){var b=h.tag;if(b===5||b===6)h=h.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(h,g):E.insertBefore(h,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(h,E)):(g=E,g.appendChild(h)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=De));else if(b!==4&&(h=h.child,h!==null))for(IE(h,g,E),h=h.sibling;h!==null;)IE(h,g,E),h=h.sibling}function PE(h,g,E){var b=h.tag;if(b===5||b===6)h=h.stateNode,g?E.insertBefore(h,g):E.appendChild(h);else if(b!==4&&(h=h.child,h!==null))for(PE(h,g,E),h=h.sibling;h!==null;)PE(h,g,E),h=h.sibling}var vn=null,ys=!1;function Ya(h,g,E){for(E=E.child;E!==null;)TR(h,g,E),E=E.sibling}function TR(h,g,E){if(yr&&typeof yr.onCommitFiberUnmount=="function")try{yr.onCommitFiberUnmount(Jl,E)}catch{}switch(E.tag){case 5:Dn||ih(E,g);case 6:var b=vn,A=ys;vn=null,Ya(h,g,E),vn=b,ys=A,vn!==null&&(ys?(h=vn,E=E.stateNode,h.nodeType===8?h.parentNode.removeChild(E):h.removeChild(E)):vn.removeChild(E.stateNode));break;case 18:vn!==null&&(ys?(h=vn,E=E.stateNode,h.nodeType===8?If(h.parentNode,E):h.nodeType===1&&If(h,E),wr(h)):If(vn,E.stateNode));break;case 4:b=vn,A=ys,vn=E.stateNode.containerInfo,ys=!0,Ya(h,g,E),vn=b,ys=A;break;case 0:case 11:case 14:case 15:if(!Dn&&(b=E.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){A=b=b.next;do{var P=A,V=P.destroy;P=P.tag,V!==void 0&&(P&2||P&4)&&AE(E,g,V),A=A.next}while(A!==b)}Ya(h,g,E);break;case 1:if(!Dn&&(ih(E,g),b=E.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=E.memoizedProps,b.state=E.memoizedState,b.componentWillUnmount()}catch(oe){Mi(E,g,oe)}Ya(h,g,E);break;case 21:Ya(h,g,E);break;case 22:E.mode&1?(Dn=(b=Dn)||E.memoizedState!==null,Ya(h,g,E),Dn=b):Ya(h,g,E);break;default:Ya(h,g,E)}}function SR(h){var g=h.updateQueue;if(g!==null){h.updateQueue=null;var E=h.stateNode;E===null&&(E=h.stateNode=new B5),g.forEach(function(b){var A=K5.bind(null,h,b);E.has(b)||(E.add(b),b.then(A,A))})}}function _s(h,g){var E=g.deletions;if(E!==null)for(var b=0;b<E.length;b++){var A=E[b];try{var P=h,V=g,oe=V;e:for(;oe!==null;){switch(oe.tag){case 5:vn=oe.stateNode,ys=!1;break e;case 3:vn=oe.stateNode.containerInfo,ys=!0;break e;case 4:vn=oe.stateNode.containerInfo,ys=!0;break e}oe=oe.return}if(vn===null)throw Error(t(160));TR(P,V,A),vn=null,ys=!1;var ue=A.alternate;ue!==null&&(ue.return=null),A.return=null}catch(Se){Mi(A,g,Se)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)bR(g,h),g=g.sibling}function bR(h,g){var E=h.alternate,b=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(_s(g,h),Ys(h),b&4){try{zf(3,h,h.return),xm(3,h)}catch(st){Mi(h,h.return,st)}try{zf(5,h,h.return)}catch(st){Mi(h,h.return,st)}}break;case 1:_s(g,h),Ys(h),b&512&&E!==null&&ih(E,E.return);break;case 5:if(_s(g,h),Ys(h),b&512&&E!==null&&ih(E,E.return),h.flags&32){var A=h.stateNode;try{U(A,"")}catch(st){Mi(h,h.return,st)}}if(b&4&&(A=h.stateNode,A!=null)){var P=h.memoizedProps,V=E!==null?E.memoizedProps:P,oe=h.type,ue=h.updateQueue;if(h.updateQueue=null,ue!==null)try{oe==="input"&&P.type==="radio"&&P.name!=null&&Yt(A,P),tt(oe,V);var Se=tt(oe,P);for(V=0;V<ue.length;V+=2){var Ne=ue[V],Be=ue[V+1];Ne==="style"?Me(A,Be):Ne==="dangerouslySetInnerHTML"?G(A,Be):Ne==="children"?U(A,Be):C(A,Ne,Be,Se)}switch(oe){case"input":k(A,P);break;case"textarea":vt(A,P);break;case"select":var ke=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!P.multiple;var qe=P.value;qe!=null?Ae(A,!!P.multiple,qe,!1):ke!==!!P.multiple&&(P.defaultValue!=null?Ae(A,!!P.multiple,P.defaultValue,!0):Ae(A,!!P.multiple,P.multiple?[]:"",!1))}A[$a]=P}catch(st){Mi(h,h.return,st)}}break;case 6:if(_s(g,h),Ys(h),b&4){if(h.stateNode===null)throw Error(t(162));A=h.stateNode,P=h.memoizedProps;try{A.nodeValue=P}catch(st){Mi(h,h.return,st)}}break;case 3:if(_s(g,h),Ys(h),b&4&&E!==null&&E.memoizedState.isDehydrated)try{wr(g.containerInfo)}catch(st){Mi(h,h.return,st)}break;case 4:_s(g,h),Ys(h);break;case 13:_s(g,h),Ys(h),A=h.child,A.flags&8192&&(P=A.memoizedState!==null,A.stateNode.isHidden=P,!P||A.alternate!==null&&A.alternate.memoizedState!==null||(kE=xi())),b&4&&SR(h);break;case 22:if(Ne=E!==null&&E.memoizedState!==null,h.mode&1?(Dn=(Se=Dn)||Ne,_s(g,h),Dn=Se):_s(g,h),Ys(h),b&8192){if(Se=h.memoizedState!==null,(h.stateNode.isHidden=Se)&&!Ne&&h.mode&1)for(Ye=h,Ne=h.child;Ne!==null;){for(Be=Ye=Ne;Ye!==null;){switch(ke=Ye,qe=ke.child,ke.tag){case 0:case 11:case 14:case 15:zf(4,ke,ke.return);break;case 1:ih(ke,ke.return);var it=ke.stateNode;if(typeof it.componentWillUnmount=="function"){b=ke,E=ke.return;try{g=b,it.props=g.memoizedProps,it.state=g.memoizedState,it.componentWillUnmount()}catch(st){Mi(b,E,st)}}break;case 5:ih(ke,ke.return);break;case 22:if(ke.memoizedState!==null){RR(Be);continue}}qe!==null?(qe.return=ke,Ye=qe):RR(Be)}Ne=Ne.sibling}e:for(Ne=null,Be=h;;){if(Be.tag===5){if(Ne===null){Ne=Be;try{A=Be.stateNode,Se?(P=A.style,typeof P.setProperty=="function"?P.setProperty("display","none","important"):P.display="none"):(oe=Be.stateNode,ue=Be.memoizedProps.style,V=ue!=null&&ue.hasOwnProperty("display")?ue.display:null,oe.style.display=Re("display",V))}catch(st){Mi(h,h.return,st)}}}else if(Be.tag===6){if(Ne===null)try{Be.stateNode.nodeValue=Se?"":Be.memoizedProps}catch(st){Mi(h,h.return,st)}}else if((Be.tag!==22&&Be.tag!==23||Be.memoizedState===null||Be===h)&&Be.child!==null){Be.child.return=Be,Be=Be.child;continue}if(Be===h)break e;for(;Be.sibling===null;){if(Be.return===null||Be.return===h)break e;Ne===Be&&(Ne=null),Be=Be.return}Ne===Be&&(Ne=null),Be.sibling.return=Be.return,Be=Be.sibling}}break;case 19:_s(g,h),Ys(h),b&4&&SR(h);break;case 21:break;default:_s(g,h),Ys(h)}}function Ys(h){var g=h.flags;if(g&2){try{e:{for(var E=h.return;E!==null;){if(ER(E)){var b=E;break e}E=E.return}throw Error(t(160))}switch(b.tag){case 5:var A=b.stateNode;b.flags&32&&(U(A,""),b.flags&=-33);var P=wR(h);PE(h,P,A);break;case 3:case 4:var V=b.stateNode.containerInfo,oe=wR(h);IE(h,oe,V);break;default:throw Error(t(161))}}catch(ue){Mi(h,h.return,ue)}h.flags&=-3}g&4096&&(h.flags&=-4097)}function z5(h,g,E){Ye=h,xR(h)}function xR(h,g,E){for(var b=(h.mode&1)!==0;Ye!==null;){var A=Ye,P=A.child;if(A.tag===22&&b){var V=A.memoizedState!==null||bm;if(!V){var oe=A.alternate,ue=oe!==null&&oe.memoizedState!==null||Dn;oe=bm;var Se=Dn;if(bm=V,(Dn=ue)&&!Se)for(Ye=A;Ye!==null;)V=Ye,ue=V.child,V.tag===22&&V.memoizedState!==null?AR(A):ue!==null?(ue.return=V,Ye=ue):AR(A);for(;P!==null;)Ye=P,xR(P),P=P.sibling;Ye=A,bm=oe,Dn=Se}CR(h)}else A.subtreeFlags&8772&&P!==null?(P.return=A,Ye=P):CR(h)}}function CR(h){for(;Ye!==null;){var g=Ye;if(g.flags&8772){var E=g.alternate;try{if(g.flags&8772)switch(g.tag){case 0:case 11:case 15:Dn||xm(5,g);break;case 1:var b=g.stateNode;if(g.flags&4&&!Dn)if(E===null)b.componentDidMount();else{var A=g.elementType===g.type?E.memoizedProps:vs(g.type,E.memoizedProps);b.componentDidUpdate(A,E.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var P=g.updateQueue;P!==null&&RC(g,P,b);break;case 3:var V=g.updateQueue;if(V!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}RC(g,V,E)}break;case 5:var oe=g.stateNode;if(E===null&&g.flags&4){E=oe;var ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":ue.autoFocus&&E.focus();break;case"img":ue.src&&(E.src=ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var Se=g.alternate;if(Se!==null){var Ne=Se.memoizedState;if(Ne!==null){var Be=Ne.dehydrated;Be!==null&&wr(Be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Dn||g.flags&512&&LE(g)}catch(ke){Mi(g,g.return,ke)}}if(g===h){Ye=null;break}if(E=g.sibling,E!==null){E.return=g.return,Ye=E;break}Ye=g.return}}function RR(h){for(;Ye!==null;){var g=Ye;if(g===h){Ye=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Ye=E;break}Ye=g.return}}function AR(h){for(;Ye!==null;){var g=Ye;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{xm(4,g)}catch(ue){Mi(g,E,ue)}break;case 1:var b=g.stateNode;if(typeof b.componentDidMount=="function"){var A=g.return;try{b.componentDidMount()}catch(ue){Mi(g,A,ue)}}var P=g.return;try{LE(g)}catch(ue){Mi(g,P,ue)}break;case 5:var V=g.return;try{LE(g)}catch(ue){Mi(g,V,ue)}}}catch(ue){Mi(g,g.return,ue)}if(g===h){Ye=null;break}var oe=g.sibling;if(oe!==null){oe.return=g.return,Ye=oe;break}Ye=g.return}}var G5=Math.ceil,Cm=I.ReactCurrentDispatcher,DE=I.ReactCurrentOwner,Yr=I.ReactCurrentBatchConfig,Wt=0,rn=null,Hi=null,yn=0,Ar=0,nh=ja(0),Zi=0,Gf=null,yc=0,Rm=0,OE=0,Hf=null,rr=null,kE=0,rh=1/0,Ho=null,Am=!1,ME=null,Xa=null,Lm=!1,Ja=null,Im=0,$f=0,NE=null,Pm=-1,Dm=0;function jn(){return Wt&6?xi():Pm!==-1?Pm:Pm=xi()}function Qa(h){return h.mode&1?Wt&2&&yn!==0?yn&-yn:b5.transition!==null?(Dm===0&&(Dm=Mg()),Dm):(h=$t,h!==0||(h=window.event,h=h===void 0?16:Bt(h.type)),h):1}function Es(h,g,E,b){if(50<$f)throw $f=0,NE=null,Error(t(185));_r(h,E,b),(!(Wt&2)||h!==rn)&&(h===rn&&(!(Wt&2)&&(Rm|=E),Zi===4&&el(h,yn)),sr(h,b),E===1&&Wt===0&&!(g.mode&1)&&(rh=xi()+500,om&&qa()))}function sr(h,g){var E=h.callbackNode;bu(h,g);var b=di(h,h===rn?yn:0);if(b===0)E!==null&&rf(E),h.callbackNode=null,h.callbackPriority=0;else if(g=b&-b,h.callbackPriority!==g){if(E!=null&&rf(E),g===1)h.tag===0?S5(IR.bind(null,h)):gC(IR.bind(null,h)),An(function(){!(Wt&6)&&qa()}),E=null;else{switch(Aa(b)){case 1:E=sf;break;case 4:E=kg;break;case 16:E=Tu;break;case 536870912:E=ba;break;default:E=Tu}E=BR(E,LR.bind(null,h))}h.callbackPriority=g,h.callbackNode=E}}function LR(h,g){if(Pm=-1,Dm=0,Wt&6)throw Error(t(327));var E=h.callbackNode;if(sh()&&h.callbackNode!==E)return null;var b=di(h,h===rn?yn:0);if(b===0)return null;if(b&30||b&h.expiredLanes||g)g=Om(h,b);else{g=b;var A=Wt;Wt|=2;var P=DR();(rn!==h||yn!==g)&&(Ho=null,rh=xi()+500,Ec(h,g));do try{V5();break}catch(oe){PR(h,oe)}while(!0);eE(),Cm.current=P,Wt=A,Hi!==null?g=0:(rn=null,yn=0,g=Zi)}if(g!==0){if(g===2&&(A=Cn(h),A!==0&&(b=A,g=FE(h,A))),g===1)throw E=Gf,Ec(h,0),el(h,b),sr(h,xi()),E;if(g===6)el(h,b);else{if(A=h.current.alternate,!(b&30)&&!H5(A)&&(g=Om(h,b),g===2&&(P=Cn(h),P!==0&&(b=P,g=FE(h,P))),g===1))throw E=Gf,Ec(h,0),el(h,b),sr(h,xi()),E;switch(h.finishedWork=A,h.finishedLanes=b,g){case 0:case 1:throw Error(t(345));case 2:wc(h,rr,Ho);break;case 3:if(el(h,b),(b&130023424)===b&&(g=kE+500-xi(),10<g)){if(di(h,0)!==0)break;if(A=h.suspendedLanes,(A&b)!==b){jn(),h.pingedLanes|=h.suspendedLanes&A;break}h.timeoutHandle=qi(wc.bind(null,h,rr,Ho),g);break}wc(h,rr,Ho);break;case 4:if(el(h,b),(b&4194240)===b)break;for(g=h.eventTimes,A=-1;0<b;){var V=31-Rt(b);P=1<<V,V=g[V],V>A&&(A=V),b&=~P}if(b=A,b=xi()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*G5(b/1960))-b,10<b){h.timeoutHandle=qi(wc.bind(null,h,rr,Ho),b);break}wc(h,rr,Ho);break;case 5:wc(h,rr,Ho);break;default:throw Error(t(329))}}}return sr(h,xi()),h.callbackNode===E?LR.bind(null,h):null}function FE(h,g){var E=Hf;return h.current.memoizedState.isDehydrated&&(Ec(h,g).flags|=256),h=Om(h,g),h!==2&&(g=rr,rr=E,g!==null&&BE(g)),h}function BE(h){rr===null?rr=h:rr.push.apply(rr,h)}function H5(h){for(var g=h;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var b=0;b<E.length;b++){var A=E[b],P=A.getSnapshot;A=A.value;try{if(!br(P(),A))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function el(h,g){for(g&=~OE,g&=~Rm,h.suspendedLanes|=g,h.pingedLanes&=~g,h=h.expirationTimes;0<g;){var E=31-Rt(g),b=1<<E;h[E]=-1,g&=~b}}function IR(h){if(Wt&6)throw Error(t(327));sh();var g=di(h,0);if(!(g&1))return sr(h,xi()),null;var E=Om(h,g);if(h.tag!==0&&E===2){var b=Cn(h);b!==0&&(g=b,E=FE(h,b))}if(E===1)throw E=Gf,Ec(h,0),el(h,g),sr(h,xi()),E;if(E===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=g,wc(h,rr,Ho),sr(h,xi()),null}function UE(h,g){var E=Wt;Wt|=1;try{return h(g)}finally{Wt=E,Wt===0&&(rh=xi()+500,om&&qa())}}function _c(h){Ja!==null&&Ja.tag===0&&!(Wt&6)&&sh();var g=Wt;Wt|=1;var E=Yr.transition,b=$t;try{if(Yr.transition=null,$t=1,h)return h()}finally{$t=b,Yr.transition=E,Wt=g,!(Wt&6)&&qa()}}function zE(){Ar=nh.current,Ei(nh)}function Ec(h,g){h.finishedWork=null,h.finishedLanes=0;var E=h.timeoutHandle;if(E!==-1&&(h.timeoutHandle=-1,Gi(E)),Hi!==null)for(E=Hi.return;E!==null;){var b=E;switch(Z_(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&rm();break;case 3:eh(),Ei(tr),Ei(Ln),lE();break;case 5:oE(b);break;case 4:eh();break;case 13:Ei(Ri);break;case 19:Ei(Ri);break;case 10:tE(b.type._context);break;case 22:case 23:zE()}E=E.return}if(rn=h,Hi=h=tl(h.current,null),yn=Ar=g,Zi=0,Gf=null,OE=Rm=yc=0,rr=Hf=null,gc!==null){for(g=0;g<gc.length;g++)if(E=gc[g],b=E.interleaved,b!==null){E.interleaved=null;var A=b.next,P=E.pending;if(P!==null){var V=P.next;P.next=A,b.next=V}E.pending=b}gc=null}return h}function PR(h,g){do{var E=Hi;try{if(eE(),mm.current=Em,vm){for(var b=Ai.memoizedState;b!==null;){var A=b.queue;A!==null&&(A.pending=null),b=b.next}vm=!1}if(vc=0,nn=Ki=Ai=null,Mf=!1,Nf=0,DE.current=null,E===null||E.return===null){Zi=1,Gf=g,Hi=null;break}e:{var P=h,V=E.return,oe=E,ue=g;if(g=yn,oe.flags|=32768,ue!==null&&typeof ue=="object"&&typeof ue.then=="function"){var Se=ue,Ne=oe,Be=Ne.tag;if(!(Ne.mode&1)&&(Be===0||Be===11||Be===15)){var ke=Ne.alternate;ke?(Ne.updateQueue=ke.updateQueue,Ne.memoizedState=ke.memoizedState,Ne.lanes=ke.lanes):(Ne.updateQueue=null,Ne.memoizedState=null)}var qe=iR(V);if(qe!==null){qe.flags&=-257,nR(qe,V,oe,P,g),qe.mode&1&&tR(P,Se,g),g=qe,ue=Se;var it=g.updateQueue;if(it===null){var st=new Set;st.add(ue),g.updateQueue=st}else it.add(ue);break e}else{if(!(g&1)){tR(P,Se,g),GE();break e}ue=Error(t(426))}}else if(Si&&oe.mode&1){var Fi=iR(V);if(Fi!==null){!(Fi.flags&65536)&&(Fi.flags|=256),nR(Fi,V,oe,P,g),J_(th(ue,oe));break e}}P=ue=th(ue,oe),Zi!==4&&(Zi=2),Hf===null?Hf=[P]:Hf.push(P),P=V;do{switch(P.tag){case 3:P.flags|=65536,g&=-g,P.lanes|=g;var ye=QC(P,ue,g);CC(P,ye);break e;case 1:oe=ue;var he=P.type,we=P.stateNode;if(!(P.flags&128)&&(typeof he.getDerivedStateFromError=="function"||we!==null&&typeof we.componentDidCatch=="function"&&(Xa===null||!Xa.has(we)))){P.flags|=65536,g&=-g,P.lanes|=g;var He=eR(P,oe,g);CC(P,He);break e}}P=P.return}while(P!==null)}kR(E)}catch(at){g=at,Hi===E&&E!==null&&(Hi=E=E.return);continue}break}while(!0)}function DR(){var h=Cm.current;return Cm.current=Em,h===null?Em:h}function GE(){(Zi===0||Zi===3||Zi===2)&&(Zi=4),rn===null||!(yc&268435455)&&!(Rm&268435455)||el(rn,yn)}function Om(h,g){var E=Wt;Wt|=2;var b=DR();(rn!==h||yn!==g)&&(Ho=null,Ec(h,g));do try{$5();break}catch(A){PR(h,A)}while(!0);if(eE(),Wt=E,Cm.current=b,Hi!==null)throw Error(t(261));return rn=null,yn=0,Zi}function $5(){for(;Hi!==null;)OR(Hi)}function V5(){for(;Hi!==null&&!A_();)OR(Hi)}function OR(h){var g=FR(h.alternate,h,Ar);h.memoizedProps=h.pendingProps,g===null?kR(h):Hi=g,DE.current=null}function kR(h){var g=h;do{var E=g.alternate;if(h=g.return,g.flags&32768){if(E=F5(E,g),E!==null){E.flags&=32767,Hi=E;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Zi=6,Hi=null;return}}else if(E=N5(E,g,Ar),E!==null){Hi=E;return}if(g=g.sibling,g!==null){Hi=g;return}Hi=g=h}while(g!==null);Zi===0&&(Zi=5)}function wc(h,g,E){var b=$t,A=Yr.transition;try{Yr.transition=null,$t=1,j5(h,g,E,b)}finally{Yr.transition=A,$t=b}return null}function j5(h,g,E,b){do sh();while(Ja!==null);if(Wt&6)throw Error(t(327));E=h.finishedWork;var A=h.finishedLanes;if(E===null)return null;if(h.finishedWork=null,h.finishedLanes=0,E===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var P=E.lanes|E.childLanes;if(ki(h,P),h===rn&&(Hi=rn=null,yn=0),!(E.subtreeFlags&2064)&&!(E.flags&2064)||Lm||(Lm=!0,BR(Tu,function(){return sh(),null})),P=(E.flags&15990)!==0,E.subtreeFlags&15990||P){P=Yr.transition,Yr.transition=null;var V=$t;$t=1;var oe=Wt;Wt|=4,DE.current=null,U5(h,E),bR(E,h),$r(ut),rc=!!We,ut=We=null,h.current=E,z5(E),wu(),Wt=oe,$t=V,Yr.transition=P}else h.current=E;if(Lm&&(Lm=!1,Ja=h,Im=A),P=h.pendingLanes,P===0&&(Xa=null),Ql(E.stateNode),sr(h,xi()),g!==null)for(b=h.onRecoverableError,E=0;E<g.length;E++)A=g[E],b(A.value,{componentStack:A.stack,digest:A.digest});if(Am)throw Am=!1,h=ME,ME=null,h;return Im&1&&h.tag!==0&&sh(),P=h.pendingLanes,P&1?h===NE?$f++:($f=0,NE=h):$f=0,qa(),null}function sh(){if(Ja!==null){var h=Aa(Im),g=Yr.transition,E=$t;try{if(Yr.transition=null,$t=16>h?16:h,Ja===null)var b=!1;else{if(h=Ja,Ja=null,Im=0,Wt&6)throw Error(t(331));var A=Wt;for(Wt|=4,Ye=h.current;Ye!==null;){var P=Ye,V=P.child;if(Ye.flags&16){var oe=P.deletions;if(oe!==null){for(var ue=0;ue<oe.length;ue++){var Se=oe[ue];for(Ye=Se;Ye!==null;){var Ne=Ye;switch(Ne.tag){case 0:case 11:case 15:zf(8,Ne,P)}var Be=Ne.child;if(Be!==null)Be.return=Ne,Ye=Be;else for(;Ye!==null;){Ne=Ye;var ke=Ne.sibling,qe=Ne.return;if(_R(Ne),Ne===Se){Ye=null;break}if(ke!==null){ke.return=qe,Ye=ke;break}Ye=qe}}}var it=P.alternate;if(it!==null){var st=it.child;if(st!==null){it.child=null;do{var Fi=st.sibling;st.sibling=null,st=Fi}while(st!==null)}}Ye=P}}if(P.subtreeFlags&2064&&V!==null)V.return=P,Ye=V;else e:for(;Ye!==null;){if(P=Ye,P.flags&2048)switch(P.tag){case 0:case 11:case 15:zf(9,P,P.return)}var ye=P.sibling;if(ye!==null){ye.return=P.return,Ye=ye;break e}Ye=P.return}}var he=h.current;for(Ye=he;Ye!==null;){V=Ye;var we=V.child;if(V.subtreeFlags&2064&&we!==null)we.return=V,Ye=we;else e:for(V=he;Ye!==null;){if(oe=Ye,oe.flags&2048)try{switch(oe.tag){case 0:case 11:case 15:xm(9,oe)}}catch(at){Mi(oe,oe.return,at)}if(oe===V){Ye=null;break e}var He=oe.sibling;if(He!==null){He.return=oe.return,Ye=He;break e}Ye=oe.return}}if(Wt=A,qa(),yr&&typeof yr.onPostCommitFiberRoot=="function")try{yr.onPostCommitFiberRoot(Jl,h)}catch{}b=!0}return b}finally{$t=E,Yr.transition=g}}return!1}function MR(h,g,E){g=th(E,g),g=QC(h,g,1),h=Za(h,g,1),g=jn(),h!==null&&(_r(h,1,g),sr(h,g))}function Mi(h,g,E){if(h.tag===3)MR(h,h,E);else for(;g!==null;){if(g.tag===3){MR(g,h,E);break}else if(g.tag===1){var b=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Xa===null||!Xa.has(b))){h=th(E,h),h=eR(g,h,1),g=Za(g,h,1),h=jn(),g!==null&&(_r(g,1,h),sr(g,h));break}}g=g.return}}function W5(h,g,E){var b=h.pingCache;b!==null&&b.delete(g),g=jn(),h.pingedLanes|=h.suspendedLanes&E,rn===h&&(yn&E)===E&&(Zi===4||Zi===3&&(yn&130023424)===yn&&500>xi()-kE?Ec(h,0):OE|=E),sr(h,g)}function NR(h,g){g===0&&(h.mode&1?(g=Ca,Ca<<=1,!(Ca&130023424)&&(Ca=4194304)):g=1);var E=jn();h=Uo(h,g),h!==null&&(_r(h,g,E),sr(h,E))}function q5(h){var g=h.memoizedState,E=0;g!==null&&(E=g.retryLane),NR(h,E)}function K5(h,g){var E=0;switch(h.tag){case 13:var b=h.stateNode,A=h.memoizedState;A!==null&&(E=A.retryLane);break;case 19:b=h.stateNode;break;default:throw Error(t(314))}b!==null&&b.delete(g),NR(h,E)}var FR;FR=function(h,g,E){if(h!==null)if(h.memoizedProps!==g.pendingProps||tr.current)nr=!0;else{if(!(h.lanes&E)&&!(g.flags&128))return nr=!1,M5(h,g,E);nr=!!(h.flags&131072)}else nr=!1,Si&&g.flags&1048576&&mC(g,lm,g.index);switch(g.lanes=0,g.tag){case 2:var b=g.type;Sm(h,g),h=g.pendingProps;var A=qu(g,Ln.current);Qu(g,E),A=hE(null,g,b,h,A,E);var P=dE();return g.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ir(b)?(P=!0,sm(g)):P=!1,g.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,rE(g),A.updater=wm,g.stateNode=A,A._reactInternals=g,yE(g,b,h,E),g=TE(null,g,b,!0,P,E)):(g.tag=0,Si&&P&&K_(g),Vn(null,g,A,E),g=g.child),g;case 16:b=g.elementType;e:{switch(Sm(h,g),h=g.pendingProps,A=b._init,b=A(b._payload),g.type=b,A=g.tag=Y5(b),h=vs(b,h),A){case 0:g=wE(null,g,b,h,E);break e;case 1:g=cR(null,g,b,h,E);break e;case 11:g=rR(null,g,b,h,E);break e;case 14:g=sR(null,g,b,vs(b.type,h),E);break e}throw Error(t(306,b,""))}return g;case 0:return b=g.type,A=g.pendingProps,A=g.elementType===b?A:vs(b,A),wE(h,g,b,A,E);case 1:return b=g.type,A=g.pendingProps,A=g.elementType===b?A:vs(b,A),cR(h,g,b,A,E);case 3:e:{if(uR(g),h===null)throw Error(t(387));b=g.pendingProps,P=g.memoizedState,A=P.element,xC(h,g),pm(g,b,null,E);var V=g.memoizedState;if(b=V.element,P.isDehydrated)if(P={element:b,isDehydrated:!1,cache:V.cache,pendingSuspenseBoundaries:V.pendingSuspenseBoundaries,transitions:V.transitions},g.updateQueue.baseState=P,g.memoizedState=P,g.flags&256){A=th(Error(t(423)),g),g=hR(h,g,b,E,A);break e}else if(b!==A){A=th(Error(t(424)),g),g=hR(h,g,b,E,A);break e}else for(Rr=qs(g.stateNode.containerInfo.firstChild),Cr=g,Si=!0,ms=null,E=SC(g,null,b,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(Yu(),b===A){g=Go(h,g,E);break e}Vn(h,g,b,E)}g=g.child}return g;case 5:return AC(g),h===null&&X_(g),b=g.type,A=g.pendingProps,P=h!==null?h.memoizedProps:null,V=A.children,Pt(b,A)?V=null:P!==null&&Pt(b,P)&&(g.flags|=32),lR(h,g),Vn(h,g,V,E),g.child;case 6:return h===null&&X_(g),null;case 13:return dR(h,g,E);case 4:return sE(g,g.stateNode.containerInfo),b=g.pendingProps,h===null?g.child=Xu(g,null,b,E):Vn(h,g,b,E),g.child;case 11:return b=g.type,A=g.pendingProps,A=g.elementType===b?A:vs(b,A),rR(h,g,b,A,E);case 7:return Vn(h,g,g.pendingProps,E),g.child;case 8:return Vn(h,g,g.pendingProps.children,E),g.child;case 12:return Vn(h,g,g.pendingProps.children,E),g.child;case 10:e:{if(b=g.type._context,A=g.pendingProps,P=g.memoizedProps,V=A.value,fi(hm,b._currentValue),b._currentValue=V,P!==null)if(br(P.value,V)){if(P.children===A.children&&!tr.current){g=Go(h,g,E);break e}}else for(P=g.child,P!==null&&(P.return=g);P!==null;){var oe=P.dependencies;if(oe!==null){V=P.child;for(var ue=oe.firstContext;ue!==null;){if(ue.context===b){if(P.tag===1){ue=zo(-1,E&-E),ue.tag=2;var Se=P.updateQueue;if(Se!==null){Se=Se.shared;var Ne=Se.pending;Ne===null?ue.next=ue:(ue.next=Ne.next,Ne.next=ue),Se.pending=ue}}P.lanes|=E,ue=P.alternate,ue!==null&&(ue.lanes|=E),iE(P.return,E,g),oe.lanes|=E;break}ue=ue.next}}else if(P.tag===10)V=P.type===g.type?null:P.child;else if(P.tag===18){if(V=P.return,V===null)throw Error(t(341));V.lanes|=E,oe=V.alternate,oe!==null&&(oe.lanes|=E),iE(V,E,g),V=P.sibling}else V=P.child;if(V!==null)V.return=P;else for(V=P;V!==null;){if(V===g){V=null;break}if(P=V.sibling,P!==null){P.return=V.return,V=P;break}V=V.return}P=V}Vn(h,g,A.children,E),g=g.child}return g;case 9:return A=g.type,b=g.pendingProps.children,Qu(g,E),A=Kr(A),b=b(A),g.flags|=1,Vn(h,g,b,E),g.child;case 14:return b=g.type,A=vs(b,g.pendingProps),A=vs(b.type,A),sR(h,g,b,A,E);case 15:return oR(h,g,g.type,g.pendingProps,E);case 17:return b=g.type,A=g.pendingProps,A=g.elementType===b?A:vs(b,A),Sm(h,g),g.tag=1,ir(b)?(h=!0,sm(g)):h=!1,Qu(g,E),XC(g,b,A),yE(g,b,A,E),TE(null,g,b,!0,h,E);case 19:return pR(h,g,E);case 22:return aR(h,g,E)}throw Error(t(156,g.tag))};function BR(h,g){return Og(h,g)}function Z5(h,g,E,b){this.tag=h,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xr(h,g,E,b){return new Z5(h,g,E,b)}function HE(h){return h=h.prototype,!(!h||!h.isReactComponent)}function Y5(h){if(typeof h=="function")return HE(h)?1:0;if(h!=null){if(h=h.$$typeof,h===Y)return 11;if(h===W)return 14}return 2}function tl(h,g){var E=h.alternate;return E===null?(E=Xr(h.tag,g,h.key,h.mode),E.elementType=h.elementType,E.type=h.type,E.stateNode=h.stateNode,E.alternate=h,h.alternate=E):(E.pendingProps=g,E.type=h.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=h.flags&14680064,E.childLanes=h.childLanes,E.lanes=h.lanes,E.child=h.child,E.memoizedProps=h.memoizedProps,E.memoizedState=h.memoizedState,E.updateQueue=h.updateQueue,g=h.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=h.sibling,E.index=h.index,E.ref=h.ref,E}function km(h,g,E,b,A,P){var V=2;if(b=h,typeof h=="function")HE(h)&&(V=1);else if(typeof h=="string")V=5;else e:switch(h){case N:return Tc(E.children,A,P,g);case z:V=8,A|=8;break;case Z:return h=Xr(12,E,g,A|2),h.elementType=Z,h.lanes=P,h;case ee:return h=Xr(13,E,g,A),h.elementType=ee,h.lanes=P,h;case le:return h=Xr(19,E,g,A),h.elementType=le,h.lanes=P,h;case ne:return Mm(E,A,P,g);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case q:V=10;break e;case H:V=9;break e;case Y:V=11;break e;case W:V=14;break e;case ie:V=16,b=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return g=Xr(V,E,g,A),g.elementType=h,g.type=b,g.lanes=P,g}function Tc(h,g,E,b){return h=Xr(7,h,b,g),h.lanes=E,h}function Mm(h,g,E,b){return h=Xr(22,h,b,g),h.elementType=ne,h.lanes=E,h.stateNode={isHidden:!1},h}function $E(h,g,E){return h=Xr(6,h,null,g),h.lanes=E,h}function VE(h,g,E){return g=Xr(4,h.children!==null?h.children:[],h.key,g),g.lanes=E,g.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},g}function X5(h,g,E,b,A){this.tag=g,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ra(0),this.expirationTimes=Ra(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ra(0),this.identifierPrefix=b,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function jE(h,g,E,b,A,P,V,oe,ue){return h=new X5(h,g,E,oe,ue),g===1?(g=1,P===!0&&(g|=8)):g=0,P=Xr(3,null,null,g),h.current=P,P.stateNode=h,P.memoizedState={element:b,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},rE(P),h}function J5(h,g,E){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:B,key:b==null?null:""+b,children:h,containerInfo:g,implementation:E}}function UR(h){if(!h)return Wa;h=h._reactInternals;e:{if(Us(h)!==h||h.tag!==1)throw Error(t(170));var g=h;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ir(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(h.tag===1){var E=h.type;if(ir(E))return fC(h,E,g)}return g}function zR(h,g,E,b,A,P,V,oe,ue){return h=jE(E,b,!0,h,A,P,V,oe,ue),h.context=UR(null),E=h.current,b=jn(),A=Qa(E),P=zo(b,A),P.callback=g??null,Za(E,P,A),h.current.lanes=A,_r(h,A,b),sr(h,b),h}function Nm(h,g,E,b){var A=g.current,P=jn(),V=Qa(A);return E=UR(E),g.context===null?g.context=E:g.pendingContext=E,g=zo(P,V),g.payload={element:h},b=b===void 0?null:b,b!==null&&(g.callback=b),h=Za(A,g,V),h!==null&&(Es(h,A,V,P),fm(h,A,V)),V}function Fm(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function GR(h,g){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var E=h.retryLane;h.retryLane=E!==0&&E<g?E:g}}function WE(h,g){GR(h,g),(h=h.alternate)&&GR(h,g)}function Q5(){return null}var HR=typeof reportError=="function"?reportError:function(h){console.error(h)};function qE(h){this._internalRoot=h}Bm.prototype.render=qE.prototype.render=function(h){var g=this._internalRoot;if(g===null)throw Error(t(409));Nm(h,g,null,null)},Bm.prototype.unmount=qE.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var g=h.containerInfo;_c(function(){Nm(null,h,null,null)}),g[ei]=null}};function Bm(h){this._internalRoot=h}Bm.prototype.unstable_scheduleHydration=function(h){if(h){var g=Ru();h={blockedOn:null,target:h,priority:g};for(var E=0;E<Wi.length&&g!==0&&g<Wi[E].priority;E++);Wi.splice(E,0,h),E===0&&Au(h)}};function KE(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Um(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function $R(){}function ez(h,g,E,b,A){if(A){if(typeof b=="function"){var P=b;b=function(){var Se=Fm(V);P.call(Se)}}var V=zR(g,b,h,0,null,!1,!1,"",$R);return h._reactRootContainer=V,h[ei]=V.current,Ga(h.nodeType===8?h.parentNode:h),_c(),V}for(;A=h.lastChild;)h.removeChild(A);if(typeof b=="function"){var oe=b;b=function(){var Se=Fm(ue);oe.call(Se)}}var ue=jE(h,0,!1,null,null,!1,!1,"",$R);return h._reactRootContainer=ue,h[ei]=ue.current,Ga(h.nodeType===8?h.parentNode:h),_c(function(){Nm(g,ue,E,b)}),ue}function zm(h,g,E,b,A){var P=E._reactRootContainer;if(P){var V=P;if(typeof A=="function"){var oe=A;A=function(){var ue=Fm(V);oe.call(ue)}}Nm(g,V,h,A)}else V=ez(E,g,h,A,b);return Fm(V)}xu=function(h){switch(h.tag){case 3:var g=h.stateNode;if(g.current.memoizedState.isDehydrated){var E=bt(g.pendingLanes);E!==0&&(hs(g,E|1),sr(g,xi()),!(Wt&6)&&(rh=xi()+500,qa()))}break;case 13:_c(function(){var b=Uo(h,1);if(b!==null){var A=jn();Es(b,h,1,A)}}),WE(h,1)}},bo=function(h){if(h.tag===13){var g=Uo(h,134217728);if(g!==null){var E=jn();Es(g,h,134217728,E)}WE(h,134217728)}},Cu=function(h){if(h.tag===13){var g=Qa(h),E=Uo(h,g);if(E!==null){var b=jn();Es(E,h,g,b)}WE(h,g)}},Ru=function(){return $t},ec=function(h,g){var E=$t;try{return $t=h,g()}finally{$t=E}},ji=function(h,g,E){switch(g){case"input":if(k(h,E),g=E.name,E.type==="radio"&&g!=null){for(E=h;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var b=E[g];if(b!==h&&b.form===h.form){var A=ju(b);if(!A)throw Error(t(90));ct(b),k(b,A)}}}break;case"textarea":vt(h,E);break;case"select":g=E.value,g!=null&&Ae(h,!!E.multiple,g,!1)}},cs=UE,mn=_c;var tz={usingClientEntryPoint:!1,Events:[ko,Mo,ju,Yl,tn,UE]},Vf={findFiberByHostInstance:Oo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iz={bundleType:Vf.bundleType,version:Vf.version,rendererPackageName:Vf.rendererPackageName,rendererConfig:Vf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:I.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Pg(h),h===null?null:h.stateNode},findFiberByHostInstance:Vf.findFiberByHostInstance||Q5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gm.isDisabled&&Gm.supportsFiber)try{Jl=Gm.inject(iz),yr=Gm}catch{}}return or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tz,or.createPortal=function(h,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!KE(g))throw Error(t(200));return J5(h,g,null,E)},or.createRoot=function(h,g){if(!KE(h))throw Error(t(299));var E=!1,b="",A=HR;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(b=g.identifierPrefix),g.onRecoverableError!==void 0&&(A=g.onRecoverableError)),g=jE(h,1,!1,null,null,E,!1,b,A),h[ei]=g.current,Ga(h.nodeType===8?h.parentNode:h),new qE(g)},or.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var g=h._reactInternals;if(g===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=Pg(g),h=h===null?null:h.stateNode,h},or.flushSync=function(h){return _c(h)},or.hydrate=function(h,g,E){if(!Um(g))throw Error(t(200));return zm(null,h,g,!0,E)},or.hydrateRoot=function(h,g,E){if(!KE(h))throw Error(t(405));var b=E!=null&&E.hydratedSources||null,A=!1,P="",V=HR;if(E!=null&&(E.unstable_strictMode===!0&&(A=!0),E.identifierPrefix!==void 0&&(P=E.identifierPrefix),E.onRecoverableError!==void 0&&(V=E.onRecoverableError)),g=zR(g,null,h,1,E??null,A,!1,P,V),h[ei]=g.current,Ga(h),b)for(h=0;h<b.length;h++)E=b[h],A=E._getVersion,A=A(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,A]:g.mutableSourceEagerHydrationData.push(E,A);return new Bm(g)},or.render=function(h,g,E){if(!Um(g))throw Error(t(200));return zm(null,h,g,!1,E)},or.unmountComponentAtNode=function(h){if(!Um(h))throw Error(t(40));return h._reactRootContainer?(_c(function(){zm(null,null,h,!1,function(){h._reactRootContainer=null,h[ei]=null})}),!0):!1},or.unstable_batchedUpdates=UE,or.unstable_renderSubtreeIntoContainer=function(h,g,E,b){if(!Um(E))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return zm(h,g,E,!1,b)},or.version="18.3.1-next-f1338f8080-20240426",or}function OM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(OM)}catch(n){console.error(n)}}OM(),DM.exports=Gj();var du=DM.exports;const Hj=hu(du);var kM,EL=du;kM=EL.createRoot,EL.hydrateRoot;var $j=Object.defineProperty,Vj=(n,e,t)=>e in n?$j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,My=(n,e,t)=>(Vj(n,typeof e!="symbol"?e+"":e,t),t);const Xe=[];Object.freeze(Xe);const jj={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:Xe,motivation:null,label:null,thumbnail:Xe,summary:null,requiredStatement:null,metadata:Xe,rights:null,provider:Xe,items:Xe,seeAlso:Xe,homepage:Xe,logo:Xe,rendering:Xe,service:Xe},Wj={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:Xe,motivation:null,thumbnail:Xe,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Xe,rights:null,navDate:null,provider:Xe,items:Xe,annotations:Xe,seeAlso:Xe,homepage:Xe,logo:Xe,partOf:Xe,rendering:Xe,service:Xe,duration:0,height:0,width:0},qj={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:Xe,motivation:null,thumbnail:Xe,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Xe,rights:null,navDate:null,provider:Xe,items:Xe,annotations:Xe,seeAlso:Xe,homepage:Xe,logo:Xe,partOf:Xe,rendering:Xe,service:Xe,services:Xe},Kj={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:Xe,behavior:Xe,homepage:Xe,items:Xe,label:null,logo:Xe,metadata:Xe,motivation:null,navDate:null,provider:Xe,partOf:Xe,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:Xe,requiredStatement:null,rights:null,seeAlso:Xe,service:Xe,services:Xe,start:null,structures:Xe,summary:null,thumbnail:Xe,viewingDirection:"left-to-right"},Zj={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:Xe,motivation:null,thumbnail:Xe,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:Xe,rights:null,navDate:null,provider:Xe,items:Xe,annotations:Xe,seeAlso:Xe,homepage:Xe,logo:Xe,partOf:Xe,rendering:Xe,service:Xe,start:null,supplementary:null,viewingDirection:"left-to-right"},Yj={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:Xe,seeAlso:Xe,homepage:Xe};function tS(n){return Array.isArray(n)?n:[n]}const wL=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function Xj(n){if(typeof n>"u"||n===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(n))throw new Error("Array is not a valid entity");if(typeof n!="object")throw new Error(`${typeof n} is not a valid entity`);if(typeof n.type=="string"){const e=wL.indexOf(n.type);if(e!==-1)return wL[e]}if(n.profile)return"Service";throw new Error("Resource type is not known")}class Sx{constructor(e,t={}){My(this,"traversals"),My(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new Sx({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=e.thumbnail.map(t=>this.traverseType(t,this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(t=>this.traverseAgent(t))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map(t=>this.traverseType(t,this.traversals.contentResource))),e.service&&(e.service=tS(e.service).map(t=>this.traverseType(t,this.traversals.service))),e.services&&(e.services=e.services.map(t=>this.traverseType(t,this.traversals.service))),e.logo&&(e.logo=e.logo.map(t=>this.traverseType(t,this.traversals.contentResource))),e.homepage&&(e.homepage=e.homepage.map(t=>this.traverseType(t,this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(t=>typeof t=="string"||!t.type?this.traverseType(t,this.traversals.contentResource):t.type==="Canvas"?this.traverseType(t,this.traversals.canvas):t.type==="AnnotationCollection"?this.traverseType(t,this.traversals.annotationCollection):t.type==="Collection"?this.traverseType(t,this.traversals.collection):this.traverseType(t,this.traversals.contentResource))),e.start&&(e.start=e.start?this.traverseType(e.start,this.traversals.canvas):null),e.rendering&&(e.rendering=e.rendering.map(t=>this.traverseType(t,this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(t=>this.traverseType(t,this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(t=>t.type==="Collection"?this.traverseCollection(t):this.traverseManifest(t)),e}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(e))))),this.traversals.collection)}traverseManifestItems(e){return e.items&&(e.items=e.items.map(t=>this.traverseCanvas(t))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(t=>this.traverseRange(t))),e}traverseManifest(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e)))))),this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(t=>this.traverseAnnotationPage(t)),e}traverseInlineAnnotationPages(e){return typeof e=="string"||!e||e.annotations&&(e.annotations=e.annotations.map(t=>this.traverseAnnotationPage(t))),e}traverseCanvas(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))))),this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(t=>this.traverseAnnotation(t))),e}traverseAnnotationPage(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(e))),this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(t=>this.traverseContentResource(t)):e.body&&(e.body=this.traverseContentResource(e.body)),e}traversePosterCanvas(e){return e.posterCanvas&&(e.posterCanvas=this.traverseCanvas(e.posterCanvas)),e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(e)),this.traversals.annotation)}traverseContentResourceLinking(e){return typeof e=="string"||!e||e&&e.service&&(e.service=tS(e.service||[]).map(t=>this.traverseType(t,this.traversals.service))),e}traverseContentResource(e){return e.type==="Choice"&&(e.items=e.items.map(t=>this.traverseContentResource(t))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),this.traversals.contentResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(t=>typeof t=="string"?this.traverseCanvas({id:t,type:"Canvas"}):t.type==="Manifest"?this.traverseManifest(t):this.traverseRange(t))),e}traverseRange(e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(e)))),this.traversals.range)}traverseAgent(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.agent)}traverseType(e,t){return t.reduce((i,r)=>{const s=r(i);return typeof s>"u"&&!this.options.allowUndefinedReturn?i:s},e)}traverseService(e){return this.traverseType(e,this.traversals.service)}traverseUnknown(e){const t=Xj(e);switch(t){case"Collection":return this.traverseCollection(e);case"Manifest":return this.traverseManifest(e);case"Canvas":return this.traverseCanvas(e);case"AnnotationPage":return this.traverseAnnotationPage(e);case"Annotation":return this.traverseAnnotation(e);case"ContentResource":return this.traverseContentResource(e);case"Range":return this.traverseRange(e);case"Service":return this.traverseService(e);case"Agent":return this.traverseAgent(e);default:throw new Error(`Unknown or unsupported resource type of ${t}`)}}}const TL=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function Jj(n){if(typeof n>"u"||n===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(n))throw new Error("Array is not a valid entity");if(typeof n!="object")throw new Error(`${typeof n} is not a valid entity`);if(typeof n["@type"]=="string"){const e=TL.indexOf(n["@type"]);if(e!==-1)return TL[e]}if(n.profile)return"Service";if(n.format||n["@type"])return"ContentResource";throw new Error("Resource type is not known")}class bx{constructor(e,t={}){My(this,"traversals"),My(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new bx({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){const t=[...(e.manifests||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Manifest"}:i),...(e.collections||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Collection"}:i),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map(t=>this.traverseManifest(typeof t=="string"?{"@id":t,"@type":"sc:Manifest"}:t))),e.collections&&(e.collections=e.collections.map(t=>this.traverseCollection(typeof t=="string"?{"@id":t,"@type":"sc:Collection"}:t))),e.members&&(e.members=e.members.map(t=>typeof t=="string"?t:this.traverseUnknown(t))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(t=>this.traverseSequence(t))),e.structures&&(e.structures=e.structures.map(t=>this.traverseRange(t))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(t=>this.traverseCanvas(t))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(t=>this.traverseAnnotation(t))),e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){const t=[...(e.ranges||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Range"}:i),...(e.canvases||[]).map(i=>typeof i=="string"?{"@id":i,"@type":"sc:Canvas"}:i),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(i=>this.traverseUnknown(i)):void 0}return e}traverseAnnotationList(e){const t=typeof e=="string"?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(t=>this.traverseAnnotation(t))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(t=>this.traverseContentResource(t)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(t=>this.traverseAnnotationList(t))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&e.default!=="rdf:nil"&&(e.default=this.traverseContentResource(e.default)),e.item&&e.item!=="rdf:nil"&&(e.item=e.item.map(t=>this.traverseContentResource(t))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return e["@type"]==="oa:Choice"?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||typeof e=="string")return e;switch(Jj(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const s of i)typeof s=="string"?r.push(this.traverseContentResource({"@id":s,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){const t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(const s of i)r.push(this.traverseService(s));return!t&&!this.options.convertPropsToArray?r[0]:r}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&(typeof e.within=="string"||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&(typeof e.startCanvas=="string"?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&(typeof e.contentLayer=="string"?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e))if(this.options.convertPropsToArray)e=[e];else return this.traverseType(e,t);return e.map(i=>this.traverseType(i,t))}traverseType(e,t){return t.reduce((i,r)=>{const s=r(i);return typeof s>"u"&&!this.options.allowUndefinedReturn?i:s},e)}}const Qj="http://library.stanford.edu/iiif/image-api/compliance.html#level0",MM="http://library.stanford.edu/iiif/image-api/compliance.html#level1",NM="http://library.stanford.edu/iiif/image-api/compliance.html#level2",eW="http://library.stanford.edu/iiif/image-api/conformance.html#level0",FM="http://library.stanford.edu/iiif/image-api/conformance.html#level1",BM="http://library.stanford.edu/iiif/image-api/conformance.html#level2",tW="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",UM="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",zM="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",iW="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",GM="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",HM="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",nW="http://iiif.io/api/image/1/level0.json",rW="http://iiif.io/api/image/1/profiles/level0.json",$M="http://iiif.io/api/image/1/level1.json",VM="http://iiif.io/api/image/1/profiles/level1.json",jM="http://iiif.io/api/image/1/level2.json",WM="http://iiif.io/api/image/1/profiles/level2.json",sW="http://iiif.io/api/image/2/level0.json",oW="http://iiif.io/api/image/2/profiles/level0.json",qM="http://iiif.io/api/image/2/level1.json",KM="http://iiif.io/api/image/2/profiles/level1.json",ZM="http://iiif.io/api/image/2/level2.json",YM="http://iiif.io/api/image/2/profiles/level2.json",aW="level0",XM="level1",JM="level2",lW="http://iiif.io/api/image/2/level0",QM="http://iiif.io/api/image/2/level1",eN="http://iiif.io/api/image/2/level2",cW=[QM,eN,MM,NM,FM,BM,UM,zM,GM,HM,$M,VM,jM,WM,qM,KM,ZM,YM,XM,JM],uW=[lW,QM,eN,Qj,MM,NM,eW,FM,BM,tW,UM,zM,iW,GM,HM,nW,rW,$M,VM,jM,WM,sW,oW,qM,KM,ZM,YM,aW,XM,JM],iS={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function zc(n,e="none"){if(!n)return{};const t=Array.isArray(n)?n:[n],i={};for(const r of t){if(typeof r=="string"){i[e]=i[e]?i[e]:[],i[e].push(r||"");continue}if(!r["@language"]){i[e]=i[e]?i[e]:[],i[e].push(r["@value"]||"");continue}const s=r["@language"];i[s]=i[s]?i[s]:[],i[s].push(r["@value"]||"")}return i}function tN(n){if(Array.isArray(n))return tN(n.find(e=>typeof e=="string"));if(uW.indexOf(n)!==-1)return"level2";if(cW.indexOf(n)!==-1)return"level1";if(typeof n=="string")return n}function hW(n){const e=Array.isArray(n)?n:[n];for(const t of e)switch(t){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function dW(n){switch(n){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function SL(n){for(const e of["sc","oa","dcterms","dctypes","iiif"])if(n.startsWith(`${e}:`))return n.slice(e.length+1);return n}const fW=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function xx(n){const e=n["@id"]||n.id;let t=n["@type"]||n.type;const i=n.profile||void 0,r=n["@context"]||void 0;if(i){const s=dW(i);if(s)return s}if(r){const s=hW(r);if(s)return s}if(t){if(Array.isArray(t)){if(t.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(t.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";t=t[0]}for(const s of["sc","oa","dcterms","dctypes","iiif"])if(t.startsWith(`${s}:`)){t=t.slice(s.length+1);break}switch(t){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(t&&fW.indexOf(t)!==-1)return t;if(n.format){if(n.format.startsWith("image/"))return"Image";if(n.format.startsWith("text/")||n.format==="application/pdf")return"Text";if(n.format.startsWith("application/"))return"Dataset"}return e&&(e.endsWith(".jpg")||e.endsWith(".png")||e.endsWith(".jpeg"))?"Image":t||"unknown"}const pW=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function gW(n){const e=n.match(pW);return e?e[0]:n}function mW(n,e="Rights/License",t="none"){let i=null;const r=[],s=Array.isArray(n)?n:[n];for(const o of s){const a=o?gW(o):void 0;if(a&&(a.indexOf("creativecommons.org")!==-1||a.indexOf("rightsstatements.org")!==-1)){a.startsWith("https://")?i=`http://${a.slice(8)}`:i=a;continue}a&&r.push({label:{[t]:[e]},value:{[t]:[a]}})}return[i,r]}const vW=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function yW(n){if(n){const e=Array.isArray(n)?n:[n],t=[];for(const i of e)i==="http://iiif.io/api/presentation/2/context.json"&&t.push("http://iiif.io/api/presentation/3/context.json"),vW.indexOf(i)===-1&&t.push(i);if(e.length)return t.length===1?t[0]:t}}function _W(n){return n?n.map(e=>({label:zc(e.label),value:zc(e.value)})):[]}function _a(n){for(const e in n)(typeof n[e]>"u"||n[e]===null)&&delete n[e];return n}let bL=0;function iN(n,e){const t=encodeURI(n.id||n["@id"]||"").trim();return t&&e?`${t}/${e}`:t||(bL++,`http://example.org/${n["@type"]}${e?`/${e}`:""}/${bL}`)}function Ea(n){const e=[...n.behavior||[]];n.viewingHint&&e.push(n.viewingHint);let t;return Array.isArray(n.motivation)?t=n.motivation.map(SL):n.motivation&&(t=SL(n.motivation)),{"@context":n["@context"]?yW(n["@context"]):void 0,id:(n["@id"]||iN(n)).trim(),type:xx(n),behavior:e.length?e:void 0,height:n.height?n.height:void 0,width:n.width?n.width:void 0,motivation:t,viewingDirection:n.viewingDirection,profile:n.profile,format:n.format?n.format:void 0,duration:void 0,timeMode:void 0}}function wa(n){const[e,t]=mW(n.license),i=[...n.metadata?_W(n.metadata):[],...t];return{rights:e,metadata:i.length?i:void 0,label:n.label?zc(n.label):void 0,requiredStatement:n.attribution?{label:zc(iS.attributionLabel),value:zc(n.attribution)}:void 0,navDate:n.navDate,summary:n.description?zc(n.description):void 0,thumbnail:n.thumbnail}}function EW(n){if(!n.within)return;const e=Array.isArray(n.within)?n.within:[n.within],t=[];for(const i of e)if(typeof i=="string"){if(i)switch(n["@type"]){case"sc:Manifest":t.push({id:i,type:"Collection"});break}}else i["@id"]&&t.push({id:i["@id"],type:xx(i)});return t.length?t:void 0}function $l(n){const e=n.related?Array.isArray(n.related)?n.related:[n.related]:[],t=n.contentLayer;return{provider:n.logo||e.length?[{id:iS.providerId,type:"Agent",homepage:e.length?[e[0]]:void 0,logo:n.logo?Array.isArray(n.logo)?n.logo:[n.logo]:void 0,label:zc(iS.providerName)}]:void 0,partOf:EW(n),rendering:n.rendering,seeAlso:n.seeAlso,start:n.startCanvas,service:n.service?tS(n.service):void 0,supplementary:t?[t]:void 0}}function wW(n){return{chars:n.chars,format:n.format?n.format:void 0,language:n.language}}function TW(n){return _a({...Ea(n),...wa(n),...$l(n),items:n.members})}function SW(n){const e=[],t=[];for(const r of n.sequences||[])r.canvases.length&&e.push(...r.canvases),r.behavior&&t.push(...r.behavior);const i=Ea(n);return t.length&&(i.behavior?i.behavior.push(...t):i.behavior=t),_a({...i,...wa(n),...$l(n),items:e,structures:n.structures})}function bW(n){return _a({...Ea(n),...wa(n),...$l(n),annotations:n.otherContent&&n.otherContent.length?n.otherContent:void 0,items:n.images&&n.images.length?[{id:iN(n,"annotation-page"),type:"AnnotationPage",items:n.images}]:void 0})}function xW(n){return _a({...Ea(n),...wa(n),...$l(n),items:n.resources&&n.resources.length?n.resources:void 0})}function CW(n){return!n.canvases||n.canvases.length===0?{canvases:[],behavior:[]}:{canvases:n.canvases,behavior:n.viewingHint?[n.viewingHint]:[]}}function RW(n){function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if(typeof t=="string")return encodeURI(t).trim();if("@type"in t){let i;if(typeof t.full=="string")i=t.full;else if(t.full["@type"]==="dctypes:Image")i={id:t.full["@id"],type:"Image"};else if(t.full["@type"]==="sc:Canvas")i={id:t.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:i,selector:rS(t.selector)}}else return encodeURI(t["@id"]).trim()}return _a({...Ea(n),...wa(n),...$l(n),target:e(n.on),body:Array.isArray(n.resource)?n.resource.map(nS):nS(n.resource)})}function nS(n){const e=n;return _a({...Ea(e),...wa(e),...$l(e),...wW(e)})}function AW(n){const e=[];return n.default&&n.default!=="rdf:nil"&&e.push(n.default),n.item&&n.item!=="rdf:nil"&&e.push(...n.item),{...Ea(n),...wa(n),items:e}}function LW(n){return _a({...Ea(n),...wa(n),...$l(n),items:n.members})}function IW(n){const{"@id":e,"@type":t,"@context":i,profile:r,...s}=n,o={};return e&&(o["@id"]=e),o["@type"]=xx(n),o["@type"]==="unknown"&&(i&&i.length&&(o["@context"]=i),o["@type"]="Service"),r&&(o.profile=tN(r)),_a({...o,...s})}function PW(n){return _a({...Ea(n),...wa(n),...$l(n)})}const DW=new bx({collection:[TW],manifest:[SW],canvas:[bW],annotationList:[xW],sequence:[CW],annotation:[RW],contentResource:[nS],choice:[AW],range:[LW],service:[IW],layer:[PW]});function OW(n){return n&&n["@context"]&&(n["@context"]==="http://iiif.io/api/presentation/2/context.json"||n["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||n["@context"]==="http://www.shared-canvas.org/ns/context.json")||n["@context"]==="http://iiif.io/api/image/2/context.json"?DW.traverseUnknown(n):n}function rS(n){if((Array.isArray(n["@type"])&&n["@type"].includes("oa:SvgSelector")||n["@type"]=="oa:SvgSelector")&&("chars"in n||"value"in n))return{type:"SvgSelector",value:"chars"in n?n.chars:n.value};if(n["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:n.value};if(n["@type"]==="oa:Choice")return[rS(n.default),...(Array.isArray(n.item)?n.item:[n.item]).map(rS)];if(n["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in n?n.region:void 0,rotation:"rotation"in n?n.rotation:void 0};throw new Error(`Unsupported selector type: ${n["@type"]}`)}function kW(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function nN(n,e){if(typeof n=="string")return{id:n,type:e};if(!n.id)throw new Error(`Invalid resource does not have an ID (${e})`);return n}function MW(n){return(e,t)=>{const i=n[e]?n[e]:{};return r=>{const s=nN(r,t||e);return s&&s.id&&e?(i[s.id]=i[s.id]?NW(i[s.id],s):Object.assign({},s),{id:s.id,type:e==="ContentResource"?e:s.type}):s}}}function sS(n,e){if(!e)return n;if(Array.isArray(n)){if(!Array.isArray(e))throw new Error("Cannot merge array with non-array");const t=[...n];for(const i of e)if(i!=null)if(Array.isArray(i))t.push(i);else if(typeof i=="object"&&i.id&&i.type){const r=t.findIndex(s=>s.id===i.id&&s.type===i.type);r>=0&&(t[r]=sS(t[r],i))}else n.indexOf(i)===-1&&t.push(i);return t}else if(typeof n=="object"){if(Array.isArray(e)||typeof e!="object")throw new Error("Cannot merge object with non-object");const t={...n};for(const[i,r]of Object.entries(e)){const s=t[i];s===Xe||!s?t[i]=r:t[i]=sS(s,r)}return t}else if(n)return n;return e}function NW(n,e){if(typeof n=="string")return n;if(e.id!==n.id||e.type!==n.type)throw new Error("Can only merge entities with identical identifiers and type!");return sS({...n},e)}function FW(n){return(e,t)=>i=>{const{id:r,type:s}=nN(i,t||e);if(typeof r>"u")throw new Error("Found invalid entity without an ID.");return e==="ContentResource"?n[r]=e:n[r]=s,i}}function BW(n){const e=JSON.stringify(n);let t=5381,i=e.length;for(;i;)t=t*33^e.charCodeAt(--i);const s=(t>>>0).toString(16);return s.length%2?"0"+s:s}function ww(n){return e=>typeof e=="string"?{id:e,type:n}:e.id?e.type?e:{type:n,...e}:{id:`vault://${BW(e)}`,type:n,...e}}function mh(n){return e=>({...n,...e})}function vh(n){return Array.isArray(n)?n:[n]}function UW(n){return n.body&&(n.body=vh(n.body)),n.seeAlso&&(n.seeAlso=vh(n.seeAlso)),n.body&&(n.body=vh(n.body)),n.audience&&(n.audience=vh(n.audience)),n.accessibility&&(n.accessibility=vh(n.accessibility)),n.motivation&&(n.motivation=vh(n.motivation)),n}function zW(n){const e=OW(n),t=kW(),i={},r=MW(t),s=FW(i),a=new Sx({collection:[mh(qj),s("Collection"),r("Collection")],manifest:[mh(Kj),s("Manifest"),r("Manifest")],canvas:[mh(Wj),s("Canvas"),r("Canvas")],annotationPage:[ww("AnnotationPage"),mh(jj),s("AnnotationPage"),r("AnnotationPage")],annotation:[ww("Annotation"),UW,s("Annotation"),r("Annotation")],contentResource:[ww("ContentResource"),s("ContentResource"),r("ContentResource")],range:[mh(Zj),s("Range","Canvas"),r("Range","Canvas")],agent:[mh(Yj),s("Agent"),r("Agent")]}).traverseUnknown(e);return{entities:t,resource:a,mapping:i}}const Oc="__$UNSET$__",rN="__$UNWRAP$__";function GW(n,e){const t=n.requests[e],i=n.mapping[e];if(!(!i||t&&t.resourceUri&&!n.entities[i][t.resourceUri]))return n.entities[i][t?t.resourceUri:e]}function HW(n){const e={};for(const[t,i]of n){if(t===rN&&i!==Oc)return i;i!==Oc&&typeof i<"u"&&i!==null&&(e[t]=i)}return e}function $W(n,e,t){if(!e.type||!e.id)throw new Error("Unknown entity");if(!t[e.type])throw new Error(`Serializer not found for ${e.type}`);function i(r){const s=t[r.type];if(!s)return Oc;const o=GW(n,r.id)||(r.id&&r.type?r:null);if(!o)return Oc;const a=s(o,n,{isTopLevel:e.id===r.id});let l=a.next();for(;!l.done;){const c=l.value;let u=Oc;if(c)if(Array.isArray(c)){const f=[];for(const p of c)f.push(i(p));u=f}else u=i(c);l=a.next(u)}return l.value===Oc?Oc:HW(l.value)}return i(e)}function Fh(n){if(!n)return;const e=Object.keys(n);if(e.length!==0){if(e.length===1){const t=e[0];if(!t)return"";const i=(n[t]||[]).join("");return t==="@none"||t==="none"||t==="en"?i:{"@language":t,"@value":i}}return e.map(t=>({"@language":t,"@value":(n[t]||[]).join("")}))}}function sN(n){return Array.isArray(n)?n.map(e=>sN(e)):typeof n=="string"?n:n.type&&n.type==="Canvas"?n.id:n}function bl(n,e=!1){if(n)return n.length>1&&!e?n:n[0]||void 0}function VW(n){if(n){if(typeof n=="string")return{"@id":n};if("@id"in n){const e={...n};return delete e["@type"],e}return{"@context":"http://iiif.io/api/image/2/context.json","@id":n.id,profile:`http://iiif.io/api/image/2/profiles/${n.profile}.json`}}}function xc(n,e){return[["@id",n.id],["@type",e],["format",n.format],["height",n.height],["width",n.width],["viewingDirection",n.viewingDirection!=="left-to-right"?n.viewingDirection:void 0]]}function*Cc(n){const e=n.provider?yield n.provider[0]:void 0;return[["label",Fh(n.label)],["metadata",n.metadata&&n.metadata.length?n.metadata.map(t=>({label:Fh(t.label)||"",value:Fh(t.value)||""})):void 0],["description",Fh(n.summary)],["thumbnail",bl(yield n.thumbnail)],["navDate",n.navDate],["logo",e?bl(e.logo):void 0],["homepage",e?e.homepage:void 0],["attribution",n.requiredStatement?Fh(n.requiredStatement.value):void 0]]}function*Zf(n){return[["seeAlso",bl(yield n.seeAlso)],["service",bl((n.service||[]).map(VW))],["rendering",bl(yield n.rendering)],["startCanvas",n.start?n.start.id:void 0]]}const jW={Manifest:function*(n){return[...xc(n,"sc:Manifest"),...yield*Cc(n),...yield*Zf(n),["sequences",[{"@id":`${n.id}/sequence0`,"@type":"sc:Sequence",canvases:yield n.items}]],["structures",yield n.structures]]},Canvas:function*(n){const t=(yield n.items)[0];return[...xc(n,"sc:Canvas"),...yield*Cc(n),...yield*Zf(n),["images",t?[t.resources]:void 0],["annotations",n.annotations&&n.annotations.length?bl(yield n.annotations):void 0]]},AnnotationPage:function*(n){return[...xc(n,"sc:AnnotationList"),...yield*Cc(n),["resources",n.items&&n.items.length?bl(yield n.items):void 0]]},Annotation:function*(n){return[["@id",n.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",sN(n.target)],["resource",bl(yield n.body,!0)]]},ContentResource:function*(n){switch(n.type){case"Image":return[...xc(n,"dctypes:Image"),...yield*Cc(n),...yield*Zf(n)];case"Text":case"Dataset":default:return[...xc(n,void 0),...yield*Cc(n)]}},AnnotationCollection:function*(n){return[["@id",n.id],["@type","sc:Layer"],["label",Fh(n.label)]]},Collection:function*(n){return[...xc(n,"sc:Collection"),...yield*Cc(n),...yield*Zf(n),["members",yield*n.items]]},Range:function*(n){const e=[],t=[];if(n.items)for(const i of n.items){const r=yield i;e.push({"@id":i.id,"@type":i.type,label:r?r.label:void 0,within:n.id}),i.type==="Canvas"&&t.push(i.id)}return[...xc(n,"sc:Range"),...yield*Cc(n),...yield*Zf(n),["canvases",t.length===e.length?t:void 0],["members",t.length!==e.length?e:void 0]]}};function Rc(n){var e;return[["id",(e=n.id)!=null&&e.startsWith("vault://")?void 0:n.id],["type",n.type],["format",n.format],["profile",n.profile],["height",n.height],["width",n.width],["duration",n.duration||void 0],["viewingDirection",n.viewingDirection!=="left-to-right"?n.viewingDirection:void 0],["behavior",n.behavior&&n.behavior.length?n.behavior:void 0],["timeMode",n.timeMode],["motivation",Array.isArray(n.motivation)?n.motivation[0]:n.motivation]]}function cn(n){if(!(!n||n.length===0))return n}function oN(n){if(n&&n.type&&n.type==="ImageService2"){const{id:e,type:t,profile:i,...r}=n,s=typeof i=="string"?i:Array.isArray(i)?i.find(o=>typeof o=="string"):"";return{"@id":e,"@type":t,profile:s?s.startsWith("http")?s:`http://iiif.io/api/image/2/${s}.json`:"http://iiif.io/api/image/2/level0.json",...r}}return n}function xL(n){if(!(!n||n.length===0))return n.map(oN)}function*Ac(n){return[["label",n.label],["metadata",cn(n.metadata)],["summary",n.summary],["requiredStatement",n.requiredStatement],["rights",n.rights],["navDate",n.navDate],["language",n.language],["thumbnail",cn(yield n.thumbnail)],["placeholderCanvas",yield n.placeholderCanvas],["accompanyingCanvas",yield n.accompanyingCanvas],["provider",cn(yield n.provider)]]}function*Lc(n){return[["seeAlso",cn(yield n.seeAlso)],["service",xL(n.service)],["services",xL(n.services)],["rendering",cn(yield n.rendering)],["supplementary",cn(yield n.supplementary)],["homepage",cn(yield n.homepage)],["logo",cn(yield n.logo)],["partOf",cn(yield n.partOf)],["start",n.start]]}const WW={Manifest:function*(n,e,{isTopLevel:t}){return t?[["@context","http://iiif.io/api/presentation/3/context.json"],...Rc(n),...yield*Ac(n),...yield*Lc(n),["items",yield n.items],["structures",cn(yield n.structures)],["annotations",cn(yield n.annotations)]]:[...Rc(n),...yield*Ac(n)]},Canvas:function*(n){return[...Rc(n),...yield*Ac(n),...yield*Lc(n),["items",yield n.items],["annotations",cn(yield n.annotations)]]},Agent:function*(n){return[["id",n.id],["type","Agent"],["label",n.label],...yield*Lc(n)]},AnnotationPage:function*(n){return[...Object.entries(n).map(([t,i])=>[t,Array.isArray(i)?cn(i):i]).filter(([t,i])=>t!=="items"),...yield*Lc(n),["items",yield n.items]]},Service:function*(n){return[[rN,oN(n)]]},Annotation:function*(n){const e=Object.entries(n).map(([i,r])=>i==="motivation"?[i,Array.isArray(r)?r[0]:r]:[i,Array.isArray(r)?cn(r):r]).filter(([i])=>i!=="body"),t=yield n.body;return[...e,["body",t.length===1?t[0]:t]]},ContentResource:function*(n){return[...Rc(n),...yield*Ac(n),...yield*Lc(n),["annotations",cn(yield n.annotations)],["items",cn(yield n.items)]]},AnnotationCollection:function*(n){return[["id",n.id],["type","AnnotationCollection"],["label",n.label]]},Collection:function*(n,e,{isTopLevel:t}){return t?[["@context","http://iiif.io/api/presentation/3/context.json"],...Rc(n),...yield*Ac(n),...yield*Lc(n),["items",cn(yield n.items)]]:[...Rc(n),...yield*Ac(n)]},Range:function*(n){const e=[];for(const t of n.items)t.type==="Range"?e.push(yield t):e.push(t);return[...Rc(n),...yield*Ac(n),...yield*Lc(n),["items",e],["annotations",cn(yield n.annotations)]]}};function aN(n){return n==null}function lN(n){throw new Error("Argument "+n+" is empty.")}function qW(n){return typeof n=="string"||typeof n=="symbol"}function cN(n){return!qW(n)}function uN(n){throw new Error("Argument "+n+" is invalid, it should be an action type of type: string | symbol")}function KW(n,e){return aN(n)&&lN(1),cN(n)&&uN(1),Object.assign(function(){var t=e!=null?e.apply(void 0,arguments):void 0;return Object.assign({type:n},t)},{getType:function(){return n},toString:function(){return n}})}function bn(n,e,t){return aN(n)&&lN(1),cN(n)&&uN(1),function(){return KW(n,function(){var i=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1];return Object.assign({},i!==void 0&&{payload:i},{},r!==void 0&&{meta:r})})}}function Np(n){"@babel/helpers - typeof";return Np=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Np(n)}function ZW(n,e){if(Np(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(Np(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function YW(n){var e=ZW(n,"string");return Np(e)=="symbol"?e:e+""}function XW(n,e,t){return(e=YW(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function CL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function RL(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?CL(Object(t),!0).forEach(function(i){XW(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):CL(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function Mn(n){return"Minified Redux error #"+n+"; visit https://redux.js.org/Errors?code="+n+" for the full message or use the non-minified dev environment for full errors. "}var AL=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Tw=function(){return Math.random().toString(36).substring(7).split("").join(".")},Ny={INIT:"@@redux/INIT"+Tw(),REPLACE:"@@redux/REPLACE"+Tw(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+Tw()}};function JW(n){if(typeof n!="object"||n===null)return!1;for(var e=n;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}function hN(n,e,t){var i;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Mn(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Mn(1));return t(hN)(n,e)}if(typeof n!="function")throw new Error(Mn(2));var r=n,s=e,o=[],a=o,l=!1;function c(){a===o&&(a=o.slice())}function u(){if(l)throw new Error(Mn(3));return s}function f(_){if(typeof _!="function")throw new Error(Mn(4));if(l)throw new Error(Mn(5));var w=!0;return c(),a.push(_),function(){if(w){if(l)throw new Error(Mn(6));w=!1,c();var x=a.indexOf(_);a.splice(x,1),o=null}}}function p(_){if(!JW(_))throw new Error(Mn(7));if(typeof _.type>"u")throw new Error(Mn(8));if(l)throw new Error(Mn(9));try{l=!0,s=r(s,_)}finally{l=!1}for(var w=o=a,T=0;T<w.length;T++){var x=w[T];x()}return _}function m(_){if(typeof _!="function")throw new Error(Mn(10));r=_,p({type:Ny.REPLACE})}function y(){var _,w=f;return _={subscribe:function(x){if(typeof x!="object"||x===null)throw new Error(Mn(11));function C(){x.next&&x.next(u())}C();var I=w(C);return{unsubscribe:I}}},_[AL]=function(){return this},_}return p({type:Ny.INIT}),i={dispatch:p,subscribe:f,getState:u,replaceReducer:m},i[AL]=y,i}function QW(n){Object.keys(n).forEach(function(e){var t=n[e],i=t(void 0,{type:Ny.INIT});if(typeof i>"u")throw new Error(Mn(12));if(typeof t(void 0,{type:Ny.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Mn(13))})}function dN(n){for(var e=Object.keys(n),t={},i=0;i<e.length;i++){var r=e[i];typeof n[r]=="function"&&(t[r]=n[r])}var s=Object.keys(t),o;try{QW(t)}catch(a){o=a}return function(l,c){if(l===void 0&&(l={}),o)throw o;for(var u=!1,f={},p=0;p<s.length;p++){var m=s[p],y=t[m],_=l[m],w=y(_,c);if(typeof w>"u")throw c&&c.type,new Error(Mn(14));f[m]=w,u=u||w!==_}return u=u||s.length!==Object.keys(l).length,u?f:l}}function Fy(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.length===0?function(i){return i}:e.length===1?e[0]:e.reduce(function(i,r){return function(){return i(r.apply(void 0,arguments))}})}function LL(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(i){return function(){var r=i.apply(void 0,arguments),s=function(){throw new Error(Mn(15))},o={getState:r.getState,dispatch:function(){return s.apply(void 0,arguments)}},a=e.map(function(l){return l(o)});return s=Fy.apply(void 0,a)(r.dispatch),RL(RL({},r),{},{dispatch:s})}}}const fN="@iiif/IMPORT_ENTITIES",pN="@iiif/MODIFY_ENTITY_FIELD",gN="@iiif/REORDER_ENTITY_FIELD",mN="@iiif/ADD_REFERENCE",vN="@iiif/REMOVE_REFERENCE",yN=bn(fN)(),e7=bn(pN)(),t7=bn(gN)(),i7=bn(mN)(),n7=bn(vN)(),r7={importEntities:yN,modifyEntityField:e7,reorderEntityField:t7,addReference:i7,removeReference:n7},_N="@iiif/ADD_MAPPING",EN="@iiif/ADD_MAPPINGS",s7=bn(_N)(),o7=bn(EN)(),wN="@iiif/SET_META_VALUE",TN="@iiif/SET_META_VALUE_DYNAMIC",SN="@iiif/UNSET_META_VALUE",a7=bn(wN)(),l7=bn(TN)(),c7=bn(SN)(),IL={setMetaValue:a7,setMetaValueDynamic:l7,unsetMetaValue:c7},oS="RESOURCE_ERROR",bN="RESOURCE_LOADING",aS="RESOURCE_READY",xN="@iiif/REQUEST_RESOURCE",CN="@iiif/REQUEST_ERROR",RN="@iiif/REQUEST_MISMATCH",AN="@iiif/REQUEST_COMPLETE",LN="@iiif/REQUEST_OFFLINE_RESOURCE",u7=bn(xN)(),IN=bn(CN)(),h7=bn(RN)(),d7=bn(AN)();bn(LN)();const Cx="@iiif/BATCH",PN="@iiif/BATCH_IMPORT",lS=bn(Cx)();bn(PN)();const f7=(n,e)=>{const{entities:t,resource:i,mapping:r}=zW(e);if(i.id===void 0)return[IN({id:n,message:"ID is not defined in resource."})];const s=[yN({entities:t}),o7({mapping:r})];return i.id!==n&&(s.push(s7({id:n,type:i.type})),s.push(h7({requestId:n,actualId:i.id}))),s.push(d7({id:n})),s},PL=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function p7(n,e){return!!(n===e||PL(n)&&PL(e))}function DL(n,e){if(!Array.isArray(n)||!Array.isArray(e))return n===e;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!p7(n[t],e[t]))return!1;return!0}function Sw(n,e){const t=n.iiif.requests[e],i=n.iiif.mapping[e];if(!(!i||!n.iiif.entities[i][t.resourceUri]))return n.iiif.entities[i][t.resourceUri]}function OL(n,e,{waitTimeout:t=30}={}){return async(i,r)=>{const s=n.getState(),o=s.iiif.requests[i];if(o)switch(o.loadingState){case oS:break;case bN:{let a,l=!1;try{const c=await Promise.race([new Promise((u,f)=>{l||(a=n.subscribe(()=>{const p=n.getState();if(p.iiif.requests[i].loadingState===oS){f();return}if(p.iiif.requests[i].loadingState===aS){const m=Sw(p,i);m?u(m):f()}}))}),new Promise((u,f)=>setTimeout(()=>{l=!0,f()},t*60))]);if(a&&a(),c)return c}catch{a&&a();break}break}case aS:{const a=Sw(s,i);if(a)return a;break}}n.dispatch(u7({id:i}));try{const a=await e(i,r);!a.id&&!a["@id"]&&(a["@type"]&&(a["@id"]=i),a.id=i);const l=f7(i,a);return n.dispatch(lS({actions:l})),Sw(n.getState(),i)}catch(a){throw n.dispatch(IN({id:i,message:a.toString()})),a}}}function g7(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const m7=(n={},e)=>{switch(e.type){case _N:return{...n,[e.payload.id]:e.payload.type};case EN:return{...n,...e.payload.mapping};default:return n}};function bw(n,e,t,i){return!(!n[t]||!n[t][e]||!n[t][e][i]||!Array.isArray(n[t][e][i]))}function v7(n,e){const t={},i=[];for(const[r,s]of Object.entries(n||{})){i.push(r);const o=(e||{})[r];if(!o||o.length===0){t[r]=s;continue}t[r]=o}for(const[r,s]of Object.entries(e||{}))i.indexOf(r)===-1&&(t[r]=s);return t}const y7=(n=g7(),e)=>{var t;switch(e.type){case pN:{if(!n[e.payload.type]||!n[e.payload.type][e.payload.id])return n;const i=n[e.payload.type][e.payload.id];return typeof i=="string"?n:{...n,[e.payload.type]:{...n[e.payload.type],[e.payload.id]:{...i,[e.payload.key]:e.payload.value}}}}case gN:{if(!bw(n,e.payload.id,e.payload.type,e.payload.key))return n;const i=n[e.payload.type][e.payload.id];if(typeof i=="string")return n;const r=Array.from(i[e.payload.key]),[s]=r.splice(e.payload.startIndex,1);return r.splice(e.payload.endIndex,0,s),{...n,[e.payload.type]:{...n[e.payload.type],[e.payload.id]:{...i,[e.payload.key]:r}}}}case fN:{const i=Object.keys(e.payload.entities),r={...n};for(const s of i){const o=e.payload.entities[s],a={...n[s]||{}};let l=!1;const c=Object.keys(o||{})||[];if(o&&c){for(const u of c)l=!0,a[u]=n[s][u]?v7(n[s][u],o[u]):o[u];l&&(r[s]=a)}}return r}case mN:{if(!bw(n,e.payload.id,e.payload.type,e.payload.key))return n;const i=n[e.payload.type][e.payload.id],r=Array.from(i[e.payload.key]);return r.splice(e.payload.index||r.length+1,0,e.payload.reference),{...n,[e.payload.type]:{...n[e.payload.type],[e.payload.id]:{...i,[e.payload.key]:r}}}}case vN:{if(!bw(n,e.payload.id,e.payload.type,e.payload.key))return n;const i=n[e.payload.type][e.payload.id],r=Array.from(i[e.payload.key]),s=e.payload.index||r.findIndex(o=>o&&o.id===e.payload.reference.id);return s===-1||((t=r[s])==null?void 0:t.id)!==e.payload.reference.id?n:(r.splice(s,1),{...n,[e.payload.type]:{...n[e.payload.type],[e.payload.id]:{...i,[e.payload.key]:r}}})}default:return n}},_7=(n={},e)=>{switch(e.type){case xN:case LN:return{...n,[e.payload.id]:{requestUri:e.payload.id,loadingState:bN,uriMismatch:!1,resourceUri:e.payload.id}};case RN:return{...n,[e.payload.requestId]:{...n[e.payload.requestId]||{},uriMismatch:!0,resourceUri:e.payload.actualId},[e.payload.actualId]:{requestUri:e.payload.requestId,loadingState:n[e.payload.requestId].loadingState,uriMismatch:!0,resourceUri:e.payload.actualId}};case CN:return{...n,[e.payload.id]:{...n[e.payload.id]||{},loadingState:oS,error:e.payload.message}};case AN:return{...n,[e.payload.id]:{...n[e.payload.id]||{},loadingState:aS,error:void 0}}}return n},E7=(n={},e)=>{const{id:t,updateValue:i,value:r,meta:s,key:o}=e&&e.payload||{};switch(e.type){case wN:return{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[o]:r}}};case TN:return{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[o]:n[t]&&n[t][s]?i(n[t][s][o]):i(void 0)}}};case SN:return n[t]&&n[t][s]&&n[t][s][o]?{...n,[t]:{...n[t]||{},[s]:{...n[t]?n[t][s]||{}:{},[o]:void 0}}}:n;default:return n}};function w7(n){return(e,t)=>t&&t.type===Cx?t.payload.actions.reduce(n,e):t&&t.type===PN?t.payload.state:n(e,t)}const T7=dN({mapping:m7,entities:y7,requests:_7,meta:E7}),S7=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Fy;function b7(n={}){const{enableDevtools:e=!0,iiifStoreName:t="iiif",defaultState:i={},extraMiddleware:r=[],customReducers:s={}}=n,o=dN({[t]:T7,...s});return hN(w7(o),i,e?S7(LL(...r)):Fy(LL(...r)))}function x7(n){return{all:n=n||new Map,on:function(e,t){var i=n.get(e);i?i.push(t):n.set(e,[t])},off:function(e,t){var i=n.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var i=n.get(e);i&&i.slice().map(function(r){r(t)}),(i=n.get("*"))&&i.slice().map(function(r){r(e,t)})}}}class Fp{constructor(e,t){wn(this,"options"),wn(this,"store"),wn(this,"emitter"),wn(this,"isBatching",!1),wn(this,"batchQueue",[]),wn(this,"remoteFetcher"),wn(this,"staticFetcher"),wn(this,"defaultFetcher",i=>fetch(i).then(r=>r.json())),wn(this,"middleware",i=>r=>s=>{if(s.type===Cx){for(const l of s.payload.actions)this.emitter.emit(l.type,{realAction:l,state:i.getState()});const a=r(s);for(const l of s.payload.actions)this.emitter.emit(`after:${s.type}`,{action:s,state:a});return a}this.emitter.emit(s.type,{action:s,state:i.getState()});const o=r(s);return this.emitter.emit(`after:${s.type}`,{action:s,state:o}),o}),this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||b7({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=x7(),this.remoteFetcher=OL(this.store,this.options.customFetcher),this.staticFetcher=OL(this.store,(i,r)=>r)}batch(e){this.isBatching=!0;try{e(this),this.store.dispatch(lS({actions:this.batchQueue}))}catch(t){throw this.batchQueue=[],this.isBatching=!1,t}this.batchQueue=[],this.isBatching=!1}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.store.dispatch(lS({actions:this.batchQueue}))}catch(t){throw this.batchQueue=[],this.isBatching=!1,t}this.batchQueue=[],this.isBatching=!1}modifyEntityField(e,t,i){this.dispatch(r7.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){this.isBatching?this.batchQueue.push(e):this.store.dispatch(e)}serialize(e,t){return $W(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,jW)}toPresentation3(e){return this.serialize(e,WW)}hydrate(e,t){return this.get(e,t,{skipSelfReturn:!1})}get(e,t,i={}){typeof t!="string"&&(i=t||{},t=void 0);const{skipSelfReturn:r=!0}=i||{};if(Array.isArray(e))return e.map(c=>this.get(c,i));const s=this.getState();if(typeof e=="string"){const c=t||s.iiif.mapping[e];if(!c)return r?null:{id:e,type:"unknown"};e={id:e,type:c}}const o=t||e.type,a=e.id,l=s.iiif.entities[o];if(!l){const c=s.iiif.requests[a];return c&&c.resourceUri!==a?this.get(c.resourceUri,i):r?null:e}return l[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(e,t){const i=typeof e=="string"?e:e.id;return this.load(i,t)}loadCollection(e,t){const i=typeof e=="string"?e:e.id;return this.load(i,t)}load(e,t){const i=typeof e=="string"?e:e.id;return t?this.staticFetcher(i,t):this.remoteFetcher(i)}areInputsEqual(e,t){return DL(e,t)}subscribe(e,t,i){typeof i>"u"&&(typeof t>"u"||t===!1||t===!0)&&(i=t,t=e,e=s=>s);let r=i?null:e(this.store.getState());return i||t(r,this),this.store.subscribe(()=>{const s=this.store.getState(),o=e(s);r!==o&&!DL(r,o)&&t(o,this),r=o})}async ensureLoaded(e){const t=typeof e=="string"?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getResourceMeta(e,t){const i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}setMetaValue([e,t,i],r){this.dispatch(typeof r=="function"?IL.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):IL.setMetaValue({id:e,meta:t,key:i,value:r}))}}let nv;const C7=new Uint8Array(16);function R7(){if(!nv&&(nv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!nv))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return nv(C7)}const _n=[];for(let n=0;n<256;++n)_n.push((n+256).toString(16).slice(1));function A7(n,e=0){return _n[n[e+0]]+_n[n[e+1]]+_n[n[e+2]]+_n[n[e+3]]+"-"+_n[n[e+4]]+_n[n[e+5]]+"-"+_n[n[e+6]]+_n[n[e+7]]+"-"+_n[n[e+8]]+_n[n[e+9]]+"-"+_n[n[e+10]]+_n[n[e+11]]+_n[n[e+12]]+_n[n[e+13]]+_n[n[e+14]]+_n[n[e+15]]}const L7=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),kL={randomUUID:L7};function Hd(n,e,t){if(kL.randomUUID&&!e&&!n)return kL.randomUUID();n=n||{};const i=n.random||(n.rng||R7)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,A7(i)}function Ze(){return Ze=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ze.apply(null,arguments)}function Dt(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function ks(n,e=[]){let t=[];function i(s,o){const a=M.createContext(o),l=t.length;t=[...t,o];function c(f){const{scope:p,children:m,...y}=f,_=(p==null?void 0:p[n][l])||a,w=M.useMemo(()=>y,Object.values(y));return M.createElement(_.Provider,{value:w},m)}function u(f,p){const m=(p==null?void 0:p[n][l])||a,y=M.useContext(m);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return c.displayName=s+"Provider",[c,u]}const r=()=>{const s=t.map(o=>M.createContext(o));return function(a){const l=(a==null?void 0:a[n])||s;return M.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return r.scopeName=n,[i,I7(r,...e)]}function I7(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const i=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:l,scopeName:c})=>{const f=l(s)[`__scope${c}`];return{...a,...f}},{});return M.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function go(n){const e=M.useRef(n);return M.useEffect(()=>{e.current=n}),M.useMemo(()=>(...t)=>{var i;return(i=e.current)===null||i===void 0?void 0:i.call(e,...t)},[])}function Dl({prop:n,defaultProp:e,onChange:t=()=>{}}){const[i,r]=P7({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:i,a=go(t),l=M.useCallback(c=>{if(s){const f=typeof c=="function"?c(n):c;f!==n&&a(f)}else r(c)},[s,n,r,a]);return[o,l]}function P7({defaultProp:n,onChange:e}){const t=M.useState(n),[i]=t,r=M.useRef(i),s=go(e);return M.useEffect(()=>{r.current!==i&&(s(i),r.current=i)},[i,r,s]),t}const Xn=globalThis!=null&&globalThis.document?M.useLayoutEffect:()=>{};function D7(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function DN(...n){return e=>n.forEach(t=>D7(t,e))}function vi(...n){return M.useCallback(DN(...n),n)}const gd=M.forwardRef((n,e)=>{const{children:t,...i}=n,r=M.Children.toArray(t),s=r.find(k7);if(s){const o=s.props.children,a=r.map(l=>l===s?M.Children.count(o)>1?M.Children.only(null):M.isValidElement(o)?o.props.children:null:l);return M.createElement(cS,Ze({},i,{ref:e}),M.isValidElement(o)?M.cloneElement(o,void 0,a):null)}return M.createElement(cS,Ze({},i,{ref:e}),t)});gd.displayName="Slot";const cS=M.forwardRef((n,e)=>{const{children:t,...i}=n;return M.isValidElement(t)?M.cloneElement(t,{...M7(i,t.props),ref:e?DN(e,t.ref):t.ref}):M.Children.count(t)>1?M.Children.only(null):null});cS.displayName="SlotClone";const O7=({children:n})=>M.createElement(M.Fragment,null,n);function k7(n){return M.isValidElement(n)&&n.type===O7}function M7(n,e){const t={...e};for(const i in e){const r=n[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?t[i]=(...a)=>{s(...a),r(...a)}:r&&(t[i]=r):i==="style"?t[i]={...r,...s}:i==="className"&&(t[i]=[r,s].filter(Boolean).join(" "))}return{...n,...t}}const N7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Gt=N7.reduce((n,e)=>{const t=M.forwardRef((i,r)=>{const{asChild:s,...o}=i,a=s?gd:e;return M.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),M.createElement(a,Ze({},o,{ref:r}))});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function F7(n,e){n&&du.flushSync(()=>n.dispatchEvent(e))}function B7(n,e){return M.useReducer((t,i)=>{const r=e[t][i];return r??t},n)}const z0=n=>{const{present:e,children:t}=n,i=U7(e),r=typeof t=="function"?t({present:i.isPresent}):M.Children.only(t),s=vi(i.ref,r.ref);return typeof t=="function"||i.isPresent?M.cloneElement(r,{ref:s}):null};z0.displayName="Presence";function U7(n){const[e,t]=M.useState(),i=M.useRef({}),r=M.useRef(n),s=M.useRef("none"),o=n?"mounted":"unmounted",[a,l]=B7(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return M.useEffect(()=>{const c=rv(i.current);s.current=a==="mounted"?c:"none"},[a]),Xn(()=>{const c=i.current,u=r.current;if(u!==n){const p=s.current,m=rv(c);n?l("MOUNT"):m==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&p!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=n}},[n,l]),Xn(()=>{if(e){const c=f=>{const m=rv(i.current).includes(f.animationName);f.target===e&&m&&du.flushSync(()=>l("ANIMATION_END"))},u=f=>{f.target===e&&(s.current=rv(i.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:M.useCallback(c=>{c&&(i.current=getComputedStyle(c)),t(c)},[])}}function rv(n){return(n==null?void 0:n.animationName)||"none"}const z7=Bj.useId||(()=>{});let G7=0;function Vl(n){const[e,t]=M.useState(z7());return Xn(()=>{n||t(i=>i??String(G7++))},[n]),n||(e?`radix-${e}`:"")}const ON="Collapsible",[H7,sme]=ks(ON),[$7,Rx]=H7(ON),V7=M.forwardRef((n,e)=>{const{__scopeCollapsible:t,open:i,defaultOpen:r,disabled:s,onOpenChange:o,...a}=n,[l=!1,c]=Dl({prop:i,defaultProp:r,onChange:o});return M.createElement($7,{scope:t,disabled:s,contentId:Vl(),open:l,onOpenToggle:M.useCallback(()=>c(u=>!u),[c])},M.createElement(Gt.div,Ze({"data-state":Ax(l),"data-disabled":s?"":void 0},a,{ref:e})))}),j7="CollapsibleTrigger",W7=M.forwardRef((n,e)=>{const{__scopeCollapsible:t,...i}=n,r=Rx(j7,t);return M.createElement(Gt.button,Ze({type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":Ax(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled},i,{ref:e,onClick:Dt(n.onClick,r.onOpenToggle)}))}),kN="CollapsibleContent",q7=M.forwardRef((n,e)=>{const{forceMount:t,...i}=n,r=Rx(kN,n.__scopeCollapsible);return M.createElement(z0,{present:t||r.open},({present:s})=>M.createElement(K7,Ze({},i,{ref:e,present:s})))}),K7=M.forwardRef((n,e)=>{const{__scopeCollapsible:t,present:i,children:r,...s}=n,o=Rx(kN,t),[a,l]=M.useState(i),c=M.useRef(null),u=vi(e,c),f=M.useRef(0),p=f.current,m=M.useRef(0),y=m.current,_=o.open||a,w=M.useRef(_),T=M.useRef();return M.useEffect(()=>{const x=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(x)},[]),Xn(()=>{const x=c.current;if(x){T.current=T.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const C=x.getBoundingClientRect();f.current=C.height,m.current=C.width,w.current||(x.style.transitionDuration=T.current.transitionDuration,x.style.animationName=T.current.animationName),l(i)}},[o.open,i]),M.createElement(Gt.div,Ze({"data-state":Ax(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!_},s,{ref:u,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0,...n.style}}),_&&r)});function Ax(n){return n?"open":"closed"}const Z7=V7,Y7=W7,X7=q7;var MN={exports:{}};(function(n){//! openseadragon 4.1.1
//! Built on 2024-04-01
//! Git commit: v4.1.1-0-f90d9814
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(t){return new e.Viewer(t)}(function(t){t.version={versionStr:"4.1.1",major:parseInt("4",10),minor:parseInt("1",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,s=Object.prototype.hasOwnProperty;t.isFunction=function(o){return t.type(o)==="function"},t.isArray=Array.isArray||function(o){return t.type(o)==="array"},t.isWindow=function(o){return o&&typeof o=="object"&&"setInterval"in o},t.type=function(o){return o==null?String(o):i[r.call(o)]||"object"},t.isPlainObject=function(o){if(!o||e.type(o)!=="object"||o.nodeType||t.isWindow(o)||o.constructor&&!s.call(o,"constructor")&&!s.call(o.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var l in o)a=l;return a===void 0||s.call(o,a)},t.isEmptyObject=function(o){for(var a in o)return!1;return!0},t.freezeObject=function(o){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(a){return a},t.freezeObject(o)},t.supportsCanvas=function(){var o=document.createElement("canvas");return!!(t.isFunction(o.getContext)&&o.getContext("2d"))}(),t.isCanvasTainted=function(o){var a=!1;try{o.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},t.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),t.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),t.supportsEventListenerOptions=function(){var o=0;if(t.supportsAddEventListener)try{var a={get capture(){return o++,!1},get once(){return o++,!1},get passive(){return o++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{o=0}return o>=3}(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var o=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,l=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return Math.max(a,1)/l}else return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(e),function(t){t.extend=function(){var l,c,u,f,p,m,y=arguments[0]||{},_=arguments.length,w=!1,T=1;for(typeof y=="boolean"&&(w=y,y=arguments[1]||{},T=2),typeof y!="object"&&!e.isFunction(y)&&(y={}),_===T&&(y=this,--T);T<_;T++)if(l=arguments[T],l!==null||l!==void 0)for(c in l){var x=Object.getOwnPropertyDescriptor(l,c);if(x!==void 0){if(x.get||x.set){Object.defineProperty(y,c,x);continue}f=x.value}else{t.console.warn('Could not copy inherited property "'+c+'".');continue}y!==f&&(w&&f&&(e.isPlainObject(f)||(p=e.isArray(f)))?(u=y[c],p?(p=!1,m=u&&e.isArray(u)?u:[]):m=u&&e.isPlainObject(u)?u:{},y[c]=e.extend(w,m,f)):f!==void 0&&(y[c]=f))}return y};var i=function(){if(typeof navigator!="object")return!1;var l=navigator.userAgent;return typeof l!="string"?!1:l.indexOf("iPhone")!==-1||l.indexOf("iPad")!==-1||l.indexOf("iPod")!==-1};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(l,c){return function(){var u=arguments;return u===void 0&&(u=[]),c.apply(l,u)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(l){return t._viewers.get(this.getElement(l))},getElement:function(l){return typeof l=="string"&&(l=document.getElementById(l)),l},getElementPosition:function(l){var c=new t.Point,u,f;for(l=t.getElement(l),u=t.getElementStyle(l).position==="fixed",f=a(l,u);f;)c.x+=l.offsetLeft,c.y+=l.offsetTop,u&&(c=c.plus(t.getPageScroll())),l=f,u=t.getElementStyle(l).position==="fixed",f=a(l,u);return c},getElementOffset:function(l){l=t.getElement(l);var c=l&&l.ownerDocument,u,f,p={top:0,left:0};return c?(u=c.documentElement,typeof l.getBoundingClientRect<"u"&&(p=l.getBoundingClientRect()),f=c===c.window?c:c.nodeType===9?c.defaultView||c.parentWindow:!1,new t.Point(p.left+(f.pageXOffset||u.scrollLeft)-(u.clientLeft||0),p.top+(f.pageYOffset||u.scrollTop)-(u.clientTop||0))):new t.Point},getElementSize:function(l){return l=t.getElement(l),new t.Point(l.clientWidth,l.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(l){return l=t.getElement(l),l.currentStyle}:function(l){return l=t.getElement(l),window.getComputedStyle(l,"")},getCssPropertyWithVendorPrefix:function(l){var c={};return t.getCssPropertyWithVendorPrefix=function(u){if(c[u]!==void 0)return c[u];var f=document.createElement("div").style,p=null;if(f[u]!==void 0)p=u;else for(var m=["Webkit","Moz","MS","O","webkit","moz","ms","o"],y=t.capitalizeFirstLetter(u),_=0;_<m.length;_++){var w=m[_]+y;if(f[w]!==void 0){p=w;break}}return c[u]=p,p},t.getCssPropertyWithVendorPrefix(l)},capitalizeFirstLetter:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},positiveModulo:function(l,c){var u=l%c;return u<0&&(u+=c),u},pointInElement:function(l,c){l=t.getElement(l);var u=t.getElementOffset(l),f=t.getElementSize(l);return c.x>=u.x&&c.x<u.x+f.x&&c.y<u.y+f.y&&c.y>=u.y},getMousePosition:function(l){if(typeof l.pageX=="number")t.getMousePosition=function(c){var u=new t.Point;return u.x=c.pageX,u.y=c.pageY,u};else if(typeof l.clientX=="number")t.getMousePosition=function(c){var u=new t.Point;return u.x=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,u.y=c.clientY+document.body.scrollTop+document.documentElement.scrollTop,u};else throw new Error("Unknown event mouse position, no known technique.");return t.getMousePosition(l)},getPageScroll:function(){var l=document.documentElement||{},c=document.body||{};if(typeof window.pageXOffset=="number")t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(c.scrollLeft||c.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else if(l.scrollLeft||l.scrollTop)t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new t.Point(0,0);return t.getPageScroll()},setPageScroll:function(l){if(typeof window.scrollTo<"u")t.setPageScroll=function(f){window.scrollTo(f.x,f.y)};else{var c=t.getPageScroll();if(c.x===l.x&&c.y===l.y)return;document.body.scrollLeft=l.x,document.body.scrollTop=l.y;var u=t.getPageScroll();if(u.x!==c.x&&u.y!==c.y){t.setPageScroll=function(f){document.body.scrollLeft=f.x,document.body.scrollTop=f.y};return}if(document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y,u=t.getPageScroll(),u.x!==c.x&&u.y!==c.y){t.setPageScroll=function(f){document.documentElement.scrollLeft=f.x,document.documentElement.scrollTop=f.y};return}t.setPageScroll=function(f){}}t.setPageScroll(l)},getWindowSize:function(){var l=document.documentElement||{},c=document.body||{};if(typeof window.innerWidth=="number")t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(l.clientWidth||l.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(c.clientWidth||c.clientHeight)t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return t.getWindowSize()},makeCenteredNode:function(l){l=t.getElement(l);var c=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(c[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(c[1].style,{display:"table-row"}),t.extend(c[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),c[0].appendChild(c[1]),c[1].appendChild(c[2]),c[2].appendChild(l),c[0]},makeNeutralElement:function(l){var c=document.createElement(l),u=c.style;return u.background="transparent none",u.border="none",u.margin="0px",u.padding="0px",u.position="static",c},now:function(){return Date.now?t.now=Date.now:t.now=function(){return new Date().getTime()},t.now()},makeTransparentImage:function(l){var c=t.makeNeutralElement("img");return c.src=l,c},setElementOpacity:function(l,c,u){var f,p;l=t.getElement(l),u&&!t.Browser.alpha&&(c=Math.round(c)),t.Browser.opacity?l.style.opacity=c<1?c:"":c<1?(f=Math.round(100*c),p="alpha(opacity="+f+")",l.style.filter=p):l.style.filter=""},setElementTouchActionNone:function(l){l=t.getElement(l),typeof l.style.touchAction<"u"?l.style.touchAction="none":typeof l.style.msTouchAction<"u"&&(l.style.msTouchAction="none")},setElementPointerEvents:function(l,c){l=t.getElement(l),typeof l.style<"u"&&typeof l.style.pointerEvents<"u"&&(l.style.pointerEvents=c)},setElementPointerEventsNone:function(l){t.setElementPointerEvents(l,"none")},addClass:function(l,c){l=t.getElement(l),l.className?(" "+l.className+" ").indexOf(" "+c+" ")===-1&&(l.className+=" "+c):l.className=c},indexOf:function(l,c,u){return Array.prototype.indexOf?this.indexOf=function(f,p,m){return f.indexOf(p,m)}:this.indexOf=function(f,p,m){var y,_=m||0,w;if(!f)throw new TypeError;if(w=f.length,w===0||_>=w)return-1;for(_<0&&(_=w-Math.abs(_)),y=_;y<w;y++)if(f[y]===p)return y;return-1},this.indexOf(l,c,u)},removeClass:function(l,c){var u,f=[],p;for(l=t.getElement(l),u=l.className.split(/\s+/),p=0;p<u.length;p++)u[p]&&u[p]!==c&&f.push(u[p]);l.className=f.join(" ")},normalizeEventListenerOptions:function(l){var c;return typeof l<"u"?typeof l=="boolean"?c=t.supportsEventListenerOptions?{capture:l}:l:c=t.supportsEventListenerOptions?l:typeof l.capture<"u"?l.capture:!1:c=t.supportsEventListenerOptions?{capture:!1}:!1,c},addEvent:function(){if(t.supportsAddEventListener)return function(l,c,u,f){f=t.normalizeEventListenerOptions(f),l=t.getElement(l),l.addEventListener(c,u,f)};if(document.documentElement.attachEvent&&document.attachEvent)return function(l,c,u){l=t.getElement(l),l.attachEvent("on"+c,u)};throw new Error("No known event model.")}(),removeEvent:function(){if(t.supportsRemoveEventListener)return function(l,c,u,f){f=t.normalizeEventListenerOptions(f),l=t.getElement(l),l.removeEventListener(c,u,f)};if(document.documentElement.detachEvent&&document.detachEvent)return function(l,c,u){l=t.getElement(l),l.detachEvent("on"+c,u)};throw new Error("No known event model.")}(),cancelEvent:function(l){l.preventDefault()},eventIsCanceled:function(l){return l.defaultPrevented},stopEvent:function(l){l.stopPropagation()},createCallback:function(l,c){var u=[],f;for(f=2;f<arguments.length;f++)u.push(arguments[f]);return function(){var p=u.concat([]),m;for(m=0;m<arguments.length;m++)p.push(arguments[m]);return c.apply(l,p)}},getUrlParameter:function(l){var c=o[l];return c||null},getUrlProtocol:function(l){var c=l.match(/^([a-z]+:)\/\//i);return c===null?window.location.protocol:c[1].toLowerCase()},createAjaxRequest:function(l){var c;try{c=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{c=!1}if(c)window.XMLHttpRequest?t.createAjaxRequest=function(u){return u?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:t.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)t.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return t.createAjaxRequest(l)},makeAjaxRequest:function(l,c,u){var f,p,m,y;t.isPlainObject(l)&&(c=l.success,u=l.error,f=l.withCredentials,p=l.headers,m=l.responseType||null,y=l.postData||null,l=l.url);var _=t.getUrlProtocol(l),w=t.createAjaxRequest(_==="file:");if(!t.isFunction(c))throw new Error("makeAjaxRequest requires a success callback");w.onreadystatechange=function(){w.readyState===4&&(w.onreadystatechange=function(){},w.status>=200&&w.status<300||w.status===0&&_!=="http:"&&_!=="https:"?c(w):t.isFunction(u)?u(w):t.console.error("AJAX request returned %d: %s",w.status,l))};var T=y?"POST":"GET";try{if(w.open(T,l,!0),m&&(w.responseType=m),p)for(var x in p)Object.prototype.hasOwnProperty.call(p,x)&&p[x]&&w.setRequestHeader(x,p[x]);f&&(w.withCredentials=!0),w.send(y)}catch(C){t.console.error("%s while making AJAX request: %s",C.name,C.message),w.onreadystatechange=function(){},t.isFunction(u)&&u(w,C)}return w},jsonp:function(l){var c,u=l.url,f=document.head||document.getElementsByTagName("head")[0]||document.documentElement,p=l.callbackName||"openseadragon"+t.now(),m=window[p],y="$1"+p+"$2",_=l.param||"callback",w=l.callback;u=u.replace(/(=)\?(&|$)|\?\?/i,y),u+=(/\?/.test(u)?"&":"?")+_+"="+p,window[p]=function(T){if(m)window[p]=m;else try{delete window[p]}catch{}w&&t.isFunction(w)&&w(T)},c=document.createElement("script"),(l.async!==void 0||l.async!==!1)&&(c.async="async"),l.scriptCharset&&(c.charset=l.scriptCharset),c.src=u,c.onload=c.onreadystatechange=function(T,x){(x||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,f&&c.parentNode&&f.removeChild(c),c=void 0)},f.insertBefore(c,f.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(l){if(window.DOMParser)t.parseXml=function(c){var u=null,f;return f=new DOMParser,u=f.parseFromString(c,"text/xml"),u};else if(window.ActiveXObject)t.parseXml=function(c){var u=null;return u=new ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(c),u};else throw new Error("Browser doesn't support XML DOM.");return t.parseXml(l)},parseJSON:function(l){return t.parseJSON=window.JSON.parse,t.parseJSON(l)},imageFormatSupported:function(l){return l=l||"",!!s[l.toLowerCase()]},setImageFormatsSupported:function(l){t.extend(s,l)}});var r=function(l){};t.console=window.console||{log:r,debug:r,info:r,warn:r,error:r,assert:r},t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var s={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},o={};(function(){var l=navigator.appVersion,c=navigator.userAgent,u;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(c.indexOf("Edge")>=0?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(c.substring(c.indexOf("Edge")+5))):c.indexOf("Edg")>=0?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(c.substring(c.indexOf("Edg")+4))):c.indexOf("Firefox")>=0?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):c.indexOf("Safari")>=0?(t.Browser.vendor=c.indexOf("Chrome")>=0?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):(u=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),u.exec(c)!==null&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(l);break}var f=window.location.search.substring(1),p=f.split("&"),m,y,_;for(_=0;_<p.length;_++)if(m=p[_],y=m.indexOf("="),y>0){var w=m.substring(0,y),T=m.substring(y+1);try{o[w]=decodeURIComponent(T)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",w,T)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<11&&t.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(l){var c=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame||l.msRequestAnimationFrame,u=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame||l.msCancelAnimationFrame;if(c&&u)t.requestAnimationFrame=function(){return c.apply(l,arguments)},t.cancelAnimationFrame=function(){return u.apply(l,arguments)};else{var f=[],p=[],m=0,y;t.requestAnimationFrame=function(_){return f.push([++m,_]),y||(y=setInterval(function(){if(f.length){var w=t.now(),T=p;for(p=f,f=T;p.length;)p.shift()[1](w)}else clearInterval(y),y=void 0},1e3/50)),m},t.cancelAnimationFrame=function(_){var w,T;for(w=0,T=f.length;w<T;w+=1)if(f[w][0]===_){f.splice(w,1);return}for(w=0,T=p.length;w<T;w+=1)if(p[w][0]===_){p.splice(w,1);return}}}}(window);function a(l,c){return c&&l!==document.body?document.body:l.offsetParent}}(e),function(t,i){n.exports?n.exports=i():t.OpenSeadragon=i()}(wt,function(){return e}),function(t){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(r){return r.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(r){return r.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(r){return r.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},t.extend(t,i)}(e),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(i,r,s,o,a){var l=this;o=o||1;var c=0,u=function(f){return c++,c===o&&l.removeHandler(i,u),r(f)};this.addHandler(i,u,s,a)},addHandler:function(i,r,s,o){var a=this.events[i];if(a||(this.events[i]=a=[]),r&&t.isFunction(r)){var l=a.length,c={handler:r,userData:s||null,priority:o||0};for(a[l]=c;l>0&&a[l-1].priority<a[l].priority;)a[l]=a[l-1],a[l-1]=c,l--}},removeHandler:function(i,r){var s=this.events[i],o=[],a;if(s&&t.isArray(s)){for(a=0;a<s.length;a++)s[a].handler!==r&&o.push(s[a]);this.events[i]=o}},numberOfHandlers:function(i){var r=this.events[i];return r?r.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var r in this.events)this.events[r]=[]},getHandler:function(i){var r=this.events[i];return!r||!r.length?null:(r=r.length===1?[r[0]]:Array.apply(null,r),function(s,o){var a,l=r.length;for(a=0;a<l;a++)r[a]&&(o.eventSource=s,o.userData=r[a].userData,r[a].handler(o))})},raiseEvent:function(i,r){var s=this.getHandler(i);if(s)return s(this,r||{})}}}(e),function(t){var i={};t.MouseTracker=function(G){var U=arguments;t.isPlainObject(G)||(G={element:U[0],clickTimeThreshold:U[1],clickDistThreshold:U[2]}),this.hash=Math.random(),this.element=t.getElement(G.element),this.clickTimeThreshold=G.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=G.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=G.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=G.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=G.userData||null,this.stopDelay=G.stopDelay||50,this.preProcessEventHandler=G.preProcessEventHandler||null,this.contextMenuHandler=G.contextMenuHandler||null,this.enterHandler=G.enterHandler||null,this.leaveHandler=G.leaveHandler||null,this.exitHandler=G.exitHandler||null,this.overHandler=G.overHandler||null,this.outHandler=G.outHandler||null,this.pressHandler=G.pressHandler||null,this.nonPrimaryPressHandler=G.nonPrimaryPressHandler||null,this.releaseHandler=G.releaseHandler||null,this.nonPrimaryReleaseHandler=G.nonPrimaryReleaseHandler||null,this.moveHandler=G.moveHandler||null,this.scrollHandler=G.scrollHandler||null,this.clickHandler=G.clickHandler||null,this.dblClickHandler=G.dblClickHandler||null,this.dragHandler=G.dragHandler||null,this.dragEndHandler=G.dragEndHandler||null,this.pinchHandler=G.pinchHandler||null,this.stopHandler=G.stopHandler||null,this.keyDownHandler=G.keyDownHandler||null,this.keyUpHandler=G.keyUpHandler||null,this.keyHandler=G.keyHandler||null,this.focusHandler=G.focusHandler||null,this.blurHandler=G.blurHandler||null;var K=this;i[this.hash]={click:function(re){C(K,re)},dblclick:function(re){I(K,re)},keydown:function(re){D(K,re)},keyup:function(re){B(K,re)},keypress:function(re){N(K,re)},focus:function(re){z(K,re)},blur:function(re){Z(K,re)},contextmenu:function(re){q(K,re)},wheel:function(re){H(K,re)},mousewheel:function(re){Y(K,re)},DOMMouseScroll:function(re){Y(K,re)},MozMousePixelScroll:function(re){Y(K,re)},losecapture:function(re){le(K,re)},mouseenter:function(re){_e(K,re)},mouseleave:function(re){fe(K,re)},mouseover:function(re){pe(K,re)},mouseout:function(re){Ce(K,re)},mousedown:function(re){xe(K,re)},mouseup:function(re){Le(K,re)},mousemove:function(re){lt(K,re)},touchstart:function(re){W(K,re)},touchend:function(re){ie(K,re)},touchmove:function(re){ne(K,re)},touchcancel:function(re){J(K,re)},gesturestart:function(re){ce(K,re)},gesturechange:function(re){se(K,re)},gotpointercapture:function(re){te(K,re)},lostpointercapture:function(re){Q(K,re)},pointerenter:function(re){_e(K,re)},pointerleave:function(re){fe(K,re)},pointerover:function(re){pe(K,re)},pointerout:function(re){Ce(K,re)},pointerdown:function(re){xe(K,re)},pointerup:function(re){Le(K,re)},pointermove:function(re){lt(K,re)},pointercancel:function(re){Vt(K,re)},pointerupcaptured:function(re){je(K,re)},pointermovecaptured:function(re){ct(K,re)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),G.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){l(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(G){return G?a(this):l(this),this},getActivePointersListByType:function(G){var U=i[this.hash],K,re=U.activePointersLists.length,Re;for(K=0;K<re;K++)if(U.activePointersLists[K].type===G)return U.activePointersLists[K];return Re=new t.MouseTracker.GesturePointList(G),U.activePointersLists.push(Re),Re},getActivePointerCount:function(){var G=i[this.hash],U,K=G.activePointersLists.length,re=0;for(U=0;U<K;U++)re+=G.activePointersLists[U].getLength();return re},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var r=function(){try{return window.self!==window.top}catch{return!0}}();function s(G){try{return G.addEventListener&&G.removeEventListener}catch{return!1}}t.MouseTracker.gesturePointVelocityTracker=function(){var G=[],U=0,K=0,re=function(Nt,tt){return Nt.hash.toString()+tt.type+tt.id.toString()},Re=function(){var Nt,tt=G.length,Di,si,ji=t.now(),Qi,en,Fs;for(Qi=ji-K,K=ji,Nt=0;Nt<tt;Nt++)Di=G[Nt],si=Di.gPoint,si.direction=Math.atan2(si.currentPos.y-Di.lastPos.y,si.currentPos.x-Di.lastPos.x),en=Di.lastPos.distanceTo(si.currentPos),Di.lastPos=si.currentPos,Fs=1e3*en/(Qi+1),si.speed=.75*Fs+.25*si.speed},Me=function(Nt,tt){var Di=re(Nt,tt);G.push({guid:Di,gPoint:tt,lastPos:tt.currentPos}),G.length===1&&(K=t.now(),U=window.setInterval(Re,50))},ot=function(Nt,tt){var Di=re(Nt,tt),si,ji=G.length;for(si=0;si<ji;si++)if(G[si].guid===Di){G.splice(si,1),ji--,ji===0&&window.clearInterval(U);break}};return{addPoint:Me,removePoint:ot}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName==="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=function(){var G=document.createElement("div");return t.isFunction(G.setPointerCapture)&&t.isFunction(G.releasePointerCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=function(){var G=document.createElement("div");return t.isFunction(G.setCapture)&&t.isFunction(G.releaseCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(G){this._gPoints=[],this.type=G,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(G){return this._gPoints.push(G)},removeById:function(G){var U,K=this._gPoints.length;for(U=0;U<K;U++)if(this._gPoints[U].id===G){this._gPoints.splice(U,1);break}return this._gPoints.length},getByIndex:function(G){return G<this._gPoints.length?this._gPoints[G]:null},getById:function(G){var U,K=this._gPoints.length;for(U=0;U<K;U++)if(this._gPoints[U].id===G)return this._gPoints[U];return null},getPrimary:function(G){var U,K=this._gPoints.length;for(U=0;U<K;U++)if(this._gPoints[U].isPrimary)return this._gPoints[U];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function o(G){var U=i[G.hash],K,re,Re,Me,ot,Nt=U.activePointersLists.length;for(K=0;K<Nt;K++)if(Re=U.activePointersLists[K],Re.getLength()>0){for(ot=[],Me=Re.asArray(),re=0;re<Me.length;re++)ot.push(Me[re]);for(re=0;re<ot.length;re++)Yt(G,Re,ot[re])}for(K=0;K<Nt;K++)U.activePointersLists.pop();U.sentDragEvent=!1}function a(G){var U=i[G.hash],K,re;if(!U.tracking){for(re=0;re<t.MouseTracker.subscribeEvents.length;re++)K=t.MouseTracker.subscribeEvents[re],t.addEvent(G.element,K,U[K],K===t.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);o(G),U.tracking=!0}}function l(G){var U=i[G.hash],K,re;if(U.tracking){for(re=0;re<t.MouseTracker.subscribeEvents.length;re++)K=t.MouseTracker.subscribeEvents[re],t.removeEvent(G.element,K,U[K],!1);o(G),U.tracking=!1}}function c(G,U){var K=i[G.hash];if(U==="pointerevent")return{upName:"pointerup",upHandler:K.pointerupcaptured,moveName:"pointermove",moveHandler:K.pointermovecaptured};if(U==="mouse")return{upName:"pointerup",upHandler:K.pointerupcaptured,moveName:"pointermove",moveHandler:K.pointermovecaptured};if(U==="touch")return{upName:"touchend",upHandler:K.touchendcaptured,moveName:"touchmove",moveHandler:K.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function u(G,U){var K;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{G.element.setPointerCapture(U.id)}catch{t.console.warn("setPointerCapture() called on invalid pointer ID");return}else G.element.setCapture(!0);else K=c(G,t.MouseTracker.havePointerEvents?"pointerevent":U.type),r&&s(window.top)&&t.addEvent(window.top,K.upName,K.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,K.upName,K.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,K.moveName,K.moveHandler,!0);ve(G,U,!0)}function f(G,U){var K,re,Re;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(re=G.getActivePointersListByType(U.type),Re=re.getById(U.id),!Re||!Re.captured)return;try{G.element.releasePointerCapture(U.id)}catch{}}else G.element.releaseCapture();else K=c(G,t.MouseTracker.havePointerEvents?"pointerevent":U.type),r&&s(window.top)&&t.removeEvent(window.top,K.upName,K.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,K.moveName,K.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,K.upName,K.upHandler,!0);ve(G,U,!1)}function p(G){return t.MouseTracker.havePointerEvents?G.pointerId:t.MouseTracker.mousePointerId}function m(G){return t.MouseTracker.havePointerEvents?G.pointerType||(t.Browser.vendor===t.BROWSERS.IE?"mouse":""):"mouse"}function y(G){return t.MouseTracker.havePointerEvents?G.isPrimary:!0}function _(G){return t.getMousePosition(G)}function w(G,U){return T(_(G),U)}function T(G,U){var K=t.getElementOffset(U);return G.minus(K)}function x(G,U){return new t.Point((G.x+U.x)/2,(G.y+U.y)/2)}function C(G,U){var K={originalEvent:U,eventType:"click",pointerType:"mouse",isEmulated:!1};X(G,K),K.preventDefault&&!K.defaultPrevented&&t.cancelEvent(U),K.stopPropagation&&t.stopEvent(U)}function I(G,U){var K={originalEvent:U,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};X(G,K),K.preventDefault&&!K.defaultPrevented&&t.cancelEvent(U),K.stopPropagation&&t.stopEvent(U)}function D(G,U){var K=null,re={originalEvent:U,eventType:"keydown",pointerType:"",isEmulated:!1};X(G,re),G.keyDownHandler&&!re.preventGesture&&!re.defaultPrevented&&(K={eventSource:G,keyCode:U.keyCode?U.keyCode:U.charCode,ctrl:U.ctrlKey,shift:U.shiftKey,alt:U.altKey,meta:U.metaKey,originalEvent:U,preventDefault:re.preventDefault||re.defaultPrevented,userData:G.userData},G.keyDownHandler(K)),(K&&K.preventDefault||re.preventDefault&&!re.defaultPrevented)&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function B(G,U){var K=null,re={originalEvent:U,eventType:"keyup",pointerType:"",isEmulated:!1};X(G,re),G.keyUpHandler&&!re.preventGesture&&!re.defaultPrevented&&(K={eventSource:G,keyCode:U.keyCode?U.keyCode:U.charCode,ctrl:U.ctrlKey,shift:U.shiftKey,alt:U.altKey,meta:U.metaKey,originalEvent:U,preventDefault:re.preventDefault||re.defaultPrevented,userData:G.userData},G.keyUpHandler(K)),(K&&K.preventDefault||re.preventDefault&&!re.defaultPrevented)&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function N(G,U){var K=null,re={originalEvent:U,eventType:"keypress",pointerType:"",isEmulated:!1};X(G,re),G.keyHandler&&!re.preventGesture&&!re.defaultPrevented&&(K={eventSource:G,keyCode:U.keyCode?U.keyCode:U.charCode,ctrl:U.ctrlKey,shift:U.shiftKey,alt:U.altKey,meta:U.metaKey,originalEvent:U,preventDefault:re.preventDefault||re.defaultPrevented,userData:G.userData},G.keyHandler(K)),(K&&K.preventDefault||re.preventDefault&&!re.defaultPrevented)&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function z(G,U){var K={originalEvent:U,eventType:"focus",pointerType:"",isEmulated:!1};X(G,K),G.focusHandler&&!K.preventGesture&&G.focusHandler({eventSource:G,originalEvent:U,userData:G.userData})}function Z(G,U){var K={originalEvent:U,eventType:"blur",pointerType:"",isEmulated:!1};X(G,K),G.blurHandler&&!K.preventGesture&&G.blurHandler({eventSource:G,originalEvent:U,userData:G.userData})}function q(G,U){var K=null,re={originalEvent:U,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};X(G,re),G.contextMenuHandler&&!re.preventGesture&&!re.defaultPrevented&&(K={eventSource:G,position:T(_(U),G.element),originalEvent:re.originalEvent,preventDefault:re.preventDefault||re.defaultPrevented,userData:G.userData},G.contextMenuHandler(K)),(K&&K.preventDefault||re.preventDefault&&!re.defaultPrevented)&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function H(G,U){ee(G,U,U)}function Y(G,U){var K={target:U.target||U.srcElement,type:"wheel",shiftKey:U.shiftKey||!1,clientX:U.clientX,clientY:U.clientY,pageX:U.pageX?U.pageX:U.clientX,pageY:U.pageY?U.pageY:U.clientY,deltaMode:U.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName==="mousewheel"?K.deltaY=-U.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:K.deltaY=U.detail,ee(G,K,U)}function ee(G,U,K){var re=0,Re,Me=null;re=U.deltaY<0?1:-1,Re={originalEvent:U,eventType:"wheel",pointerType:"mouse",isEmulated:U!==K},X(G,Re),G.scrollHandler&&!Re.preventGesture&&!Re.defaultPrevented&&(Me={eventSource:G,pointerType:"mouse",position:w(U,G.element),scroll:re,shift:U.shiftKey,isTouchEvent:!1,originalEvent:K,preventDefault:Re.preventDefault||Re.defaultPrevented,userData:G.userData},G.scrollHandler(Me)),Re.stopPropagation&&t.stopEvent(K),(Me&&Me.preventDefault||Re.preventDefault&&!Re.defaultPrevented)&&t.cancelEvent(K)}function le(G,U){var K={id:t.MouseTracker.mousePointerId,type:"mouse"},re={originalEvent:U,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};X(G,re),U.target===G.element&&ve(G,K,!1),re.stopPropagation&&t.stopEvent(U)}function W(G,U){var K,re,Re=U.changedTouches.length,Me,ot=G.getActivePointersListByType("touch");K=t.now(),ot.getLength()>U.touches.length-Re&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var Nt={originalEvent:U,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(X(G,Nt),re=0;re<Re;re++)Me={id:U.changedTouches[re].identifier,type:"touch",isPrimary:ot.getLength()===0,currentPos:_(U.changedTouches[re]),currentTime:K},Pe(G,Nt,Me),vt(G,Nt,Me,0),ve(G,Me,!0);Nt.preventDefault&&!Nt.defaultPrevented&&t.cancelEvent(U),Nt.stopPropagation&&t.stopEvent(U)}function ie(G,U){var K,re,Re=U.changedTouches.length,Me;K=t.now();var ot={originalEvent:U,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(X(G,ot),re=0;re<Re;re++)Me={id:U.changedTouches[re].identifier,type:"touch",currentPos:_(U.changedTouches[re]),currentTime:K},xt(G,ot,Me,0),ve(G,Me,!1),Ae(G,ot,Me);ot.preventDefault&&!ot.defaultPrevented&&t.cancelEvent(U),ot.stopPropagation&&t.stopEvent(U)}function ne(G,U){var K,re,Re=U.changedTouches.length,Me;K=t.now();var ot={originalEvent:U,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(X(G,ot),re=0;re<Re;re++)Me={id:U.changedTouches[re].identifier,type:"touch",currentPos:_(U.changedTouches[re]),currentTime:K},It(G,ot,Me);ot.preventDefault&&!ot.defaultPrevented&&t.cancelEvent(U),ot.stopPropagation&&t.stopEvent(U)}function J(G,U){var K=U.changedTouches.length,re,Re,Me={originalEvent:U,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(X(G,Me),re=0;re<K;re++)Re={id:U.changedTouches[re].identifier,type:"touch"},rt(G,Me,Re);Me.stopPropagation&&t.stopEvent(U)}function ce(G,U){return t.eventIsCanceled(U)||U.preventDefault(),!1}function se(G,U){return t.eventIsCanceled(U)||U.preventDefault(),!1}function te(G,U){var K={originalEvent:U,eventType:"gotpointercapture",pointerType:m(U),isEmulated:!1};X(G,K),U.target===G.element&&ve(G,{id:U.pointerId,type:m(U)},!0),K.stopPropagation&&t.stopEvent(U)}function Q(G,U){var K={originalEvent:U,eventType:"lostpointercapture",pointerType:m(U),isEmulated:!1};X(G,K),U.target===G.element&&ve(G,{id:U.pointerId,type:m(U)},!1),K.stopPropagation&&t.stopEvent(U)}function _e(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re={originalEvent:U,eventType:"pointerenter",pointerType:K.type,isEmulated:!1};X(G,re),Pe(G,re,K)}function fe(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re={originalEvent:U,eventType:"pointerleave",pointerType:K.type,isEmulated:!1};X(G,re),Ae(G,re,K)}function pe(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re={originalEvent:U,eventType:"pointerover",pointerType:K.type,isEmulated:!1};X(G,re),Ve(G,re,K),re.preventDefault&&!re.defaultPrevented&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function Ce(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re={originalEvent:U,eventType:"pointerout",pointerType:K.type,isEmulated:!1};X(G,re),ze(G,re,K),re.preventDefault&&!re.defaultPrevented&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function xe(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re=t.MouseTracker.havePointerEvents&&K.type==="touch"&&t.Browser.vendor!==t.BROWSERS.IE,Re={originalEvent:U,eventType:"pointerdown",pointerType:K.type,isEmulated:!1};X(G,Re),vt(G,Re,K,U.button),Re.preventDefault&&!Re.defaultPrevented&&t.cancelEvent(U),Re.stopPropagation&&t.stopEvent(U),Re.shouldCapture&&(re?ve(G,K,!0):u(G,K))}function Le(G,U){Ke(G,U)}function je(G,U){var K=G.getActivePointersListByType(m(U));K.getById(U.pointerId)&&Ke(G,U),t.stopEvent(U)}function Ke(G,U){var K;K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()};var re={originalEvent:U,eventType:"pointerup",pointerType:K.type,isEmulated:!1};X(G,re),xt(G,re,K,U.button),re.preventDefault&&!re.defaultPrevented&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U),re.shouldReleaseCapture&&(U.target===G.element?f(G,K):ve(G,K,!1))}function lt(G,U){Ht(G,U)}function ct(G,U){var K=G.getActivePointersListByType(m(U));K.getById(U.pointerId)&&Ht(G,U),t.stopEvent(U)}function Ht(G,U){var K={id:p(U),type:m(U),isPrimary:y(U),currentPos:_(U),currentTime:t.now()},re={originalEvent:U,eventType:"pointermove",pointerType:K.type,isEmulated:!1};X(G,re),It(G,re,K),re.preventDefault&&!re.defaultPrevented&&t.cancelEvent(U),re.stopPropagation&&t.stopEvent(U)}function Vt(G,U){var K={id:U.pointerId,type:m(U)},re={originalEvent:U,eventType:"pointercancel",pointerType:K.type,isEmulated:!1};X(G,re),rt(G,re,K),re.stopPropagation&&t.stopEvent(U)}function ii(G,U){return U.speed=0,U.direction=0,U.contactPos=U.currentPos,U.contactTime=U.currentTime,U.lastPos=U.currentPos,U.lastTime=U.currentTime,G.add(U)}function Yt(G,U,K){var re,Re=U.getById(K.id);return Re?(Re.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),f(G,Re)),U.removeContact(),re=U.removeById(K.id)):re=U.getLength(),re}function k(G,U){switch(U.eventType){case"pointermove":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!1,U.preventGesture=!G.hasGestureHandlers,U.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!1,U.preventGesture=!1,U.stopPropagation=!1;break;case"pointerdown":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!1,U.preventGesture=!G.hasGestureHandlers,U.stopPropagation=!1;break;case"pointerup":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!1,U.preventGesture=!G.hasGestureHandlers,U.stopPropagation=!1;break;case"wheel":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!1,U.preventGesture=!G.hasScrollHandler,U.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":U.isStoppable=!0,U.isCancelable=!1,U.preventDefault=!1,U.preventGesture=!1,U.stopPropagation=!1;break;case"click":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!!G.clickHandler,U.preventGesture=!1,U.stopPropagation=!1;break;case"dblclick":U.isStoppable=!0,U.isCancelable=!0,U.preventDefault=!!G.dblClickHandler,U.preventGesture=!1,U.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:U.isStoppable=!1,U.isCancelable=!1,U.preventDefault=!1,U.preventGesture=!1,U.stopPropagation=!1;break}}function X(G,U){U.eventSource=G,U.eventPhase=U.originalEvent&&typeof U.originalEvent.eventPhase<"u"?U.originalEvent.eventPhase:0,U.defaultPrevented=t.eventIsCanceled(U.originalEvent),U.shouldCapture=!1,U.shouldReleaseCapture=!1,U.userData=G.userData,k(G,U),G.preProcessEventHandler&&G.preProcessEventHandler(U)}function ve(G,U,K){var re=G.getActivePointersListByType(U.type),Re=re.getById(U.id);Re?K&&!Re.captured?(Re.captured=!0,re.captureCount++):!K&&Re.captured&&(Re.captured=!1,re.captureCount--,re.captureCount<0&&(re.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function Pe(G,U,K){var re=G.getActivePointersListByType(K.type),Re;Re=re.getById(K.id),Re?(Re.insideElement=!0,Re.lastPos=Re.currentPos,Re.lastTime=Re.currentTime,Re.currentPos=K.currentPos,Re.currentTime=K.currentTime,K=Re):(K.captured=!1,K.insideElementPressed=!1,K.insideElement=!0,ii(re,K)),G.enterHandler&&G.enterHandler({eventSource:G,pointerType:K.type,position:T(K.currentPos,G.element),buttons:re.buttons,pointers:G.getActivePointerCount(),insideElementPressed:K.insideElementPressed,buttonDownAny:re.buttons!==0,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData})}function Ae(G,U,K){var re=G.getActivePointersListByType(K.type),Re,Me;Re=re.getById(K.id),Re?(Re.captured?(Re.insideElement=!1,Re.lastPos=Re.currentPos,Re.lastTime=Re.currentTime,Re.currentPos=K.currentPos,Re.currentTime=K.currentTime):Yt(G,re,Re),K=Re):(K.captured=!1,K.insideElementPressed=!1),(G.leaveHandler||G.exitHandler)&&(Me={eventSource:G,pointerType:K.type,position:K.currentPos&&T(K.currentPos,G.element),buttons:re.buttons,pointers:G.getActivePointerCount(),insideElementPressed:K.insideElementPressed,buttonDownAny:re.buttons!==0,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData},G.leaveHandler&&G.leaveHandler(Me),G.exitHandler&&G.exitHandler(Me))}function Ve(G,U,K){var re,Re;re=G.getActivePointersListByType(K.type),Re=re.getById(K.id),Re?K=Re:(K.captured=!1,K.insideElementPressed=!1),G.overHandler&&G.overHandler({eventSource:G,pointerType:K.type,position:T(K.currentPos,G.element),buttons:re.buttons,pointers:G.getActivePointerCount(),insideElementPressed:K.insideElementPressed,buttonDownAny:re.buttons!==0,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData})}function ze(G,U,K){var re,Re;re=G.getActivePointersListByType(K.type),Re=re.getById(K.id),Re?K=Re:(K.captured=!1,K.insideElementPressed=!1),G.outHandler&&G.outHandler({eventSource:G,pointerType:K.type,position:K.currentPos&&T(K.currentPos,G.element),buttons:re.buttons,pointers:G.getActivePointerCount(),insideElementPressed:K.insideElementPressed,buttonDownAny:re.buttons!==0,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData})}function vt(G,U,K,re){var Re=i[G.hash],Me=G.getActivePointersListByType(K.type),ot;if(typeof U.originalEvent.buttons<"u"?Me.buttons=U.originalEvent.buttons:re===0?Me.buttons|=1:re===1?Me.buttons|=4:re===2?Me.buttons|=2:re===3?Me.buttons|=8:re===4?Me.buttons|=16:re===5&&(Me.buttons|=32),re!==0){U.shouldCapture=!1,U.shouldReleaseCapture=!1,G.nonPrimaryPressHandler&&!U.preventGesture&&!U.defaultPrevented&&(U.preventDefault=!0,G.nonPrimaryPressHandler({eventSource:G,pointerType:K.type,position:T(K.currentPos,G.element),button:re,buttons:Me.buttons,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData}));return}ot=Me.getById(K.id),ot?(ot.insideElementPressed=!0,ot.insideElement=!0,ot.originalTarget=U.originalEvent.target,ot.contactPos=K.currentPos,ot.contactTime=K.currentTime,ot.lastPos=ot.currentPos,ot.lastTime=ot.currentTime,ot.currentPos=K.currentPos,ot.currentTime=K.currentTime,K=ot):(K.captured=!1,K.insideElementPressed=!0,K.insideElement=!0,K.originalTarget=U.originalEvent.target,ii(Me,K)),Me.addContact(),!U.preventGesture&&!U.defaultPrevented?(U.shouldCapture=!0,U.shouldReleaseCapture=!1,U.preventDefault=!0,(G.dragHandler||G.dragEndHandler||G.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(G,K),Me.contacts===1?G.pressHandler&&!U.preventGesture&&G.pressHandler({eventSource:G,pointerType:K.type,position:T(K.contactPos,G.element),buttons:Me.buttons,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData}):Me.contacts===2&&G.pinchHandler&&K.type==="touch"&&(Re.pinchGPoints=Me.asArray(),Re.lastPinchDist=Re.currentPinchDist=Re.pinchGPoints[0].currentPos.distanceTo(Re.pinchGPoints[1].currentPos),Re.lastPinchCenter=Re.currentPinchCenter=x(Re.pinchGPoints[0].currentPos,Re.pinchGPoints[1].currentPos))):(U.shouldCapture=!1,U.shouldReleaseCapture=!1)}function xt(G,U,K,re){var Re=i[G.hash],Me=G.getActivePointersListByType(K.type),ot,Nt,tt,Di=!1,si;if(typeof U.originalEvent.buttons<"u"?Me.buttons=U.originalEvent.buttons:re===0?Me.buttons^=-2:re===1?Me.buttons^=-5:re===2?Me.buttons^=-3:re===3?Me.buttons^=-9:re===4?Me.buttons^=-17:re===5&&(Me.buttons^=-33),U.shouldCapture=!1,re!==0){U.shouldReleaseCapture=!1,G.nonPrimaryReleaseHandler&&!U.preventGesture&&!U.defaultPrevented&&(U.preventDefault=!0,G.nonPrimaryReleaseHandler({eventSource:G,pointerType:K.type,position:T(K.currentPos,G.element),button:re,buttons:Me.buttons,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData}));return}tt=Me.getById(K.id),tt?(Me.removeContact(),tt.captured&&(Di=!0),tt.lastPos=tt.currentPos,tt.lastTime=tt.currentTime,tt.currentPos=K.currentPos,tt.currentTime=K.currentTime,tt.insideElement||Yt(G,Me,tt),ot=tt.currentPos,Nt=tt.currentTime):(K.captured=!1,K.insideElementPressed=!1,K.insideElement=!0,ii(Me,K),tt=K),!U.preventGesture&&!U.defaultPrevented&&(Di?(U.shouldReleaseCapture=!0,U.preventDefault=!0,(G.dragHandler||G.dragEndHandler||G.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(G,tt),Me.contacts===0?(G.releaseHandler&&ot&&G.releaseHandler({eventSource:G,pointerType:tt.type,position:T(ot,G.element),buttons:Me.buttons,insideElementPressed:tt.insideElementPressed,insideElementReleased:tt.insideElement,isTouchEvent:tt.type==="touch",originalEvent:U.originalEvent,userData:G.userData}),G.dragEndHandler&&Re.sentDragEvent&&G.dragEndHandler({eventSource:G,pointerType:tt.type,position:T(tt.currentPos,G.element),speed:tt.speed,direction:tt.direction,shift:U.originalEvent.shiftKey,isTouchEvent:tt.type==="touch",originalEvent:U.originalEvent,userData:G.userData}),Re.sentDragEvent=!1,(G.clickHandler||G.dblClickHandler)&&tt.insideElement&&(si=Nt-tt.contactTime<=G.clickTimeThreshold&&tt.contactPos.distanceTo(ot)<=G.clickDistThreshold,G.clickHandler&&G.clickHandler({eventSource:G,pointerType:tt.type,position:T(tt.currentPos,G.element),quick:si,shift:U.originalEvent.shiftKey,isTouchEvent:tt.type==="touch",originalEvent:U.originalEvent,originalTarget:tt.originalTarget,userData:G.userData}),G.dblClickHandler&&si&&(Me.clicks++,Me.clicks===1?(Re.lastClickPos=ot,Re.dblClickTimeOut=setTimeout(function(){Me.clicks=0},G.dblClickTimeThreshold)):Me.clicks===2&&(clearTimeout(Re.dblClickTimeOut),Me.clicks=0,Re.lastClickPos.distanceTo(ot)<=G.dblClickDistThreshold&&G.dblClickHandler({eventSource:G,pointerType:tt.type,position:T(tt.currentPos,G.element),shift:U.originalEvent.shiftKey,isTouchEvent:tt.type==="touch",originalEvent:U.originalEvent,userData:G.userData}),Re.lastClickPos=null)))):Me.contacts===2&&G.pinchHandler&&tt.type==="touch"&&(Re.pinchGPoints=Me.asArray(),Re.lastPinchDist=Re.currentPinchDist=Re.pinchGPoints[0].currentPos.distanceTo(Re.pinchGPoints[1].currentPos),Re.lastPinchCenter=Re.currentPinchCenter=x(Re.pinchGPoints[0].currentPos,Re.pinchGPoints[1].currentPos))):(U.shouldReleaseCapture=!1,G.releaseHandler&&ot&&(G.releaseHandler({eventSource:G,pointerType:tt.type,position:T(ot,G.element),buttons:Me.buttons,insideElementPressed:tt.insideElementPressed,insideElementReleased:tt.insideElement,isTouchEvent:tt.type==="touch",originalEvent:U.originalEvent,userData:G.userData}),U.preventDefault=!0)))}function It(G,U,K){var re=i[G.hash],Re=G.getActivePointersListByType(K.type),Me,ot,Nt;if(typeof U.originalEvent.buttons<"u"&&(Re.buttons=U.originalEvent.buttons),Me=Re.getById(K.id),Me)Me.lastPos=Me.currentPos,Me.lastTime=Me.currentTime,Me.currentPos=K.currentPos,Me.currentTime=K.currentTime;else return;U.shouldCapture=!1,U.shouldReleaseCapture=!1,G.stopHandler&&K.type==="mouse"&&(clearTimeout(G.stopTimeOut),G.stopTimeOut=setTimeout(function(){Ot(G,U.originalEvent,K.type)},G.stopDelay)),Re.contacts===0?G.moveHandler&&G.moveHandler({eventSource:G,pointerType:K.type,position:T(K.currentPos,G.element),buttons:Re.buttons,isTouchEvent:K.type==="touch",originalEvent:U.originalEvent,userData:G.userData}):Re.contacts===1?(G.moveHandler&&(Me=Re.asArray()[0],G.moveHandler({eventSource:G,pointerType:Me.type,position:T(Me.currentPos,G.element),buttons:Re.buttons,isTouchEvent:Me.type==="touch",originalEvent:U.originalEvent,userData:G.userData})),G.dragHandler&&!U.preventGesture&&!U.defaultPrevented&&(Me=Re.asArray()[0],Nt=Me.currentPos.minus(Me.lastPos),G.dragHandler({eventSource:G,pointerType:Me.type,position:T(Me.currentPos,G.element),buttons:Re.buttons,delta:Nt,speed:Me.speed,direction:Me.direction,shift:U.originalEvent.shiftKey,isTouchEvent:Me.type==="touch",originalEvent:U.originalEvent,userData:G.userData}),U.preventDefault=!0,re.sentDragEvent=!0)):Re.contacts===2&&(G.moveHandler&&(ot=Re.asArray(),G.moveHandler({eventSource:G,pointerType:ot[0].type,position:T(x(ot[0].currentPos,ot[1].currentPos),G.element),buttons:Re.buttons,isTouchEvent:ot[0].type==="touch",originalEvent:U.originalEvent,userData:G.userData})),G.pinchHandler&&K.type==="touch"&&!U.preventGesture&&!U.defaultPrevented&&(Nt=re.pinchGPoints[0].currentPos.distanceTo(re.pinchGPoints[1].currentPos),Nt!==re.currentPinchDist&&(re.lastPinchDist=re.currentPinchDist,re.currentPinchDist=Nt,re.lastPinchCenter=re.currentPinchCenter,re.currentPinchCenter=x(re.pinchGPoints[0].currentPos,re.pinchGPoints[1].currentPos),G.pinchHandler({eventSource:G,pointerType:"touch",gesturePoints:re.pinchGPoints,lastCenter:T(re.lastPinchCenter,G.element),center:T(re.currentPinchCenter,G.element),lastDistance:re.lastPinchDist,distance:re.currentPinchDist,shift:U.originalEvent.shiftKey,originalEvent:U.originalEvent,userData:G.userData}),U.preventDefault=!0)))}function rt(G,U,K){var re=G.getActivePointersListByType(K.type),Re;Re=re.getById(K.id),Re&&Yt(G,re,Re)}function Ot(G,U,K){G.stopHandler&&G.stopHandler({eventSource:G,pointerType:K,position:w(U,G.element),buttons:G.getActivePointersListByType(K).buttons,isTouchEvent:K==="touch",originalEvent:U,userData:G.userData})}}(e),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,r,s){var o=i.parentNode;typeof r=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=typeof r.attachToViewer>"u"?!0:r.attachToViewer,this.autoFade=typeof r.autoFade>"u"?!0:r.autoFade,this.element=i,this.anchor=r.anchor,this.container=s,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof r.top=="number"?r.top+"px":r.top,this.wrapper.style.left=typeof r.left=="number"?r.left+"px":r.left,this.wrapper.style.height=typeof r.height=="number"?r.height+"px":r.height,this.wrapper.style.width=typeof r.width=="number"?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[t.SIGNAL]&&t.Browser.vendor===t.BROWSERS.IE?t.setElementOpacity(this.element,i,!0):t.setElementOpacity(this.wrapper,i,!0)}}}(e),function(t){t.ControlDock=function(r){var s=["topleft","topright","bottomright","bottomleft"],o,a;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},r),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),a=0;a<s.length;a++)o=s[a],this.controls[o]=t.makeNeutralElement("div"),this.controls[o].style.position="absolute",o.match("left")&&(this.controls[o].style.left="0px"),o.match("right")&&(this.controls[o].style.right="0px"),o.match("top")&&(this.controls[o].style.top="0px"),o.match("bottom")&&(this.controls[o].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(r,s){r=t.getElement(r);var o=null;if(!(i(this,r)>=0)){switch(s.anchor){case t.ControlAnchor.TOP_RIGHT:o=this.controls.topright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:o=this.controls.topleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:o=this.container,r.style.margin="0px",r.style.padding="0px";break;default:case t.ControlAnchor.NONE:o=this.container,r.style.margin="0px",r.style.padding="0px";break}this.controls.push(new t.Control(r,s,o)),r.style.display="inline-block"}},removeControl:function(r){r=t.getElement(r);var s=i(this,r);return s>=0&&(this.controls[s].destroy(),this.controls.splice(s,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var r;for(r=this.controls.length-1;r>=0;r--)if(this.controls[r].isVisible())return!0;return!1},setControlsEnabled:function(r){var s;for(s=this.controls.length-1;s>=0;s--)this.controls[s].setVisible(r);return this}};function i(r,s){var o=r.controls,a;for(a=o.length-1;a>=0;a--)if(o[a].element===s)return a;return-1}}(e),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(e),function(t){var i={},r=1;t.Viewer=function(k){var X=arguments,ve=this,Pe;if(t.isPlainObject(k)||(k={id:X[0],xmlPath:X.length>1?X[1]:void 0,prefixUrl:X.length>2?X[2]:void 0,controls:X.length>3?X[3]:void 0,overlays:X.length>4?X[4]:void 0}),k.config&&(t.extend(!0,k,k.config),delete k.config),t.extend(!0,this,{id:k.id,hash:k.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,k),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(Ae){var Ve=t.getString("Errors.OpenFailed",Ae.eventSource,Ae.message);ve._showMessage(Ve)}),t.ControlDock.call(this,k),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(Ae){Ae.width="100%",Ae.height="100%",Ae.overflow="hidden",Ae.position="absolute",Ae.top="0px",Ae.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),k.tabIndex!==""&&(this.canvas.tabIndex=k.tabIndex===void 0?0:k.tabIndex),this.container.className="openseadragon-container",function(Ae){Ae.width="100%",Ae.height="100%",Ae.position="relative",Ae.overflow="hidden",Ae.left="0px",Ae.top="0px",Ae.textAlign="left"}(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,w),keyDownHandler:t.delegate(this,T),keyHandler:t.delegate(this,x),clickHandler:t.delegate(this,C),dblClickHandler:t.delegate(this,I),dragHandler:t.delegate(this,D),dragEndHandler:t.delegate(this,B),enterHandler:t.delegate(this,N),leaveHandler:t.delegate(this,z),pressHandler:t.delegate(this,Z),releaseHandler:t.delegate(this,q),nonPrimaryPressHandler:t.delegate(this,H),nonPrimaryReleaseHandler:t.delegate(this,Y),scrollHandler:t.delegate(this,ie),pinchHandler:t.delegate(this,ee),focusHandler:t.delegate(this,le),blurHandler:t.delegate(this,W)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,ne),leaveHandler:t.delegate(this,J)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=s(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[ve.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(Ae){ve.source=ve.world.getItemAt(0).source,i[ve.hash].forceRedraw=!0,ve._updateRequestId||(ve._updateRequestId=c(ve,ce))}),this.world.addHandler("remove-item",function(Ae){ve.world.getItemCount()?ve.source=ve.world.getItemAt(0).source:ve.source=null,i[ve.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(Ae){ve.viewport&&ve.viewport._setContentBounds(ve.world.getHomeBounds(),ve.world.getContentFactor())}),this.world.addHandler("item-index-change",function(Ae){ve.source=ve.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:k.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(Pe=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(Pe,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(Pe=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(Pe,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),Pe=0;Pe<this.customControls.length;Pe++)this.addControl(this.customControls[Pe].id,{anchor:this.customControls[Pe].anchor});t.requestAnimationFrame(function(){f(ve)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(k){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(k)},openTileSource:function(k){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(k)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(k,X){var ve=this;if(this.close(),!k)return this;if(this.sequenceMode&&t.isArray(k))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof X<"u"&&!isNaN(X)&&(this.initialPage=X),this.tileSources=k,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(t.isArray(k)||(k=[k]),!k.length)return this;this._opening=!0;for(var Pe=k.length,Ae=0,Ve=0,ze,vt=function(){if(Ae+Ve===Pe)if(Ae){(ve._firstOpen||!ve.preserveViewport)&&(ve.viewport.goHome(!0),ve.viewport.update()),ve._firstOpen=!1;var rt=k[0];if(rt.tileSource&&(rt=rt.tileSource),ve.overlays&&!ve.preserveOverlays)for(var Ot=0;Ot<ve.overlays.length;Ot++)ve.currentOverlays[Ot]=a(ve,ve.overlays[Ot]);ve._drawOverlays(),ve._opening=!1,ve.raiseEvent("open",{source:rt})}else ve._opening=!1,ve.raiseEvent("open-failed",ze)},xt=function(rt){(!t.isPlainObject(rt)||!rt.tileSource)&&(rt={tileSource:rt}),rt.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete rt.index),rt.collectionImmediately===void 0&&(rt.collectionImmediately=!0);var Ot=rt.success;rt.success=function(U){if(Ae++,rt.tileSource.overlays)for(var K=0;K<rt.tileSource.overlays.length;K++)ve.addOverlay(rt.tileSource.overlays[K]);Ot&&Ot(U),vt()};var G=rt.error;rt.error=function(U){Ve++,ze||(ze=U),G&&G(U),vt()},ve.addTiledImage(rt)},It=0;It<k.length;It++)xt(k[It]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(k){return this.innerTracker.setTracking(k),this.outerTracker.setTracking(k),this.raiseEvent("mouse-enabled",{enabled:k}),this},areControlsEnabled:function(){var k=this.controls.length,X;for(X=0;X<this.controls.length;X++)k=k&&this.controls[X].isVisible();return k},setControlsEnabled:function(k){return k?m(this):f(this),this.raiseEvent("controls-enabled",{enabled:k}),this},setDebugMode:function(k){for(var X=0;X<this.world.getItemCount();X++)this.world.getItemAt(X).debugMode=k;this.debugMode=k,this.forceRedraw()},setAjaxHeaders:function(k,X){if(k===null&&(k={}),!t.isPlainObject(k)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(X===void 0&&(X=!0),this.ajaxHeaders=k,X){for(var ve=0;ve<this.world.getItemCount();ve++)this.world.getItemAt(ve)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var Pe in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[Pe].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(k){this.buttonGroup.addButton(k)},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(k){var X=document.body,ve=X.style,Pe=document.documentElement.style,Ae=this,Ve,ze;if(k===this.isFullPage())return this;var vt={fullPage:k,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",vt),vt.preventDefaultAction)return this;if(k){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=ve.margin,this.docMargin=Pe.margin,ve.margin="0",Pe.margin="0",this.bodyPadding=ve.padding,this.docPadding=Pe.padding,ve.padding="0",Pe.padding="0",this.bodyWidth=ve.width,this.docWidth=Pe.width,ve.width="100%",Pe.width="100%",this.bodyHeight=ve.height,this.docHeight=Pe.height,ve.height="100%",Pe.height="100%",this.bodyDisplay=ve.display,ve.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,Ve=X.childNodes.length,ze=0;ze<Ve;ze++)this.previousBody.push(X.childNodes[0]),X.removeChild(X.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,X.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),X.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,ne)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,ve.margin=this.bodyMargin,Pe.margin=this.docMargin,ve.padding=this.bodyPadding,Pe.padding=this.docPadding,ve.width=this.bodyWidth,Pe.width=this.docWidth,ve.height=this.bodyHeight,Pe.height=this.docHeight,ve.display=this.bodyDisplay,X.removeChild(this.element),Ve=this.previousBody.length,ze=0;ze<Ve;ze++)X.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(X.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var xt=0,It=function(){t.setPageScroll(Ae.pageScroll);var rt=t.getPageScroll();xt++,xt<10&&(rt.x!==Ae.pageScroll.x||rt.y!==Ae.pageScroll.y)&&t.requestAnimationFrame(It)};t.requestAnimationFrame(It),i[this.hash].fullPage=!1,t.delegate(this,J)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:k}),this},setFullScreen:function(k){var X=this;if(!t.supportsFullScreen)return this.setFullPage(k);if(t.isFullScreen()===k)return this;var ve={fullScreen:k,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",ve),ve.preventDefaultAction)return this;if(k){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var Pe=function(){var Ae=t.isFullScreen();Ae||(t.removeEvent(document,t.fullScreenEventName,Pe),t.removeEvent(document,t.fullScreenErrorEventName,Pe),X.setFullPage(!1),X.isFullPage()&&(X.element.style.width=X.fullPageStyleWidth,X.element.style.height=X.fullPageStyleHeight)),X.navigator&&X.viewport&&setTimeout(function(){X.navigator.update(X.viewport)}),X.raiseEvent("full-screen",{fullScreen:Ae})};t.addEvent(document,t.fullScreenEventName,Pe),t.addEvent(document,t.fullScreenErrorEventName,Pe),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(k){return this.container.style.visibility=k?"":"hidden",this.raiseEvent("visible",{visible:k}),this},addTiledImage:function(k){t.console.assert(k,"[Viewer.addTiledImage] options is required"),t.console.assert(k.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!k.replace||k.index>-1&&k.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var X=this;k.replace&&(k.replaceItem=X.world.getItemAt(k.index)),this._hideMessage(),k.placeholderFillStyle===void 0&&(k.placeholderFillStyle=this.placeholderFillStyle),k.opacity===void 0&&(k.opacity=this.opacity),k.preload===void 0&&(k.preload=this.preload),k.compositeOperation===void 0&&(k.compositeOperation=this.compositeOperation),k.crossOriginPolicy===void 0&&(k.crossOriginPolicy=k.tileSource.crossOriginPolicy!==void 0?k.tileSource.crossOriginPolicy:this.crossOriginPolicy),k.ajaxWithCredentials===void 0&&(k.ajaxWithCredentials=this.ajaxWithCredentials),k.loadTilesWithAjax===void 0&&(k.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(k.ajaxHeaders)||(k.ajaxHeaders={});var ve={options:k};function Pe(ze){for(var vt=0;vt<X._loadQueue.length;vt++)if(X._loadQueue[vt]===ve){X._loadQueue.splice(vt,1);break}X._loadQueue.length===0&&Ae(ve),X.raiseEvent("add-item-failed",ze),k.error&&k.error(ze)}function Ae(ze){X.collectionMode&&(X.world.arrange({immediately:ze.options.collectionImmediately,rows:X.collectionRows,columns:X.collectionColumns,layout:X.collectionLayout,tileSize:X.collectionTileSize,tileMargin:X.collectionTileMargin}),X.world.setAutoRefigureSizes(!0))}if(t.isArray(k.tileSource)){setTimeout(function(){Pe({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:k.tileSource,options:k})});return}this._loadQueue.push(ve);function Ve(){for(var ze,vt,xt;X._loadQueue.length&&(ze=X._loadQueue[0],!!ze.tileSource);){if(X._loadQueue.splice(0,1),ze.options.replace){var It=X.world.getIndexOfItem(ze.options.replaceItem);It!==-1&&(ze.options.index=It),X.world.removeItem(ze.options.replaceItem)}vt=new t.TiledImage({viewer:X,source:ze.tileSource,viewport:X.viewport,drawer:X.drawer,tileCache:X.tileCache,imageLoader:X.imageLoader,x:ze.options.x,y:ze.options.y,width:ze.options.width,height:ze.options.height,fitBounds:ze.options.fitBounds,fitBoundsPlacement:ze.options.fitBoundsPlacement,clip:ze.options.clip,placeholderFillStyle:ze.options.placeholderFillStyle,opacity:ze.options.opacity,preload:ze.options.preload,degrees:ze.options.degrees,flipped:ze.options.flipped,compositeOperation:ze.options.compositeOperation,springStiffness:X.springStiffness,animationTime:X.animationTime,minZoomImageRatio:X.minZoomImageRatio,wrapHorizontal:X.wrapHorizontal,wrapVertical:X.wrapVertical,immediateRender:X.immediateRender,blendTime:X.blendTime,alwaysBlend:X.alwaysBlend,minPixelRatio:X.minPixelRatio,smoothTileEdgesMinZoom:X.smoothTileEdgesMinZoom,iOSDevice:X.iOSDevice,crossOriginPolicy:ze.options.crossOriginPolicy,ajaxWithCredentials:ze.options.ajaxWithCredentials,loadTilesWithAjax:ze.options.loadTilesWithAjax,ajaxHeaders:ze.options.ajaxHeaders,debugMode:X.debugMode,subPixelRoundingForTransparency:X.subPixelRoundingForTransparency}),X.collectionMode&&X.world.setAutoRefigureSizes(!1),X.navigator&&(xt=t.extend({},ze.options,{replace:!1,originalTiledImage:vt,tileSource:ze.tileSource}),X.navigator.addTiledImage(xt)),X.world.addItem(vt,{index:ze.options.index}),X._loadQueue.length===0&&Ae(ze),X.world.getItemCount()===1&&!X.preserveViewport&&X.viewport.goHome(!0),ze.options.success&&ze.options.success({item:vt})}}o(this,k.tileSource,k,function(ze){ve.tileSource=ze,Ve()},function(ze){ze.options=k,Pe(ze),Ve()})},addSimpleImage:function(k){t.console.assert(k,"[Viewer.addSimpleImage] options is required"),t.console.assert(k.url,"[Viewer.addSimpleImage] options.url is required");var X=t.extend({},k,{tileSource:{type:"image",url:k.url}});delete X.url,this.addTiledImage(X)},addLayer:function(k){var X=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var ve=t.extend({},k,{success:function(Pe){X.raiseEvent("add-layer",{options:k,drawer:Pe.item})},error:function(Pe){X.raiseEvent("add-layer-failed",Pe)}});return this.addTiledImage(ve),this},getLayerAtLevel:function(k){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(k)},getLevelOfLayer:function(k){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(k)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(k,X){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(k,X)},removeLayer:function(k){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(k)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var k=t.delegate(this,y),X=t.delegate(this,_),ve=t.delegate(this,this.goToNextPage),Pe=t.delegate(this,this.goToPreviousPage),Ae=this.navImages,Ve=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Ve=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:_e(this.prefixUrl,Ae.previous.REST),srcGroup:_e(this.prefixUrl,Ae.previous.GROUP),srcHover:_e(this.prefixUrl,Ae.previous.HOVER),srcDown:_e(this.prefixUrl,Ae.previous.DOWN),onRelease:Pe,onFocus:k,onBlur:X}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:_e(this.prefixUrl,Ae.next.REST),srcGroup:_e(this.prefixUrl,Ae.next.GROUP),srcHover:_e(this.prefixUrl,Ae.next.HOVER),srcDown:_e(this.prefixUrl,Ae.next.DOWN),onRelease:ve,onFocus:k,onBlur:X}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Ve&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var k=t.delegate(this,fe),X=t.delegate(this,Ce),ve=t.delegate(this,je),Pe=t.delegate(this,pe),Ae=t.delegate(this,Ke),Ve=t.delegate(this,ct),ze=t.delegate(this,Ht),vt=t.delegate(this,Vt),xt=t.delegate(this,ii),It=t.delegate(this,Yt),rt=t.delegate(this,y),Ot=t.delegate(this,_),G=this.navImages,U=[],K=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(K=!1),this.showZoomControl&&(U.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:_e(this.prefixUrl,G.zoomIn.REST),srcGroup:_e(this.prefixUrl,G.zoomIn.GROUP),srcHover:_e(this.prefixUrl,G.zoomIn.HOVER),srcDown:_e(this.prefixUrl,G.zoomIn.DOWN),onPress:k,onRelease:X,onClick:ve,onEnter:k,onExit:X,onFocus:rt,onBlur:Ot})),U.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:_e(this.prefixUrl,G.zoomOut.REST),srcGroup:_e(this.prefixUrl,G.zoomOut.GROUP),srcHover:_e(this.prefixUrl,G.zoomOut.HOVER),srcDown:_e(this.prefixUrl,G.zoomOut.DOWN),onPress:Pe,onRelease:X,onClick:Ae,onEnter:Pe,onExit:X,onFocus:rt,onBlur:Ot}))),this.showHomeControl&&U.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:_e(this.prefixUrl,G.home.REST),srcGroup:_e(this.prefixUrl,G.home.GROUP),srcHover:_e(this.prefixUrl,G.home.HOVER),srcDown:_e(this.prefixUrl,G.home.DOWN),onRelease:Ve,onFocus:rt,onBlur:Ot})),this.showFullPageControl&&U.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:_e(this.prefixUrl,G.fullpage.REST),srcGroup:_e(this.prefixUrl,G.fullpage.GROUP),srcHover:_e(this.prefixUrl,G.fullpage.HOVER),srcDown:_e(this.prefixUrl,G.fullpage.DOWN),onRelease:ze,onFocus:rt,onBlur:Ot})),this.showRotationControl&&(U.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:_e(this.prefixUrl,G.rotateleft.REST),srcGroup:_e(this.prefixUrl,G.rotateleft.GROUP),srcHover:_e(this.prefixUrl,G.rotateleft.HOVER),srcDown:_e(this.prefixUrl,G.rotateleft.DOWN),onRelease:vt,onFocus:rt,onBlur:Ot})),U.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:_e(this.prefixUrl,G.rotateright.REST),srcGroup:_e(this.prefixUrl,G.rotateright.GROUP),srcHover:_e(this.prefixUrl,G.rotateright.HOVER),srcDown:_e(this.prefixUrl,G.rotateright.DOWN),onRelease:xt,onFocus:rt,onBlur:Ot}))),this.showFlipControl&&U.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:_e(this.prefixUrl,G.flip.REST),srcGroup:_e(this.prefixUrl,G.flip.GROUP),srcHover:_e(this.prefixUrl,G.flip.HOVER),srcDown:_e(this.prefixUrl,G.flip.DOWN),onRelease:It,onFocus:rt,onBlur:Ot})),K?(this.buttonGroup=new t.ButtonGroup({buttons:U,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,lt)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=U),this},currentPage:function(){return this._sequenceIndex},goToPage:function(k){return this.tileSources&&k>=0&&k<this.tileSources.length&&(this._sequenceIndex=k,this._updateSequenceButtons(k),this.open(this.tileSources[k]),this.referenceStrip&&this.referenceStrip.setFocus(k),this.raiseEvent("page",{page:k})),this},addOverlay:function(k,X,ve,Pe){var Ae;if(t.isPlainObject(k)?Ae=k:Ae={element:k,location:X,placement:ve,onDraw:Pe},k=t.getElement(Ae.element),l(this.currentOverlays,k)>=0)return this;var Ve=a(this,Ae);return this.currentOverlays.push(Ve),Ve.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:k,location:Ae.location,placement:Ae.placement}),this},updateOverlay:function(k,X,ve){var Pe;return k=t.getElement(k),Pe=l(this.currentOverlays,k),Pe>=0&&(this.currentOverlays[Pe].update(X,ve),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:k,location:X,placement:ve})),this},removeOverlay:function(k){var X;return k=t.getElement(k),X=l(this.currentOverlays,k),X>=0&&(this.currentOverlays[X].destroy(),this.currentOverlays.splice(X,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:k})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(k){var X;return k=t.getElement(k),X=l(this.currentOverlays,k),X>=0?this.currentOverlays[X]:null},_updateSequenceButtons:function(k){this.nextButton&&(!this.tileSources||this.tileSources.length-1===k?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(k>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(k){this._hideMessage();var X=t.makeNeutralElement("div");X.appendChild(document.createTextNode(k)),this.messageDiv=t.makeCenteredNode(X),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var k=this.messageDiv;k&&(k.parentNode.removeChild(k),delete this.messageDiv)},gestureSettingsByDeviceType:function(k){switch(k){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var k,X=this.currentOverlays.length;for(k=0;k<X;k++)this.currentOverlays[k].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var k=t.pixelDensityRatio,X=t.getCurrentPixelDensityRatio();k!==X&&(t.pixelDensityRatio=X,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var k=this._sequenceIndex-1;this.navPrevNextWrap&&k<0&&(k+=this.tileSources.length),this.goToPage(k)},goToNextPage:function(){var k=this._sequenceIndex+1;this.navPrevNextWrap&&k>=this.tileSources.length&&(k=0),this.goToPage(k)},isAnimating:function(){return i[this.hash].animating}});function s(k){return k=t.getElement(k),new t.Point(k.clientWidth===0?1:k.clientWidth,k.clientHeight===0?1:k.clientHeight)}function o(k,X,ve,Pe,Ae){var Ve=k;if(t.type(X)==="string"){if(X.match(/^\s*<.*>\s*$/))X=t.parseXml(X);else if(X.match(/^\s*[{[].*[}\]]\s*$/))try{var ze=t.parseJSON(X);X=ze}catch{}}function vt(xt,It){xt.ready?Pe(xt):(xt.addHandler("ready",function(){Pe(xt)}),xt.addHandler("open-failed",function(rt){Ae({message:rt.message,source:It})}))}setTimeout(function(){if(t.type(X)==="string")X=new t.TileSource({url:X,crossOriginPolicy:ve.crossOriginPolicy!==void 0?ve.crossOriginPolicy:k.crossOriginPolicy,ajaxWithCredentials:k.ajaxWithCredentials,ajaxHeaders:ve.ajaxHeaders?ve.ajaxHeaders:k.ajaxHeaders,splitHashDataForPost:k.splitHashDataForPost,useCanvas:k.useCanvas,success:function(Ot){Pe(Ot.tileSource)}}),X.addHandler("open-failed",function(Ot){Ae(Ot)});else if(t.isPlainObject(X)||X.nodeType)if(X.crossOriginPolicy===void 0&&(ve.crossOriginPolicy!==void 0||k.crossOriginPolicy!==void 0)&&(X.crossOriginPolicy=ve.crossOriginPolicy!==void 0?ve.crossOriginPolicy:k.crossOriginPolicy),X.ajaxWithCredentials===void 0&&(X.ajaxWithCredentials=k.ajaxWithCredentials),X.useCanvas===void 0&&(X.useCanvas=k.useCanvas),t.isFunction(X.getTileUrl)){var xt=new t.TileSource(X);xt.getTileUrl=X.getTileUrl,Pe(xt)}else{var It=t.TileSource.determineType(Ve,X);if(!It){Ae({message:"Unable to load TileSource",source:X});return}var rt=It.prototype.configure.apply(Ve,[X]);vt(new It(rt),X)}else vt(X,X)})}function a(k,X){if(X instanceof t.Overlay)return X;var ve=null;if(X.element)ve=t.getElement(X.element);else{var Pe=X.id?X.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);ve=t.getElement(X.id),ve||(ve=document.createElement("a"),ve.href="#/overlay/"+Pe),ve.id=Pe,t.addClass(ve,X.className?X.className:"openseadragon-overlay")}var Ae=X.location,Ve=X.width,ze=X.height;if(!Ae){var vt=X.x,xt=X.y;if(X.px!==void 0){var It=k.viewport.imageToViewportRectangle(new t.Rect(X.px,X.py,Ve||0,ze||0));vt=It.x,xt=It.y,Ve=Ve!==void 0?It.width:void 0,ze=ze!==void 0?It.height:void 0}Ae=new t.Point(vt,xt)}var rt=X.placement;return rt&&t.type(rt)==="string"&&(rt=t.Placement[X.placement.toUpperCase()]),new t.Overlay({element:ve,location:Ae,placement:rt,onDraw:X.onDraw,checkResize:X.checkResize,width:Ve,height:ze,rotationMode:X.rotationMode})}function l(k,X){var ve;for(ve=k.length-1;ve>=0;ve--)if(k[ve].element===X)return ve;return-1}function c(k,X){return t.requestAnimationFrame(function(){X(k)})}function u(k){t.requestAnimationFrame(function(){p(k)})}function f(k){k.autoHideControls&&(k.controlsShouldFade=!0,k.controlsFadeBeginTime=t.now()+k.controlsFadeDelay,window.setTimeout(function(){u(k)},k.controlsFadeDelay))}function p(k){var X,ve,Pe,Ae;if(k.controlsShouldFade){for(X=t.now(),ve=X-k.controlsFadeBeginTime,Pe=1-ve/k.controlsFadeLength,Pe=Math.min(1,Pe),Pe=Math.max(0,Pe),Ae=k.controls.length-1;Ae>=0;Ae--)k.controls[Ae].autoFade&&k.controls[Ae].setOpacity(Pe);Pe>0&&u(k)}}function m(k){var X;for(k.controlsShouldFade=!1,X=k.controls.length-1;X>=0;X--)k.controls[X].setOpacity(1)}function y(){m(this)}function _(){f(this)}function w(k){var X={tracker:k.eventSource,position:k.position,originalEvent:k.originalEvent,preventDefault:k.preventDefault};this.raiseEvent("canvas-contextmenu",X),k.preventDefault=X.preventDefault}function T(k){var X={originalEvent:k.originalEvent,preventDefaultAction:!1,preventVerticalPan:k.preventVerticalPan||!this.panVertical,preventHorizontalPan:k.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",X),!X.preventDefaultAction&&!k.ctrl&&!k.alt&&!k.meta)switch(k.keyCode){case 38:X.preventVerticalPan||(k.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 40:X.preventVerticalPan||(k.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 37:X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 39:X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 87:X.preventVerticalPan||(k.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 83:X.preventVerticalPan||(k.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 65:X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 68:X.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),k.preventDefault=!0;break;case 82:k.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),k.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),k.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:k.preventDefault=!1;break}else k.preventDefault=!1}function x(k){var X={originalEvent:k.originalEvent};this.raiseEvent("canvas-key-press",X)}function C(k){var X,ve=document.activeElement===this.canvas;ve||this.canvas.focus(),this.viewport.flipped&&(k.position.x=this.viewport.getContainerSize().x-k.position.x);var Pe={tracker:k.eventSource,position:k.position,quick:k.quick,shift:k.shift,originalEvent:k.originalEvent,originalTarget:k.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",Pe),!Pe.preventDefaultAction&&this.viewport&&k.quick&&(X=this.gestureSettingsByDeviceType(k.pointerType),X.clickToZoom===!0&&(this.viewport.zoomBy(k.shift?1/this.zoomPerClick:this.zoomPerClick,X.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints()),X.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=t.now()))}function I(k){var X,ve={tracker:k.eventSource,position:k.position,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",ve),!ve.preventDefaultAction&&this.viewport&&(X=this.gestureSettingsByDeviceType(k.pointerType),X.dblClickToZoom&&(this.viewport.zoomBy(k.shift?1/this.zoomPerClick:this.zoomPerClick,X.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints()))}function D(k){var X,ve={tracker:k.eventSource,pointerType:k.pointerType,position:k.position,delta:k.delta,speed:k.speed,direction:k.direction,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",ve),X=this.gestureSettingsByDeviceType(k.pointerType),!ve.preventDefaultAction&&this.viewport){if(X.dblClickDragToZoom&&i[this.hash].draggingToZoom){var Pe=Math.pow(this.zoomPerDblClickDrag,k.delta.y/50);this.viewport.zoomBy(Pe)}else if(X.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(k.delta.x=0),this.panVertical||(k.delta.y=0),this.viewport.flipped&&(k.delta.x=-k.delta.x),this.constrainDuringPan){var Ae=this.viewport.deltaPointsFromPixels(k.delta.negate());this.viewport.centerSpringX.target.value+=Ae.x,this.viewport.centerSpringY.target.value+=Ae.y;var Ve=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=Ae.x,this.viewport.centerSpringY.target.value-=Ae.y,Ve.xConstrained&&(k.delta.x=0),Ve.yConstrained&&(k.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(k.delta.negate()),X.flickEnabled&&!this.constrainDuringPan)}}}function B(k){var X,ve={tracker:k.eventSource,pointerType:k.pointerType,position:k.position,speed:k.speed,direction:k.direction,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",ve),X=this.gestureSettingsByDeviceType(k.pointerType),!ve.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&X.flickEnabled&&k.speed>=X.flickMinSpeed){var Pe=0;this.panHorizontal&&(Pe=X.flickMomentum*k.speed*Math.cos(k.direction));var Ae=0;this.panVertical&&(Ae=X.flickMomentum*k.speed*Math.sin(k.direction));var Ve=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),ze=this.viewport.pointFromPixel(new t.Point(Ve.x-Pe,Ve.y-Ae));this.viewport.panTo(ze,!1)}this.viewport.applyConstraints()}X.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function N(k){this.raiseEvent("canvas-enter",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function z(k){this.raiseEvent("canvas-exit",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function Z(k){var X;if(this.raiseEvent("canvas-press",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,insideElementPressed:k.insideElementPressed,insideElementReleased:k.insideElementReleased,originalEvent:k.originalEvent}),X=this.gestureSettingsByDeviceType(k.pointerType),X.dblClickDragToZoom){var ve=i[this.hash].lastClickTime,Pe=t.now();if(ve===null)return;Pe-ve<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function q(k){this.raiseEvent("canvas-release",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,insideElementPressed:k.insideElementPressed,insideElementReleased:k.insideElementReleased,originalEvent:k.originalEvent})}function H(k){this.raiseEvent("canvas-nonprimary-press",{tracker:k.eventSource,position:k.position,pointerType:k.pointerType,button:k.button,buttons:k.buttons,originalEvent:k.originalEvent})}function Y(k){this.raiseEvent("canvas-nonprimary-release",{tracker:k.eventSource,position:k.position,pointerType:k.pointerType,button:k.button,buttons:k.buttons,originalEvent:k.originalEvent})}function ee(k){var X,ve,Pe,Ae,Ve={tracker:k.eventSource,pointerType:k.pointerType,gesturePoints:k.gesturePoints,lastCenter:k.lastCenter,center:k.center,lastDistance:k.lastDistance,distance:k.distance,shift:k.shift,originalEvent:k.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",Ve),this.viewport&&(X=this.gestureSettingsByDeviceType(k.pointerType),X.pinchToZoom&&(!Ve.preventDefaultPanAction||!Ve.preventDefaultZoomAction)&&(ve=this.viewport.pointFromPixel(k.center,!0),X.zoomToRefPoint&&!Ve.preventDefaultPanAction&&(Pe=this.viewport.pointFromPixel(k.lastCenter,!0),Ae=Pe.minus(ve),this.panHorizontal||(Ae.x=0),this.panVertical||(Ae.y=0),this.viewport.panBy(Ae,!0)),Ve.preventDefaultZoomAction||this.viewport.zoomBy(k.distance/k.lastDistance,ve,!0),this.viewport.applyConstraints()),X.pinchRotate&&!Ve.preventDefaultRotateAction)){var ze=Math.atan2(k.gesturePoints[0].currentPos.y-k.gesturePoints[1].currentPos.y,k.gesturePoints[0].currentPos.x-k.gesturePoints[1].currentPos.x),vt=Math.atan2(k.gesturePoints[0].lastPos.y-k.gesturePoints[1].lastPos.y,k.gesturePoints[0].lastPos.x-k.gesturePoints[1].lastPos.x);ve=this.viewport.pointFromPixel(k.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(ze-vt)*(180/Math.PI),ve,!0)}}function le(k){this.raiseEvent("canvas-focus",{tracker:k.eventSource,originalEvent:k.originalEvent})}function W(k){this.raiseEvent("canvas-blur",{tracker:k.eventSource,originalEvent:k.originalEvent})}function ie(k){var X,ve,Pe,Ae,Ve;Ae=t.now(),Ve=Ae-this._lastScrollTime,Ve>this.minScrollDeltaTime?(this._lastScrollTime=Ae,X={tracker:k.eventSource,position:k.position,scroll:k.scroll,shift:k.shift,originalEvent:k.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",X),!X.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(k.position.x=this.viewport.getContainerSize().x-k.position.x),ve=this.gestureSettingsByDeviceType(k.pointerType),ve.scrollToZoom&&(Pe=Math.pow(this.zoomPerScroll,k.scroll),this.viewport.zoomBy(Pe,ve.zoomToRefPoint?this.viewport.pointFromPixel(k.position,!0):null),this.viewport.applyConstraints())),k.preventDefault=X.preventDefault):k.preventDefault=!0}function ne(k){i[this.hash].mouseInside=!0,m(this),this.raiseEvent("container-enter",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function J(k){k.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||f(this)),this.raiseEvent("container-exit",{tracker:k.eventSource,pointerType:k.pointerType,position:k.position,buttons:k.buttons,pointers:k.pointers,insideElementPressed:k.insideElementPressed,buttonDownAny:k.buttonDownAny,originalEvent:k.originalEvent})}function ce(k){te(k),k.isOpen()?k._updateRequestId=c(k,ce):k._updateRequestId=!1}function se(k,X){var ve=k.viewport,Pe=ve.getZoom(),Ae=ve.getCenter();ve.resize(X,k.preserveImageSizeOnResize),ve.panTo(Ae,!0);var Ve;if(k.preserveImageSizeOnResize)Ve=i[k.hash].prevContainerSize.x/X.x;else{var ze=new t.Point(0,0),vt=new t.Point(i[k.hash].prevContainerSize.x,i[k.hash].prevContainerSize.y).distanceTo(ze),xt=new t.Point(X.x,X.y).distanceTo(ze);Ve=xt/vt*i[k.hash].prevContainerSize.x/X.x}ve.zoomTo(Pe*Ve,null,!0),i[k.hash].prevContainerSize=X,i[k.hash].forceRedraw=!0,i[k.hash].needsResize=!1,i[k.hash].forceResize=!1}function te(k){if(!(k._opening||!i[k.hash])){if(k.autoResize||i[k.hash].forceResize){var X;if(k._autoResizePolling){X=s(k.container);var ve=i[k.hash].prevContainerSize;X.equals(ve)||(i[k.hash].needsResize=!0)}i[k.hash].needsResize&&se(k,X||s(k.container))}var Pe=k.viewport.update(),Ae=k.world.update()||Pe;Pe&&k.raiseEvent("viewport-change"),k.referenceStrip&&(Ae=k.referenceStrip.update(k.viewport)||Ae);var Ve=i[k.hash].animating;!Ve&&Ae&&(k.raiseEvent("animation-start"),m(k));var ze=Ve&&!Ae;ze&&(i[k.hash].animating=!1),(Ae||ze||i[k.hash].forceRedraw||k.world.needsDraw())&&(Q(k),k._drawOverlays(),k.navigator&&k.navigator.update(k.viewport),i[k.hash].forceRedraw=!1,Ae&&k.raiseEvent("animation")),ze&&(k.raiseEvent("animation-finish"),i[k.hash].mouseInside||f(k)),i[k.hash].animating=Ae}}function Q(k){k.imageLoader.clear(),k.drawer.clear(),k.world.draw(),k.raiseEvent("update-viewport",{})}function _e(k,X){return k?k+X:X}function fe(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,xe(this)}function pe(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,xe(this)}function Ce(){i[this.hash].zooming=!1}function xe(k){t.requestAnimationFrame(t.delegate(k,Le))}function Le(){var k,X,ve;i[this.hash].zooming&&this.viewport&&(k=t.now(),X=k-i[this.hash].lastZoomTime,ve=Math.pow(i[this.hash].zoomFactor,X/1e3),this.viewport.zoomBy(ve),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=k,xe(this))}function je(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ke(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lt(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function ct(){this.viewport&&this.viewport.goHome()}function Ht(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Vt(){if(this.viewport){var k=this.viewport.getRotation();this.viewport.flipped?k+=this.rotationIncrement:k-=this.rotationIncrement,this.viewport.setRotation(k)}}function ii(){if(this.viewport){var k=this.viewport.getRotation();this.viewport.flipped?k-=this.rotationIncrement:k+=this.rotationIncrement,this.viewport.setRotation(k)}}function Yt(){this.viewport.toggleFlip()}}(e),function(t){t.Navigator=function(c){var u=c.viewer,f=this,p,m;c.element||c.id?(c.element?(c.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),c.element.id?c.id=c.element.id:c.id="navigator-"+t.now(),this.element=c.element):this.element=document.getElementById(c.id),c.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(c.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),c.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:c.autoFade},c.position&&(c.position==="BOTTOM_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:c.position==="BOTTOM_LEFT"?c.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:c.position==="TOP_RIGHT"?c.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:c.position==="TOP_LEFT"?c.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:c.position==="ABSOLUTE"&&(c.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,c.controlOptions.top=c.top,c.controlOptions.left=c.left,c.controlOptions.height=c.height,c.controlOptions.width=c.width))),this.element.id=c.id,this.element.className+=" navigator",c=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},c,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:c.animationTime,autoResize:!1,minZoomImageRatio:1,background:c.background,opacity:c.opacity,borderColor:c.borderColor,displayRegionColor:c.displayRegionColor}),c.minPixelRatio=this.minPixelRatio=u.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),c.controlOptions.anchor!==t.ControlAnchor.NONE&&function(w,T){w.margin="0px",w.border=T+"px solid "+c.borderColor,w.padding="0px",w.background=c.background,w.opacity=c.opacity,w.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(w,T){w.position="relative",w.top="0px",w.left="0px",w.fontSize="0px",w.overflow="hidden",w.border=T+"px solid "+c.displayRegionColor,w.margin="0px",w.padding="0px",w.background="transparent",w.float="left",w.cssFloat="left",w.styleFloat="left",w.zIndex=999999999,w.cursor="default",w.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),u.addControl(this.element,c.controlOptions),this._resizeWithViewer=c.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&c.controlOptions.anchor!==t.ControlAnchor.NONE,c.width&&c.height?(this.setWidth(c.width),this.setHeight(c.height)):this._resizeWithViewer&&(p=t.getElementSize(u.element),this.element.style.height=Math.round(p.y*c.sizeRatio)+"px",this.element.style.width=Math.round(p.x*c.sizeRatio)+"px",this.oldViewerSize=p,m=t.getElementSize(this.element),this.elementArea=m.x*m.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[c]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function y(w,T){a(f.displayRegionContainer,w),a(f.displayRegion,-w),f.viewport.setRotation(w,T)}if(c.navigatorRotate){var _=c.viewer.viewport?c.viewer.viewport.getRotation():c.viewer.degrees||0;y(_,!0),c.viewer.addHandler("rotate",function(w){y(w.degrees,w.immediately)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,r),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,s),scrollHandler:t.delegate(this,o),preProcessEventHandler:function(w){w.eventType==="wheel"&&(w.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){f.viewport&&f.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(w){window.setTimeout(function(){var T=f.world.getItemAt(w.previousIndex);f.world.setItemIndex(T,w.newIndex)},1)}),u.world.addHandler("remove-item",function(w){var T=w.item,x=f._getMatchingItem(T);x&&f.world.removeItem(x)}),this.update(u.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var c=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);c.equals(this.oldContainerSize)||(this.viewport.resize(c,!0),this.viewport.goHome(!0),this.oldContainerSize=c,this.drawer.clear(),this.world.draw())}},setWidth:function(c){this.width=c,this.element.style.width=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(c){this.height=c,this.element.style.height=typeof c=="number"?c+"px":c,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(c){return this.viewport.setFlip(c),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(c){l(this.displayRegion,c),l(this.canvas,c),l(this.element,c)},update:function(c){var u,f,p,m,y,_;if(u=t.getElementSize(this.viewer.element),this._resizeWithViewer&&u.x&&u.y&&!u.equals(this.oldViewerSize)&&(this.oldViewerSize=u,this.maintainSizeRatio||!this.elementArea?(f=u.x*this.sizeRatio,p=u.y*this.sizeRatio):(f=Math.sqrt(this.elementArea*(u.x/u.y)),p=this.elementArea/f),this.element.style.width=Math.round(f)+"px",this.element.style.height=Math.round(p)+"px",this.elementArea||(this.elementArea=f*p),this.updateSize()),c&&this.viewport){if(m=c.getBoundsNoRotate(!0),y=this.viewport.pixelFromPointNoRotate(m.getTopLeft(),!1),_=this.viewport.pixelFromPointNoRotate(m.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var w=c.getRotation(!0);a(this.displayRegion,-w)}var T=this.displayRegion.style;T.display=this.world.getItemCount()?"block":"none",T.top=y.y.toFixed(2)+"px",T.left=y.x.toFixed(2)+"px";var x=_.x-y.x,C=_.y-y.y;T.width=Math.round(Math.max(x,0))+"px",T.height=Math.round(Math.max(C,0))+"px"}},addTiledImage:function(c){var u=this,f=c.originalTiledImage;delete c.original;var p=t.extend({},c,{success:function(m){var y=m.item;y._originalForNavigator=f,u._matchBounds(y,f,!0),u._matchOpacity(y,f),u._matchCompositeOperation(y,f);function _(){u._matchBounds(y,f)}function w(){u._matchOpacity(y,f)}function T(){u._matchCompositeOperation(y,f)}f.addHandler("bounds-change",_),f.addHandler("clip-change",_),f.addHandler("opacity-change",w),f.addHandler("composite-operation-change",T)}});return t.Viewer.prototype.addTiledImage.apply(this,[p])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(c){for(var u=this.world.getItemCount(),f,p=0;p<u;p++)if(f=this.world.getItemAt(p),f._originalForNavigator===c)return f;return null},_matchBounds:function(c,u,f){var p=u.getBoundsNoRotate();c.setPosition(p.getTopLeft(),f),c.setWidth(p.width,f),c.setRotation(u.getRotation(),f),c.setClip(u.getClip()),c.setFlip(u.getFlip())},_matchOpacity:function(c,u){c.setOpacity(u.opacity)},_matchCompositeOperation:function(c,u){c.setCompositeOperation(u.compositeOperation)}});function i(c){var u={tracker:c.eventSource,position:c.position,quick:c.quick,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&c.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(c.position.x=this.viewport.getContainerSize().x-c.position.x);var f=this.viewport.pointFromPixel(c.position);this.panVertical?this.panHorizontal||(f.x=this.viewer.viewport.getCenter(!0).x):f.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(f),this.viewer.viewport.applyConstraints()}}function r(c){var u={tracker:c.eventSource,position:c.position,delta:c.delta,speed:c.speed,direction:c.direction,shift:c.shift,originalEvent:c.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(c.delta.x=0),this.panVertical||(c.delta.y=0),this.viewer.viewport.flipped&&(c.delta.x=-c.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(c.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function s(c){c.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(c){var u={tracker:c.eventSource,position:c.position,scroll:c.scroll,shift:c.shift,originalEvent:c.originalEvent,preventDefault:c.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),c.preventDefault=u.preventDefault}function a(c,u){l(c,"rotate("+u+"deg)")}function l(c,u){c.style.webkitTransform=u,c.style.mozTransform=u,c.style.msTransform=u,c.style.oTransform=u,c.style.transform=u}}(e),function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(r){var s=r.split("."),o=null,a=arguments,l=i,c;for(c=0;c<s.length-1;c++)l=l[s[c]]||{};return o=l[s[c]],typeof o!="string"&&(t.console.error("Untranslated source string:",r),o=""),o.replace(/\{\d+\}/g,function(u){var f=parseInt(u.match(/\d+/),10)+1;return f<a.length?a[f]:""})},setString:function(r,s){var o=r.split("."),a=i,l;for(l=0;l<o.length-1;l++)a[o[l]]||(a[o[l]]={}),a=a[o[l]];a[o[l]]=s}})}(e),function(t){t.Point=function(i,r){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,r){r=r||new t.Point(0,0);var s,o;if(i%90===0){var a=t.positiveModulo(i,360);switch(a){case 0:s=1,o=0;break;case 90:s=0,o=1;break;case 180:s=-1,o=0;break;case 270:s=0,o=-1;break}}else{var l=i*Math.PI/180;s=Math.cos(l),o=Math.sin(l)}var c=s*(this.x-r.x)-o*(this.y-r.y)+r.x,u=o*(this.x-r.x)+s*(this.y-r.y)+r.y;return new t.Point(c,u)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(e),function(t){t.TileSource=function(r,s,o,a,l,c){var u=this,f=arguments,p,m;if(t.isPlainObject(r)?p=r:p={width:f[0],height:f[1],tileSize:f[2],tileOverlap:f[3],minLevel:f[4],maxLevel:f[5]},t.EventSource.call(this),t.extend(!0,this,p),!this.success){for(m=0;m<arguments.length;m++)if(t.isFunction(arguments[m])){this.success=arguments[m];break}}this.success&&this.addHandler("ready",function(y){u.success(y)}),t.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=p.width&&p.height?p.width/p.height:1,this.dimensions=new t.Point(p.width,p.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=p.tileOverlap?p.tileOverlap:0,this.minLevel=p.minLevel?p.minLevel:0,this.maxLevel=p.maxLevel!==void 0&&p.maxLevel!==null?p.maxLevel:p.width&&p.height?Math.ceil(Math.log(Math.max(p.width,p.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(r){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(r){return this._tileWidth?this._tileWidth:this.getTileSize(r)},getTileHeight:function(r){return this._tileHeight?this._tileHeight:this.getTileSize(r)},setMaxLevel:function(r){this.maxLevel=r,this._memoizeLevelScale()},getLevelScale:function(r){return this._memoizeLevelScale(),this.getLevelScale(r)},_memoizeLevelScale:function(){var r={},s;for(s=0;s<=this.maxLevel;s++)r[s]=1/Math.pow(2,this.maxLevel-s);this.getLevelScale=function(o){return r[o]}},getNumTiles:function(r){var s=this.getLevelScale(r),o=Math.ceil(s*this.dimensions.x/this.getTileWidth(r)),a=Math.ceil(s*this.dimensions.y/this.getTileHeight(r));return new t.Point(o,a)},getPixelRatio:function(r){var s=this.dimensions.times(this.getLevelScale(r)),o=1/s.x*t.pixelDensityRatio,a=1/s.y*t.pixelDensityRatio;return new t.Point(o,a)},getClosestLevel:function(){var r,s;for(r=this.minLevel+1;r<=this.maxLevel&&(s=this.getNumTiles(r),!(s.x>1||s.y>1));r++);return r-1},getTileAtPoint:function(r,s){var o=s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/this.aspectRatio;t.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(r),l=s.x*a,c=s.y*a,u=Math.floor(l/this.getTileWidth(r)),f=Math.floor(c/this.getTileHeight(r));s.x>=1&&(u=this.getNumTiles(r).x-1);var p=1e-15;return s.y>=1/this.aspectRatio-p&&(f=this.getNumTiles(r).y-1),new t.Point(u,f)},getTileBounds:function(r,s,o,a){var l=this.dimensions.times(this.getLevelScale(r)),c=this.getTileWidth(r),u=this.getTileHeight(r),f=s===0?0:c*s-this.tileOverlap,p=o===0?0:u*o-this.tileOverlap,m=c+(s===0?1:2)*this.tileOverlap,y=u+(o===0?1:2)*this.tileOverlap,_=1/l.x;return m=Math.min(m,l.x-f),y=Math.min(y,l.y-p),a?new t.Rect(0,0,m,y):new t.Rect(f*_,p*_,m*_,y*_)},getImageInfo:function(r){var s=this,o,a,l,c,u,f,p;r&&(u=r.split("/"),f=u[u.length-1],p=f.lastIndexOf("."),p>-1&&(u[u.length-1]=f.slice(0,p)));var m=null;if(this.splitHashDataForPost){var y=r.indexOf("#");y!==-1&&(m=r.substring(y+1),r=r.substr(0,y))}a=function(_){typeof _=="string"&&(_=t.parseXml(_));var w=t.TileSource.determineType(s,_,r);if(!w){s.raiseEvent("open-failed",{message:"Unable to load TileSource",source:r});return}c=w.prototype.configure.apply(s,[_,r,m]),c.ajaxWithCredentials===void 0&&(c.ajaxWithCredentials=s.ajaxWithCredentials),l=new w(c),s.ready=!0,s.raiseEvent("ready",{tileSource:l})},r.match(/\.js$/)?(o=r.split("/").pop().replace(".js",""),t.jsonp({url:r,async:!1,callbackName:o,callback:a})):t.makeAjaxRequest({url:r,postData:m,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(_){var w=i(_);a(w)},error:function(_,w){var T;try{T="HTTP "+_.status+" attempting to load TileSource: "+r}catch{var x;typeof w>"u"||!w.toString?x="Unknown error":x=w.toString(),T=x+" attempting to load TileSource: "+r}t.console.error(T),s.raiseEvent("open-failed",{message:T,source:r,postData:m})}})},supports:function(r,s){return!1},configure:function(r,s,o){throw new Error("Method not implemented.")},getTileUrl:function(r,s,o){throw new Error("Method not implemented.")},getTilePostData:function(r,s,o){return null},getTileAjaxHeaders:function(r,s,o){return{}},getTileHashKey:function(r,s,o,a,l,c){function u(f){return l?f+"+"+JSON.stringify(l):f}return u(typeof a!="string"?r+"/"+s+"_"+o:a)},tileExists:function(r,s,o){var a=this.getNumTiles(r);return r>=this.minLevel&&r<=this.maxLevel&&s>=0&&o>=0&&s<a.x&&o<a.y},hasTransparency:function(r,s,o,a){return!!r||s.match(".png")},downloadTileStart:function(r){var s=r.userData,o=new Image;s.image=o,s.request=null;var a=function(l){if(!o){r.finish(null,s.request,"Image load failed: undefined Image instance.");return}o.onload=o.onerror=o.onabort=null,r.finish(l?null:o,s.request,l)};o.onload=function(){a()},o.onabort=o.onerror=function(){a("Image load aborted.")},r.loadWithAjax?s.request=t.makeAjaxRequest({url:r.src,withCredentials:r.ajaxWithCredentials,headers:r.ajaxHeaders,responseType:"arraybuffer",postData:r.postData,success:function(l){var c;try{c=new window.Blob([l.response])}catch(p){var u=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(p.name==="TypeError"&&u){var f=new u;f.append(l.response),c=f.getBlob()}}c.size===0?a("Empty image response."):o.src=(window.URL||window.webkitURL).createObjectURL(c)},error:function(l){a("Image load aborted - XHR error")}}):(r.crossOriginPolicy!==!1&&(o.crossOrigin=r.crossOriginPolicy),o.src=r.src)},downloadTileAbort:function(r){r.userData.request&&r.userData.request.abort();var s=r.userData.image;r.userData.image&&(s.onload=s.onerror=s.onabort=null)},createTileCache:function(r,s,o){r._data=s},destroyTileCache:function(r){r._data=null,r._renderedContext=null},getTileCacheData:function(r){return r._data},getTileCacheDataAsImage:function(r){return r._data},getTileCacheDataAsContext2D:function(r){if(!r._renderedContext){var s=document.createElement("canvas");s.width=r._data.width,s.height=r._data.height,r._renderedContext=s.getContext("2d"),r._renderedContext.drawImage(r._data,0,0),r._data=null}return r._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function i(r){var s=r.responseText,o=r.status,a,l;if(r){if(r.status!==200&&r.status!==0)throw o=r.status,a=o===404?"Not Found":r.statusText,new Error(t.getString("Errors.Status",o,a))}else throw new Error(t.getString("Errors.Security"));if(s.match(/^\s*<.*/))try{l=r.responseXML&&r.responseXML.documentElement?r.responseXML:t.parseXml(s)}catch{l=r.responseText}else if(s.match(/\s*[{[].*/))try{l=t.parseJSON(s)}catch{l=s}else l=s;return l}t.TileSource.determineType=function(r,s,o){var a;for(a in e)if(a.match(/.+TileSource$/)&&t.isFunction(e[a])&&t.isFunction(e[a].prototype.supports)&&e[a].prototype.supports.call(r,s,o))return e[a];return t.console.error("No TileSource was able to open %s %s",o,s),null}}(e),function(t){t.DziTileSource=function(s,o,a,l,c,u,f,p,m){var y,_,w,T;if(t.isPlainObject(s)?T=s:T={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=T.tilesUrl,this.fileFormat=T.fileFormat,this.displayRects=T.displayRects,this.displayRects)for(y=this.displayRects.length-1;y>=0;y--)for(_=this.displayRects[y],w=_.minLevel;w<=_.maxLevel;w++)this._levelRects[w]||(this._levelRects[w]=[]),this._levelRects[w].push(_);t.TileSource.apply(this,[T])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(s,o){var a;return s.Image?a=s.Image.xmlns:s.documentElement&&(s.documentElement.localName==="Image"||s.documentElement.tagName==="Image")&&(a=s.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(s,o,a){var l;return t.isPlainObject(s)?l=r(this,s):l=i(this,s),o&&!l.tilesUrl&&(l.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?l.queryParams=o.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(s,o,a){return[this.tilesUrl,s,"/",o,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(s,o,a){var l=this._levelRects[s],c,u,f,p,m,y,_;if(this.minLevel&&s<this.minLevel||this.maxLevel&&s>this.maxLevel)return!1;if(!l||!l.length)return!0;for(_=l.length-1;_>=0;_--)if(c=l[_],!(s<c.minLevel||s>c.maxLevel)&&(u=this.getLevelScale(s),f=c.x*u,p=c.y*u,m=f+c.width*u,y=p+c.height*u,f=Math.floor(f/this._tileWidth),p=Math.floor(p/this._tileWidth),m=Math.ceil(m/this._tileWidth),y=Math.ceil(y/this._tileWidth),f<=o&&o<m&&p<=a&&a<y))return!0;return!1}});function i(s,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,l=a.localName||a.tagName,c=o.documentElement.namespaceURI,u=null,f=[],p,m,y,_,w;if(l==="Image")try{if(_=a.getElementsByTagName("Size")[0],_===void 0&&(_=a.getElementsByTagNameNS(c,"Size")[0]),u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(_.getAttribute("Height"),10),Width:parseInt(_.getAttribute("Width"),10)}}},!t.imageFormatSupported(u.Image.Format))throw new Error(t.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(p=a.getElementsByTagName("DisplayRect"),p===void 0&&(p=a.getElementsByTagNameNS(c,"DisplayRect")[0]),w=0;w<p.length;w++)m=p[w],y=m.getElementsByTagName("Rect")[0],y===void 0&&(y=m.getElementsByTagNameNS(c,"Rect")[0]),f.push({Rect:{X:parseInt(y.getAttribute("X"),10),Y:parseInt(y.getAttribute("Y"),10),Width:parseInt(y.getAttribute("Width"),10),Height:parseInt(y.getAttribute("Height"),10),MinLevel:parseInt(m.getAttribute("MinLevel"),10),MaxLevel:parseInt(m.getAttribute("MaxLevel"),10)}});return f.length&&(u.Image.DisplayRect=f),r(s,u)}catch(C){throw C instanceof Error?C:new Error(t.getString("Errors.Dzi"))}else{if(l==="Collection")throw new Error(t.getString("Errors.Dzc"));if(l==="Error"){var T=a.getElementsByTagName("Message")[0],x=T.firstChild.nodeValue;throw new Error(x)}}throw new Error(t.getString("Errors.Dzi"))}function r(s,o){var a=o.Image,l=a.Url,c=a.Format,u=a.Size,f=a.DisplayRect||[],p=parseInt(u.Width,10),m=parseInt(u.Height,10),y=parseInt(a.TileSize,10),_=parseInt(a.Overlap,10),w=[],T,x;for(x=0;x<f.length;x++)T=f[x].Rect,w.push(new t.DisplayRect(parseInt(T.X,10),parseInt(T.Y,10),parseInt(T.Width,10),parseInt(T.Height,10),parseInt(T.MinLevel,10),parseInt(T.MaxLevel,10)));return t.extend(!0,{width:p,height:m,tileSize:y,tileOverlap:_,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:c,displayRects:w},o)}}(e),function(t){t.IIIFTileSource=function(a){if(t.extend(!0,this,a),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var c=0;c<this.tiles[l].scaleFactors.length;c++){var u=this.tiles[l].scaleFactors[c];this.scale_factors.push(u),a.tileSizePerScaleFactor[u]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(i(a)){for(var f=Math.min(this.height,this.width),p=[256,512,1024],m=[],y=0;y<p.length;y++)p[y]<=f&&m.push(p[y]);m.length>0?a.tileSize=Math.max.apply(null,m):a.tileSize=f}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=r(this),t.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var _=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(_)*Math.LOG2E)}if(this.sizes){var w=this.sizes.length;(w===a.maxLevel||w===a.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort(function(T,x){return T.width-x.width}),w===a.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}t.TileSource.apply(this,[a])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(a,l){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,l,c){if(t.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=l.replace("/info.json",""),a.version=1;else{var f=a["@context"];if(Array.isArray(f)){for(var p=0;p<f.length;p++)if(typeof f[p]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(f[p])||f[p]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){f=f[p];break}}switch(f){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(a.preferredFormats){for(var m=0;m<a.preferredFormats.length;m++)if(e.imageFormatSupported(a.preferredFormats[m])){a.tileFormat=a.preferredFormats[m];break}}return a}else{var u=s(a);return u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=l.replace("/info.xml",""),u.version=1,u}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var l=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(l=this.levels[a].width/this.levels[this.maxLevel].width),l}return t.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var l=this.getLevelScale(a);return l?new t.Point(1,1):new t.Point(0,0)}if(this.levelSizes){var c=this.levelSizes[a],u=Math.ceil(c.width/this.getTileWidth(a)),f=Math.ceil(c.height/this.getTileHeight(a));return new t.Point(u,f)}else return t.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,l){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var c=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;t.console.assert(c,"[TileSource.getTileAtPoint] must be called with a valid point.");var u=this.levelSizes[a].width,f=l.x*u,p=l.y*u,m=Math.floor(f/this.getTileWidth(a)),y=Math.floor(p/this.getTileHeight(a));l.x>=1&&(m=this.getNumTiles(a).x-1);var _=1e-15;return l.y>=1/this.aspectRatio-_&&(y=this.getNumTiles(a).y-1),new t.Point(m,y)}return t.TileSource.prototype.getTileAtPoint.call(this,a,l)},getTileUrl:function(a,l,c){if(this.emulateLegacyImagePyramid){var u=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(u=this.levels[a].url),u}var f="0",p=Math.pow(.5,this.maxLevel-a),m,y,_,w,T,x,C,I,D,B,N,z,Z,q,H,Y;return this.levelSizes?(m=this.levelSizes[a].width,y=this.levelSizes[a].height):(m=Math.ceil(this.width*p),y=Math.ceil(this.height*p)),_=this.getTileWidth(a),w=this.getTileHeight(a),T=Math.round(_/p),x=Math.round(w/p),this.version===1?H="native."+this.tileFormat:H="default."+this.tileFormat,m<_&&y<w?(this.version===2&&m===this.width?z="full":this.version===3&&m===this.width&&y===this.height?z="max":this.version===3?z=m+","+y:z=m+",",C="full"):(I=l*T,D=c*x,B=Math.min(T,this.width-I),N=Math.min(x,this.height-D),l===0&&c===0&&B===this.width&&N===this.height?C="full":C=[I,D,B,N].join(","),Z=Math.min(_,m-l*_),q=Math.min(w,y-c*w),this.version===2&&Z===this.width?z="full":this.version===3&&Z===this.width&&q===this.height?z="max":this.version===3?z=Z+","+q:z=Z+","),Y=[this._id,C,z,f,H].join("/"),Y},__testonly__:{canBeTiled:i,constructLevels:r}});function i(a){var l=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],c=Array.isArray(a.profile)?a.profile[0]:a.profile,u=l.indexOf(c)!==-1,f=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(f=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(f=a.extraFeatures.indexOf("sizeByWh")!==-1),!u||f}function r(a){for(var l=[],c=0;c<a.sizes.length;c++)l.push({url:a._id+"/full/"+a.sizes[c].width+","+(a.version===3?a.sizes[c].height:"")+"/0/default."+a.tileFormat,width:a.sizes[c].width,height:a.sizes[c].height});return l.sort(function(u,f){return u.width-f.width})}function s(a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var l=a.documentElement,c=l.tagName,u=null;if(c==="info")try{return u={},o(l,u),u}catch(f){throw f instanceof Error?f:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function o(a,l,c){var u,f;if(a.nodeType===3&&c)f=a.nodeValue.trim(),f.match(/^\d*$/)&&(f=Number(f)),l[c]?(t.isArray(l[c])||(l[c]=[l[c]]),l[c].push(f)):l[c]=f;else if(a.nodeType===1)for(u=0;u<a.childNodes.length;u++)o(a.childNodes[u],l,a.nodeName)}}(e),function(t){t.OsmTileSource=function(i,r,s,o,a){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!l.width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,t.TileSource.apply(this,[l])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="openstreetmaps"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){return this.tilesUrl+(i-8)+"/"+r+"/"+s+".png"}})}(e),function(t){t.TmsTileSource=function(i,r,s,o,a){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var c=Math.ceil(l.width/256)*256,u=Math.ceil(l.height/256)*256,f;c>u?f=c/256:f=u/256,l.maxLevel=Math.ceil(Math.log(f)/Math.log(2))-1,l.tileSize=256,l.width=c,l.height=u,t.TileSource.apply(this,[l])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="tiledmapservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var o=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+r+"/"+(o-s)+".png"}})}(e),function(t){t.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var r={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(r.x,10)>i.tileSize||parseInt(r.y,10)>i.tileSize;)r.x=Math.floor(r.x/2),r.y=Math.floor(r.y/2),i.imageSizes.push({x:r.x,y:r.y}),i.gridSize.push(this._getGridSize(r.x,r.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(i,r,s){return{x:Math.ceil(i/s),y:Math.ceil(r/s)}},_calculateAbsoluteTileNumber:function(i,r,s){for(var o=0,a={},l=0;l<i;l++)a=this.gridSize[l],o+=a.x*a.y;return a=this.gridSize[i],o+=a.x*s+r,o},supports:function(i,r){return i.type&&i.type==="zoomifytileservice"},configure:function(i,r,s){return i},getTileUrl:function(i,r,s){var o=0,a=this._calculateAbsoluteTileNumber(i,r,s);return o=Math.floor(a/256),this.tilesUrl+"TileGroup"+o+"/"+i+"-"+r+"-"+s+"."+this.fileFormat}})}(e),function(t){t.LegacyTileSource=function(o){var a,l,c;t.isArray(o)&&(a={type:"legacy-image-pyramid",levels:o}),a.levels=i(a.levels),a.levels.length>0?(l=a.levels[a.levels.length-1].width,c=a.levels[a.levels.length-1].height):(l=0,c=0,t.console.error("No supported image formats found")),t.extend(!0,a,{width:l,height:c,tileSize:Math.max(c,l),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),t.TileSource.apply(this,[a]),this.levels=a.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(o,a){return o.type&&o.type==="legacy-image-pyramid"||o.documentElement&&o.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(o,a,l){var c;return t.isPlainObject(o)?c=s(this,o):c=r(this,o),c},getLevelScale:function(o){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a},getNumTiles:function(o){var a=this.getLevelScale(o);return a?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(o,a,l){var c=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(c=this.levels[o].url),c}});function i(o){var a=[],l,c;for(c=0;c<o.length;c++)l=o[c],l.height&&l.width&&l.url?a.push({url:l.url,width:Number(l.width),height:Number(l.height)}):t.console.error("Unsupported image format: %s",l.url?l.url:"<no URL>");return a.sort(function(u,f){return u.height-f.height})}function r(o,a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var l=a.documentElement,c=l.tagName,u=null,f=[],p,m;if(c==="image")try{for(u={type:l.getAttribute("type"),levels:[]},f=l.getElementsByTagName("level"),m=0;m<f.length;m++)p=f[m],u.levels.push({url:p.getAttribute("url"),width:parseInt(p.getAttribute("width"),10),height:parseInt(p.getAttribute("height"),10)});return s(o,u)}catch(y){throw y instanceof Error?y:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(c==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(c==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+c)}function s(o,a){return a.levels}}(e),function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="image"},configure:function(i,r,s){return i},getImageInfo:function(i){var r=this._image=new Image,s=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),t.addEvent(r,"load",function(){s.width=r.naturalWidth,s.height=r.naturalHeight,s.aspectRatio=s.width/s.height,s.dimensions=new t.Point(s.width,s.height),s._tileWidth=s.width,s._tileHeight=s.height,s.tileOverlap=0,s.minLevel=0,s.levels=s._buildLevels(),s.maxLevel=s.levels.length-1,s.ready=!0,s.raiseEvent("ready",{tileSource:s})}),t.addEvent(r,"error",function(){s.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),r.src=i},getLevelScale:function(i){var r=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(r=this.levels[i].width/this.levels[this.maxLevel].width),r},getNumTiles:function(i){var r=this.getLevelScale(i);return r?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(i,r,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].url),o},getContext2D:function(i,r,s){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].context2D),o},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,i;var r=this._image.naturalWidth,s=this._image.naturalHeight,o=document.createElement("canvas"),a=o.getContext("2d");if(o.width=r,o.height=s,a.drawImage(this._image,0,0,r,s),i[0].context2D=a,delete this._image,t.isCanvasTainted(o))return i;for(;r>=2&&s>=2;){r=Math.floor(r/2),s=Math.floor(s/2);var l=document.createElement("canvas"),c=l.getContext("2d");l.width=r,l.height=s,c.drawImage(o,0,0,r,s),i.splice(0,0,{context2D:c,width:r,height:s}),o=l,a=c}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})}(e),function(t){t.TileSourceCollection=function(i,r,s,o){t.console.error("TileSourceCollection is deprecated; use World instead")}}(e),function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(c){var u=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},c),this.element=c.element||t.makeNeutralElement("div"),c.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor===t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(f){f.insideElementPressed?(a(u,t.ButtonState.DOWN),u.raiseEvent("enter",{originalEvent:f.originalEvent})):f.buttonDownAny||a(u,t.ButtonState.HOVER)},focusHandler:function(f){u.tracker.enterHandler(f),u.raiseEvent("focus",{originalEvent:f.originalEvent})},leaveHandler:function(f){l(u,t.ButtonState.GROUP),f.insideElementPressed&&u.raiseEvent("exit",{originalEvent:f.originalEvent})},blurHandler:function(f){u.tracker.leaveHandler(f),u.raiseEvent("blur",{originalEvent:f.originalEvent})},pressHandler:function(f){a(u,t.ButtonState.DOWN),u.raiseEvent("press",{originalEvent:f.originalEvent})},releaseHandler:function(f){f.insideElementPressed&&f.insideElementReleased?(l(u,t.ButtonState.HOVER),u.raiseEvent("release",{originalEvent:f.originalEvent})):f.insideElementPressed?l(u,t.ButtonState.GROUP):a(u,t.ButtonState.HOVER)},clickHandler:function(f){f.quick&&u.raiseEvent("click",{originalEvent:f.originalEvent})},keyHandler:function(f){f.keyCode===13?(u.raiseEvent("click",{originalEvent:f.originalEvent}),u.raiseEvent("release",{originalEvent:f.originalEvent}),f.preventDefault=!0):f.preventDefault=!1}}),l(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){a(this,t.ButtonState.GROUP)},notifyGroupExit:function(){l(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(c){t.requestAnimationFrame(function(){r(c)})}function r(c){var u,f,p;c.shouldFade&&(u=t.now(),f=u-c.fadeBeginTime,p=1-f/c.fadeLength,p=Math.min(1,p),p=Math.max(0,p),c.imgGroup&&t.setElementOpacity(c.imgGroup,p,!0),p>0&&i(c))}function s(c){c.shouldFade=!0,c.fadeBeginTime=t.now()+c.fadeDelay,window.setTimeout(function(){i(c)},c.fadeDelay)}function o(c){c.shouldFade=!1,c.imgGroup&&t.setElementOpacity(c.imgGroup,1,!0)}function a(c,u){c.element.disabled||(u>=t.ButtonState.GROUP&&c.currentState===t.ButtonState.REST&&(o(c),c.currentState=t.ButtonState.GROUP),u>=t.ButtonState.HOVER&&c.currentState===t.ButtonState.GROUP&&(c.imgHover&&(c.imgHover.style.visibility=""),c.currentState=t.ButtonState.HOVER),u>=t.ButtonState.DOWN&&c.currentState===t.ButtonState.HOVER&&(c.imgDown&&(c.imgDown.style.visibility=""),c.currentState=t.ButtonState.DOWN))}function l(c,u){c.element.disabled||(u<=t.ButtonState.HOVER&&c.currentState===t.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=t.ButtonState.HOVER),u<=t.ButtonState.GROUP&&c.currentState===t.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=t.ButtonState.GROUP),u<=t.ButtonState.REST&&c.currentState===t.ButtonState.GROUP&&(s(c),c.currentState=t.ButtonState.REST))}}(e),function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var r=this.buttons.concat([]),s=this,o;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",o=0;o<r.length;o++)this.element.appendChild(r[o].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var l;for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupEnter()},leaveHandler:function(a){var l;if(!a.insideElementPressed)for(l=0;l<s.buttons.length;l++)s.buttons[l].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(e),function(t){t.Rect=function(i,r,s,o,a){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0,this.width=typeof s=="number"?s:0,this.height=typeof o=="number"?o:0,this.degrees=typeof a=="number"?a:0,this.degrees=t.positiveModulo(this.degrees,360);var l,c;this.degrees>=270?(l=this.getTopRight(),this.x=l.x,this.y=l.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=270):this.degrees>=180?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):this.degrees>=90&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,c=this.height,this.height=this.width,this.width=c,this.degrees-=90)},t.Rect.fromSummits=function(i,r,s){var o=i.distanceTo(r),a=i.distanceTo(s),l=r.minus(i),c=Math.atan(l.y/l.x);return l.x<0?c+=Math.PI:l.y<0&&(c+=2*Math.PI),new t.Rect(i.x,i.y,o,a,c/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var r=this.getBoundingBox(),s=i.getBoundingBox(),o=Math.min(r.x,s.x),a=Math.min(r.y,s.y),l=Math.max(r.x+r.width,s.x+s.width),c=Math.max(r.y+r.height,s.y+s.height);return new t.Rect(o,a,l-o,c-a)},intersection:function(i){var r=1e-10,s=[],o=this.getTopLeft();i.containsPoint(o,r)&&s.push(o);var a=this.getTopRight();i.containsPoint(a,r)&&s.push(a);var l=this.getBottomLeft();i.containsPoint(l,r)&&s.push(l);var c=this.getBottomRight();i.containsPoint(c,r)&&s.push(c);var u=i.getTopLeft();this.containsPoint(u,r)&&s.push(u);var f=i.getTopRight();this.containsPoint(f,r)&&s.push(f);var p=i.getBottomLeft();this.containsPoint(p,r)&&s.push(p);var m=i.getBottomRight();this.containsPoint(m,r)&&s.push(m);for(var y=this._getSegments(),_=i._getSegments(),w=0;w<y.length;w++)for(var T=y[w],x=0;x<_.length;x++){var C=_[x],I=D(T[0],T[1],C[0],C[1]);I&&s.push(I)}function D(Y,ee,le,W){var ie=ee.minus(Y),ne=W.minus(le),J=-ne.x*ie.y+ie.x*ne.y;if(J===0)return null;var ce=(ie.x*(Y.y-le.y)-ie.y*(Y.x-le.x))/J,se=(ne.x*(Y.y-le.y)-ne.y*(Y.x-le.x))/J;return-r<=ce&&ce<=1-r&&-r<=se&&se<=1-r?new t.Point(Y.x+se*ie.x,Y.y+se*ie.y):null}if(s.length===0)return null;for(var B=s[0].x,N=s[0].x,z=s[0].y,Z=s[0].y,q=1;q<s.length;q++){var H=s[q];H.x<B&&(B=H.x),H.x>N&&(N=H.x),H.y<z&&(z=H.y),H.y>Z&&(Z=H.y)}return new t.Rect(B,z,N-B,Z-z)},_getSegments:function(){var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight();return[[i,r],[r,o],[o,s],[s,i]]},rotate:function(i,r){if(i=t.positiveModulo(i,360),i===0)return this.clone();r=r||this.getCenter();var s=this.getTopLeft().rotate(i,r),o=this.getTopRight().rotate(i,r),a=o.minus(s);a=a.apply(function(c){var u=1e-15;return Math.abs(c)<u?0:c});var l=Math.atan(a.y/a.x);return a.x<0?l+=Math.PI:a.y<0&&(l+=2*Math.PI),new t.Rect(s.x,s.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),r=this.getTopRight(),s=this.getBottomLeft(),o=this.getBottomRight(),a=Math.min(i.x,r.x,s.x,o.x),l=Math.max(i.x,r.x,s.x,o.x),c=Math.min(i.y,r.y,s.y,o.y),u=Math.max(i.y,r.y,s.y,o.y);return new t.Rect(a,c,l-a,u-c)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),r=Math.floor(i.x),s=Math.floor(i.y),o=Math.ceil(i.width+i.x-r),a=Math.ceil(i.height+i.y-s);return new t.Rect(r,s,o,a)},containsPoint:function(i,r){r=r||0;var s=this.getTopLeft(),o=this.getTopRight(),a=this.getBottomLeft(),l=o.minus(s),c=a.minus(s);return(i.x-s.x)*l.x+(i.y-s.y)*l.y>=-r&&(i.x-o.x)*l.x+(i.y-o.y)*l.y<=r&&(i.x-s.x)*c.x+(i.y-s.y)*c.y>=-r&&(i.x-a.x)*c.x+(i.y-a.y)*c.y<=r},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(e),function(t){var i={};t.ReferenceStrip=function(p){var m=this,y=p.viewer,_=t.getElementSize(y.element),w,T,x;for(p.id||(p.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=p.id,this.element.className="referencestrip"),p=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},p,{element:this.element}),t.extend(this,p),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,T=this.element.style,T.marginTop="0px",T.marginRight="0px",T.marginBottom="0px",T.marginLeft="0px",T.left="0px",T.bottom="0px",T.border="0px",T.background="#000",T.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=y,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,r),dragHandler:t.delegate(this,s),scrollHandler:t.delegate(this,o),enterHandler:t.delegate(this,l),leaveHandler:t.delegate(this,c),keyDownHandler:t.delegate(this,u),keyHandler:t.delegate(this,f),preProcessEventHandler:function(C){C.eventType==="wheel"&&(C.preventDefault=!0)}}),p.width&&p.height?(this.element.style.width=p.width+"px",this.element.style.height=p.height+"px",y.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):p.scroll==="horizontal"?(this.element.style.width=_.x*p.sizeRatio*y.tileSources.length+12*y.tileSources.length+"px",this.element.style.height=_.y*p.sizeRatio+"px",y.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=_.y*p.sizeRatio*y.tileSources.length+12*y.tileSources.length+"px",this.element.style.width=_.x*p.sizeRatio+"px",y.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=_.x*this.sizeRatio+8,this.panelHeight=_.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},x=0;x<y.tileSources.length;x++)w=t.makeNeutralElement("div"),w.id=this.element.id+"-"+x,w.style.width=m.panelWidth+"px",w.style.height=m.panelHeight+"px",w.style.display="inline",w.style.float="left",w.style.cssFloat="left",w.style.styleFloat="left",w.style.padding="2px",t.setElementTouchActionNone(w),t.setElementPointerEventsNone(w),this.element.appendChild(w),w.activePanel=!1,this.panels.push(w);a(this,this.scroll==="vertical"?_.y:_.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(p){var m=this.element.querySelector("#"+this.element.id+"-"+p),y=t.getElementSize(this.viewer.canvas),_=Number(this.element.style.width.replace("px","")),w=Number(this.element.style.height.replace("px","")),T=-Number(this.element.style.marginLeft.replace("px","")),x=-Number(this.element.style.marginTop.replace("px","")),C;this.currentSelected!==m&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=m,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(C=Number(p)*(this.panelWidth+3),C>T+y.x-this.panelWidth?(C=Math.min(C,_-y.x),this.element.style.marginLeft=-C+"px",a(this,y.x,-C)):C<T&&(C=Math.max(0,C-y.x/2),this.element.style.marginLeft=-C+"px",a(this,y.x,-C))):(C=Number(p)*(this.panelHeight+3),C>x+y.y-this.panelHeight?(C=Math.min(C,w-y.y),this.element.style.marginTop=-C+"px",a(this,y.y,-C)):C<x&&(C=Math.max(0,C-y.y/2),this.element.style.marginTop=-C+"px",a(this,y.y,-C))),this.currentPage=p,l.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var p in this.miniViewers)this.miniViewers[p].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function r(p){if(p.quick){var m;this.scroll==="horizontal"?m=Math.floor(p.position.x/(this.panelWidth+4)):m=Math.floor(p.position.y/this.panelHeight),this.viewer.goToPage(m)}this.element.focus()}function s(p){if(this.dragging=!0,this.element){var m=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),_=Number(this.element.style.width.replace("px","")),w=Number(this.element.style.height.replace("px","")),T=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-p.delta.x>0?m>-(_-T.x)&&(this.element.style.marginLeft=m+p.delta.x*2+"px",a(this,T.x,m+p.delta.x*2)):-p.delta.x<0&&m<0&&(this.element.style.marginLeft=m+p.delta.x*2+"px",a(this,T.x,m+p.delta.x*2)):-p.delta.y>0?y>-(w-T.y)&&(this.element.style.marginTop=y+p.delta.y*2+"px",a(this,T.y,y+p.delta.y*2)):-p.delta.y<0&&y<0&&(this.element.style.marginTop=y+p.delta.y*2+"px",a(this,T.y,y+p.delta.y*2))}}function o(p){if(this.element){var m=Number(this.element.style.marginLeft.replace("px","")),y=Number(this.element.style.marginTop.replace("px","")),_=Number(this.element.style.width.replace("px","")),w=Number(this.element.style.height.replace("px","")),T=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?p.scroll>0?m>-(_-T.x)&&(this.element.style.marginLeft=m-p.scroll*60+"px",a(this,T.x,m-p.scroll*60)):p.scroll<0&&m<0&&(this.element.style.marginLeft=m-p.scroll*60+"px",a(this,T.x,m-p.scroll*60)):p.scroll<0?y>T.y-w&&(this.element.style.marginTop=y+p.scroll*60+"px",a(this,T.y,y+p.scroll*60)):p.scroll>0&&y<0&&(this.element.style.marginTop=y+p.scroll*60+"px",a(this,T.y,y+p.scroll*60)),p.preventDefault=!0}}function a(p,m,y){var _,w,T,x,C,I;for(p.scroll==="horizontal"?_=p.panelWidth:_=p.panelHeight,w=Math.ceil(m/_)+5,T=Math.ceil((Math.abs(y)+m)/_)+1,w=T-w,w=w<0?0:w,C=w;C<T&&C<p.panels.length;C++)if(I=p.panels[C],!I.activePanel){var D,B=p.viewer.tileSources[C];B.referenceStripThumbnailUrl?D={type:"image",url:B.referenceStripThumbnailUrl}:D=B,x=new t.Viewer({id:I.id,tileSources:[D],element:I,navigatorSizeRatio:p.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:p.viewer.loadTilesWithAjax,ajaxHeaders:p.viewer.ajaxHeaders,useCanvas:p.useCanvas}),t.setElementPointerEventsNone(x.canvas),t.setElementPointerEventsNone(x.container),x.innerTracker.setTracking(!1),x.outerTracker.setTracking(!1),p.miniViewers[I.id]=x,I.activePanel=!0}}function l(p){var m=p.eventSource.element;this.scroll==="horizontal"?m.style.marginBottom="0px":m.style.marginLeft="0px"}function c(p){var m=p.eventSource.element;this.scroll==="horizontal"?m.style.marginBottom="-"+t.getElementSize(m).y/2+"px":m.style.marginLeft="-"+t.getElementSize(m).x/2+"px"}function u(p){if(!p.ctrl&&!p.alt&&!p.meta)switch(p.keyCode){case 38:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 40:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 37:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 39:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;default:p.preventDefault=!1;break}else p.preventDefault=!1}function f(p){if(!p.ctrl&&!p.alt&&!p.meta)switch(p.keyCode){case 61:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 45:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 48:case 119:case 87:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;case 115:case 83:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 97:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),p.preventDefault=!0;break;case 100:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),p.preventDefault=!0;break;default:p.preventDefault=!1;break}else p.preventDefault=!1}}(e),function(t){t.DisplayRect=function(i,r,s,o,a,l){t.Rect.apply(this,[i,r,s,o]),this.minLevel=a,this.maxLevel=l},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(e),function(t){t.Spring=function(r){var s=arguments;typeof r!="object"&&(r={initial:s.length&&typeof s[0]=="number"?s[0]:void 0,springStiffness:s.length>1?s[1].springStiffness:5,animationTime:s.length>1?s[1].animationTime:1.5}),t.console.assert(typeof r.springStiffness=="number"&&r.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof r.animationTime=="number"&&r.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),r.exponential&&(this._exponential=!0,delete r.exponential),t.extend(!0,this,r),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=r,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=r,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(r){this.start.value+=r,this.target.value+=r,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(r){this._exponential=r,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var r,s;this._exponential?(r=this.start._logValue,s=this.target._logValue):(r=this.start.value,s=this.target.value);var o=this.current.time>=this.target.time?s:r+(s-r)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),a=this.current.value;return this._exponential?this.current.value=Math.exp(o):this.current.value=o,a!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(r,s){return(1-Math.exp(r*-s))/(1-Math.exp(-r))}}(e),function(t){t.ImageJob=function(r){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},r),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var r=this,s=this.abort;this.jobId=window.setTimeout(function(){r.finish(null,null,"Image load exceeded timeout ("+r.timeout+" ms)")},this.timeout),this.abort=function(){r.source.downloadTileAbort(r),typeof s=="function"&&s()},this.source.downloadTileStart(this)},finish:function(r,s,o){this.data=r,this.request=s,this.errorMsg=o,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(r){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},r)},t.ImageLoader.prototype={addJob:function(r){if(!r.source){t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var s=t.TileSource.prototype;r.source={downloadTileStart:s.downloadTileStart,downloadTileAbort:s.downloadTileAbort}}var o=this,a=function(u){i(o,u,r.callback)},l={src:r.src,tile:r.tile||{},source:r.source,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.loadWithAjax?r.ajaxHeaders:null,crossOriginPolicy:r.crossOriginPolicy,ajaxWithCredentials:r.ajaxWithCredentials,postData:r.postData,callback:a,abort:r.abort,timeout:this.timeout},c=new t.ImageJob(l);!this.jobLimit||this.jobsInProgress<this.jobLimit?(c.start(),this.jobsInProgress++):this.jobQueue.push(c)},clear:function(){for(var r=0;r<this.jobQueue.length;r++){var s=this.jobQueue[r];typeof s.abort=="function"&&s.abort()}this.jobQueue=[]}};function i(r,s,o){s.errorMsg!==""&&(s.data===null||s.data===void 0)&&s.tries<1+r.tileRetryMax&&r.failedTiles.push(s);var a;r.jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.jobQueue.length>0&&(a=r.jobQueue.shift(),a.start(),r.jobsInProgress++),r.tileRetryMax>0&&r.jobQueue.length===0&&(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.failedTiles.length>0&&(a=r.failedTiles.shift(),setTimeout(function(){a.start()},r.tileRetryDelay),r.jobsInProgress++),o(s.data,s.errorMsg,s.request)}}(e),function(t){t.Tile=function(i,r,s,o,a,l,c,u,f,p,m,y){this.level=i,this.x=r,this.y=s,this.bounds=o,this.sourceBounds=p,this.exists=a,this._url=l,this.postData=m,this.context2D=c,this.loadWithAjax=u,this.ajaxHeaders=f,y===void 0&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),y=t.TileSource.prototype.getTileHashKey(i,r,s,l,f,m)),this.cacheKey=y,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){var r=this.getImage();if(!r)return;this.element=t.makeNeutralElement("div"),this.imgElement=r.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),t.setElementOpacity(this.element,this.opacity)},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(i,r,s,o,a,l){var c=this.position.times(t.pixelDensityRatio),u=this.size.times(t.pixelDensityRatio),f;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(f=this.getCanvasContext(),!this.loaded||!f){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof s=="number"&&s!==1&&(c=c.times(s),u=u.times(s)),o instanceof t.Point&&(c=c.plus(o)),i.globalAlpha===1&&this.hasTransparency&&(a&&(c.x=Math.round(c.x),c.y=Math.round(c.y),u.x=Math.round(u.x),u.y=Math.round(u.y)),i.clearRect(c.x,c.y,u.x,u.y)),r({context:i,tile:this,rendered:f});var p,m;this.sourceBounds?(p=Math.min(this.sourceBounds.width,f.canvas.width),m=Math.min(this.sourceBounds.height,f.canvas.height)):(p=f.canvas.width,m=f.canvas.height),i.translate(c.x+u.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(f.canvas,0,0,p,m,-u.x/2,c.y,u.x,u.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,r,s){var o=Math.max(1,Math.ceil((s.x-r.x)/2)),a=Math.max(1,Math.ceil((s.y-r.y)/2));return new t.Point(o,a).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(e),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,r,s){var o;t.isPlainObject(i)?o=i:o={element:i,location:r,placement:s},this.element=o.element,this.style=o.element.style,this._init(o)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,r){var s=t.Placement.properties[this.placement];s&&(s.isHorizontallyCentered?i.x-=r.x/2:s.isRight&&(i.x-=r.x),s.isVerticallyCentered?i.y-=r.y/2:s.isBottom&&(i.y-=r.y))},destroy:function(){var i=this.element,r=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(r.display="none",document.body.appendChild(i))),this.onDraw=null,r.top="",r.left="",r.position="",this.width!==null&&(r.width=""),this.height!==null&&(r.height="");var s=t.getCssPropertyWithVendorPrefix("transformOrigin"),o=t.getCssPropertyWithVendorPrefix("transform");s&&o&&(r[s]="",r[o]="")},drawHTML:function(i,r){var s=this.element;s.parentNode!==i&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,i.appendChild(s),this.style.position="absolute",this.size=t.getElementSize(s));var o=this._getOverlayPositionAndSize(r),a=o.position,l=this.size=o.size,c=o.rotate;if(this.onDraw)this.onDraw(a,l,this.element);else{var u=this.style;u.left=a.x+"px",u.top=a.y+"px",this.width!==null&&(u.width=l.x+"px"),this.height!==null&&(u.height=l.y+"px");var f=t.getCssPropertyWithVendorPrefix("transformOrigin"),p=t.getCssPropertyWithVendorPrefix("transform");f&&p&&(c?(u[f]=this._getTransformOrigin(),u[p]="rotate("+c+"deg)"):(u[f]="",u[p]="")),u.display="block"}},_getOverlayPositionAndSize:function(i){var r=i.pixelFromPoint(this.location,!0),s=this._getSizeInPixels(i);this.adjust(r,s);var o=0;if(i.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new t.Rect(r.x,r.y,s.x,s.y),l=this._getBoundingBox(a,i.getRotation(!0));r=l.getTopLeft(),s=l.getSize()}else o=i.getRotation(!0);return{position:r,size:s,rotate:o}},_getSizeInPixels:function(i){var r=this.size.x,s=this.size.y;if(this.width!==null||this.height!==null){var o=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(r=o.x),this.height!==null&&(s=o.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=t.getElementSize(this.element);this.width===null&&(r=a.x),this.height===null&&(s=a.y)}return new t.Point(r,s)},_getBoundingBox:function(i,r){var s=this._getPlacementPoint(i);return i.rotate(r,s).getBoundingBox()},_getPlacementPoint:function(i){var r=new t.Point(i.x,i.y),s=t.Placement.properties[this.placement];return s&&(s.isHorizontallyCentered?r.x+=i.width/2:s.isRight&&(r.x+=i.width),s.isVerticallyCentered?r.y+=i.height/2:s.isBottom&&(r.y+=i.height)),r},_getTransformOrigin:function(){var i="",r=t.Placement.properties[this.placement];return r&&(r.isLeft?i="left":r.isRight&&(i="right"),r.isTop?i+=" top":r.isBottom&&(i+=" bottom")),i},update:function(i,r){var s=t.isPlainObject(i)?i:{location:i,placement:r};this._init({location:s.location||this.location,placement:s.placement!==void 0?s.placement:this.placement,onDraw:s.onDraw||this.onDraw,checkResize:s.checkResize||this.checkResize,width:s.width!==void 0?s.width:this.width,height:s.height!==void 0?s.height:this.height,rotationMode:s.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,s=this.height;if(r===null||s===null){var o=i.deltaPointsFromPixelsNoRotate(this.size,!0);r===null&&(r=o.x),s===null&&(s=o.y)}var a=this.location.clone();return this.adjust(a,new t.Point(r,s)),this._adjustBoundsForRotation(i,new t.Rect(a.x,a.y,r,s))},_adjustBoundsForRotation:function(i,r){if(!i||i.getRotation(!0)===0||this.rotationMode===t.OverlayRotationMode.EXACT)return r;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return r;var s=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(s.position.x,s.position.y,s.size.x,s.size.y))}return r.rotate(-i.getRotation(!0),this._getPlacementPoint(r))}}}(e),function(t){t.Drawer=function(i){t.console.assert(i.viewer,"[Drawer] options.viewer is required");var r=arguments;if(t.isPlainObject(i)||(i={source:r[0],viewport:r[1],element:r[2]}),t.console.assert(i.viewport,"[Drawer] options.viewport is required"),t.console.assert(i.element,"[Drawer] options.element is required"),i.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,i.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(i.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var s=this._calculateCanvasSize();this.canvas.width=s.x,this.canvas.height=s.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(i,r,s,o){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,r,s,o),this},updateOverlay:function(i,r,s){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,r,s),this},removeOverlay:function(i){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var r=this.viewport.pixelFromPointNoRotate(i,!0);return new t.Point(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio)},clipWithPolygons:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),i.forEach(function(o){o.forEach(function(a,l){s[l===0?"moveTo":"lineTo"](a.x,a.y)})}),s.clip()}},setOpacity:function(i){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var r=this.viewer.world,s=0;s<r.getItemCount();s++)r.getItemAt(s).setOpacity(i);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,r=0,s=0;s<i.getItemCount();s++){var o=i.getItemAt(s).getOpacity();o>r&&(r=o)}return r},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var r=this._calculateSketchCanvasSize();this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,r){if(this.useCanvas){var s=this._getContext(i);if(r)s.clearRect(r.x,r.y,r.width,r.height);else{var o=s.canvas;s.clearRect(0,0,o.width,o.height)}}},viewportToDrawerRectangle:function(i){var r=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),s=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new t.Rect(r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio,s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio)},drawTile:function(i,r,s,o,a,l,c){if(t.console.assert(i,"[Drawer.drawTile] tile is required"),t.console.assert(r,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var u=this._getContext(s);o=o||1,i.drawCanvas(u,r,o,a,l,c)}else i.drawHTML(this.canvas)},_getContext:function(i){var r=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var s=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var o=this;this.viewer.addHandler("rotate",function a(){if(o.viewport.getRotation()!==0){o.viewer.removeHandler("rotate",a);var l=o._calculateSketchCanvasSize();o.sketchCanvas.width=l.x,o.sketchCanvas.height=l.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}r=this.sketchContext}return r},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,r){if(this.useCanvas){var s=this._getContext(r);s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip()}},drawRectangle:function(i,r,s){if(this.useCanvas){var o=this._getContext(s);o.save(),o.fillStyle=r,o.fillRect(i.x,i.y,i.width,i.height),o.restore()}},blendSketch:function(i,r,s,o){var a=i;if(t.isPlainObject(a)||(a={opacity:i,scale:r,translate:s,compositeOperation:o}),!(!this.useCanvas||!this.sketchCanvas)){i=a.opacity,o=a.compositeOperation;var l=a.bounds;if(this.context.save(),this.context.globalAlpha=i,o&&(this.context.globalCompositeOperation=o),l)l.x<0&&(l.width+=l.x,l.x=0),l.x+l.width>this.canvas.width&&(l.width=this.canvas.width-l.x),l.y<0&&(l.height+=l.y,l.y=0),l.y+l.height>this.canvas.height&&(l.height=this.canvas.height-l.y),this.context.drawImage(this.sketchCanvas,l.x,l.y,l.width,l.height,l.x,l.y,l.width,l.height);else{r=a.scale||1,s=a.translate;var c=s instanceof t.Point?s:new t.Point(0,0),u=0,f=0;if(s){var p=this.sketchCanvas.width-this.canvas.width,m=this.sketchCanvas.height-this.canvas.height;u=Math.round(p/2),f=Math.round(m/2)}this.context.drawImage(this.sketchCanvas,c.x-u*r,c.y-f*r,(this.canvas.width+2*u)*r,(this.canvas.height+2*f)*r,-u,-f,this.canvas.width+2*u,this.canvas.height+2*f)}this.context.restore()}},drawDebugInfo:function(i,r,s,o){if(this.useCanvas){var a=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*t.pixelDensityRatio,l.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[a],l.fillStyle=this.debugGridColor[a],this.viewport.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),o.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0)}),o.viewport.getRotation(!0)%360===0&&o.getRotation(!0)%360===0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.strokeRect(i.position.x*t.pixelDensityRatio,i.position.y*t.pixelDensityRatio,i.size.x*t.pixelDensityRatio,i.size.y*t.pixelDensityRatio);var c=(i.position.x+i.size.x/2)*t.pixelDensityRatio,u=(i.position.y+i.size.y/2)*t.pixelDensityRatio;l.translate(c,u),l.rotate(Math.PI/180*-this.viewport.getRotation(!0)),l.translate(-c,-u),i.x===0&&i.y===0&&(l.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*t.pixelDensityRatio,(i.position.y-30)*t.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*t.pixelDensityRatio,(i.position.y-20)*t.pixelDensityRatio)),l.fillText("Level: "+i.level,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+20)*t.pixelDensityRatio),l.fillText("Column: "+i.x,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+30)*t.pixelDensityRatio),l.fillText("Row: "+i.y,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+40)*t.pixelDensityRatio),l.fillText("Order: "+s+" of "+r,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+50)*t.pixelDensityRatio),l.fillText("Size: "+i.size.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+60)*t.pixelDensityRatio),l.fillText("Position: "+i.position.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.getRotation(!0)%360!==0&&this._restoreRotationChanges(),o.viewport.getRotation(!0)%360===0&&o.getRotation(!0)%360===0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),l.restore()}},debugRect:function(i){if(this.useCanvas){var r=this.context;r.save(),r.lineWidth=2*t.pixelDensityRatio,r.strokeStyle=this.debugGridColor[0],r.fillStyle=this.debugGridColor[0],r.strokeRect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,i.width*t.pixelDensityRatio,i.height*t.pixelDensityRatio),r.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var r=this._getContext(i).canvas;return new t.Point(r.width,r.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var r=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.save(),s.translate(r.x,r.y),this.viewer.viewport.flipped?(s.rotate(Math.PI/180*-i.degrees),s.scale(-1,1)):s.rotate(Math.PI/180*i.degrees),s.translate(-r.x,-r.y)},_flip:function(i){i=i||{};var r=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),s=this._getContext(i.useSketch);s.translate(r.x,0),s.scale(-1,1),s.translate(-r.x,0)},_restoreRotationChanges:function(i){var r=this._getContext(i);r.restore()},_calculateCanvasSize:function(){var i=t.pixelDensityRatio,r=this.viewport.getContainerSize();return{x:Math.round(r.x*i),y:Math.round(r.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var r=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:r,y:r}}}}(e),function(t){t.Viewport=function(i){var r=arguments;r.length&&r[0]instanceof t.Point&&(i={containerSize:r[0],contentSize:r[1],config:r[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,r){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,r)},_setContentBounds:function(i,r){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),r;return this.homeFillsViewer?r=i>=1?i:1:r=i>=1?1:i,r/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),s=r/this.getAspectRatio();return new t.Rect(i.x-r/2,i.y-s/2,r,s)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),r=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return r},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert(t.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var r=this.getCenter(i),s=1/this.getZoom(i),o=s/this.getAspectRatio();return new t.Rect(r.x-s/2,r.y-o/2,s,o)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var r=this.getBoundsNoRotate(i),s=this._containerInnerSize.x*this.getZoom(i);return r.x-=this._margins.left/s,r.y-=this._margins.top/s,r.width+=(this._margins.left+this._margins.right)/s,r.height+=(this._margins.top+this._margins.bottom)/s,r},getCenter:function(i){var r=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),o,a,l,c,u,f,p,m;return i?r:this.zoomPoint?(o=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),l=1/a,c=l/this.getAspectRatio(),u=new t.Rect(r.x-l/2,r.y-c/2,l,c),f=this._pixelFromPoint(this.zoomPoint,u),p=f.minus(o).rotate(-this.getRotation(!0)),m=p.divide(this._containerInnerSize.x*a),s.plus(m)):s},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var r=this.viewportToViewerElementRectangle(i).getBoundingBox(),s=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,a=!1;if(!this.wrapHorizontal){var l=r.x+r.width,c=s.x+s.width,u,f,p;r.width>s.width?u=this.visibilityRatio*s.width:u=this.visibilityRatio*r.width,f=s.x-l+u,p=c-r.x-u,u>s.width?(r.x+=(f+p)/2,o=!0):p<0?(r.x+=p,o=!0):f>0&&(r.x+=f,o=!0)}if(!this.wrapVertical){var m=r.y+r.height,y=s.y+s.height,_,w,T;r.height>s.height?_=this.visibilityRatio*s.height:_=this.visibilityRatio*r.height,w=s.y-m+_,T=y-r.y-_,_>s.height?(r.y+=(w+T)/2,a=!0):T<0?(r.y+=T,a=!0):w>0&&(r.y+=w,a=!0)}var x=o||a,C=x?this.viewerElementToViewportRectangle(r):i.clone();return C.xConstrained=o,C.yConstrained=a,C.constraintApplied=x,C},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var r=this.getZoom(),s=this._applyZoomConstraints(r);r!==s&&this.zoomTo(s,this.zoomPoint,i);var o=this.getConstrainedBounds(!1);return o.constraintApplied&&(this.fitBounds(o,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,r){r=r||{};var s=r.immediately||!1,o=r.constraints||!1,a=this.getAspectRatio(),l=i.getCenter(),c=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=a?c.height=c.width/a:c.width=c.height*a,c.x=l.x-c.width/2,c.y=l.y-c.height/2;var u=1/c.width;if(s)return this.panTo(l,!0),this.zoomTo(u,null,!0),o&&this.applyConstraints(!0),this;var f=this.getCenter(!0),p=this.getZoom(!0);this.panTo(f,!0),this.zoomTo(p,null,!0);var m=this.getBounds(),y=this.getZoom();if(y===0||Math.abs(u/y-1)<1e-8)return this.zoomTo(u,null,!0),this.panTo(l,s),o&&this.applyConstraints(!1),this;if(o){this.panTo(l,!1),u=this._applyZoomConstraints(u),this.zoomTo(u,null,!1);var _=this.getConstrainedBounds();this.panTo(f,!0),this.zoomTo(p,null,!0),this.fitBounds(_)}else{var w=c.rotate(-this.getRotation()),T=w.getTopLeft().times(u).minus(m.getTopLeft().times(y)).divide(u-y);this.zoomTo(u,T,s)}return this},fitBounds:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!1})},fitBoundsWithConstraints:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!0})},fitVertically:function(i){var r=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,i)},fitHorizontally:function(i){var r=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,i)},getConstrainedBounds:function(i){var r,s;return r=this.getBounds(i),s=this._applyBoundaryConstraints(r),s},panBy:function(i,r){var s=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(s.plus(i),r)},panTo:function(i,r){return r?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:r}),this},zoomBy:function(i,r,s){return this.zoomTo(this.zoomSpring.target.value*i,r,s)},zoomTo:function(i,r,s){var o=this;return this.zoomPoint=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:r,immediately:s}),this},setRotation:function(i,r){return this.rotateTo(i,null,r)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,r,s){return this.rotateTo(i,r,s)},rotateTo:function(i,r,s){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,s)if(this.rotationPivot){var o=i-this._oldDegrees;if(!o)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var a=t.positiveModulo(this.degreesSpring.current.value,360),l=t.positiveModulo(i,360),c=l-a;c>180?l-=360:c<-180&&(l+=360);var u=a-l;this.degreesSpring.resetTo(i+u),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!s,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,r,s){return this.rotateTo(this.degreesSpring.target.value+i,r,s)},resize:function(i,r){var s=this.getBoundsNoRotate(),o=s,a;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),r&&(a=i.x/this.containerSize.x,o.width=s.width*a,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:r});var l=this.fitBounds(o,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:r}),l},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,r},_rotateAboutPivot:function(i){var r=i===!0,s=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(s.x),this.centerSpringY.shiftBy(s.y),r?this.degreesSpring.update():this.degreesSpring.resetTo(i);var o=this.degreesSpring.current.value-this._oldDegrees,a=s.rotate(o*-1).times(-1);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var r=this.pixelFromPoint(this.zoomPoint,!0);i();var s=this.pixelFromPoint(this.zoomPoint,!0),o=s.minus(r),a=this.deltaPointsFromPixels(o,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,r){return i.times(this._containerInnerSize.x*this.getZoom(r))},deltaPixelsFromPoints:function(i,r){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(r)),r)},deltaPointsFromPixelsNoRotate:function(i,r){return i.divide(this._containerInnerSize.x*this.getZoom(r))},deltaPointsFromPixels:function(i,r){return this.deltaPointsFromPixelsNoRotate(i,r).rotate(-this.getRotation(r))},pixelFromPointNoRotate:function(i,r){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(r))},pixelFromPoint:function(i,r){return this._pixelFromPoint(i,this.getBoundsNoRotate(r))},_pixelFromPointNoRotate:function(i,r){return i.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,r){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),r)},pointFromPixelNoRotate:function(i,r){var s=this.getBoundsNoRotate(r);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/s.width).plus(s.getTopLeft())},pointFromPixel:function(i,r){return this.pointFromPixelNoRotate(i,r).rotate(-this.getRotation(r),this.getCenter(r))},_viewportToImageDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/s,r*this._contentSizeNoRotate.x/s)},viewportToImageCoordinates:function(i,r){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.viewportToImageCoordinates(i,r,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,r){var s=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*s,r/this._contentSizeNoRotate.x*s)},imageToViewportCoordinates:function(i,r){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(s===1){var o=this.viewer.world.getItemAt(0);return o.imageToViewportCoordinates(i,r,!0)}}var a=this._imageToViewportDelta(i,r);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(i,r,s,o){var a=i;if(a instanceof t.Rect||(a=new t.Rect(i,r,s,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(l===1){var c=this.viewer.world.getItemAt(0);return c.imageToViewportRectangle(i,r,s,o,!0)}}var u=this.imageToViewportCoordinates(a.x,a.y),f=this._imageToViewportDelta(a.width,a.height);return new t.Rect(u.x,u.y,f.x,f.y,a.degrees)},viewportToImageRectangle:function(i,r,s,o){var a=i;if(a instanceof t.Rect||(a=new t.Rect(i,r,s,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(l===1){var c=this.viewer.world.getItemAt(0);return c.viewportToImageRectangle(i,r,s,o,!0)}}var u=this.viewportToImageCoordinates(a.x,a.y),f=this._viewportToImageDelta(a.width,a.height);return new t.Rect(u.x,u.y,f.x,f.y,a.degrees)},viewerElementToImageCoordinates:function(i){var r=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(i){var r=this.imageToViewportCoordinates(i);return this.pixelFromPoint(r,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var r=this.imageToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var r=this.viewportToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.viewportToImageZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,c=a/o*l;return i*c},imageToViewportZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(r===1){var s=this.viewer.world.getItemAt(0);return s.imageToViewportZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,c=o/a/l;return i*c},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(e),function(t){t.TiledImage=function(a){var l=this;t.console.assert(a.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(a.drawer,"[TiledImage] options.drawer is required"),t.console.assert(a.viewer,"[TiledImage] options.viewer is required"),t.console.assert(a.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(a.source,"[TiledImage] options.source is required"),t.console.assert(!a.clip||a.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=a.tileCache,delete a.tileCache,this._drawer=a.drawer,delete a.drawer,this._imageLoader=a.imageLoader,delete a.imageLoader,a.clip instanceof t.Rect&&(this._clip=a.clip.clone()),delete a.clip;var c=a.x||0;delete a.x;var u=a.y||0;delete a.y,this.normHeight=a.source.dimensions.y/a.source.dimensions.x,this.contentAspectX=a.source.dimensions.x/a.source.dimensions.y;var f=1;a.width?(f=a.width,delete a.width,a.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete a.height)):a.height&&(f=a.height/this.normHeight,delete a.height);var p=a.fitBounds;delete a.fitBounds;var m=a.fitBoundsPlacement||e.Placement.CENTER;delete a.fitBoundsPlacement;var y=a.degrees||0;delete a.degrees;var _=a.ajaxHeaders;delete a.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency},a),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:f,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),p&&this.fitBounds(p,m,!0),this._drawingHandler=function(w){l.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:l},w))},this._ownAjaxHeaders={},this.setAjaxHeaders(_,!1)},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(a){a!==this._fullyLoaded&&(this._fullyLoaded=a,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var a=this._xSpring.update(),l=this._ySpring.update(),c=this._scaleSpring.update(),u=this._degreesSpring.update();return a||l||c||u?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(a){return this.getBoundsNoRotate(a).rotate(this.getRotation(a),this._getRotationPoint(a))},getBoundsNoRotate:function(a){return a?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(a){var l=this.getBoundsNoRotate(a);if(this._clip){var c=a?this._worldWidthCurrent:this._worldWidthTarget,u=c/this.source.dimensions.x,f=this._clip.times(u);l=new t.Rect(l.x+f.x,l.y+f.y,f.width,f.height)}return l.rotate(this.getRotation(a),this._getRotationPoint(a))},getTileBounds:function(a,l,c){var u=this.source.getNumTiles(a),f=(u.x+l%u.x)%u.x,p=(u.y+c%u.y)%u.y,m=this.source.getTileBounds(a,f,p);return this.getFlip()&&(m.x=1-m.x-m.width),m.x+=(l-f)/u.x,m.y+=this._worldHeightCurrent/this._worldWidthCurrent*((c-p)/u.y),m},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var a=this.imageToWindowCoordinates(new t.Point(0,0)),l=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(l.x-a.x,l.y-a.y)},_viewportToImageDelta:function(a,l,c){var u=c?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(a*(this.source.dimensions.x/u),l*(this.source.dimensions.y*this.contentAspectX/u))},viewportToImageCoordinates:function(a,l,c){var u;return a instanceof t.Point?(c=l,u=a):u=new t.Point(a,l),u=u.rotate(-this.getRotation(c),this._getRotationPoint(c)),c?this._viewportToImageDelta(u.x-this._xSpring.current.value,u.y-this._ySpring.current.value):this._viewportToImageDelta(u.x-this._xSpring.target.value,u.y-this._ySpring.target.value)},_imageToViewportDelta:function(a,l,c){var u=c?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(a/this.source.dimensions.x*u,l/this.source.dimensions.y/this.contentAspectX*u)},imageToViewportCoordinates:function(a,l,c){a instanceof t.Point&&(c=l,l=a.y,a=a.x);var u=this._imageToViewportDelta(a,l);return c?(u.x+=this._xSpring.current.value,u.y+=this._ySpring.current.value):(u.x+=this._xSpring.target.value,u.y+=this._ySpring.target.value),u.rotate(this.getRotation(c),this._getRotationPoint(c))},imageToViewportRectangle:function(a,l,c,u,f){var p=a;p instanceof t.Rect?f=l:p=new t.Rect(a,l,c,u);var m=this.imageToViewportCoordinates(p.getTopLeft(),f),y=this._imageToViewportDelta(p.width,p.height,f);return new t.Rect(m.x,m.y,y.x,y.y,p.degrees+this.getRotation(f))},viewportToImageRectangle:function(a,l,c,u,f){var p=a;a instanceof t.Rect?f=l:p=new t.Rect(a,l,c,u);var m=this.viewportToImageCoordinates(p.getTopLeft(),f),y=this._viewportToImageDelta(p.width,p.height,f);return new t.Rect(m.x,m.y,y.x,y.y,p.degrees-this.getRotation(f))},viewerElementToImageCoordinates:function(a){var l=this.viewport.pointFromPixel(a,!0);return this.viewportToImageCoordinates(l)},imageToViewerElementCoordinates:function(a){var l=this.imageToViewportCoordinates(a);return this.viewport.pixelFromPoint(l,!0)},windowToImageCoordinates:function(a){var l=a.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(l)},imageToWindowCoordinates:function(a){var l=this.imageToViewerElementCoordinates(a);return l.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(a){var l=this._scaleSpring.current.value;return a=a.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((a.x-this._xSpring.current.value)/l,(a.y-this._ySpring.current.value)/l,a.width/l,a.height/l,a.degrees)},viewportToImageZoom:function(a){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return l*a},imageToViewportZoom:function(a){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return a/l},setPosition:function(a,l){var c=this._xSpring.target.value===a.x&&this._ySpring.target.value===a.y;if(l){if(c&&this._xSpring.current.value===a.x&&this._ySpring.current.value===a.y)return;this._xSpring.resetTo(a.x),this._ySpring.resetTo(a.y),this._needsDraw=!0}else{if(c)return;this._xSpring.springTo(a.x),this._ySpring.springTo(a.y),this._needsDraw=!0}c||this._raiseBoundsChange()},setWidth:function(a,l){this._setScale(a,l)},setHeight:function(a,l){this._setScale(a/this.normHeight,l)},setCroppingPolygons:function(a){var l=function(u){return u instanceof t.Point||typeof u.x=="number"&&typeof u.y=="number"},c=function(u){return u.map(function(f){try{if(l(f))return{x:f.x,y:f.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(a))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=a.map(function(u){return c(u)})}catch(u){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(u),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(a,l,c){l=l||t.Placement.CENTER;var u=t.Placement.properties[l],f=this.contentAspectX,p=0,m=0,y=1,_=1;if(this._clip&&(f=this._clip.getAspectRatio(),y=this._clip.width/this.source.dimensions.x,_=this._clip.height/this.source.dimensions.y,a.getAspectRatio()>f?(p=this._clip.x/this._clip.height*a.height,m=this._clip.y/this._clip.height*a.height):(p=this._clip.x/this._clip.width*a.width,m=this._clip.y/this._clip.width*a.width)),a.getAspectRatio()>f){var w=a.height/_,T=0;u.isHorizontallyCentered?T=(a.width-a.height*f)/2:u.isRight&&(T=a.width-a.height*f),this.setPosition(new t.Point(a.x-p+T,a.y-m),c),this.setHeight(w,c)}else{var x=a.width/y,C=0;u.isVerticallyCentered?C=(a.height-a.width/f)/2:u.isBottom&&(C=a.height-a.width/f),this.setPosition(new t.Point(a.x-p,a.y-m+C),c),this.setWidth(x,c)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(a){t.console.assert(!a||a instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),a instanceof t.Rect?this._clip=a.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(a){this.flipped=!!a,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(a){a!==this.opacity&&(this.opacity=a,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(a){this._preload=!!a,this._needsDraw=!0},getRotation:function(a){return a?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(a,l){this._degreesSpring.target.value===a&&this._degreesSpring.isAtTargetValue()||(l?this._degreesSpring.resetTo(a):this._degreesSpring.springTo(a),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(a){return this.getBoundsNoRotate(a).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(a){a!==this.compositeOperation&&(this.compositeOperation=a,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},setAjaxHeaders:function(a,l){if(a===null&&(a={}),!t.isPlainObject(a)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=a,this._updateAjaxHeaders(l)},_updateAjaxHeaders:function(a){if(a===void 0&&(a=!0),t.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,a){var l,c,u,f;for(var p in this.tilesMatrix){l=this.source.getNumTiles(p);for(var m in this.tilesMatrix[p]){c=(l.x+m%l.x)%l.x;for(var y in this.tilesMatrix[p][m])if(u=(l.y+y%l.y)%l.y,f=this.tilesMatrix[p][m][y],f.loadWithAjax=this.loadTilesWithAjax,f.loadWithAjax){var _=this.source.getTileAjaxHeaders(p,c,u);f.ajaxHeaders=t.extend({},this.ajaxHeaders,_)}else f.ajaxHeaders=null}}for(var w=0;w<this._imageLoader.jobQueue.length;w++){var T=this._imageLoader.jobQueue[w];T.loadWithAjax=T.tile.loadWithAjax,T.ajaxHeaders=T.tile.loadWithAjax?T.tile.ajaxHeaders:null}}},_setScale:function(a,l){var c=this._scaleSpring.target.value===a;if(l){if(c&&this._scaleSpring.current.value===a)return;this._scaleSpring.resetTo(a),this._updateForScale(),this._needsDraw=!0}else{if(c)return;this._scaleSpring.springTo(a),this._updateForScale(),this._needsDraw=!0}c||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var a=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),l=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,c=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(l/this.minPixelRatio)/Math.log(2))));return c=Math.max(c,this.source.minLevel||0),a=Math.min(a,c),{lowestLevel:a,highestLevel:c}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var a=this.lastDrawn.pop();a.beingDrawn=!1}var l=this.viewport,c=this._viewportToTiledImageRectangle(l.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var u=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(c=c.intersection(u),c===null)return}for(var f=this._getLevelsInterval(),p=f.lowestLevel,m=f.highestLevel,y=null,_=!1,w=t.now(),T=m;T>=p;T--){var x=!1,C=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(T),!0).x*this._scaleSpring.current.value;if(T===p||!_&&C>=this.minPixelRatio)x=!0,_=!0;else if(!_)continue;var I=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(T),!1).x*this._scaleSpring.current.value,D=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,B=this.immediateRender?1:D,N=Math.min(1,(C-.5)/.5),z=B/Math.abs(B-I);if(y=this._updateLevel(_,x,T,N,z,c,w,y),this._providesCoverage(this.coverage,T))break}this._drawTiles(this.lastDrawn),y&&!y.context2D?(this._loadTile(y,w),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(a,l,c){var u,f;this.wrapHorizontal?(u=t.positiveModulo(l.x,1),f=t.positiveModulo(c.x,1)):(u=Math.max(0,l.x),f=Math.min(1,c.x));var p,m,y=1/this.source.aspectRatio;this.wrapVertical?(p=t.positiveModulo(l.y,y),m=t.positiveModulo(c.y,y)):(p=Math.max(0,l.y),m=Math.min(y,c.y));var _=this.source.getTileAtPoint(a,new t.Point(u,p)),w=this.source.getTileAtPoint(a,new t.Point(f,m)),T=this.source.getNumTiles(a);return this.wrapHorizontal&&(_.x+=T.x*Math.floor(l.x),w.x+=T.x*Math.floor(c.x)),this.wrapVertical&&(_.y+=T.y*Math.floor(l.y/y),w.y+=T.y*Math.floor(c.y/y)),{topLeft:_,bottomRight:w}},_updateLevel:function(a,l,c,u,f,p,m,y){var _=p.getBoundingBox().getTopLeft(),w=p.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:a,level:c,opacity:u,visibility:f,drawArea:p,topleft:_,bottomright:w,currenttime:m,best:y}),this._resetCoverage(this.coverage,c),this._resetCoverage(this.loadingCoverage,c);var T=this._getCornerTiles(c,_,w),x=T.topLeft,C=T.bottomRight,I=this.source.getNumTiles(c),D=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(C.x+=1,this.wrapHorizontal||(C.x=Math.min(C.x,I.x-1)));for(var B=x.x;B<=C.x;B++)for(var N=x.y;N<=C.y;N++){var z;if(this.getFlip()){var Z=(I.x+B%I.x)%I.x;z=B+I.x-Z-Z-1}else z=B;p.intersection(this.getTileBounds(c,z,N))!==null&&(y=this._updateTile(l,a,z,N,c,u,f,D,I,m,y))}return y},_updateTile:function(a,l,c,u,f,p,m,y,_,w,T){var x=this._getTile(c,u,f,w,_,this._worldWidthCurrent,this._worldHeightCurrent),C=l;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:x}),this._setCoverage(this.coverage,f,c,u,!1);var I=x.loaded||x.loading||this._isCovered(this.loadingCoverage,f,c,u);if(this._setCoverage(this.loadingCoverage,f,c,u,I),!x.exists||(a&&!C&&(this._isCovered(this.coverage,f,c,u)?this._setCoverage(this.coverage,f,c,u,!0):C=!0),!C))return T;if(this._positionTile(x,this.source.tileOverlap,this.viewport,y,m),!x.loaded)if(x.context2D)this._setTileLoaded(x);else{var D=this._tileCache.getImageRecord(x.cacheKey);D&&this._setTileLoaded(x,D.getData())}if(x.loaded){var B=this._blendTile(x,c,u,f,p,w);B&&(this._needsDraw=!0)}else x.loading?this._tilesLoading++:I||(T=this._compareTiles(T,x));return T},_getTile:function(a,l,c,u,f,p,m){var y,_,w,T,x,C,I,D,B,N,z=this.tilesMatrix,Z=this.source;return z[c]||(z[c]={}),z[c][a]||(z[c][a]={}),(!z[c][a][l]||!z[c][a][l].flipped!=!this.flipped)&&(y=(f.x+a%f.x)%f.x,_=(f.y+l%f.y)%f.y,w=this.getTileBounds(c,a,l),T=Z.getTileBounds(c,y,_,!0),x=Z.tileExists(c,y,_),C=Z.getTileUrl(c,y,_),I=Z.getTilePostData(c,y,_),this.loadTilesWithAjax?(D=Z.getTileAjaxHeaders(c,y,_),t.isPlainObject(this.ajaxHeaders)&&(D=t.extend({},this.ajaxHeaders,D))):D=null,B=Z.getContext2D?Z.getContext2D(c,y,_):void 0,N=new t.Tile(c,a,l,w,x,C,B,this.loadTilesWithAjax,D,T,I,Z.getTileHashKey(c,y,_,C,D,I)),this.getFlip()?y===0&&(N.isRightMost=!0):y===f.x-1&&(N.isRightMost=!0),_===f.y-1&&(N.isBottomMost=!0),N.flipped=this.flipped,z[c][a][l]=N),N=z[c][a][l],N.lastTouchTime=u,N},_loadTile:function(a,l){var c=this;a.loading=!0,this._imageLoader.addJob({src:a.getUrl(),tile:a,source:this.source,postData:a.postData,loadWithAjax:a.loadWithAjax,ajaxHeaders:a.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(u,f,p){c._onTileLoad(a,l,u,f,p)},abort:function(){a.loading=!1}})},_onTileLoad:function(a,l,c,u,f){if(c)a.exists=!0;else{t.console.error("Tile %s failed to load: %s - error: %s",a,a.getUrl(),u),this.viewer.raiseEvent("tile-load-failed",{tile:a,tiledImage:this,time:l,message:u,tileRequest:f}),a.loading=!1,a.exists=!1;return}if(l<this.lastResetTime){t.console.warn("Ignoring tile %s loaded before reset: %s",a,a.getUrl()),a.loading=!1;return}var p=this,m=function(){var y=p.source,_=y.getClosestLevel();p._setTileLoaded(a,c,_,f)};this._midDraw?window.setTimeout(m,1):m()},_setTileLoaded:function(a,l,c,u){var f=0,p=!1,m=this;function y(){return p&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),f++,_}function _(){f--,f===0&&(a.loading=!1,a.loaded=!0,a.hasTransparency=m.source.hasTransparency(a.context2D,a.getUrl(),a.ajaxHeaders,a.postData),a.context2D||m._tileCache.cacheTile({data:l,tile:a,cutoff:c,tiledImage:m}),m._needsDraw=!0)}var w=y();this.viewer.raiseEvent("tile-loaded",{tile:a,tiledImage:this,tileRequest:u,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),l},data:l,getCompletionCallback:y}),p=!0,w()},_positionTile:function(a,l,c,u,f){var p=a.bounds.getTopLeft();p.x*=this._scaleSpring.current.value,p.y*=this._scaleSpring.current.value,p.x+=this._xSpring.current.value,p.y+=this._ySpring.current.value;var m=a.bounds.getSize();m.x*=this._scaleSpring.current.value,m.y*=this._scaleSpring.current.value;var y=c.pixelFromPointNoRotate(p,!0),_=c.pixelFromPointNoRotate(p,!1),w=c.deltaPixelsFromPointsNoRotate(m,!0),T=c.deltaPixelsFromPointsNoRotate(m,!1),x=_.plus(T.divide(2)),C=u.squaredDistanceTo(x);l||(w=w.plus(new t.Point(1,1))),a.isRightMost&&this.wrapHorizontal&&(w.x+=.75),a.isBottomMost&&this.wrapVertical&&(w.y+=.75),a.position=y,a.size=w,a.squaredDistance=C,a.visibility=f},_blendTile:function(a,l,c,u,f,p){var m=1e3*this.blendTime,y,_;if(a.blendStart||(a.blendStart=p),y=p-a.blendStart,_=m?Math.min(1,y/m):1,this.alwaysBlend&&(_*=f),a.opacity=_,this.lastDrawn.push(a),_===1)this._setCoverage(this.coverage,u,l,c,!0),this._hasOpaqueTile=!0;else if(y<m)return!0;return!1},_compareTiles:function(a,l){return!a||l.visibility>a.visibility||l.visibility===a.visibility&&l.squaredDistance<a.squaredDistance?l:a},_drawTiles:function(a){if(!(this.opacity===0||a.length===0&&!this.placeholderFillStyle)){var l=a[0],c;l&&(c=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&this.source.hasTransparency(l.context2D,l.getUrl(),l.ajaxHeaders,l.postData));var u,f,p=this.viewport.getZoom(!0),m=this.viewportToImageZoom(p);a.length>1&&m>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&t.supportsCanvas&&this.viewer.useCanvas&&(c=!0,u=l.getScaleForEdgeSmoothing(),f=l.getTranslationForEdgeSmoothing(u,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var y;c&&(u||(y=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360!==0||this.getRotation(!0)%360!==0)&&(y.x=this._drawer.viewer.container.clientWidth-(y.x+y.width)),y=y.times(t.pixelDensityRatio)),this._drawer._clear(!0,y)),u||(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:c}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:c}),this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var _=!1;if(this._clip){this._drawer.saveContext(c);var w=this.imageToViewportRectangle(this._clip,!0);w=w.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var T=this._drawer.viewportToDrawerRectangle(w);u&&(T=T.times(u)),f&&(T=T.translate(f)),this._drawer.setClip(T,c),_=!0}if(this._croppingPolygons){var x=this;this._drawer.saveContext(c);try{var C=this._croppingPolygons.map(function(q){return q.map(function(H){var Y=x.imageToViewportCoordinates(H.x,H.y,!0).rotate(-x.getRotation(!0),x._getRotationPoint(!0)),ee=x._drawer.viewportCoordToDrawerCoord(Y);return u&&(ee=ee.times(u)),f&&(ee=ee.plus(f)),ee})});this._drawer.clipWithPolygons(C,c)}catch(q){t.console.error(q)}_=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var I=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));u&&(I=I.times(u)),f&&(I=I.translate(f));var D=null;typeof this.placeholderFillStyle=="function"?D=this.placeholderFillStyle(this,this._drawer.context):D=this.placeholderFillStyle,this._drawer.drawRectangle(I,D,c)}var B=o(this.subPixelRoundingForTransparency),N=!1;if(B===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)N=!0;else if(B===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var z=this.viewer&&this.viewer.isAnimating();N=!z}for(var Z=a.length-1;Z>=0;Z--)l=a[Z],this._drawer.drawTile(l,this._drawingHandler,c,u,f,N,this.source),l.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:l});_&&this._drawer.restoreContext(c),u||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(c),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(c)),c&&(u&&(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:u,translate:f,compositeOperation:this.compositeOperation,bounds:y}),u&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1))),u||this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(a)}},_drawDebugInfo:function(a){if(this.debugMode)for(var l=a.length-1;l>=0;l--){var c=a[l];try{this._drawer.drawDebugInfo(c,a.length,l,this)}catch(u){t.console.error(u)}}},_providesCoverage:function(a,l,c,u){var f,p,m,y;if(!a[l])return!1;if(c===void 0||u===void 0){f=a[l];for(m in f)if(Object.prototype.hasOwnProperty.call(f,m)){p=f[m];for(y in p)if(Object.prototype.hasOwnProperty.call(p,y)&&!p[y])return!1}return!0}return a[l][c]===void 0||a[l][c][u]===void 0||a[l][c][u]===!0},_isCovered:function(a,l,c,u){return c===void 0||u===void 0?this._providesCoverage(a,l+1):this._providesCoverage(a,l+1,2*c,2*u)&&this._providesCoverage(a,l+1,2*c,2*u+1)&&this._providesCoverage(a,l+1,2*c+1,2*u)&&this._providesCoverage(a,l+1,2*c+1,2*u+1)},_setCoverage:function(a,l,c,u,f){if(!a[l]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",l);return}a[l][c]||(a[l][c]={}),a[l][c][u]=f},_resetCoverage:function(a,l){a[l]={}}});var i=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function r(a){return a!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&a!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&a!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function s(a){return r(a)?i:a}function o(a){if(typeof a=="number")return s(a);if(!a||!t.Browser)return i;var l=a[t.Browser.vendor];return r(l)&&(l=a["*"]),s(l)}}(e),function(t){var i=function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=s.tile,this.tiledImage=s.tiledImage},r=function(s){t.console.assert(s,"[ImageRecord] options is required"),t.console.assert(s.data,"[ImageRecord] options.data is required"),this._tiles=[],s.create.apply(null,[this,s.data,s.ownerTile]),this._destroyImplementation=s.destroy.bind(null,this),this.getImage=s.getImage.bind(null,this),this.getData=s.getData.bind(null,this),this.getRenderedContext=s.getRenderedContext.bind(null,this)};r.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(s){t.console.assert(s,"[ImageRecord.addTile] tile is required"),this._tiles.push(s)},removeTile:function(s){for(var o=0;o<this._tiles.length;o++)if(this._tiles[o]===s){this._tiles.splice(o,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",s)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(s){s=s||{},this._maxImageCacheCount=s.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o=s.cutoff||0,a=this._tilesLoaded.length,l=this._imagesLoaded[s.tile.cacheKey];if(l||(s.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),s.data=s.image),t.console.assert(s.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[s.tile.cacheKey]=new r({data:s.data,ownerTile:s.tile,create:s.tiledImage.source.createTileCache,destroy:s.tiledImage.source.destroyTileCache,getImage:s.tiledImage.source.getTileCacheDataAsImage,getData:s.tiledImage.source.getTileCacheData,getRenderedContext:s.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(s.tile),s.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var c=null,u=-1,f=null,p,m,y,_,w,T,x=this._tilesLoaded.length-1;x>=0;x--)if(T=this._tilesLoaded[x],p=T.tile,!(p.level<=o||p.beingDrawn)){if(!c){c=p,u=x,f=T;continue}_=p.lastTouchTime,m=c.lastTouchTime,w=p.level,y=c.level,(_<m||_===m&&w>y)&&(c=p,u=x,f=T)}c&&u>=0&&(this._unloadTile(f),a=u)}this._tilesLoaded[a]=new i({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(s){t.console.assert(s,"[TileCache.clearTilesFor] tiledImage is required");for(var o,a=0;a<this._tilesLoaded.length;++a)o=this._tilesLoaded[a],o.tiledImage===s&&(this._unloadTile(o),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(s){return t.console.assert(s,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[s]},_unloadTile:function(s){t.console.assert(s,"[TileCache._unloadTile] tileRecord is required");var o=s.tile,a=s.tiledImage;o.unload(),o.cacheImageRecord=null;var l=this._imagesLoaded[o.cacheKey];l.removeTile(o),l.getTileCount()||(l.destroy(),delete this._imagesLoaded[o.cacheKey],this._imagesLoadedCount--),a.viewer.raiseEvent("tile-unloaded",{tile:o,tiledImage:a})}}}(e),function(t){t.World=function(i){var r=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(s){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,r){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),r=r||{},r.index!==void 0){var s=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(s,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,r){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(r!==void 0,"[World.setItemIndex] index is required");var s=this.getIndexOfItem(i);if(r>=this._items.length)throw new Error("Index bigger than number of layers.");r===s||s===-1||(this._items.splice(s,1),this._items.splice(r,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:s,newIndex:r}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var r=t.indexOf(this._items,i);r!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,r;for(r=0;r<this._items.length;r++)i=this._items[r],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var s=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,r=0;r<s.length;r++)i=s[r],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,r=0;r<this._items.length;r++)i=this._items[r].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var r=i.immediately||!1,s=i.layout||t.DEFAULT_SETTINGS.collectionLayout,o=i.rows||t.DEFAULT_SETTINGS.collectionRows,a=i.columns||t.DEFAULT_SETTINGS.collectionColumns,l=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,c=i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,u=l+c,f;!i.rows&&a?f=a:f=Math.ceil(this._items.length/o);var p=0,m=0,y,_,w,T,x;this.setAutoRefigureSizes(!1);for(var C=0;C<this._items.length;C++)C&&C%f===0&&(s==="horizontal"?(m+=u,p=0):(p+=u,m=0)),y=this._items[C],_=y.getBounds(),_.width>_.height?w=l:w=l*(_.width/_.height),T=w*(_.height/_.width),x=new t.Point(p+(l-w)/2,m+(l-T)/2),y.setPosition(x,r),y.setWidth(w,r),s==="horizontal"?p+=u:m+=u;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var o=this._items[0],a=o.getBounds();this._contentFactor=o.getContentSize().x/a.width;for(var l=o.getClippedBounds().getBoundingBox(),c=l.x,u=l.y,f=l.x+l.width,p=l.y+l.height,m=1;m<this._items.length;m++)o=this._items[m],a=o.getBounds(),this._contentFactor=Math.max(this._contentFactor,o.getContentSize().x/a.width),l=o.getClippedBounds().getBoundingBox(),c=Math.min(c,l.x),u=Math.min(u,l.y),f=Math.max(f,l.x+l.width),p=Math.max(p,l.y+l.height);this._homeBounds=new t.Rect(c,u,f-c,p-u),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==s||!this._homeBounds.equals(i)||!this._contentSize.equals(r))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(e)})(MN);var J7=MN.exports;const $d=hu(J7);function Q7(n){const t=eq(n).replace(/-/g,"+").replace(/_/g,"/"),i=typeof atob>"u"?Buffer.from(t,"base64").toString("utf-8"):atob(t);return decodeURIComponent(i).trim()}function eq(n){const e=n.length%4;if(e===1)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return n+(e?"====".slice(0,4-e):"")}const tq=M.createContext(null),xw={didCatch:!1,error:null};class G0 extends M.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=xw}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,i,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];(t=(i=this.props).onReset)===null||t===void 0||t.call(i,{args:s,reason:"imperative-api"}),this.setState(xw)}}componentDidCatch(e,t){var i,r;(i=(r=this.props).onError)===null||i===void 0||i.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&t.error!==null&&iq(e.resetKeys,r)){var s,o;(s=(o=this.props).onReset)===null||s===void 0||s.call(o,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(xw)}}render(){const{children:e,fallbackRender:t,FallbackComponent:i,fallback:r}=this.props,{didCatch:s,error:o}=this.state;let a=e;if(s){const l={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")a=t(l);else if(i)a=M.createElement(i,l);else if(r===null||M.isValidElement(r))a=r;else throw o}return M.createElement(tq.Provider,{value:{didCatch:s,error:o,resetErrorBoundary:this.resetErrorBoundary}},a)}}function iq(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==e.length||n.some((t,i)=>!Object.is(t,e[i]))}var li="colors",Wn="sizes",Qe="space",nq={gap:Qe,gridGap:Qe,columnGap:Qe,gridColumnGap:Qe,rowGap:Qe,gridRowGap:Qe,inset:Qe,insetBlock:Qe,insetBlockEnd:Qe,insetBlockStart:Qe,insetInline:Qe,insetInlineEnd:Qe,insetInlineStart:Qe,margin:Qe,marginTop:Qe,marginRight:Qe,marginBottom:Qe,marginLeft:Qe,marginBlock:Qe,marginBlockEnd:Qe,marginBlockStart:Qe,marginInline:Qe,marginInlineEnd:Qe,marginInlineStart:Qe,padding:Qe,paddingTop:Qe,paddingRight:Qe,paddingBottom:Qe,paddingLeft:Qe,paddingBlock:Qe,paddingBlockEnd:Qe,paddingBlockStart:Qe,paddingInline:Qe,paddingInlineEnd:Qe,paddingInlineStart:Qe,top:Qe,right:Qe,bottom:Qe,left:Qe,scrollMargin:Qe,scrollMarginTop:Qe,scrollMarginRight:Qe,scrollMarginBottom:Qe,scrollMarginLeft:Qe,scrollMarginX:Qe,scrollMarginY:Qe,scrollMarginBlock:Qe,scrollMarginBlockEnd:Qe,scrollMarginBlockStart:Qe,scrollMarginInline:Qe,scrollMarginInlineEnd:Qe,scrollMarginInlineStart:Qe,scrollPadding:Qe,scrollPaddingTop:Qe,scrollPaddingRight:Qe,scrollPaddingBottom:Qe,scrollPaddingLeft:Qe,scrollPaddingX:Qe,scrollPaddingY:Qe,scrollPaddingBlock:Qe,scrollPaddingBlockEnd:Qe,scrollPaddingBlockStart:Qe,scrollPaddingInline:Qe,scrollPaddingInlineEnd:Qe,scrollPaddingInlineStart:Qe,fontSize:"fontSizes",background:li,backgroundColor:li,backgroundImage:li,borderImage:li,border:li,borderBlock:li,borderBlockEnd:li,borderBlockStart:li,borderBottom:li,borderBottomColor:li,borderColor:li,borderInline:li,borderInlineEnd:li,borderInlineStart:li,borderLeft:li,borderLeftColor:li,borderRight:li,borderRightColor:li,borderTop:li,borderTopColor:li,caretColor:li,color:li,columnRuleColor:li,fill:li,outline:li,outlineColor:li,stroke:li,textDecorationColor:li,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Wn,minBlockSize:Wn,maxBlockSize:Wn,inlineSize:Wn,minInlineSize:Wn,maxInlineSize:Wn,width:Wn,minWidth:Wn,maxWidth:Wn,height:Wn,minHeight:Wn,maxHeight:Wn,flexBasis:Wn,gridTemplateColumns:Wn,gridTemplateRows:Wn,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},rq=(n,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,Vd=()=>{const n=Object.create(null);return(e,t,...i)=>{const r=(s=>JSON.stringify(s,rq))(e);return r in n?n[r]:n[r]=t(e,...i)}},Wc=Symbol.for("sxs.internal"),Lx=(n,e)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)),ML=n=>{for(const e in n)return!0;return!1},{hasOwnProperty:sq}=Object.prototype,uS=n=>n.includes("-")?n:n.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),oq=/\s+(?![^()]*\))/,yh=n=>e=>n(...typeof e=="string"?String(e).split(oq):[e]),NL={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:yh((n,e)=>({marginBlockStart:n,marginBlockEnd:e||n})),marginInline:yh((n,e)=>({marginInlineStart:n,marginInlineEnd:e||n})),maxSize:yh((n,e)=>({maxBlockSize:n,maxInlineSize:e||n})),minSize:yh((n,e)=>({minBlockSize:n,minInlineSize:e||n})),paddingBlock:yh((n,e)=>({paddingBlockStart:n,paddingBlockEnd:e||n})),paddingInline:yh((n,e)=>({paddingInlineStart:n,paddingInlineEnd:e||n}))},Cw=/([\d.]+)([^]*)/,aq=(n,e)=>n.length?n.reduce((t,i)=>(t.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(r)?`:is(${i})`:i):i+" "+r)),t),[]):e,lq=(n,e)=>n in cq&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,i,r,s)=>i+(r==="stretch"?`-moz-available${s};${uS(n)}:${i}-webkit-fill-available`:`-moz-fit-content${s};${uS(n)}:${i}fit-content`)+s):String(e),cq={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},da=n=>n?n+"-":"",NN=(n,e,t)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(i,r,s,o,a)=>o=="$"==!!s?i:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?da(e)+(a.includes("$")?"":da(t))+a.replace(/\$/g,"-"):a)+")"+(r||o=="--"?"*"+(r||"")+(s||"1")+")":"")),uq=/\s*,\s*(?![^()]*\))/,hq=Object.prototype.toString,Vh=(n,e,t,i,r)=>{let s,o,a;const l=(c,u,f)=>{let p,m;const y=_=>{for(p in _){const x=p.charCodeAt(0)===64,C=x&&Array.isArray(_[p])?_[p]:[_[p]];for(m of C){const I=/[A-Z]/.test(T=p)?T:T.replace(/-[^]/g,B=>B[1].toUpperCase()),D=typeof m=="object"&&m&&m.toString===hq&&(!i.utils[I]||!u.length);if(I in i.utils&&!D){const B=i.utils[I];if(B!==o){o=B,y(B(m)),o=null;continue}}else if(I in NL){const B=NL[I];if(B!==a){a=B,y(B(m)),a=null;continue}}if(x&&(w=p.slice(1)in i.media?"@media "+i.media[p.slice(1)]:p,p=w.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(B,N,z,Z,q,H)=>{const Y=Cw.test(N),ee=.0625*(Y?-1:1),[le,W]=Y?[Z,N]:[N,Z];return"("+(z[0]==="="?"":z[0]===">"===Y?"max-":"min-")+le+":"+(z[0]!=="="&&z.length===1?W.replace(Cw,(ie,ne,J)=>Number(ne)+ee*(z===">"?1:-1)+J):W)+(q?") and ("+(q[0]===">"?"min-":"max-")+le+":"+(q.length===1?H.replace(Cw,(ie,ne,J)=>Number(ne)+ee*(q===">"?-1:1)+J):H):"")+")"})),D){const B=x?f.concat(p):[...f],N=x?[...u]:aq(u,p.split(uq));s!==void 0&&r(FL(...s)),s=void 0,l(m,N,B)}else s===void 0&&(s=[[],u,f]),p=x||p.charCodeAt(0)!==36?p:`--${da(i.prefix)}${p.slice(1).replace(/\$/g,"-")}`,m=D?m:typeof m=="number"?m&&I in dq?String(m)+"px":String(m):NN(lq(I,m??""),i.prefix,i.themeMap[I]),s[0].push(`${x?`${p} `:`${uS(p)}:`}${m}`)}}var w,T};y(c),s!==void 0&&r(FL(...s)),s=void 0};l(n,e,t)},FL=(n,e,t)=>`${t.map(i=>`${i}{`).join("")}${e.length?`${e.join(",")}{`:""}${n.join(";")}${e.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,dq={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},BL=n=>String.fromCharCode(n+(n>25?39:97)),qc=n=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=BL(t%52)+i;return BL(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(n))>>>0),op=["themed","global","styled","onevar","resonevar","allvar","inline"],fq=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},pq=n=>{let e;const t=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(s,o)=>{const{cssText:a}=s;let l="";if(a.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!s.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===s)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${a}`;return s.cssRules.length?`${l}${a}`:""}return a}).join("")},i=()=>{if(e){const{rules:a,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in a)delete a[c]}const r=Object(n).styleSheets||[];for(const a of r)if(fq(a)){for(let l=0,c=a.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const f=Object(c[l+1]);if(f.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const m=p.slice(14,-3).trim().split(/\s+/),y=op[m[0]];y&&(e||(e={sheet:a,reset:i,rules:{},toString:t}),e.rules[y]={group:f,index:l,cache:new Set(m)})}if(e)break}if(!e){const a=(l,c)=>({type:c,cssRules:[],insertRule(u,f){this.cssRules.splice(f,0,a(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:a("","text/css"),rules:{},reset:i,toString:t}}const{sheet:s,rules:o}=e;for(let a=op.length-1;a>=0;--a){const l=op[a];if(!o[l]){const c=op[a+1],u=o[c]?o[c].index:s.cssRules.length;s.insertRule("@media{}",u),s.insertRule(`--sxs{--sxs:${a}}`,u),o[l]={group:s.cssRules[u+1],index:u,cache:new Set([a])}}gq(o[l])}};return i(),e},gq=n=>{const e=n.group;let t=e.cssRules.length;n.apply=i=>{try{e.insertRule(i,t),++t}catch{}}},Yf=Symbol(),mq=Vd(),UL=(n,e)=>mq(n,()=>(...t)=>{let i={type:null,composers:new Set};for(const r of t)if(r!=null)if(r[Wc]){i.type==null&&(i.type=r[Wc].type);for(const s of r[Wc].composers)i.composers.add(s)}else r.constructor!==Object||r.$$typeof?i.type==null&&(i.type=r):i.composers.add(vq(r,n));return i.type==null&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),yq(n,i,e)}),vq=({variants:n,compoundVariants:e,defaultVariants:t,...i},r)=>{const s=`${da(r.prefix)}c-${qc(i)}`,o=[],a=[],l=Object.create(null),c=[];for(const p in t)l[p]=String(t[p]);if(typeof n=="object"&&n)for(const p in n){u=l,f=p,sq.call(u,f)||(l[p]="undefined");const m=n[p];for(const y in m){const _={[p]:String(y)};String(y)==="undefined"&&c.push(p);const w=m[y],T=[_,w,!ML(w)];o.push(T)}}var u,f;if(typeof e=="object"&&e)for(const p of e){let{css:m,...y}=p;m=typeof m=="object"&&m||{};for(const w in y)y[w]=String(y[w]);const _=[y,m,!ML(m)];a.push(_)}return[s,i,o,a,l,c]},yq=(n,e,t)=>{const[i,r,s,o]=_q(e.composers),a=typeof e.type=="function"||e.type.$$typeof?(f=>{function p(){for(let m=0;m<p[Yf].length;m++){const[y,_]=p[Yf][m];f.rules[y].apply(_)}return p[Yf]=[],null}return p[Yf]=[],p.rules={},op.forEach(m=>p.rules[m]={apply:y=>p[Yf].push([m,y])}),p})(t):null,l=(a||t).rules,c=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,u=f=>{f=typeof f=="object"&&f||Eq;const{css:p,...m}=f,y={};for(const T in s)if(delete m[T],T in f){let x=f[T];typeof x=="object"&&x?y[T]={"@initial":s[T],...x}:(x=String(x),y[T]=x!=="undefined"||o.has(T)?x:s[T])}else y[T]=s[T];const _=new Set([...r]);for(const[T,x,C,I]of e.composers){t.rules.styled.cache.has(T)||(t.rules.styled.cache.add(T),Vh(x,[`.${T}`],[],n,N=>{l.styled.apply(N)}));const D=zL(C,y,n.media),B=zL(I,y,n.media,!0);for(const N of D)if(N!==void 0)for(const[z,Z,q]of N){const H=`${T}-${qc(Z)}-${z}`;_.add(H);const Y=(q?t.rules.resonevar:t.rules.onevar).cache,ee=q?l.resonevar:l.onevar;Y.has(H)||(Y.add(H),Vh(Z,[`.${H}`],[],n,le=>{ee.apply(le)}))}for(const N of B)if(N!==void 0)for(const[z,Z]of N){const q=`${T}-${qc(Z)}-${z}`;_.add(q),t.rules.allvar.cache.has(q)||(t.rules.allvar.cache.add(q),Vh(Z,[`.${q}`],[],n,H=>{l.allvar.apply(H)}))}}if(typeof p=="object"&&p){const T=`${i}-i${qc(p)}-css`;_.add(T),t.rules.inline.cache.has(T)||(t.rules.inline.cache.add(T),Vh(p,[`.${T}`],[],n,x=>{l.inline.apply(x)}))}for(const T of String(f.className||"").trim().split(/\s+/))T&&_.add(T);const w=m.className=[..._].join(" ");return{type:e.type,className:w,selector:c,props:m,toString:()=>w,deferredInjector:a}};return Lx(u,{className:i,selector:c,[Wc]:e,toString:()=>(t.rules.styled.cache.has(i)||u(),i)})},_q=n=>{let e="";const t=[],i={},r=[];for(const[s,,,,o,a]of n){e===""&&(e=s),t.push(s),r.push(...a);for(const l in o){const c=o[l];(i[l]===void 0||c!=="undefined"||a.includes(c))&&(i[l]=c)}}return[e,t,i,new Set(r)]},zL=(n,e,t,i)=>{const r=[];e:for(let[s,o,a]of n){if(a)continue;let l,c=0,u=!1;for(l in s){const f=s[l];let p=e[l];if(p!==f){if(typeof p!="object"||!p)continue e;{let m,y,_=0;for(const w in p){if(f===String(p[w])){if(w!=="@initial"){const T=w.slice(1);(y=y||[]).push(T in t?t[T]:w.replace(/^@media ?/,"")),u=!0}c+=_,m=!0}++_}if(y&&y.length&&(o={["@media "+y.join(", ")]:o}),!m)continue e}}}(r[c]=r[c]||[]).push([i?"cv":`${l}-${s[l]}`,o,u])}return r},Eq={},wq=Vd(),Tq=(n,e)=>wq(n,()=>(...t)=>{const i=()=>{for(let r of t){r=typeof r=="object"&&r||{};let s=qc(r);if(!e.rules.global.cache.has(s)){if(e.rules.global.cache.add(s),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let a of[].concat(r["@import"]))a=a.includes('"')||a.includes("'")?a:`"${a}"`,e.sheet.insertRule(`@import ${a};`,o++);delete r["@import"]}Vh(r,[],[],n,o=>{e.rules.global.apply(o)})}}return""};return Lx(i,{toString:i})}),Sq=Vd(),bq=(n,e)=>Sq(n,()=>t=>{const i=`${da(n.prefix)}k-${qc(t)}`,r=()=>{if(!e.rules.global.cache.has(i)){e.rules.global.cache.add(i);const s=[];Vh(t,[],[],n,a=>s.push(a));const o=`@keyframes ${i}{${s.join("")}}`;e.rules.global.apply(o)}return i};return Lx(r,{get name(){return r()},toString:r})}),xq=class{constructor(e,t,i,r){this.token=e==null?"":String(e),this.value=t==null?"":String(t),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+da(this.prefix)+da(this.scale)+this.token}toString(){return this.computedValue}},Cq=Vd(),Rq=(n,e)=>Cq(n,()=>(t,i)=>{i=typeof t=="object"&&t||Object(i);const r=`.${t=(t=typeof t=="string"?t:"")||`${da(n.prefix)}t-${qc(i)}`}`,s={},o=[];for(const l in i){s[l]={};for(const c in i[l]){const u=`--${da(n.prefix)}${l}-${c}`,f=NN(String(i[l][c]),n.prefix,l);s[l][c]=new xq(c,f,l,n.prefix),o.push(`${u}:${f}`)}}const a=()=>{if(o.length&&!e.rules.themed.cache.has(t)){e.rules.themed.cache.add(t);const l=`${i===n.theme?":root,":""}.${t}{${o.join(";")}}`;e.rules.themed.apply(l)}return t};return{...s,get className(){return a()},selector:r,toString:a}}),Aq=Vd(),GL,Lq=Vd(),Ix=n=>{const e=(t=>{let i=!1;const r=Aq(t,s=>{i=!0;const o="prefix"in(s=typeof s=="object"&&s||{})?String(s.prefix):"",a=typeof s.media=="object"&&s.media||{},l=typeof s.root=="object"?s.root||null:globalThis.document||null,c=typeof s.theme=="object"&&s.theme||{},u={prefix:o,media:a,theme:c,themeMap:typeof s.themeMap=="object"&&s.themeMap||{...nq},utils:typeof s.utils=="object"&&s.utils||{}},f=pq(l),p={css:UL(u,f),globalCss:Tq(u,f),keyframes:bq(u,f),createTheme:Rq(u,f),reset(){f.reset(),p.theme.toString()},theme:{},sheet:f,config:u,prefix:o,getCssText:f.toString,toString:f.toString};return String(p.theme=p.createTheme(c)),p});return i||r.reset(),r})(n);return e.styled=(({config:t,sheet:i})=>Lq(t,()=>{const r=UL(t,i);return(...s)=>{const o=r(...s),a=o[Wc].type,l=F.forwardRef((c,u)=>{const f=c&&c.as||a,{props:p,deferredInjector:m}=o(c);return delete p.as,p.ref=u,m?F.createElement(F.Fragment,null,F.createElement(f,p),F.createElement(m,null)):F.createElement(f,p)});return l.className=o.className,l.displayName=`Styled.${a.displayName||a.name||a}`,l.selector=o.selector,l.toString=()=>o.selector,l[Wc]=o[Wc],l}}))(e),e},Iq=()=>GL||(GL=Ix()),Pq=(...n)=>Iq().createTheme(...n);function FN(n){const e=n+"CollectionProvider",[t,i]=ks(e),[r,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:y,children:_}=m,w=F.useRef(null),T=F.useRef(new Map).current;return F.createElement(r,{scope:y,itemMap:T,collectionRef:w},_)},a=n+"CollectionSlot",l=F.forwardRef((m,y)=>{const{scope:_,children:w}=m,T=s(a,_),x=vi(y,T.collectionRef);return F.createElement(gd,{ref:x},w)}),c=n+"CollectionItemSlot",u="data-radix-collection-item",f=F.forwardRef((m,y)=>{const{scope:_,children:w,...T}=m,x=F.useRef(null),C=vi(y,x),I=s(c,_);return F.useEffect(()=>(I.itemMap.set(x,{ref:x,...T}),()=>void I.itemMap.delete(x))),F.createElement(gd,{[u]:"",ref:C},w)});function p(m){const y=s(n+"CollectionConsumer",m);return F.useCallback(()=>{const w=y.collectionRef.current;if(!w)return[];const T=Array.from(w.querySelectorAll(`[${u}]`));return Array.from(y.itemMap.values()).sort((I,D)=>T.indexOf(I.ref.current)-T.indexOf(D.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:l,ItemSlot:f},p,i]}const Dq=M.createContext(void 0);function H0(n){const e=M.useContext(Dq);return n||e||"ltr"}const Rw="rovingFocusGroup.onEntryFocus",Oq={bubbles:!1,cancelable:!0},Px="RovingFocusGroup",[hS,BN,kq]=FN(Px),[Mq,$0]=ks(Px,[kq]),[Nq,Fq]=Mq(Px),Bq=M.forwardRef((n,e)=>M.createElement(hS.Provider,{scope:n.__scopeRovingFocusGroup},M.createElement(hS.Slot,{scope:n.__scopeRovingFocusGroup},M.createElement(Uq,Ze({},n,{ref:e}))))),Uq=M.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:i,loop:r=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...u}=n,f=M.useRef(null),p=vi(e,f),m=H0(s),[y=null,_]=Dl({prop:o,defaultProp:a,onChange:l}),[w,T]=M.useState(!1),x=go(c),C=BN(t),I=M.useRef(!1),[D,B]=M.useState(0);return M.useEffect(()=>{const N=f.current;if(N)return N.addEventListener(Rw,x),()=>N.removeEventListener(Rw,x)},[x]),M.createElement(Nq,{scope:t,orientation:i,dir:m,loop:r,currentTabStopId:y,onItemFocus:M.useCallback(N=>_(N),[_]),onItemShiftTab:M.useCallback(()=>T(!0),[]),onFocusableItemAdd:M.useCallback(()=>B(N=>N+1),[]),onFocusableItemRemove:M.useCallback(()=>B(N=>N-1),[])},M.createElement(Gt.div,Ze({tabIndex:w||D===0?-1:0,"data-orientation":i},u,{ref:p,style:{outline:"none",...n.style},onMouseDown:Dt(n.onMouseDown,()=>{I.current=!0}),onFocus:Dt(n.onFocus,N=>{const z=!I.current;if(N.target===N.currentTarget&&z&&!w){const Z=new CustomEvent(Rw,Oq);if(N.currentTarget.dispatchEvent(Z),!Z.defaultPrevented){const q=C().filter(W=>W.focusable),H=q.find(W=>W.active),Y=q.find(W=>W.id===y),le=[H,Y,...q].filter(Boolean).map(W=>W.ref.current);UN(le)}}I.current=!1}),onBlur:Dt(n.onBlur,()=>T(!1))})))}),zq="RovingFocusGroupItem",Gq=M.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:i=!0,active:r=!1,tabStopId:s,...o}=n,a=Vl(),l=s||a,c=Fq(zq,t),u=c.currentTabStopId===l,f=BN(t),{onFocusableItemAdd:p,onFocusableItemRemove:m}=c;return M.useEffect(()=>{if(i)return p(),()=>m()},[i,p,m]),M.createElement(hS.ItemSlot,{scope:t,id:l,focusable:i,active:r},M.createElement(Gt.span,Ze({tabIndex:u?0:-1,"data-orientation":c.orientation},o,{ref:e,onMouseDown:Dt(n.onMouseDown,y=>{i?c.onItemFocus(l):y.preventDefault()}),onFocus:Dt(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:Dt(n.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){c.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const _=Vq(y,c.orientation,c.dir);if(_!==void 0){y.preventDefault();let T=f().filter(x=>x.focusable).map(x=>x.ref.current);if(_==="last")T.reverse();else if(_==="prev"||_==="next"){_==="prev"&&T.reverse();const x=T.indexOf(y.currentTarget);T=c.loop?jq(T,x+1):T.slice(x+1)}setTimeout(()=>UN(T))}})})))}),Hq={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $q(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function Vq(n,e,t){const i=$q(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return Hq[i]}function UN(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function jq(n,e){return n.map((t,i)=>n[(e+i)%n.length])}const zN=Bq,GN=Gq,HN="Tabs",[Wq,ame]=ks(HN,[$0]),$N=$0(),[qq,Dx]=Wq(HN),Kq=M.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,onValueChange:r,defaultValue:s,orientation:o="horizontal",dir:a,activationMode:l="automatic",...c}=n,u=H0(a),[f,p]=Dl({prop:i,onChange:r,defaultProp:s});return M.createElement(qq,{scope:t,baseId:Vl(),value:f,onValueChange:p,orientation:o,dir:u,activationMode:l},M.createElement(Gt.div,Ze({dir:u,"data-orientation":o},c,{ref:e})))}),Zq="TabsList",Yq=M.forwardRef((n,e)=>{const{__scopeTabs:t,loop:i=!0,...r}=n,s=Dx(Zq,t),o=$N(t);return M.createElement(zN,Ze({asChild:!0},o,{orientation:s.orientation,dir:s.dir,loop:i}),M.createElement(Gt.div,Ze({role:"tablist","aria-orientation":s.orientation},r,{ref:e})))}),Xq="TabsTrigger",Jq=M.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,disabled:r=!1,...s}=n,o=Dx(Xq,t),a=$N(t),l=VN(o.baseId,i),c=jN(o.baseId,i),u=i===o.value;return M.createElement(GN,Ze({asChild:!0},a,{focusable:!r,active:u}),M.createElement(Gt.button,Ze({type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:l},s,{ref:e,onMouseDown:Dt(n.onMouseDown,f=>{!r&&f.button===0&&f.ctrlKey===!1?o.onValueChange(i):f.preventDefault()}),onKeyDown:Dt(n.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&o.onValueChange(i)}),onFocus:Dt(n.onFocus,()=>{const f=o.activationMode!=="manual";!u&&!r&&f&&o.onValueChange(i)})})))}),Qq="TabsContent",eK=M.forwardRef((n,e)=>{const{__scopeTabs:t,value:i,forceMount:r,children:s,...o}=n,a=Dx(Qq,t),l=VN(a.baseId,i),c=jN(a.baseId,i),u=i===a.value,f=M.useRef(u);return M.useEffect(()=>{const p=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(p)},[]),M.createElement(z0,{present:r||u},({present:p})=>M.createElement(Gt.div,Ze({"data-state":u?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!p,id:c,tabIndex:0},o,{ref:e,style:{...n.style,animationDuration:f.current?"0s":void 0}}),p&&s))});function VN(n,e){return`${n}-trigger-${e}`}function jN(n,e){return`${n}-content-${e}`}const tK=Kq,iK=Yq,nK=Jq,rK=eK;function Ox(n){const[e,t]=M.useState(void 0);return Xn(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return i.observe(n,{box:"border-box"}),()=>i.unobserve(n)}else t(void 0)},[n]),e}function kx(n){const e=M.useRef({value:n,previous:n});return M.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}const WN="Radio",[sK,qN]=ks(WN),[oK,lme]=sK(WN),aK=M.forwardRef((n,e)=>{const{__scopeRadio:t,name:i,checked:r=!1,required:s,disabled:o,value:a="on",onCheck:l,...c}=n,[u,f]=M.useState(null),p=vi(e,_=>f(_)),m=M.useRef(!1),y=u?!!u.closest("form"):!0;return M.createElement(oK,{scope:t,checked:r,disabled:o},M.createElement(Gt.button,Ze({type:"button",role:"radio","aria-checked":r,"data-state":cK(r),"data-disabled":o?"":void 0,disabled:o,value:a},c,{ref:p,onClick:Dt(n.onClick,_=>{r||l==null||l(),y&&(m.current=_.isPropagationStopped(),m.current||_.stopPropagation())})})),y&&M.createElement(lK,{control:u,bubbles:!m.current,name:i,value:a,checked:r,required:s,disabled:o,style:{transform:"translateX(-100%)"}}))}),lK=n=>{const{control:e,checked:t,bubbles:i=!0,...r}=n,s=M.useRef(null),o=kx(t),a=Ox(e);return M.useEffect(()=>{const l=s.current,c=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(c,"checked").set;if(o!==t&&f){const p=new Event("click",{bubbles:i});f.call(l,t),l.dispatchEvent(p)}},[o,t,i]),M.createElement("input",Ze({type:"radio","aria-hidden":!0,defaultChecked:t},r,{tabIndex:-1,ref:s,style:{...n.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function cK(n){return n?"checked":"unchecked"}const uK=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],KN="RadioGroup",[hK,cme]=ks(KN,[$0,qN]),ZN=$0(),dK=qN(),[fK,pK]=hK(KN),gK=M.forwardRef((n,e)=>{const{__scopeRadioGroup:t,name:i,defaultValue:r,value:s,required:o=!1,disabled:a=!1,orientation:l,dir:c,loop:u=!0,onValueChange:f,...p}=n,m=ZN(t),y=H0(c),[_,w]=Dl({prop:s,defaultProp:r,onChange:f});return M.createElement(fK,{scope:t,name:i,required:o,disabled:a,value:_,onValueChange:w},M.createElement(zN,Ze({asChild:!0},m,{orientation:l,dir:y,loop:u}),M.createElement(Gt.div,Ze({role:"radiogroup","aria-required":o,"aria-orientation":l,"data-disabled":a?"":void 0,dir:y},p,{ref:e}))))}),mK="RadioGroupItem",vK=M.forwardRef((n,e)=>{const{__scopeRadioGroup:t,disabled:i,...r}=n,s=pK(mK,t),o=s.disabled||i,a=ZN(t),l=dK(t),c=M.useRef(null),u=vi(e,c),f=s.value===r.value,p=M.useRef(!1);return M.useEffect(()=>{const m=_=>{uK.includes(_.key)&&(p.current=!0)},y=()=>p.current=!1;return document.addEventListener("keydown",m),document.addEventListener("keyup",y),()=>{document.removeEventListener("keydown",m),document.removeEventListener("keyup",y)}},[]),M.createElement(GN,Ze({asChild:!0},a,{focusable:!o,active:f}),M.createElement(aK,Ze({disabled:o,required:s.required,checked:f},l,r,{name:s.name,ref:u,onCheck:()=>s.onValueChange(r.value),onKeyDown:Dt(m=>{m.key==="Enter"&&m.preventDefault()}),onFocus:Dt(r.onFocus,()=>{var m;p.current&&((m=c.current)===null||m===void 0||m.click())})})))}),YN=gK,XN=vK;function ts(n,e){this.message=n,this.error=e}ts.prototype=Object.create(Error.prototype);const Mx=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function yK(n,e){e||(e={});const{meta:t=!1,strict:i=!0}=e;if(typeof n!="string")throw new ts("Input must be a string");n=n.trim(),n=n.replace(/\r\n/g,`
`),n=n.replace(/\r/g,`
`);const r=n.split(`

`),s=r.shift();if(!s.startsWith("WEBVTT"))throw new ts('Must start with "WEBVTT"');const o=s.split(`
`),a=o[0].replace("WEBVTT","");if(a.length>0&&a[0]!==" "&&a[0]!=="	")throw new ts("Header comment must start with space or tab");if(r.length===0&&o.length===1)return{valid:!0,strict:i,cues:[],errors:[]};if(!t&&o.length>1&&o[1]!=="")throw new ts("Missing blank line after signature");const{cues:l,errors:c}=EK(r,i);if(i&&c.length>0)throw c[0];const u=t?_K(o):null,f={valid:c.length===0,strict:i,cues:l,errors:c};return t&&(f.meta=u),f}function _K(n){const e={};return n.slice(1).forEach(t=>{const i=t.indexOf(":"),r=t.slice(0,i).trim(),s=t.slice(i+1).trim();e[r]=s}),Object.keys(e).length>0?e:null}function EK(n,e){const t=[];return{cues:n.map((r,s)=>{try{return wK(r,s,e)}catch(o){return t.push(o),null}}).filter(Boolean),errors:t}}function wK(n,e,t){let i="",r=0,s=.01,o="",a="";const l=n.split(`
`).filter(Boolean);if(l.length>0&&l[0].trim().startsWith("NOTE"))return null;if(l.length===1&&!l[0].includes("-->"))throw new ts(`Cue identifier cannot be standalone (cue #${e})`);if(l.length>1&&!(l[0].includes("-->")||l[1].includes("-->"))){const u=`Cue identifier needs to be followed by timestamp (cue #${e})`;throw new ts(u)}l.length>1&&l[1].includes("-->")&&(i=l.shift());const c=typeof l[0]=="string"&&l[0].split(" --> ");if(c.length!==2||!HL(c[0])||!HL(c[1]))throw new ts(`Invalid cue timestamp (cue #${e})`);if(r=$L(c[0]),s=$L(c[1]),t){if(r>s)throw new ts(`Start timestamp greater than end (cue #${e})`);if(s<=r)throw new ts(`End must be greater than start (cue #${e})`)}if(!t&&s<r)throw new ts(`End must be greater or equal to start when not strict (cue #${e})`);return a=c[1].replace(Mx,"").trim(),l.shift(),o=l.join(`
`),o?{identifier:i,start:r,end:s,text:o,styles:a}:!1}function HL(n){return Mx.test(n)}function $L(n){const e=n.match(Mx);let t=parseFloat(e[1]||0)*60*60;return t+=parseFloat(e[2])*60,t+=parseFloat(e[3]),t}var JN={ParserError:ts,parse:yK};function Nn(n,e){this.message=n,this.error=e}Nn.prototype=Object.create(Error.prototype);function TK(n){if(!n)throw new Nn("Input must be non-null");if(typeof n!="object")throw new Nn("Input must be an object");if(Array.isArray(n))throw new Nn("Input cannot be array");if(!n.valid)throw new Nn("Input must be valid");let e=`WEBVTT
`;if(n.meta){if(typeof n.meta!="object"||Array.isArray(n.meta))throw new Nn("Metadata must be an object");Object.entries(n.meta).forEach(i=>{if(typeof i[1]!="string")throw new Nn(`Metadata value for "${i[0]}" must be string`);e+=`${i[0]}: ${i[1]}
`})}let t=null;return n.cues.forEach((i,r)=>{if(t&&t>i.start)throw new Nn(`Cue number ${r} is not in chronological order`);t=i.start,e+=`
`,e+=SK(i),e+=`
`}),e}function SK(n){if(typeof n!="object")throw new Nn("Cue malformed: not of type object");if(typeof n.identifier!="string"&&typeof n.identifier!="number"&&n.identifier!==null)throw new Nn(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(n)}`);if(isNaN(n.start))throw new Nn(`Cue malformed: null start value.
    ${JSON.stringify(n)}`);if(isNaN(n.end))throw new Nn(`Cue malformed: null end value.
    ${JSON.stringify(n)}`);if(n.start>=n.end)throw new Nn(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(n)}`);if(typeof n.text!="string")throw new Nn(`Cue malformed: null text value.
    ${JSON.stringify(n)}`);if(typeof n.styles!="string")throw new Nn(`Cue malformed: null styles value.
    ${JSON.stringify(n)}`);let e="";n.identifier.length>0&&(e+=`${n.identifier}
`);const t=VL(n.start),i=VL(n.end);return e+=`${t} --> ${i}`,e+=n.styles?` ${n.styles}`:"",e+=`
${n.text}`,e}function VL(n){const e=sv(bK(n),2),t=sv(xK(n),2),i=sv(CK(n),2),r=sv(RK(n),3);return`${e}:${t}:${i}.${r}`}function sv(n,e){let t=`${n}`;for(;t.length<e;)t=`0${t}`;return t}function bK(n){return Math.floor(n/60/60)}function xK(n){return Math.floor(n/60)%60}function CK(n){return Math.floor(n%60)}function RK(n){return Math.floor((n%1).toFixed(4)*1e3)}var AK={CompilerError:Nn,compile:TK};const LK=JN.parse;function IK(n,e){e=e||10;const t=LK(n),i=[];let r=[],s=null,o=0,a=0;return t.cues.forEach((l,c)=>{const u=c===0,f=c===t.cues.length-1,p=l.start,m=l.end,y=f?1/0:t.cues[c+1].start,_=u?m:m-p,w=u?0:p-t.cues[c-1].end;o=o+_+w,s&&(r.push(s),o+=s.end-a,s=null),r.push(l);let T=y-m<e&&w<e&&o>e;if(PK(a,e,y,w)){const x=DK(f,m,e,o,a);i.push({duration:x,cues:r}),a+=x,o=0,r=[]}else T=!1;T&&(s=l)}),i}function PK(n,e,t,i){const r=QN(i,e);return(i<=e||r+n<t)&&t-n>=e}function DK(n,e,t,i,r){let s=t;return i>t&&(s=QN(i-t,t)),n?s=parseFloat((e-r).toFixed(2)):s=Math.round(s),s}function QN(n,e){return n+=e-n%e,n}var eF={segment:IK};const tF=eF.segment;function OK(n,e,t){typeof t>"u"&&(t="900000");const i=tF(n,e),r=[];return i.forEach((s,o)=>{const a=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${t},LOCAL:00:00:00.000

${FK(s.cues)}
`,l=iF(o);r.push({filename:l,content:a})}),r}function kK(n,e){const t=tF(n,e),i=MK(t);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(NK(t))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${i}
#EXT-X-ENDLIST
`}function ov(n,e){return`${"0".repeat(Math.max(0,e-n.toString().length))}${n}`}function iF(n){return`${n}.vtt`}function MK(n){const e=[];return n.forEach((t,i)=>{e.push(`#EXTINF:${t.duration.toFixed(5)},
${iF(i)}`)}),e.join(`
`)}function NK(n){let e=0;return n.forEach(t=>{t.duration>e&&(e=t.duration)}),e}function FK(n){const e=[];return n.forEach(t=>{e.push(BK(t))}),e.join(`

`)}function BK(n){const e=[];n.identifier&&e.push(n.identifier);const t=jL(n.start),i=jL(n.end),r=n.styles?`${n.styles}`:"";return e.push(`${t} --> ${i} ${r}`),e.push(n.text),e.join(`
`)}function jL(n){const e=(n%1).toFixed(3);n=Math.round(n-e);const t=Math.floor(n/3600),i=Math.floor((n-t*3600)/60),r=n-t*3600-i*60;return`${`${ov(t,2)}:`}${ov(i,2)}:${ov(r,2)}.${ov(e*1e3,3)}`}var UK={hlsSegment:OK,hlsSegmentPlaylist:kK};const zK=JN.parse,GK=AK.compile,HK=eF.segment,$K=UK;var VK={parse:zK,compile:GK,segment:HK,hls:$K};const[Nx,ume]=ks("Form"),nF="Form",[jK,rF]=Nx(nF),[WK,qK]=Nx(nF),KK=M.forwardRef((n,e)=>{const{__scopeForm:t,onClearServerErrors:i=()=>{},...r}=n,s=M.useRef(null),o=vi(e,s),[a,l]=M.useState({}),c=M.useCallback(q=>a[q],[a]),u=M.useCallback((q,H)=>l(Y=>{var ee;return{...Y,[q]:{...(ee=Y[q])!==null&&ee!==void 0?ee:{},...H}}}),[]),f=M.useCallback(q=>{l(H=>({...H,[q]:void 0})),x(H=>({...H,[q]:{}}))},[]),[p,m]=M.useState({}),y=M.useCallback(q=>{var H;return(H=p[q])!==null&&H!==void 0?H:[]},[p]),_=M.useCallback((q,H)=>{m(Y=>{var ee;return{...Y,[q]:[...(ee=Y[q])!==null&&ee!==void 0?ee:[],H]}})},[]),w=M.useCallback((q,H)=>{m(Y=>{var ee;return{...Y,[q]:((ee=Y[q])!==null&&ee!==void 0?ee:[]).filter(le=>le.id!==H)}})},[]),[T,x]=M.useState({}),C=M.useCallback(q=>{var H;return(H=T[q])!==null&&H!==void 0?H:{}},[T]),I=M.useCallback((q,H)=>{x(Y=>{var ee;return{...Y,[q]:{...(ee=Y[q])!==null&&ee!==void 0?ee:{},...H}}})},[]),[D,B]=M.useState({}),N=M.useCallback((q,H)=>{B(Y=>{const ee=new Set(Y[q]).add(H);return{...Y,[q]:ee}})},[]),z=M.useCallback((q,H)=>{B(Y=>{const ee=new Set(Y[q]);return ee.delete(H),{...Y,[q]:ee}})},[]),Z=M.useCallback(q=>{var H;return Array.from((H=D[q])!==null&&H!==void 0?H:[]).join(" ")||void 0},[D]);return M.createElement(jK,{scope:t,getFieldValidity:c,onFieldValidityChange:u,getFieldCustomMatcherEntries:y,onFieldCustomMatcherEntryAdd:_,onFieldCustomMatcherEntryRemove:w,getFieldCustomErrors:C,onFieldCustomErrorsChange:I,onFieldValiditionClear:f},M.createElement(WK,{scope:t,onFieldMessageIdAdd:N,onFieldMessageIdRemove:z,getFieldDescription:Z},M.createElement(Gt.form,Ze({},r,{ref:o,onInvalid:Dt(n.onInvalid,q=>{const H=oF(q.currentTarget);H===q.target&&H.focus(),q.preventDefault()}),onSubmit:Dt(n.onSubmit,i,{checkForDefaultPrevented:!1}),onReset:Dt(n.onReset,i)}))))}),sF="FormField",[ZK,YK]=Nx(sF),XK=M.forwardRef((n,e)=>{const{__scopeForm:t,name:i,serverInvalid:r=!1,...s}=n,a=rF(sF,t).getFieldValidity(i),l=Vl();return M.createElement(ZK,{scope:t,id:l,name:i,serverInvalid:r},M.createElement(Gt.div,Ze({"data-valid":aF(a,r),"data-invalid":lF(a,r)},s,{ref:e})))}),Aw="FormControl",JK=M.forwardRef((n,e)=>{const{__scopeForm:t,...i}=n,r=rF(Aw,t),s=YK(Aw,t),o=qK(Aw,t),a=M.useRef(null),l=vi(e,a),c=i.name||s.name,u=i.id||s.id,f=r.getFieldCustomMatcherEntries(c),{onFieldValidityChange:p,onFieldCustomErrorsChange:m,onFieldValiditionClear:y}=r,_=M.useCallback(async x=>{if(oZ(x.validity)){const Y=Lw(x.validity);p(c,Y);return}const C=x.form?new FormData(x.form):new FormData,I=[x.value,C],D=[],B=[];f.forEach(Y=>{nZ(Y,I)?B.push(Y):rZ(Y)&&D.push(Y)});const N=D.map(({id:Y,match:ee})=>[Y,ee(...I)]),z=Object.fromEntries(N),Z=Object.values(z).some(Boolean),q=Z;x.setCustomValidity(q?WL:"");const H=Lw(x.validity);if(p(c,H),m(c,z),!Z&&B.length>0){const Y=B.map(({id:J,match:ce})=>ce(...I).then(se=>[J,se])),ee=await Promise.all(Y),le=Object.fromEntries(ee),ie=Object.values(le).some(Boolean);x.setCustomValidity(ie?WL:"");const ne=Lw(x.validity);p(c,ne),m(c,le)}},[f,c,m,p]);M.useEffect(()=>{const x=a.current;if(x){const C=()=>_(x);return x.addEventListener("change",C),()=>x.removeEventListener("change",C)}},[_]);const w=M.useCallback(()=>{const x=a.current;x&&(x.setCustomValidity(""),y(c))},[c,y]);M.useEffect(()=>{var x;const C=(x=a.current)===null||x===void 0?void 0:x.form;if(C)return C.addEventListener("reset",w),()=>C.removeEventListener("reset",w)},[w]),M.useEffect(()=>{const x=a.current,C=x==null?void 0:x.closest("form");if(C&&s.serverInvalid){const I=oF(C);I===x&&I.focus()}},[s.serverInvalid]);const T=r.getFieldValidity(c);return M.createElement(Gt.input,Ze({"data-valid":aF(T,s.serverInvalid),"data-invalid":lF(T,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(c),title:""},i,{ref:l,id:u,name:c,onInvalid:Dt(n.onInvalid,x=>{const C=x.currentTarget;_(C)}),onChange:Dt(n.onChange,x=>{w()})}))}),WL="This value is not valid",QK=M.forwardRef((n,e)=>{const{__scopeForm:t,...i}=n;return M.createElement(Gt.button,Ze({type:"submit"},i,{ref:e}))});function Lw(n){const e={};for(const t in n)e[t]=n[t];return e}function eZ(n){return n instanceof HTMLElement}function tZ(n){return"validity"in n}function iZ(n){return tZ(n)&&(n.validity.valid===!1||n.getAttribute("aria-invalid")==="true")}function oF(n){const e=n.elements,[t]=Array.from(e).filter(eZ).filter(iZ);return t}function nZ(n,e){return n.match.constructor.name==="AsyncFunction"||sZ(n.match,e)}function rZ(n){return n.match.constructor.name==="Function"}function sZ(n,e){return n(...e)instanceof Promise}function oZ(n){let e=!1;for(const t in n){const i=t;if(i!=="valid"&&i!=="customError"&&n[i]){e=!0;break}}return e}function aF(n,e){if((n==null?void 0:n.valid)===!0&&!e)return!0}function lF(n,e){if((n==null?void 0:n.valid)===!1||e)return!0}const aZ=KK,lZ=XK,cZ=JK,uZ=QK;var cF={},Bp={},Fx={},Up={},Bx={};Object.defineProperty(Bx,"__esModule",{value:!0});Bx.default=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(function(n){return n.charCodeAt(0)}));var Ux={};Object.defineProperty(Ux,"__esModule",{value:!0});Ux.default=new Uint16Array("Ȁaglq	\x1Bɭ\0\0p;䀦os;䀧t;䀾t;䀼uot;䀢".split("").map(function(n){return n.charCodeAt(0)}));var dS={};(function(n){var e;Object.defineProperty(n,"__esModule",{value:!0}),n.replaceCodePoint=n.fromCodePoint=void 0;var t=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);n.fromCodePoint=(e=String.fromCodePoint)!==null&&e!==void 0?e:function(s){var o="";return s>65535&&(s-=65536,o+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),o+=String.fromCharCode(s),o};function i(s){var o;return s>=55296&&s<=57343||s>1114111?65533:(o=t.get(s))!==null&&o!==void 0?o:s}n.replaceCodePoint=i;function r(s){return(0,n.fromCodePoint)(i(s))}n.default=r})(dS);(function(n){var e=wt&&wt.__createBinding||(Object.create?function(H,Y,ee,le){le===void 0&&(le=ee);var W=Object.getOwnPropertyDescriptor(Y,ee);(!W||("get"in W?!Y.__esModule:W.writable||W.configurable))&&(W={enumerable:!0,get:function(){return Y[ee]}}),Object.defineProperty(H,le,W)}:function(H,Y,ee,le){le===void 0&&(le=ee),H[le]=Y[ee]}),t=wt&&wt.__setModuleDefault||(Object.create?function(H,Y){Object.defineProperty(H,"default",{enumerable:!0,value:Y})}:function(H,Y){H.default=Y}),i=wt&&wt.__importStar||function(H){if(H&&H.__esModule)return H;var Y={};if(H!=null)for(var ee in H)ee!=="default"&&Object.prototype.hasOwnProperty.call(H,ee)&&e(Y,H,ee);return t(Y,H),Y},r=wt&&wt.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXML=n.decodeHTMLStrict=n.decodeHTMLAttribute=n.decodeHTML=n.determineBranch=n.EntityDecoder=n.DecodingMode=n.BinTrieFlags=n.fromCodePoint=n.replaceCodePoint=n.decodeCodePoint=n.xmlDecodeTree=n.htmlDecodeTree=void 0;var s=r(Bx);n.htmlDecodeTree=s.default;var o=r(Ux);n.xmlDecodeTree=o.default;var a=i(dS);n.decodeCodePoint=a.default;var l=dS;Object.defineProperty(n,"replaceCodePoint",{enumerable:!0,get:function(){return l.replaceCodePoint}}),Object.defineProperty(n,"fromCodePoint",{enumerable:!0,get:function(){return l.fromCodePoint}});var c;(function(H){H[H.NUM=35]="NUM",H[H.SEMI=59]="SEMI",H[H.EQUALS=61]="EQUALS",H[H.ZERO=48]="ZERO",H[H.NINE=57]="NINE",H[H.LOWER_A=97]="LOWER_A",H[H.LOWER_F=102]="LOWER_F",H[H.LOWER_X=120]="LOWER_X",H[H.LOWER_Z=122]="LOWER_Z",H[H.UPPER_A=65]="UPPER_A",H[H.UPPER_F=70]="UPPER_F",H[H.UPPER_Z=90]="UPPER_Z"})(c||(c={}));var u=32,f;(function(H){H[H.VALUE_LENGTH=49152]="VALUE_LENGTH",H[H.BRANCH_LENGTH=16256]="BRANCH_LENGTH",H[H.JUMP_TABLE=127]="JUMP_TABLE"})(f=n.BinTrieFlags||(n.BinTrieFlags={}));function p(H){return H>=c.ZERO&&H<=c.NINE}function m(H){return H>=c.UPPER_A&&H<=c.UPPER_F||H>=c.LOWER_A&&H<=c.LOWER_F}function y(H){return H>=c.UPPER_A&&H<=c.UPPER_Z||H>=c.LOWER_A&&H<=c.LOWER_Z||p(H)}function _(H){return H===c.EQUALS||y(H)}var w;(function(H){H[H.EntityStart=0]="EntityStart",H[H.NumericStart=1]="NumericStart",H[H.NumericDecimal=2]="NumericDecimal",H[H.NumericHex=3]="NumericHex",H[H.NamedEntity=4]="NamedEntity"})(w||(w={}));var T;(function(H){H[H.Legacy=0]="Legacy",H[H.Strict=1]="Strict",H[H.Attribute=2]="Attribute"})(T=n.DecodingMode||(n.DecodingMode={}));var x=function(){function H(Y,ee,le){this.decodeTree=Y,this.emitCodePoint=ee,this.errors=le,this.state=w.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=T.Strict}return H.prototype.startEntity=function(Y){this.decodeMode=Y,this.state=w.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},H.prototype.write=function(Y,ee){switch(this.state){case w.EntityStart:return Y.charCodeAt(ee)===c.NUM?(this.state=w.NumericStart,this.consumed+=1,this.stateNumericStart(Y,ee+1)):(this.state=w.NamedEntity,this.stateNamedEntity(Y,ee));case w.NumericStart:return this.stateNumericStart(Y,ee);case w.NumericDecimal:return this.stateNumericDecimal(Y,ee);case w.NumericHex:return this.stateNumericHex(Y,ee);case w.NamedEntity:return this.stateNamedEntity(Y,ee)}},H.prototype.stateNumericStart=function(Y,ee){return ee>=Y.length?-1:(Y.charCodeAt(ee)|u)===c.LOWER_X?(this.state=w.NumericHex,this.consumed+=1,this.stateNumericHex(Y,ee+1)):(this.state=w.NumericDecimal,this.stateNumericDecimal(Y,ee))},H.prototype.addToNumericResult=function(Y,ee,le,W){if(ee!==le){var ie=le-ee;this.result=this.result*Math.pow(W,ie)+parseInt(Y.substr(ee,ie),W),this.consumed+=ie}},H.prototype.stateNumericHex=function(Y,ee){for(var le=ee;ee<Y.length;){var W=Y.charCodeAt(ee);if(p(W)||m(W))ee+=1;else return this.addToNumericResult(Y,le,ee,16),this.emitNumericEntity(W,3)}return this.addToNumericResult(Y,le,ee,16),-1},H.prototype.stateNumericDecimal=function(Y,ee){for(var le=ee;ee<Y.length;){var W=Y.charCodeAt(ee);if(p(W))ee+=1;else return this.addToNumericResult(Y,le,ee,10),this.emitNumericEntity(W,2)}return this.addToNumericResult(Y,le,ee,10),-1},H.prototype.emitNumericEntity=function(Y,ee){var le;if(this.consumed<=ee)return(le=this.errors)===null||le===void 0||le.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(Y===c.SEMI)this.consumed+=1;else if(this.decodeMode===T.Strict)return 0;return this.emitCodePoint((0,a.replaceCodePoint)(this.result),this.consumed),this.errors&&(Y!==c.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},H.prototype.stateNamedEntity=function(Y,ee){for(var le=this.decodeTree,W=le[this.treeIndex],ie=(W&f.VALUE_LENGTH)>>14;ee<Y.length;ee++,this.excess++){var ne=Y.charCodeAt(ee);if(this.treeIndex=I(le,W,this.treeIndex+Math.max(1,ie),ne),this.treeIndex<0)return this.result===0||this.decodeMode===T.Attribute&&(ie===0||_(ne))?0:this.emitNotTerminatedNamedEntity();if(W=le[this.treeIndex],ie=(W&f.VALUE_LENGTH)>>14,ie!==0){if(ne===c.SEMI)return this.emitNamedEntityData(this.treeIndex,ie,this.consumed+this.excess);this.decodeMode!==T.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},H.prototype.emitNotTerminatedNamedEntity=function(){var Y,ee=this,le=ee.result,W=ee.decodeTree,ie=(W[le]&f.VALUE_LENGTH)>>14;return this.emitNamedEntityData(le,ie,this.consumed),(Y=this.errors)===null||Y===void 0||Y.missingSemicolonAfterCharacterReference(),this.consumed},H.prototype.emitNamedEntityData=function(Y,ee,le){var W=this.decodeTree;return this.emitCodePoint(ee===1?W[Y]&~f.VALUE_LENGTH:W[Y+1],le),ee===3&&this.emitCodePoint(W[Y+2],le),le},H.prototype.end=function(){var Y;switch(this.state){case w.NamedEntity:return this.result!==0&&(this.decodeMode!==T.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case w.NumericDecimal:return this.emitNumericEntity(0,2);case w.NumericHex:return this.emitNumericEntity(0,3);case w.NumericStart:return(Y=this.errors)===null||Y===void 0||Y.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case w.EntityStart:return 0}},H}();n.EntityDecoder=x;function C(H){var Y="",ee=new x(H,function(le){return Y+=(0,a.fromCodePoint)(le)});return function(W,ie){for(var ne=0,J=0;(J=W.indexOf("&",J))>=0;){Y+=W.slice(ne,J),ee.startEntity(ie);var ce=ee.write(W,J+1);if(ce<0){ne=J+ee.end();break}ne=J+ce,J=ce===0?ne+1:ne}var se=Y+W.slice(ne);return Y="",se}}function I(H,Y,ee,le){var W=(Y&f.BRANCH_LENGTH)>>7,ie=Y&f.JUMP_TABLE;if(W===0)return ie!==0&&le===ie?ee:-1;if(ie){var ne=le-ie;return ne<0||ne>=W?-1:H[ee+ne]-1}for(var J=ee,ce=J+W-1;J<=ce;){var se=J+ce>>>1,te=H[se];if(te<le)J=se+1;else if(te>le)ce=se-1;else return H[se+W]}return-1}n.determineBranch=I;var D=C(s.default),B=C(o.default);function N(H,Y){return Y===void 0&&(Y=T.Legacy),D(H,Y)}n.decodeHTML=N;function z(H){return D(H,T.Attribute)}n.decodeHTMLAttribute=z;function Z(H){return D(H,T.Strict)}n.decodeHTMLStrict=Z;function q(H){return B(H,T.Strict)}n.decodeXML=q})(Up);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteType=void 0;var e=Up,t;(function(p){p[p.Tab=9]="Tab",p[p.NewLine=10]="NewLine",p[p.FormFeed=12]="FormFeed",p[p.CarriageReturn=13]="CarriageReturn",p[p.Space=32]="Space",p[p.ExclamationMark=33]="ExclamationMark",p[p.Number=35]="Number",p[p.Amp=38]="Amp",p[p.SingleQuote=39]="SingleQuote",p[p.DoubleQuote=34]="DoubleQuote",p[p.Dash=45]="Dash",p[p.Slash=47]="Slash",p[p.Zero=48]="Zero",p[p.Nine=57]="Nine",p[p.Semi=59]="Semi",p[p.Lt=60]="Lt",p[p.Eq=61]="Eq",p[p.Gt=62]="Gt",p[p.Questionmark=63]="Questionmark",p[p.UpperA=65]="UpperA",p[p.LowerA=97]="LowerA",p[p.UpperF=70]="UpperF",p[p.LowerF=102]="LowerF",p[p.UpperZ=90]="UpperZ",p[p.LowerZ=122]="LowerZ",p[p.LowerX=120]="LowerX",p[p.OpeningSquareBracket=91]="OpeningSquareBracket"})(t||(t={}));var i;(function(p){p[p.Text=1]="Text",p[p.BeforeTagName=2]="BeforeTagName",p[p.InTagName=3]="InTagName",p[p.InSelfClosingTag=4]="InSelfClosingTag",p[p.BeforeClosingTagName=5]="BeforeClosingTagName",p[p.InClosingTagName=6]="InClosingTagName",p[p.AfterClosingTagName=7]="AfterClosingTagName",p[p.BeforeAttributeName=8]="BeforeAttributeName",p[p.InAttributeName=9]="InAttributeName",p[p.AfterAttributeName=10]="AfterAttributeName",p[p.BeforeAttributeValue=11]="BeforeAttributeValue",p[p.InAttributeValueDq=12]="InAttributeValueDq",p[p.InAttributeValueSq=13]="InAttributeValueSq",p[p.InAttributeValueNq=14]="InAttributeValueNq",p[p.BeforeDeclaration=15]="BeforeDeclaration",p[p.InDeclaration=16]="InDeclaration",p[p.InProcessingInstruction=17]="InProcessingInstruction",p[p.BeforeComment=18]="BeforeComment",p[p.CDATASequence=19]="CDATASequence",p[p.InSpecialComment=20]="InSpecialComment",p[p.InCommentLike=21]="InCommentLike",p[p.BeforeSpecialS=22]="BeforeSpecialS",p[p.SpecialStartSequence=23]="SpecialStartSequence",p[p.InSpecialTag=24]="InSpecialTag",p[p.BeforeEntity=25]="BeforeEntity",p[p.BeforeNumericEntity=26]="BeforeNumericEntity",p[p.InNamedEntity=27]="InNamedEntity",p[p.InNumericEntity=28]="InNumericEntity",p[p.InHexEntity=29]="InHexEntity"})(i||(i={}));function r(p){return p===t.Space||p===t.NewLine||p===t.Tab||p===t.FormFeed||p===t.CarriageReturn}function s(p){return p===t.Slash||p===t.Gt||r(p)}function o(p){return p>=t.Zero&&p<=t.Nine}function a(p){return p>=t.LowerA&&p<=t.LowerZ||p>=t.UpperA&&p<=t.UpperZ}function l(p){return p>=t.UpperA&&p<=t.UpperF||p>=t.LowerA&&p<=t.LowerF}var c;(function(p){p[p.NoValue=0]="NoValue",p[p.Unquoted=1]="Unquoted",p[p.Single=2]="Single",p[p.Double=3]="Double"})(c=n.QuoteType||(n.QuoteType={}));var u={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},f=function(){function p(m,y){var _=m.xmlMode,w=_===void 0?!1:_,T=m.decodeEntities,x=T===void 0?!0:T;this.cbs=y,this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=w,this.decodeEntities=x,this.entityTrie=w?e.xmlDecodeTree:e.htmlDecodeTree}return p.prototype.reset=function(){this.state=i.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=i.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},p.prototype.write=function(m){this.offset+=this.buffer.length,this.buffer=m,this.parse()},p.prototype.end=function(){this.running&&this.finish()},p.prototype.pause=function(){this.running=!1},p.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},p.prototype.getIndex=function(){return this.index},p.prototype.getSectionStart=function(){return this.sectionStart},p.prototype.stateText=function(m){m===t.Lt||!this.decodeEntities&&this.fastForwardTo(t.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=i.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&m===t.Amp&&(this.state=i.BeforeEntity)},p.prototype.stateSpecialStartSequence=function(m){var y=this.sequenceIndex===this.currentSequence.length,_=y?s(m):(m|32)===this.currentSequence[this.sequenceIndex];if(!_)this.isSpecial=!1;else if(!y){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=i.InTagName,this.stateInTagName(m)},p.prototype.stateInSpecialTag=function(m){if(this.sequenceIndex===this.currentSequence.length){if(m===t.Gt||r(m)){var y=this.index-this.currentSequence.length;if(this.sectionStart<y){var _=this.index;this.index=y,this.cbs.ontext(this.sectionStart,y),this.index=_}this.isSpecial=!1,this.sectionStart=y+2,this.stateInClosingTagName(m);return}this.sequenceIndex=0}(m|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===u.TitleEnd?this.decodeEntities&&m===t.Amp&&(this.state=i.BeforeEntity):this.fastForwardTo(t.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(m===t.Lt)},p.prototype.stateCDATASequence=function(m){m===u.Cdata[this.sequenceIndex]?++this.sequenceIndex===u.Cdata.length&&(this.state=i.InCommentLike,this.currentSequence=u.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=i.InDeclaration,this.stateInDeclaration(m))},p.prototype.fastForwardTo=function(m){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===m)return!0;return this.index=this.buffer.length+this.offset-1,!1},p.prototype.stateInCommentLike=function(m){m===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=i.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):m!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},p.prototype.isTagStartChar=function(m){return this.xmlMode?!s(m):a(m)},p.prototype.startSpecial=function(m,y){this.isSpecial=!0,this.currentSequence=m,this.sequenceIndex=y,this.state=i.SpecialStartSequence},p.prototype.stateBeforeTagName=function(m){if(m===t.ExclamationMark)this.state=i.BeforeDeclaration,this.sectionStart=this.index+1;else if(m===t.Questionmark)this.state=i.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(m)){var y=m|32;this.sectionStart=this.index,!this.xmlMode&&y===u.TitleEnd[2]?this.startSpecial(u.TitleEnd,3):this.state=!this.xmlMode&&y===u.ScriptEnd[2]?i.BeforeSpecialS:i.InTagName}else m===t.Slash?this.state=i.BeforeClosingTagName:(this.state=i.Text,this.stateText(m))},p.prototype.stateInTagName=function(m){s(m)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(m))},p.prototype.stateBeforeClosingTagName=function(m){r(m)||(m===t.Gt?this.state=i.Text:(this.state=this.isTagStartChar(m)?i.InClosingTagName:i.InSpecialComment,this.sectionStart=this.index))},p.prototype.stateInClosingTagName=function(m){(m===t.Gt||r(m))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterClosingTagName,this.stateAfterClosingTagName(m))},p.prototype.stateAfterClosingTagName=function(m){(m===t.Gt||this.fastForwardTo(t.Gt))&&(this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1)},p.prototype.stateBeforeAttributeName=function(m){m===t.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=i.InSpecialTag,this.sequenceIndex=0):this.state=i.Text,this.baseState=this.state,this.sectionStart=this.index+1):m===t.Slash?this.state=i.InSelfClosingTag:r(m)||(this.state=i.InAttributeName,this.sectionStart=this.index)},p.prototype.stateInSelfClosingTag=function(m){m===t.Gt?(this.cbs.onselfclosingtag(this.index),this.state=i.Text,this.baseState=i.Text,this.sectionStart=this.index+1,this.isSpecial=!1):r(m)||(this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(m))},p.prototype.stateInAttributeName=function(m){(m===t.Eq||s(m))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=i.AfterAttributeName,this.stateAfterAttributeName(m))},p.prototype.stateAfterAttributeName=function(m){m===t.Eq?this.state=i.BeforeAttributeValue:m===t.Slash||m===t.Gt?(this.cbs.onattribend(c.NoValue,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(m)):r(m)||(this.cbs.onattribend(c.NoValue,this.index),this.state=i.InAttributeName,this.sectionStart=this.index)},p.prototype.stateBeforeAttributeValue=function(m){m===t.DoubleQuote?(this.state=i.InAttributeValueDq,this.sectionStart=this.index+1):m===t.SingleQuote?(this.state=i.InAttributeValueSq,this.sectionStart=this.index+1):r(m)||(this.sectionStart=this.index,this.state=i.InAttributeValueNq,this.stateInAttributeValueNoQuotes(m))},p.prototype.handleInAttributeValue=function(m,y){m===y||!this.decodeEntities&&this.fastForwardTo(y)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(y===t.DoubleQuote?c.Double:c.Single,this.index),this.state=i.BeforeAttributeName):this.decodeEntities&&m===t.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},p.prototype.stateInAttributeValueDoubleQuotes=function(m){this.handleInAttributeValue(m,t.DoubleQuote)},p.prototype.stateInAttributeValueSingleQuotes=function(m){this.handleInAttributeValue(m,t.SingleQuote)},p.prototype.stateInAttributeValueNoQuotes=function(m){r(m)||m===t.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(c.Unquoted,this.index),this.state=i.BeforeAttributeName,this.stateBeforeAttributeName(m)):this.decodeEntities&&m===t.Amp&&(this.baseState=this.state,this.state=i.BeforeEntity)},p.prototype.stateBeforeDeclaration=function(m){m===t.OpeningSquareBracket?(this.state=i.CDATASequence,this.sequenceIndex=0):this.state=m===t.Dash?i.BeforeComment:i.InDeclaration},p.prototype.stateInDeclaration=function(m){(m===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},p.prototype.stateInProcessingInstruction=function(m){(m===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=i.Text,this.sectionStart=this.index+1)},p.prototype.stateBeforeComment=function(m){m===t.Dash?(this.state=i.InCommentLike,this.currentSequence=u.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=i.InDeclaration},p.prototype.stateInSpecialComment=function(m){(m===t.Gt||this.fastForwardTo(t.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=i.Text,this.sectionStart=this.index+1)},p.prototype.stateBeforeSpecialS=function(m){var y=m|32;y===u.ScriptEnd[3]?this.startSpecial(u.ScriptEnd,4):y===u.StyleEnd[3]?this.startSpecial(u.StyleEnd,4):(this.state=i.InTagName,this.stateInTagName(m))},p.prototype.stateBeforeEntity=function(m){this.entityExcess=1,this.entityResult=0,m===t.Number?this.state=i.BeforeNumericEntity:m===t.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=i.InNamedEntity,this.stateInNamedEntity(m))},p.prototype.stateInNamedEntity=function(m){if(this.entityExcess+=1,this.trieIndex=(0,e.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,m),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var y=this.trieCurrent&e.BinTrieFlags.VALUE_LENGTH;if(y){var _=(y>>14)-1;if(!this.allowLegacyEntity()&&m!==t.Semi)this.trieIndex+=_;else{var w=this.index-this.entityExcess+1;w>this.sectionStart&&this.emitPartial(this.sectionStart,w),this.entityResult=this.trieIndex,this.trieIndex+=_,this.entityExcess=0,this.sectionStart=this.index+1,_===0&&this.emitNamedEntity()}}},p.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var m=(this.entityTrie[this.entityResult]&e.BinTrieFlags.VALUE_LENGTH)>>14;switch(m){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~e.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},p.prototype.stateBeforeNumericEntity=function(m){(m|32)===t.LowerX?(this.entityExcess++,this.state=i.InHexEntity):(this.state=i.InNumericEntity,this.stateInNumericEntity(m))},p.prototype.emitNumericEntity=function(m){var y=this.index-this.entityExcess-1,_=y+2+ +(this.state===i.InHexEntity);_!==this.index&&(y>this.sectionStart&&this.emitPartial(this.sectionStart,y),this.sectionStart=this.index+Number(m),this.emitCodePoint((0,e.replaceCodePoint)(this.entityResult))),this.state=this.baseState},p.prototype.stateInNumericEntity=function(m){m===t.Semi?this.emitNumericEntity(!0):o(m)?(this.entityResult=this.entityResult*10+(m-t.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},p.prototype.stateInHexEntity=function(m){m===t.Semi?this.emitNumericEntity(!0):o(m)?(this.entityResult=this.entityResult*16+(m-t.Zero),this.entityExcess++):l(m)?(this.entityResult=this.entityResult*16+((m|32)-t.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},p.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===i.Text||this.baseState===i.InSpecialTag)},p.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===i.Text||this.state===i.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===i.InAttributeValueDq||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},p.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},p.prototype.parse=function(){for(;this.shouldContinue();){var m=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case i.Text:{this.stateText(m);break}case i.SpecialStartSequence:{this.stateSpecialStartSequence(m);break}case i.InSpecialTag:{this.stateInSpecialTag(m);break}case i.CDATASequence:{this.stateCDATASequence(m);break}case i.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(m);break}case i.InAttributeName:{this.stateInAttributeName(m);break}case i.InCommentLike:{this.stateInCommentLike(m);break}case i.InSpecialComment:{this.stateInSpecialComment(m);break}case i.BeforeAttributeName:{this.stateBeforeAttributeName(m);break}case i.InTagName:{this.stateInTagName(m);break}case i.InClosingTagName:{this.stateInClosingTagName(m);break}case i.BeforeTagName:{this.stateBeforeTagName(m);break}case i.AfterAttributeName:{this.stateAfterAttributeName(m);break}case i.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(m);break}case i.BeforeAttributeValue:{this.stateBeforeAttributeValue(m);break}case i.BeforeClosingTagName:{this.stateBeforeClosingTagName(m);break}case i.AfterClosingTagName:{this.stateAfterClosingTagName(m);break}case i.BeforeSpecialS:{this.stateBeforeSpecialS(m);break}case i.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(m);break}case i.InSelfClosingTag:{this.stateInSelfClosingTag(m);break}case i.InDeclaration:{this.stateInDeclaration(m);break}case i.BeforeDeclaration:{this.stateBeforeDeclaration(m);break}case i.BeforeComment:{this.stateBeforeComment(m);break}case i.InProcessingInstruction:{this.stateInProcessingInstruction(m);break}case i.InNamedEntity:{this.stateInNamedEntity(m);break}case i.BeforeEntity:{this.stateBeforeEntity(m);break}case i.InHexEntity:{this.stateInHexEntity(m);break}case i.InNumericEntity:{this.stateInNumericEntity(m);break}default:this.stateBeforeNumericEntity(m)}this.index++}this.cleanup()},p.prototype.finish=function(){this.state===i.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},p.prototype.handleTrailingData=function(){var m=this.buffer.length+this.offset;this.state===i.InCommentLike?this.currentSequence===u.CdataEnd?this.cbs.oncdata(this.sectionStart,m,0):this.cbs.oncomment(this.sectionStart,m,0):this.state===i.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===i.InTagName||this.state===i.BeforeAttributeName||this.state===i.BeforeAttributeValue||this.state===i.AfterAttributeName||this.state===i.InAttributeName||this.state===i.InAttributeValueSq||this.state===i.InAttributeValueDq||this.state===i.InAttributeValueNq||this.state===i.InClosingTagName||this.cbs.ontext(this.sectionStart,m)},p.prototype.emitPartial=function(m,y){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribdata(m,y):this.cbs.ontext(m,y)},p.prototype.emitCodePoint=function(m){this.baseState!==i.Text&&this.baseState!==i.InSpecialTag?this.cbs.onattribentity(m):this.cbs.ontextentity(m)},p}();n.default=f})(Fx);var hZ=wt&&wt.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,r)}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),dZ=wt&&wt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),fZ=wt&&wt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&hZ(e,n,t);return dZ(e,n),e};Object.defineProperty(Bp,"__esModule",{value:!0});Bp.Parser=void 0;var av=fZ(Fx),qL=Up,_h=new Set(["input","option","optgroup","select","button","datalist","textarea"]),ci=new Set(["p"]),KL=new Set(["thead","tbody"]),ZL=new Set(["dd","dt"]),YL=new Set(["rt","rp"]),pZ=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",ci],["h1",ci],["h2",ci],["h3",ci],["h4",ci],["h5",ci],["h6",ci],["select",_h],["input",_h],["output",_h],["button",_h],["datalist",_h],["textarea",_h],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ZL],["dt",ZL],["address",ci],["article",ci],["aside",ci],["blockquote",ci],["details",ci],["div",ci],["dl",ci],["fieldset",ci],["figcaption",ci],["figure",ci],["footer",ci],["form",ci],["header",ci],["hr",ci],["main",ci],["nav",ci],["ol",ci],["pre",ci],["section",ci],["table",ci],["ul",ci],["rt",YL],["rp",YL],["tbody",KL],["tfoot",KL]]),gZ=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),XL=new Set(["math","svg"]),JL=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),mZ=/\s|\//,vZ=function(){function n(e,t){t===void 0&&(t={});var i,r,s,o,a;this.options=t,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=e??{},this.lowerCaseTagNames=(i=t.lowerCaseTags)!==null&&i!==void 0?i:!t.xmlMode,this.lowerCaseAttributeNames=(r=t.lowerCaseAttributeNames)!==null&&r!==void 0?r:!t.xmlMode,this.tokenizer=new((s=t.Tokenizer)!==null&&s!==void 0?s:av.default)(this.options,this),(a=(o=this.cbs).onparserinit)===null||a===void 0||a.call(o,this)}return n.prototype.ontext=function(e,t){var i,r,s=this.getSlice(e,t);this.endIndex=t-1,(r=(i=this.cbs).ontext)===null||r===void 0||r.call(i,s),this.startIndex=t},n.prototype.ontextentity=function(e){var t,i,r=this.tokenizer.getSectionStart();this.endIndex=r-1,(i=(t=this.cbs).ontext)===null||i===void 0||i.call(t,(0,qL.fromCodePoint)(e)),this.startIndex=r},n.prototype.isVoidElement=function(e){return!this.options.xmlMode&&gZ.has(e)},n.prototype.onopentagname=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);this.lowerCaseTagNames&&(i=i.toLowerCase()),this.emitOpenTag(i)},n.prototype.emitOpenTag=function(e){var t,i,r,s;this.openTagStart=this.startIndex,this.tagname=e;var o=!this.options.xmlMode&&pZ.get(e);if(o)for(;this.stack.length>0&&o.has(this.stack[this.stack.length-1]);){var a=this.stack.pop();(i=(t=this.cbs).onclosetag)===null||i===void 0||i.call(t,a,!0)}this.isVoidElement(e)||(this.stack.push(e),XL.has(e)?this.foreignContext.push(!0):JL.has(e)&&this.foreignContext.push(!1)),(s=(r=this.cbs).onopentagname)===null||s===void 0||s.call(r,e),this.cbs.onopentag&&(this.attribs={})},n.prototype.endOpenTag=function(e){var t,i;this.startIndex=this.openTagStart,this.attribs&&((i=(t=this.cbs).onopentag)===null||i===void 0||i.call(t,this.tagname,this.attribs,e),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},n.prototype.onopentagend=function(e){this.endIndex=e,this.endOpenTag(!1),this.startIndex=e+1},n.prototype.onclosetag=function(e,t){var i,r,s,o,a,l;this.endIndex=t;var c=this.getSlice(e,t);if(this.lowerCaseTagNames&&(c=c.toLowerCase()),(XL.has(c)||JL.has(c))&&this.foreignContext.pop(),this.isVoidElement(c))!this.options.xmlMode&&c==="br"&&((r=(i=this.cbs).onopentagname)===null||r===void 0||r.call(i,"br"),(o=(s=this.cbs).onopentag)===null||o===void 0||o.call(s,"br",{},!0),(l=(a=this.cbs).onclosetag)===null||l===void 0||l.call(a,"br",!1));else{var u=this.stack.lastIndexOf(c);if(u!==-1)if(this.cbs.onclosetag)for(var f=this.stack.length-u;f--;)this.cbs.onclosetag(this.stack.pop(),f!==0);else this.stack.length=u;else!this.options.xmlMode&&c==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=t+1},n.prototype.onselfclosingtag=function(e){this.endIndex=e,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=e+1):this.onopentagend(e)},n.prototype.closeCurrentTag=function(e){var t,i,r=this.tagname;this.endOpenTag(e),this.stack[this.stack.length-1]===r&&((i=(t=this.cbs).onclosetag)===null||i===void 0||i.call(t,r,!e),this.stack.pop())},n.prototype.onattribname=function(e,t){this.startIndex=e;var i=this.getSlice(e,t);this.attribname=this.lowerCaseAttributeNames?i.toLowerCase():i},n.prototype.onattribdata=function(e,t){this.attribvalue+=this.getSlice(e,t)},n.prototype.onattribentity=function(e){this.attribvalue+=(0,qL.fromCodePoint)(e)},n.prototype.onattribend=function(e,t){var i,r;this.endIndex=t,(r=(i=this.cbs).onattribute)===null||r===void 0||r.call(i,this.attribname,this.attribvalue,e===av.QuoteType.Double?'"':e===av.QuoteType.Single?"'":e===av.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},n.prototype.getInstructionName=function(e){var t=e.search(mZ),i=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(i=i.toLowerCase()),i},n.prototype.ondeclaration=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("!".concat(r),"!".concat(i))}this.startIndex=t+1},n.prototype.onprocessinginstruction=function(e,t){this.endIndex=t;var i=this.getSlice(e,t);if(this.cbs.onprocessinginstruction){var r=this.getInstructionName(i);this.cbs.onprocessinginstruction("?".concat(r),"?".concat(i))}this.startIndex=t+1},n.prototype.oncomment=function(e,t,i){var r,s,o,a;this.endIndex=t,(s=(r=this.cbs).oncomment)===null||s===void 0||s.call(r,this.getSlice(e,t-i)),(a=(o=this.cbs).oncommentend)===null||a===void 0||a.call(o),this.startIndex=t+1},n.prototype.oncdata=function(e,t,i){var r,s,o,a,l,c,u,f,p,m;this.endIndex=t;var y=this.getSlice(e,t-i);this.options.xmlMode||this.options.recognizeCDATA?((s=(r=this.cbs).oncdatastart)===null||s===void 0||s.call(r),(a=(o=this.cbs).ontext)===null||a===void 0||a.call(o,y),(c=(l=this.cbs).oncdataend)===null||c===void 0||c.call(l)):((f=(u=this.cbs).oncomment)===null||f===void 0||f.call(u,"[CDATA[".concat(y,"]]")),(m=(p=this.cbs).oncommentend)===null||m===void 0||m.call(p)),this.startIndex=t+1},n.prototype.onend=function(){var e,t;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var i=this.stack.length;i>0;this.cbs.onclosetag(this.stack[--i],!0));}(t=(e=this.cbs).onend)===null||t===void 0||t.call(e)},n.prototype.reset=function(){var e,t,i,r;(t=(e=this.cbs).onreset)===null||t===void 0||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(i=this.cbs).onparserinit)===null||r===void 0||r.call(i,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},n.prototype.parseComplete=function(e){this.reset(),this.end(e)},n.prototype.getSlice=function(e,t){for(;e-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var i=this.buffers[0].slice(e-this.bufferOffset,t-this.bufferOffset);t-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),i+=this.buffers[0].slice(0,t-this.bufferOffset);return i},n.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},n.prototype.write=function(e){var t,i;if(this.ended){(i=(t=this.cbs).onerror)===null||i===void 0||i.call(t,new Error(".write() after done!"));return}this.buffers.push(e),this.tokenizer.running&&(this.tokenizer.write(e),this.writeIndex++)},n.prototype.end=function(e){var t,i;if(this.ended){(i=(t=this.cbs).onerror)===null||i===void 0||i.call(t,new Error(".end() after done!"));return}e&&this.write(e),this.ended=!0,this.tokenizer.end()},n.prototype.pause=function(){this.tokenizer.pause()},n.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},n.prototype.parseChunk=function(e){this.write(e)},n.prototype.done=function(e){this.end(e)},n}();Bp.Parser=vZ;var fa={},jd={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Doctype=n.CDATA=n.Tag=n.Style=n.Script=n.Comment=n.Directive=n.Text=n.Root=n.isTag=n.ElementType=void 0;var e;(function(i){i.Root="root",i.Text="text",i.Directive="directive",i.Comment="comment",i.Script="script",i.Style="style",i.Tag="tag",i.CDATA="cdata",i.Doctype="doctype"})(e=n.ElementType||(n.ElementType={}));function t(i){return i.type===e.Tag||i.type===e.Script||i.type===e.Style}n.isTag=t,n.Root=e.Root,n.Text=e.Text,n.Directive=e.Directive,n.Comment=e.Comment,n.Script=e.Script,n.Style=e.Style,n.Tag=e.Tag,n.CDATA=e.CDATA,n.Doctype=e.Doctype})(jd);var zt={},jl=wt&&wt.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),pp=wt&&wt.__assign||function(){return pp=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},pp.apply(this,arguments)};Object.defineProperty(zt,"__esModule",{value:!0});zt.cloneNode=zt.hasChildren=zt.isDocument=zt.isDirective=zt.isComment=zt.isText=zt.isCDATA=zt.isTag=zt.Element=zt.Document=zt.CDATA=zt.NodeWithChildren=zt.ProcessingInstruction=zt.Comment=zt.Text=zt.DataNode=zt.Node=void 0;var vr=jd,zx=function(){function n(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(n.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),n.prototype.cloneNode=function(e){return e===void 0&&(e=!1),Gx(this,e)},n}();zt.Node=zx;var V0=function(n){jl(e,n);function e(t){var i=n.call(this)||this;return i.data=t,i}return Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.data},set:function(t){this.data=t},enumerable:!1,configurable:!0}),e}(zx);zt.DataNode=V0;var uF=function(n){jl(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=vr.ElementType.Text,t}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),e}(V0);zt.Text=uF;var hF=function(n){jl(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=vr.ElementType.Comment,t}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),e}(V0);zt.Comment=hF;var dF=function(n){jl(e,n);function e(t,i){var r=n.call(this,i)||this;return r.name=t,r.type=vr.ElementType.Directive,r}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),e}(V0);zt.ProcessingInstruction=dF;var j0=function(n){jl(e,n);function e(t){var i=n.call(this)||this;return i.children=t,i}return Object.defineProperty(e.prototype,"firstChild",{get:function(){var t;return(t=this.children[0])!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.children},set:function(t){this.children=t},enumerable:!1,configurable:!0}),e}(zx);zt.NodeWithChildren=j0;var fF=function(n){jl(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=vr.ElementType.CDATA,t}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),e}(j0);zt.CDATA=fF;var pF=function(n){jl(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.type=vr.ElementType.Root,t}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),e}(j0);zt.Document=pF;var gF=function(n){jl(e,n);function e(t,i,r,s){r===void 0&&(r=[]),s===void 0&&(s=t==="script"?vr.ElementType.Script:t==="style"?vr.ElementType.Style:vr.ElementType.Tag);var o=n.call(this,r)||this;return o.name=t,o.attribs=i,o.type=s,o}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.name},set:function(t){this.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){var t=this;return Object.keys(this.attribs).map(function(i){var r,s;return{name:i,value:t.attribs[i],namespace:(r=t["x-attribsNamespace"])===null||r===void 0?void 0:r[i],prefix:(s=t["x-attribsPrefix"])===null||s===void 0?void 0:s[i]}})},enumerable:!1,configurable:!0}),e}(j0);zt.Element=gF;function mF(n){return(0,vr.isTag)(n)}zt.isTag=mF;function vF(n){return n.type===vr.ElementType.CDATA}zt.isCDATA=vF;function yF(n){return n.type===vr.ElementType.Text}zt.isText=yF;function _F(n){return n.type===vr.ElementType.Comment}zt.isComment=_F;function EF(n){return n.type===vr.ElementType.Directive}zt.isDirective=EF;function wF(n){return n.type===vr.ElementType.Root}zt.isDocument=wF;function yZ(n){return Object.prototype.hasOwnProperty.call(n,"children")}zt.hasChildren=yZ;function Gx(n,e){e===void 0&&(e=!1);var t;if(yF(n))t=new uF(n.data);else if(_F(n))t=new hF(n.data);else if(mF(n)){var i=e?Iw(n.children):[],r=new gF(n.name,pp({},n.attribs),i);i.forEach(function(l){return l.parent=r}),n.namespace!=null&&(r.namespace=n.namespace),n["x-attribsNamespace"]&&(r["x-attribsNamespace"]=pp({},n["x-attribsNamespace"])),n["x-attribsPrefix"]&&(r["x-attribsPrefix"]=pp({},n["x-attribsPrefix"])),t=r}else if(vF(n)){var i=e?Iw(n.children):[],s=new fF(i);i.forEach(function(c){return c.parent=s}),t=s}else if(wF(n)){var i=e?Iw(n.children):[],o=new pF(i);i.forEach(function(c){return c.parent=o}),n["x-mode"]&&(o["x-mode"]=n["x-mode"]),t=o}else if(EF(n)){var a=new dF(n.name,n.data);n["x-name"]!=null&&(a["x-name"]=n["x-name"],a["x-publicId"]=n["x-publicId"],a["x-systemId"]=n["x-systemId"]),t=a}else throw new Error("Not implemented yet: ".concat(n.type));return t.startIndex=n.startIndex,t.endIndex=n.endIndex,n.sourceCodeLocation!=null&&(t.sourceCodeLocation=n.sourceCodeLocation),t}zt.cloneNode=Gx;function Iw(n){for(var e=n.map(function(i){return Gx(i,!0)}),t=1;t<e.length;t++)e[t].prev=e[t-1],e[t-1].next=e[t];return e}(function(n){var e=wt&&wt.__createBinding||(Object.create?function(a,l,c,u){u===void 0&&(u=c);var f=Object.getOwnPropertyDescriptor(l,c);(!f||("get"in f?!l.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return l[c]}}),Object.defineProperty(a,u,f)}:function(a,l,c,u){u===void 0&&(u=c),a[u]=l[c]}),t=wt&&wt.__exportStar||function(a,l){for(var c in a)c!=="default"&&!Object.prototype.hasOwnProperty.call(l,c)&&e(l,a,c)};Object.defineProperty(n,"__esModule",{value:!0}),n.DomHandler=void 0;var i=jd,r=zt;t(zt,n);var s={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},o=function(){function a(l,c,u){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof c=="function"&&(u=c,c=s),typeof l=="object"&&(c=l,l=void 0),this.callback=l??null,this.options=c??s,this.elementCB=u??null}return a.prototype.onparserinit=function(l){this.parser=l},a.prototype.onreset=function(){this.dom=[],this.root=new r.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},a.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},a.prototype.onerror=function(l){this.handleCallback(l)},a.prototype.onclosetag=function(){this.lastNode=null;var l=this.tagStack.pop();this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(l)},a.prototype.onopentag=function(l,c){var u=this.options.xmlMode?i.ElementType.Tag:void 0,f=new r.Element(l,c,void 0,u);this.addNode(f),this.tagStack.push(f)},a.prototype.ontext=function(l){var c=this.lastNode;if(c&&c.type===i.ElementType.Text)c.data+=l,this.options.withEndIndices&&(c.endIndex=this.parser.endIndex);else{var u=new r.Text(l);this.addNode(u),this.lastNode=u}},a.prototype.oncomment=function(l){if(this.lastNode&&this.lastNode.type===i.ElementType.Comment){this.lastNode.data+=l;return}var c=new r.Comment(l);this.addNode(c),this.lastNode=c},a.prototype.oncommentend=function(){this.lastNode=null},a.prototype.oncdatastart=function(){var l=new r.Text(""),c=new r.CDATA([l]);this.addNode(c),l.parent=c,this.lastNode=l},a.prototype.oncdataend=function(){this.lastNode=null},a.prototype.onprocessinginstruction=function(l,c){var u=new r.ProcessingInstruction(l,c);this.addNode(u)},a.prototype.handleCallback=function(l){if(typeof this.callback=="function")this.callback(l,this.dom);else if(l)throw l},a.prototype.addNode=function(l){var c=this.tagStack[this.tagStack.length-1],u=c.children[c.children.length-1];this.options.withStartIndices&&(l.startIndex=this.parser.startIndex),this.options.withEndIndices&&(l.endIndex=this.parser.endIndex),c.children.push(l),u&&(l.prev=u,u.next=l),l.parent=c,this.lastNode=null},a}();n.DomHandler=o,n.default=o})(fa);var Kv={},Or={},yg={},TF={},iu={},Hx={};Object.defineProperty(Hx,"__esModule",{value:!0});function lv(n){for(var e=1;e<n.length;e++)n[e][0]+=n[e-1][0]+1;return n}Hx.default=new Map(lv([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(lv([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(lv([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(lv([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var By={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.escapeText=n.escapeAttribute=n.escapeUTF8=n.escape=n.encodeXML=n.getCodePoint=n.xmlReplacer=void 0,n.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var e=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);n.getCodePoint=String.prototype.codePointAt!=null?function(r,s){return r.codePointAt(s)}:function(r,s){return(r.charCodeAt(s)&64512)===55296?(r.charCodeAt(s)-55296)*1024+r.charCodeAt(s+1)-56320+65536:r.charCodeAt(s)};function t(r){for(var s="",o=0,a;(a=n.xmlReplacer.exec(r))!==null;){var l=a.index,c=r.charCodeAt(l),u=e.get(c);u!==void 0?(s+=r.substring(o,l)+u,o=l+1):(s+="".concat(r.substring(o,l),"&#x").concat((0,n.getCodePoint)(r,l).toString(16),";"),o=n.xmlReplacer.lastIndex+=+((c&64512)===55296))}return s+r.substr(o)}n.encodeXML=t,n.escape=t;function i(r,s){return function(a){for(var l,c=0,u="";l=r.exec(a);)c!==l.index&&(u+=a.substring(c,l.index)),u+=s.get(l[0].charCodeAt(0)),c=l.index+1;return u+a.substring(c)}}n.escapeUTF8=i(/[&<>'"]/g,e),n.escapeAttribute=i(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),n.escapeText=i(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(By);var _Z=wt&&wt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(iu,"__esModule",{value:!0});iu.encodeNonAsciiHTML=iu.encodeHTML=void 0;var EZ=_Z(Hx),SF=By,wZ=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function TZ(n){return bF(wZ,n)}iu.encodeHTML=TZ;function SZ(n){return bF(SF.xmlReplacer,n)}iu.encodeNonAsciiHTML=SZ;function bF(n,e){for(var t="",i=0,r;(r=n.exec(e))!==null;){var s=r.index;t+=e.substring(i,s);var o=e.charCodeAt(s),a=EZ.default.get(o);if(typeof a=="object"){if(s+1<e.length){var l=e.charCodeAt(s+1),c=typeof a.n=="number"?a.n===l?a.o:void 0:a.n.get(l);if(c!==void 0){t+=c,i=n.lastIndex+=1;continue}}a=a.v}if(a!==void 0)t+=a,i=s+1;else{var u=(0,SF.getCodePoint)(e,s);t+="&#x".concat(u.toString(16),";"),i=n.lastIndex+=+(u!==o)}}return t+e.substr(i)}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXMLStrict=n.decodeHTML5Strict=n.decodeHTML4Strict=n.decodeHTML5=n.decodeHTML4=n.decodeHTMLAttribute=n.decodeHTMLStrict=n.decodeHTML=n.decodeXML=n.DecodingMode=n.EntityDecoder=n.encodeHTML5=n.encodeHTML4=n.encodeNonAsciiHTML=n.encodeHTML=n.escapeText=n.escapeAttribute=n.escapeUTF8=n.escape=n.encodeXML=n.encode=n.decodeStrict=n.decode=n.EncodingMode=n.EntityLevel=void 0;var e=Up,t=iu,i=By,r;(function(p){p[p.XML=0]="XML",p[p.HTML=1]="HTML"})(r=n.EntityLevel||(n.EntityLevel={}));var s;(function(p){p[p.UTF8=0]="UTF8",p[p.ASCII=1]="ASCII",p[p.Extensive=2]="Extensive",p[p.Attribute=3]="Attribute",p[p.Text=4]="Text"})(s=n.EncodingMode||(n.EncodingMode={}));function o(p,m){m===void 0&&(m=r.XML);var y=typeof m=="number"?m:m.level;if(y===r.HTML){var _=typeof m=="object"?m.mode:void 0;return(0,e.decodeHTML)(p,_)}return(0,e.decodeXML)(p)}n.decode=o;function a(p,m){var y;m===void 0&&(m=r.XML);var _=typeof m=="number"?{level:m}:m;return(y=_.mode)!==null&&y!==void 0||(_.mode=e.DecodingMode.Strict),o(p,_)}n.decodeStrict=a;function l(p,m){m===void 0&&(m=r.XML);var y=typeof m=="number"?{level:m}:m;return y.mode===s.UTF8?(0,i.escapeUTF8)(p):y.mode===s.Attribute?(0,i.escapeAttribute)(p):y.mode===s.Text?(0,i.escapeText)(p):y.level===r.HTML?y.mode===s.ASCII?(0,t.encodeNonAsciiHTML)(p):(0,t.encodeHTML)(p):(0,i.encodeXML)(p)}n.encode=l;var c=By;Object.defineProperty(n,"encodeXML",{enumerable:!0,get:function(){return c.encodeXML}}),Object.defineProperty(n,"escape",{enumerable:!0,get:function(){return c.escape}}),Object.defineProperty(n,"escapeUTF8",{enumerable:!0,get:function(){return c.escapeUTF8}}),Object.defineProperty(n,"escapeAttribute",{enumerable:!0,get:function(){return c.escapeAttribute}}),Object.defineProperty(n,"escapeText",{enumerable:!0,get:function(){return c.escapeText}});var u=iu;Object.defineProperty(n,"encodeHTML",{enumerable:!0,get:function(){return u.encodeHTML}}),Object.defineProperty(n,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return u.encodeNonAsciiHTML}}),Object.defineProperty(n,"encodeHTML4",{enumerable:!0,get:function(){return u.encodeHTML}}),Object.defineProperty(n,"encodeHTML5",{enumerable:!0,get:function(){return u.encodeHTML}});var f=Up;Object.defineProperty(n,"EntityDecoder",{enumerable:!0,get:function(){return f.EntityDecoder}}),Object.defineProperty(n,"DecodingMode",{enumerable:!0,get:function(){return f.DecodingMode}}),Object.defineProperty(n,"decodeXML",{enumerable:!0,get:function(){return f.decodeXML}}),Object.defineProperty(n,"decodeHTML",{enumerable:!0,get:function(){return f.decodeHTML}}),Object.defineProperty(n,"decodeHTMLStrict",{enumerable:!0,get:function(){return f.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTMLAttribute",{enumerable:!0,get:function(){return f.decodeHTMLAttribute}}),Object.defineProperty(n,"decodeHTML4",{enumerable:!0,get:function(){return f.decodeHTML}}),Object.defineProperty(n,"decodeHTML5",{enumerable:!0,get:function(){return f.decodeHTML}}),Object.defineProperty(n,"decodeHTML4Strict",{enumerable:!0,get:function(){return f.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML5Strict",{enumerable:!0,get:function(){return f.decodeHTMLStrict}}),Object.defineProperty(n,"decodeXMLStrict",{enumerable:!0,get:function(){return f.decodeXML}})})(TF);var md={};Object.defineProperty(md,"__esModule",{value:!0});md.attributeNames=md.elementNames=void 0;md.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(n){return[n.toLowerCase(),n]}));md.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(n){return[n.toLowerCase(),n]}));var jh=wt&&wt.__assign||function(){return jh=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},jh.apply(this,arguments)},bZ=wt&&wt.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,r)}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),xZ=wt&&wt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),CZ=wt&&wt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&bZ(e,n,t);return xZ(e,n),e};Object.defineProperty(yg,"__esModule",{value:!0});yg.render=void 0;var qo=CZ(jd),Uy=TF,xF=md,RZ=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function AZ(n){return n.replace(/"/g,"&quot;")}function LZ(n,e){var t;if(n){var i=((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)===!1?AZ:e.xmlMode||e.encodeEntities!=="utf8"?Uy.encodeXML:Uy.escapeAttribute;return Object.keys(n).map(function(r){var s,o,a=(s=n[r])!==null&&s!==void 0?s:"";return e.xmlMode==="foreign"&&(r=(o=xF.attributeNames.get(r))!==null&&o!==void 0?o:r),!e.emptyAttrs&&!e.xmlMode&&a===""?r:"".concat(r,'="').concat(i(a),'"')}).join(" ")}}var QL=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function W0(n,e){e===void 0&&(e={});for(var t=("length"in n)?n:[n],i="",r=0;r<t.length;r++)i+=IZ(t[r],e);return i}yg.render=W0;yg.default=W0;function IZ(n,e){switch(n.type){case qo.Root:return W0(n.children,e);case qo.Doctype:case qo.Directive:return kZ(n);case qo.Comment:return FZ(n);case qo.CDATA:return NZ(n);case qo.Script:case qo.Style:case qo.Tag:return OZ(n,e);case qo.Text:return MZ(n,e)}}var PZ=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),DZ=new Set(["svg","math"]);function OZ(n,e){var t;e.xmlMode==="foreign"&&(n.name=(t=xF.elementNames.get(n.name))!==null&&t!==void 0?t:n.name,n.parent&&PZ.has(n.parent.name)&&(e=jh(jh({},e),{xmlMode:!1}))),!e.xmlMode&&DZ.has(n.name)&&(e=jh(jh({},e),{xmlMode:"foreign"}));var i="<".concat(n.name),r=LZ(n.attribs,e);return r&&(i+=" ".concat(r)),n.children.length===0&&(e.xmlMode?e.selfClosingTags!==!1:e.selfClosingTags&&QL.has(n.name))?(e.xmlMode||(i+=" "),i+="/>"):(i+=">",n.children.length>0&&(i+=W0(n.children,e)),(e.xmlMode||!QL.has(n.name))&&(i+="</".concat(n.name,">"))),i}function kZ(n){return"<".concat(n.data,">")}function MZ(n,e){var t,i=n.data||"";return((t=e.encodeEntities)!==null&&t!==void 0?t:e.decodeEntities)!==!1&&!(!e.xmlMode&&n.parent&&RZ.has(n.parent.name))&&(i=e.xmlMode||e.encodeEntities!=="utf8"?(0,Uy.encodeXML)(i):(0,Uy.escapeText)(i)),i}function NZ(n){return"<![CDATA[".concat(n.children[0].data,"]]>")}function FZ(n){return"<!--".concat(n.data,"-->")}var BZ=wt&&wt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Or,"__esModule",{value:!0});Or.innerText=Or.textContent=Or.getText=Or.getInnerHTML=Or.getOuterHTML=void 0;var co=fa,UZ=BZ(yg),zZ=jd;function CF(n,e){return(0,UZ.default)(n,e)}Or.getOuterHTML=CF;function GZ(n,e){return(0,co.hasChildren)(n)?n.children.map(function(t){return CF(t,e)}).join(""):""}Or.getInnerHTML=GZ;function Zv(n){return Array.isArray(n)?n.map(Zv).join(""):(0,co.isTag)(n)?n.name==="br"?`
`:Zv(n.children):(0,co.isCDATA)(n)?Zv(n.children):(0,co.isText)(n)?n.data:""}Or.getText=Zv;function fS(n){return Array.isArray(n)?n.map(fS).join(""):(0,co.hasChildren)(n)&&!(0,co.isComment)(n)?fS(n.children):(0,co.isText)(n)?n.data:""}Or.textContent=fS;function pS(n){return Array.isArray(n)?n.map(pS).join(""):(0,co.hasChildren)(n)&&(n.type===zZ.ElementType.Tag||(0,co.isCDATA)(n))?pS(n.children):(0,co.isText)(n)?n.data:""}Or.innerText=pS;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});hn.prevElementSibling=hn.nextElementSibling=hn.getName=hn.hasAttrib=hn.getAttributeValue=hn.getSiblings=hn.getParent=hn.getChildren=void 0;var $x=fa;function RF(n){return(0,$x.hasChildren)(n)?n.children:[]}hn.getChildren=RF;function AF(n){return n.parent||null}hn.getParent=AF;function HZ(n){var e,t,i=AF(n);if(i!=null)return RF(i);for(var r=[n],s=n.prev,o=n.next;s!=null;)r.unshift(s),e=s,s=e.prev;for(;o!=null;)r.push(o),t=o,o=t.next;return r}hn.getSiblings=HZ;function $Z(n,e){var t;return(t=n.attribs)===null||t===void 0?void 0:t[e]}hn.getAttributeValue=$Z;function VZ(n,e){return n.attribs!=null&&Object.prototype.hasOwnProperty.call(n.attribs,e)&&n.attribs[e]!=null}hn.hasAttrib=VZ;function jZ(n){return n.name}hn.getName=jZ;function WZ(n){for(var e,t=n.next;t!==null&&!(0,$x.isTag)(t);)e=t,t=e.next;return t}hn.nextElementSibling=WZ;function qZ(n){for(var e,t=n.prev;t!==null&&!(0,$x.isTag)(t);)e=t,t=e.prev;return t}hn.prevElementSibling=qZ;var dr={};Object.defineProperty(dr,"__esModule",{value:!0});dr.prepend=dr.prependChild=dr.append=dr.appendChild=dr.replaceElement=dr.removeElement=void 0;function _g(n){if(n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n.parent){var e=n.parent.children,t=e.lastIndexOf(n);t>=0&&e.splice(t,1)}n.next=null,n.prev=null,n.parent=null}dr.removeElement=_g;function KZ(n,e){var t=e.prev=n.prev;t&&(t.next=e);var i=e.next=n.next;i&&(i.prev=e);var r=e.parent=n.parent;if(r){var s=r.children;s[s.lastIndexOf(n)]=e,n.parent=null}}dr.replaceElement=KZ;function ZZ(n,e){if(_g(e),e.next=null,e.parent=n,n.children.push(e)>1){var t=n.children[n.children.length-2];t.next=e,e.prev=t}else e.prev=null}dr.appendChild=ZZ;function YZ(n,e){_g(e);var t=n.parent,i=n.next;if(e.next=i,e.prev=n,n.next=e,e.parent=t,i){if(i.prev=e,t){var r=t.children;r.splice(r.lastIndexOf(i),0,e)}}else t&&t.children.push(e)}dr.append=YZ;function XZ(n,e){if(_g(e),e.parent=n,e.prev=null,n.children.unshift(e)!==1){var t=n.children[1];t.prev=e,e.next=t}else e.next=null}dr.prependChild=XZ;function JZ(n,e){_g(e);var t=n.parent;if(t){var i=t.children;i.splice(i.indexOf(n),0,e)}n.prev&&(n.prev.next=e),e.parent=t,e.prev=n.prev,e.next=n,n.prev=e}dr.prepend=JZ;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.findAll=qn.existsOne=qn.findOne=qn.findOneChild=qn.find=qn.filter=void 0;var q0=fa;function QZ(n,e,t,i){return t===void 0&&(t=!0),i===void 0&&(i=1/0),LF(n,Array.isArray(e)?e:[e],t,i)}qn.filter=QZ;function LF(n,e,t,i){for(var r=[],s=[e],o=[0];;){if(o[0]>=s[0].length){if(o.length===1)return r;s.shift(),o.shift();continue}var a=s[0][o[0]++];if(n(a)&&(r.push(a),--i<=0))return r;t&&(0,q0.hasChildren)(a)&&a.children.length>0&&(o.unshift(0),s.unshift(a.children))}}qn.find=LF;function eY(n,e){return e.find(n)}qn.findOneChild=eY;function IF(n,e,t){t===void 0&&(t=!0);for(var i=null,r=0;r<e.length&&!i;r++){var s=e[r];if((0,q0.isTag)(s))n(s)?i=s:t&&s.children.length>0&&(i=IF(n,s.children,!0));else continue}return i}qn.findOne=IF;function PF(n,e){return e.some(function(t){return(0,q0.isTag)(t)&&(n(t)||PF(n,t.children))})}qn.existsOne=PF;function tY(n,e){for(var t=[],i=[e],r=[0];;){if(r[0]>=i[0].length){if(i.length===1)return t;i.shift(),r.shift();continue}var s=i[0][r[0]++];(0,q0.isTag)(s)&&(n(s)&&t.push(s),s.children.length>0&&(r.unshift(0),i.unshift(s.children)))}}qn.findAll=tY;var kr={};Object.defineProperty(kr,"__esModule",{value:!0});kr.getElementsByTagType=kr.getElementsByTagName=kr.getElementById=kr.getElements=kr.testElement=void 0;var kc=fa,K0=qn,zy={tag_name:function(n){return typeof n=="function"?function(e){return(0,kc.isTag)(e)&&n(e.name)}:n==="*"?kc.isTag:function(e){return(0,kc.isTag)(e)&&e.name===n}},tag_type:function(n){return typeof n=="function"?function(e){return n(e.type)}:function(e){return e.type===n}},tag_contains:function(n){return typeof n=="function"?function(e){return(0,kc.isText)(e)&&n(e.data)}:function(e){return(0,kc.isText)(e)&&e.data===n}}};function DF(n,e){return typeof e=="function"?function(t){return(0,kc.isTag)(t)&&e(t.attribs[n])}:function(t){return(0,kc.isTag)(t)&&t.attribs[n]===e}}function iY(n,e){return function(t){return n(t)||e(t)}}function OF(n){var e=Object.keys(n).map(function(t){var i=n[t];return Object.prototype.hasOwnProperty.call(zy,t)?zy[t](i):DF(t,i)});return e.length===0?null:e.reduce(iY)}function nY(n,e){var t=OF(n);return t?t(e):!0}kr.testElement=nY;function rY(n,e,t,i){i===void 0&&(i=1/0);var r=OF(n);return r?(0,K0.filter)(r,e,t,i):[]}kr.getElements=rY;function sY(n,e,t){return t===void 0&&(t=!0),Array.isArray(e)||(e=[e]),(0,K0.findOne)(DF("id",n),e,t)}kr.getElementById=sY;function oY(n,e,t,i){return t===void 0&&(t=!0),i===void 0&&(i=1/0),(0,K0.filter)(zy.tag_name(n),e,t,i)}kr.getElementsByTagName=oY;function aY(n,e,t,i){return t===void 0&&(t=!0),i===void 0&&(i=1/0),(0,K0.filter)(zy.tag_type(n),e,t,i)}kr.getElementsByTagType=aY;var kF={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.uniqueSort=n.compareDocumentPosition=n.DocumentPosition=n.removeSubsets=void 0;var e=fa;function t(o){for(var a=o.length;--a>=0;){var l=o[a];if(a>0&&o.lastIndexOf(l,a-1)>=0){o.splice(a,1);continue}for(var c=l.parent;c;c=c.parent)if(o.includes(c)){o.splice(a,1);break}}return o}n.removeSubsets=t;var i;(function(o){o[o.DISCONNECTED=1]="DISCONNECTED",o[o.PRECEDING=2]="PRECEDING",o[o.FOLLOWING=4]="FOLLOWING",o[o.CONTAINS=8]="CONTAINS",o[o.CONTAINED_BY=16]="CONTAINED_BY"})(i=n.DocumentPosition||(n.DocumentPosition={}));function r(o,a){var l=[],c=[];if(o===a)return 0;for(var u=(0,e.hasChildren)(o)?o:o.parent;u;)l.unshift(u),u=u.parent;for(u=(0,e.hasChildren)(a)?a:a.parent;u;)c.unshift(u),u=u.parent;for(var f=Math.min(l.length,c.length),p=0;p<f&&l[p]===c[p];)p++;if(p===0)return i.DISCONNECTED;var m=l[p-1],y=m.children,_=l[p],w=c[p];return y.indexOf(_)>y.indexOf(w)?m===a?i.FOLLOWING|i.CONTAINED_BY:i.FOLLOWING:m===o?i.PRECEDING|i.CONTAINS:i.PRECEDING}n.compareDocumentPosition=r;function s(o){return o=o.filter(function(a,l,c){return!c.includes(a,l+1)}),o.sort(function(a,l){var c=r(a,l);return c&i.PRECEDING?-1:c&i.FOLLOWING?1:0}),o}n.uniqueSort=s})(kF);var Z0={};Object.defineProperty(Z0,"__esModule",{value:!0});Z0.getFeed=void 0;var lY=Or,Eg=kr;function cY(n){var e=Gy(pY,n);return e?e.name==="feed"?uY(e):hY(e):null}Z0.getFeed=cY;function uY(n){var e,t=n.children,i={type:"atom",items:(0,Eg.getElementsByTagName)("entry",t).map(function(o){var a,l=o.children,c={media:MF(l)};cr(c,"id","id",l),cr(c,"title","title",l);var u=(a=Gy("link",l))===null||a===void 0?void 0:a.attribs.href;u&&(c.link=u);var f=wl("summary",l)||wl("content",l);f&&(c.description=f);var p=wl("updated",l);return p&&(c.pubDate=new Date(p)),c})};cr(i,"id","id",t),cr(i,"title","title",t);var r=(e=Gy("link",t))===null||e===void 0?void 0:e.attribs.href;r&&(i.link=r),cr(i,"description","subtitle",t);var s=wl("updated",t);return s&&(i.updated=new Date(s)),cr(i,"author","email",t,!0),i}function hY(n){var e,t,i=(t=(e=Gy("channel",n.children))===null||e===void 0?void 0:e.children)!==null&&t!==void 0?t:[],r={type:n.name.substr(0,3),id:"",items:(0,Eg.getElementsByTagName)("item",n.children).map(function(o){var a=o.children,l={media:MF(a)};cr(l,"id","guid",a),cr(l,"title","title",a),cr(l,"link","link",a),cr(l,"description","description",a);var c=wl("pubDate",a)||wl("dc:date",a);return c&&(l.pubDate=new Date(c)),l})};cr(r,"title","title",i),cr(r,"link","link",i),cr(r,"description","description",i);var s=wl("lastBuildDate",i);return s&&(r.updated=new Date(s)),cr(r,"author","managingEditor",i,!0),r}var dY=["url","type","lang"],fY=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function MF(n){return(0,Eg.getElementsByTagName)("media:content",n).map(function(e){for(var t=e.attribs,i={medium:t.medium,isDefault:!!t.isDefault},r=0,s=dY;r<s.length;r++){var o=s[r];t[o]&&(i[o]=t[o])}for(var a=0,l=fY;a<l.length;a++){var o=l[a];t[o]&&(i[o]=parseInt(t[o],10))}return t.expression&&(i.expression=t.expression),i})}function Gy(n,e){return(0,Eg.getElementsByTagName)(n,e,!0,1)[0]}function wl(n,e,t){return t===void 0&&(t=!1),(0,lY.textContent)((0,Eg.getElementsByTagName)(n,e,t,1)).trim()}function cr(n,e,t,i,r){r===void 0&&(r=!1);var s=wl(t,i,r);s&&(n[e]=s)}function pY(n){return n==="rss"||n==="feed"||n==="rdf:RDF"}(function(n){var e=wt&&wt.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var l=Object.getOwnPropertyDescriptor(s,o);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,l)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=wt&&wt.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),n.hasChildren=n.isDocument=n.isComment=n.isText=n.isCDATA=n.isTag=void 0,t(Or,n),t(hn,n),t(dr,n),t(qn,n),t(kr,n),t(kF,n),t(Z0,n);var i=fa;Object.defineProperty(n,"isTag",{enumerable:!0,get:function(){return i.isTag}}),Object.defineProperty(n,"isCDATA",{enumerable:!0,get:function(){return i.isCDATA}}),Object.defineProperty(n,"isText",{enumerable:!0,get:function(){return i.isText}}),Object.defineProperty(n,"isComment",{enumerable:!0,get:function(){return i.isComment}}),Object.defineProperty(n,"isDocument",{enumerable:!0,get:function(){return i.isDocument}}),Object.defineProperty(n,"hasChildren",{enumerable:!0,get:function(){return i.hasChildren}})})(Kv);(function(n){var e=wt&&wt.__createBinding||(Object.create?function(T,x,C,I){I===void 0&&(I=C);var D=Object.getOwnPropertyDescriptor(x,C);(!D||("get"in D?!x.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return x[C]}}),Object.defineProperty(T,I,D)}:function(T,x,C,I){I===void 0&&(I=C),T[I]=x[C]}),t=wt&&wt.__setModuleDefault||(Object.create?function(T,x){Object.defineProperty(T,"default",{enumerable:!0,value:x})}:function(T,x){T.default=x}),i=wt&&wt.__importStar||function(T){if(T&&T.__esModule)return T;var x={};if(T!=null)for(var C in T)C!=="default"&&Object.prototype.hasOwnProperty.call(T,C)&&e(x,T,C);return t(x,T),x},r=wt&&wt.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(n,"__esModule",{value:!0}),n.DomUtils=n.parseFeed=n.getFeed=n.ElementType=n.Tokenizer=n.createDomStream=n.parseDOM=n.parseDocument=n.DefaultHandler=n.DomHandler=n.Parser=void 0;var s=Bp,o=Bp;Object.defineProperty(n,"Parser",{enumerable:!0,get:function(){return o.Parser}});var a=fa,l=fa;Object.defineProperty(n,"DomHandler",{enumerable:!0,get:function(){return l.DomHandler}}),Object.defineProperty(n,"DefaultHandler",{enumerable:!0,get:function(){return l.DomHandler}});function c(T,x){var C=new a.DomHandler(void 0,x);return new s.Parser(C,x).end(T),C.root}n.parseDocument=c;function u(T,x){return c(T,x).children}n.parseDOM=u;function f(T,x,C){var I=new a.DomHandler(T,x,C);return new s.Parser(I,x)}n.createDomStream=f;var p=Fx;Object.defineProperty(n,"Tokenizer",{enumerable:!0,get:function(){return r(p).default}}),n.ElementType=i(jd);var m=Kv,y=Kv;Object.defineProperty(n,"getFeed",{enumerable:!0,get:function(){return y.getFeed}});var _={xmlMode:!0};function w(T,x){return x===void 0&&(x=_),(0,m.getFeed)(u(T,x))}n.parseFeed=w,n.DomUtils=i(Kv)})(cF);var gY=n=>{if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},Vx={};Object.defineProperty(Vx,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function eI(n){return Object.prototype.toString.call(n)==="[object Object]"}function mY(n){var e,t;return eI(n)===!1?!1:(e=n.constructor,e===void 0?!0:(t=e.prototype,!(eI(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}Vx.isPlainObject=mY;var vY=function(e){return yY(e)&&!_Y(e)};function yY(n){return!!n&&typeof n=="object"}function _Y(n){var e=Object.prototype.toString.call(n);return e==="[object RegExp]"||e==="[object Date]"||TY(n)}var EY=typeof Symbol=="function"&&Symbol.for,wY=EY?Symbol.for("react.element"):60103;function TY(n){return n.$$typeof===wY}function SY(n){return Array.isArray(n)?[]:{}}function zp(n,e){return e.clone!==!1&&e.isMergeableObject(n)?vd(SY(n),n,e):n}function bY(n,e,t){return n.concat(e).map(function(i){return zp(i,t)})}function xY(n,e){if(!e.customMerge)return vd;var t=e.customMerge(n);return typeof t=="function"?t:vd}function CY(n){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n).filter(function(e){return Object.propertyIsEnumerable.call(n,e)}):[]}function tI(n){return Object.keys(n).concat(CY(n))}function NF(n,e){try{return e in n}catch{return!1}}function RY(n,e){return NF(n,e)&&!(Object.hasOwnProperty.call(n,e)&&Object.propertyIsEnumerable.call(n,e))}function AY(n,e,t){var i={};return t.isMergeableObject(n)&&tI(n).forEach(function(r){i[r]=zp(n[r],t)}),tI(e).forEach(function(r){RY(n,r)||(NF(n,r)&&t.isMergeableObject(e[r])?i[r]=xY(r,t)(n[r],e[r],t):i[r]=zp(e[r],t))}),i}function vd(n,e,t){t=t||{},t.arrayMerge=t.arrayMerge||bY,t.isMergeableObject=t.isMergeableObject||vY,t.cloneUnlessOtherwiseSpecified=zp;var i=Array.isArray(e),r=Array.isArray(n),s=i===r;return s?i?t.arrayMerge(n,e,t):AY(n,e,t):zp(e,t)}vd.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(i,r){return vd(i,r,t)},{})};var LY=vd,IY=LY,FF={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.parseSrcset=t()})(wt,function(){return function(e){function t(I){return I===" "||I==="	"||I===`
`||I==="\f"||I==="\r"}function i(I){var D,B=I.exec(e.substring(w));if(B)return D=B[0],w+=D.length,D}for(var r=e.length,s=/^[ \t\n\r\u000c]+/,o=/^[, \t\n\r\u000c]+/,a=/^[^ \t\n\r\u000c]+/,l=/[,]+$/,c=/^\d+$/,u=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,f,p,m,y,_,w=0,T=[];;){if(i(o),w>=r)return T;f=i(a),p=[],f.slice(-1)===","?(f=f.replace(l,""),C()):x()}function x(){for(i(s),m="",y="in descriptor";;){if(_=e.charAt(w),y==="in descriptor")if(t(_))m&&(p.push(m),m="",y="after descriptor");else if(_===","){w+=1,m&&p.push(m),C();return}else if(_==="(")m=m+_,y="in parens";else if(_===""){m&&p.push(m),C();return}else m=m+_;else if(y==="in parens")if(_===")")m=m+_,y="in descriptor";else if(_===""){p.push(m),C();return}else m=m+_;else if(y==="after descriptor"&&!t(_))if(_===""){C();return}else y="in descriptor",w-=1;w+=1}}function C(){var I=!1,D,B,N,z,Z={},q,H,Y,ee,le;for(z=0;z<p.length;z++)q=p[z],H=q[q.length-1],Y=q.substring(0,q.length-1),ee=parseInt(Y,10),le=parseFloat(Y),c.test(Y)&&H==="w"?((D||B)&&(I=!0),ee===0?I=!0:D=ee):u.test(Y)&&H==="x"?((D||B||N)&&(I=!0),le<0?I=!0:B=le):c.test(Y)&&H==="h"?((N||B)&&(I=!0),ee===0?I=!0:N=ee):I=!0;I?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+q+"'."):(Z.url=f,D&&(Z.w=D),B&&(Z.d=B),N&&(Z.h=N),T.push(Z))}}})})(FF);var PY=FF.exports,jx={exports:{}},wi=String,BF=function(){return{isColorSupported:!1,reset:wi,bold:wi,dim:wi,italic:wi,underline:wi,inverse:wi,hidden:wi,strikethrough:wi,black:wi,red:wi,green:wi,yellow:wi,blue:wi,magenta:wi,cyan:wi,white:wi,gray:wi,bgBlack:wi,bgRed:wi,bgGreen:wi,bgYellow:wi,bgBlue:wi,bgMagenta:wi,bgCyan:wi,bgWhite:wi}};jx.exports=BF();jx.exports.createColors=BF;var DY=jx.exports;const Ms=FH(h9);let iI=DY,nI=Ms,gS=class UF extends Error{constructor(e,t,i,r,s,o){super(e),this.name="CssSyntaxError",this.reason=e,s&&(this.file=s),r&&(this.source=r),o&&(this.plugin=o),typeof t<"u"&&typeof i<"u"&&(typeof t=="number"?(this.line=t,this.column=i):(this.line=t.line,this.column=t.column,this.endLine=i.line,this.endColumn=i.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,UF)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;e==null&&(e=iI.isColorSupported),nI&&e&&(t=nI(t));let i=t.split(/\r?\n/),r=Math.max(this.line-3,0),s=Math.min(this.line+2,i.length),o=String(s).length,a,l;if(e){let{bold:c,gray:u,red:f}=iI.createColors(!0);a=p=>c(f(p)),l=p=>u(p)}else a=l=c=>c;return i.slice(r,s).map((c,u)=>{let f=r+1+u,p=" "+(" "+f).slice(-o)+" | ";if(f===this.line){let m=l(p.replace(/\d/g," "))+c.slice(0,this.column-1).replace(/[^\t]/g," ");return a(">")+l(p)+c+`
 `+m+a("^")}return" "+l(p)+c}).join(`
`)}toString(){let e=this.showSourceCode();return e&&(e=`

`+e+`
`),this.name+": "+this.message+e}};var Wx=gS;gS.default=gS;var wg={};wg.isClean=Symbol("isClean");wg.my=Symbol("my");const rI={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function OY(n){return n[0].toUpperCase()+n.slice(1)}let mS=class{constructor(e){this.builder=e}atrule(e,t){let i="@"+e.name,r=e.params?this.rawValue(e,"params"):"";if(typeof e.raws.afterName<"u"?i+=e.raws.afterName:r&&(i+=" "),e.nodes)this.block(e,i+r);else{let s=(e.raws.between||"")+(t?";":"");this.builder(i+r+s,e)}}beforeAfter(e,t){let i;e.type==="decl"?i=this.raw(e,null,"beforeDecl"):e.type==="comment"?i=this.raw(e,null,"beforeComment"):t==="before"?i=this.raw(e,null,"beforeRule"):i=this.raw(e,null,"beforeClose");let r=e.parent,s=0;for(;r&&r.type!=="root";)s+=1,r=r.parent;if(i.includes(`
`)){let o=this.raw(e,null,"indent");if(o.length)for(let a=0;a<s;a++)i+=o}return i}block(e,t){let i=this.raw(e,"between","beforeOpen");this.builder(t+i+"{",e,"start");let r;e.nodes&&e.nodes.length?(this.body(e),r=this.raw(e,"after")):r=this.raw(e,"after","emptyBody"),r&&this.builder(r),this.builder("}",e,"end")}body(e){let t=e.nodes.length-1;for(;t>0&&e.nodes[t].type==="comment";)t-=1;let i=this.raw(e,"semicolon");for(let r=0;r<e.nodes.length;r++){let s=e.nodes[r],o=this.raw(s,"before");o&&this.builder(o),this.stringify(s,t!==r||i)}}comment(e){let t=this.raw(e,"left","commentLeft"),i=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+i+"*/",e)}decl(e,t){let i=this.raw(e,"between","colon"),r=e.prop+i+this.rawValue(e,"value");e.important&&(r+=e.raws.important||" !important"),t&&(r+=";"),this.builder(r,e)}document(e){this.body(e)}raw(e,t,i){let r;if(i||(i=t),t&&(r=e.raws[t],typeof r<"u"))return r;let s=e.parent;if(i==="before"&&(!s||s.type==="root"&&s.first===e||s&&s.type==="document"))return"";if(!s)return rI[i];let o=e.root();if(o.rawCache||(o.rawCache={}),typeof o.rawCache[i]<"u")return o.rawCache[i];if(i==="before"||i==="after")return this.beforeAfter(e,i);{let a="raw"+OY(i);this[a]?r=this[a](o,e):o.walk(l=>{if(r=l.raws[t],typeof r<"u")return!1})}return typeof r>"u"&&(r=rI[i]),o.rawCache[i]=r,r}rawBeforeClose(e){let t;return e.walk(i=>{if(i.nodes&&i.nodes.length>0&&typeof i.raws.after<"u")return t=i.raws.after,t.includes(`
`)&&(t=t.replace(/[^\n]+$/,"")),!1}),t&&(t=t.replace(/\S/g,"")),t}rawBeforeComment(e,t){let i;return e.walkComments(r=>{if(typeof r.raws.before<"u")return i=r.raws.before,i.includes(`
`)&&(i=i.replace(/[^\n]+$/,"")),!1}),typeof i>"u"?i=this.raw(t,null,"beforeDecl"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeDecl(e,t){let i;return e.walkDecls(r=>{if(typeof r.raws.before<"u")return i=r.raws.before,i.includes(`
`)&&(i=i.replace(/[^\n]+$/,"")),!1}),typeof i>"u"?i=this.raw(t,null,"beforeRule"):i&&(i=i.replace(/\S/g,"")),i}rawBeforeOpen(e){let t;return e.walk(i=>{if(i.type!=="decl"&&(t=i.raws.between,typeof t<"u"))return!1}),t}rawBeforeRule(e){let t;return e.walk(i=>{if(i.nodes&&(i.parent!==e||e.first!==i)&&typeof i.raws.before<"u")return t=i.raws.before,t.includes(`
`)&&(t=t.replace(/[^\n]+$/,"")),!1}),t&&(t=t.replace(/\S/g,"")),t}rawColon(e){let t;return e.walkDecls(i=>{if(typeof i.raws.between<"u")return t=i.raws.between.replace(/[^\s:]/g,""),!1}),t}rawEmptyBody(e){let t;return e.walk(i=>{if(i.nodes&&i.nodes.length===0&&(t=i.raws.after,typeof t<"u"))return!1}),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk(i=>{let r=i.parent;if(r&&r!==e&&r.parent&&r.parent===e&&typeof i.raws.before<"u"){let s=i.raws.before.split(`
`);return t=s[s.length-1],t=t.replace(/\S/g,""),!1}}),t}rawSemicolon(e){let t;return e.walk(i=>{if(i.nodes&&i.nodes.length&&i.last.type==="decl"&&(t=i.raws.semicolon,typeof t<"u"))return!1}),t}rawValue(e,t){let i=e[t],r=e.raws[t];return r&&r.value===i?r.raw:i}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}};var zF=mS;mS.default=mS;let kY=zF;function vS(n,e){new kY(e).stringify(n)}var Y0=vS;vS.default=vS;let{isClean:cv,my:MY}=wg,NY=Wx,FY=zF,BY=Y0;function yS(n,e){let t=new n.constructor;for(let i in n){if(!Object.prototype.hasOwnProperty.call(n,i)||i==="proxyCache")continue;let r=n[i],s=typeof r;i==="parent"&&s==="object"?e&&(t[i]=e):i==="source"?t[i]=r:Array.isArray(r)?t[i]=r.map(o=>yS(o,t)):(s==="object"&&r!==null&&(r=yS(r)),t[i]=r)}return t}let _S=class{constructor(e={}){this.raws={},this[cv]=!1,this[MY]=!0;for(let t in e)if(t==="nodes"){this.nodes=[];for(let i of e[t])typeof i.clone=="function"?this.append(i.clone()):this.append(i)}else this[t]=e[t]}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}after(e){return this.parent.insertAfter(this,e),this}assign(e={}){for(let t in e)this[t]=e[t];return this}before(e){return this.parent.insertBefore(this,e),this}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}clone(e={}){let t=yS(this);for(let i in e)t[i]=e[i];return t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}error(e,t={}){if(this.source){let{end:i,start:r}=this.rangeBy(t);return this.source.input.error(e,{column:r.column,line:r.line},{column:i.column,line:i.line},t)}return new NY(e)}getProxyProcessor(){return{get(e,t){return t==="proxyOf"?e:t==="root"?()=>e.root().toProxy():e[t]},set(e,t,i){return e[t]===i||(e[t]=i,(t==="prop"||t==="value"||t==="name"||t==="params"||t==="important"||t==="text")&&e.markDirty()),!0}}}markDirty(){if(this[cv]){this[cv]=!1;let e=this;for(;e=e.parent;)e[cv]=!1}}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}positionBy(e,t){let i=this.source.start;if(e.index)i=this.positionInside(e.index,t);else if(e.word){t=this.toString();let r=t.indexOf(e.word);r!==-1&&(i=this.positionInside(r,t))}return i}positionInside(e,t){let i=t||this.toString(),r=this.source.start.column,s=this.source.start.line;for(let o=0;o<e;o++)i[o]===`
`?(r=1,s+=1):r+=1;return{column:r,line:s}}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}rangeBy(e){let t={column:this.source.start.column,line:this.source.start.line},i=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:t.column+1,line:t.line};if(e.word){let r=this.toString(),s=r.indexOf(e.word);s!==-1&&(t=this.positionInside(s,r),i=this.positionInside(s+e.word.length,r))}else e.start?t={column:e.start.column,line:e.start.line}:e.index&&(t=this.positionInside(e.index)),e.end?i={column:e.end.column,line:e.end.line}:typeof e.endIndex=="number"?i=this.positionInside(e.endIndex):e.index&&(i=this.positionInside(e.index+1));return(i.line<t.line||i.line===t.line&&i.column<=t.column)&&(i={column:t.column+1,line:t.line}),{end:i,start:t}}raw(e,t){return new FY().raw(this,e,t)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...e){if(this.parent){let t=this,i=!1;for(let r of e)r===this?i=!0:i?(this.parent.insertAfter(t,r),t=r):this.parent.insertBefore(t,r);i||this.remove()}return this}root(){let e=this;for(;e.parent&&e.parent.type!=="document";)e=e.parent;return e}toJSON(e,t){let i={},r=t==null;t=t||new Map;let s=0;for(let o in this){if(!Object.prototype.hasOwnProperty.call(this,o)||o==="parent"||o==="proxyCache")continue;let a=this[o];if(Array.isArray(a))i[o]=a.map(l=>typeof l=="object"&&l.toJSON?l.toJSON(null,t):l);else if(typeof a=="object"&&a.toJSON)i[o]=a.toJSON(null,t);else if(o==="source"){let l=t.get(a.input);l==null&&(l=s,t.set(a.input,s),s++),i[o]={end:a.end,inputId:l,start:a.start}}else i[o]=a}return r&&(i.inputs=[...t.keys()].map(o=>o.toJSON())),i}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(e=BY){e.stringify&&(e=e.stringify);let t="";return e(this,i=>{t+=i}),t}warn(e,t,i){let r={node:this};for(let s in i)r[s]=i[s];return e.warn(t,r)}get proxyOf(){return this}};var X0=_S;_S.default=_S;let UY=X0,ES=class extends UY{constructor(e){e&&typeof e.value<"u"&&typeof e.value!="string"&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var J0=ES;ES.default=ES;let zY="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",GY=(n,e=21)=>(t=e)=>{let i="",r=t;for(;r--;)i+=n[Math.random()*n.length|0];return i},HY=(n=21)=>{let e="",t=n;for(;t--;)e+=zY[Math.random()*64|0];return e};var $Y={nanoid:HY,customAlphabet:GY};let{SourceMapConsumer:sI,SourceMapGenerator:oI}=Ms,{existsSync:VY,readFileSync:jY}=Ms,{dirname:Pw,join:WY}=Ms;function qY(n){return Buffer?Buffer.from(n,"base64").toString():window.atob(n)}let wS=class{constructor(e,t){if(t.map===!1)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let i=t.map?t.map.prev:void 0,r=this.loadMap(t.from,i);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=Pw(this.mapFile)),r&&(this.text=r)}consumer(){return this.consumerCache||(this.consumerCache=new sI(this.text)),this.consumerCache}decodeInline(e){let t=/^data:application\/json;charset=utf-?8;base64,/,i=/^data:application\/json;base64,/,r=/^data:application\/json;charset=utf-?8,/,s=/^data:application\/json,/;if(r.test(e)||s.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(t.test(e)||i.test(e))return qY(e.substr(RegExp.lastMatch.length));let o=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+o)}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(e){return typeof e!="object"?!1:typeof e.mappings=="string"||typeof e._mappings=="string"||Array.isArray(e.sections)}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!t)return;let i=e.lastIndexOf(t.pop()),r=e.indexOf("*/",i);i>-1&&r>-1&&(this.annotation=this.getAnnotationURL(e.substring(i,r)))}loadFile(e){if(this.root=Pw(e),VY(e))return this.mapFile=e,jY(e,"utf-8").toString().trim()}loadMap(e,t){if(t===!1)return!1;if(t){if(typeof t=="string")return t;if(typeof t=="function"){let i=t(e);if(i){let r=this.loadFile(i);if(!r)throw new Error("Unable to load previous source map: "+i.toString());return r}}else{if(t instanceof sI)return oI.fromSourceMap(t).toString();if(t instanceof oI)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let i=this.annotation;return e&&(i=WY(Pw(e),i)),this.loadFile(i)}}}startWith(e,t){return e?e.substr(0,t.length)===t:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var GF=wS;wS.default=wS;let{SourceMapConsumer:KY,SourceMapGenerator:ZY}=Ms,{fileURLToPath:aI,pathToFileURL:uv}=Ms,{isAbsolute:TS,resolve:SS}=Ms,{nanoid:YY}=$Y,Dw=Ms,lI=Wx,XY=GF,Ow=Symbol("fromOffsetCache"),JY=!!(KY&&ZY),cI=!!(SS&&TS),Hy=class{constructor(e,t={}){if(e===null||typeof e>"u"||typeof e=="object"&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),this.css[0]==="\uFEFF"||this.css[0]==="￾"?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!cI||/^\w+:\/\//.test(t.from)||TS(t.from)?this.file=t.from:this.file=SS(t.from)),cI&&JY){let i=new XY(this.css,t);if(i.text){this.map=i;let r=i.consumer().file;!this.file&&r&&(this.file=this.mapResolve(r))}}this.file||(this.id="<input css "+YY(6)+">"),this.map&&(this.map.file=this.from)}error(e,t,i,r={}){let s,o,a;if(t&&typeof t=="object"){let c=t,u=i;if(typeof c.offset=="number"){let f=this.fromOffset(c.offset);t=f.line,i=f.col}else t=c.line,i=c.column;if(typeof u.offset=="number"){let f=this.fromOffset(u.offset);o=f.line,a=f.col}else o=u.line,a=u.column}else if(!i){let c=this.fromOffset(t);t=c.line,i=c.col}let l=this.origin(t,i,o,a);return l?s=new lI(e,l.endLine===void 0?l.line:{column:l.column,line:l.line},l.endLine===void 0?l.column:{column:l.endColumn,line:l.endLine},l.source,l.file,r.plugin):s=new lI(e,o===void 0?t:{column:i,line:t},o===void 0?i:{column:a,line:o},this.css,this.file,r.plugin),s.input={column:i,endColumn:a,endLine:o,line:t,source:this.css},this.file&&(uv&&(s.input.url=uv(this.file).toString()),s.input.file=this.file),s}fromOffset(e){let t,i;if(this[Ow])i=this[Ow];else{let s=this.css.split(`
`);i=new Array(s.length);let o=0;for(let a=0,l=s.length;a<l;a++)i[a]=o,o+=s[a].length+1;this[Ow]=i}t=i[i.length-1];let r=0;if(e>=t)r=i.length-1;else{let s=i.length-2,o;for(;r<s;)if(o=r+(s-r>>1),e<i[o])s=o-1;else if(e>=i[o+1])r=o+1;else{r=o;break}}return{col:e-i[r]+1,line:r+1}}mapResolve(e){return/^\w+:\/\//.test(e)?e:SS(this.map.consumer().sourceRoot||this.map.root||".",e)}origin(e,t,i,r){if(!this.map)return!1;let s=this.map.consumer(),o=s.originalPositionFor({column:t,line:e});if(!o.source)return!1;let a;typeof i=="number"&&(a=s.originalPositionFor({column:r,line:i}));let l;TS(o.source)?l=uv(o.source):l=new URL(o.source,this.map.consumer().sourceRoot||uv(this.map.mapFile));let c={column:o.column,endColumn:a&&a.column,endLine:a&&a.line,line:o.line,url:l.toString()};if(l.protocol==="file:")if(aI)c.file=aI(l);else throw new Error("file: protocol is not available in this PostCSS build");let u=s.sourceContentFor(o.source);return u&&(c.source=u),c}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])this[t]!=null&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}get from(){return this.file||this.id}};var Q0=Hy;Hy.default=Hy;Dw&&Dw.registerInput&&Dw.registerInput(Hy);let{SourceMapConsumer:HF,SourceMapGenerator:Yv}=Ms,{dirname:Xv,relative:$F,resolve:VF,sep:jF}=Ms,{pathToFileURL:uI}=Ms,QY=Q0,eX=!!(HF&&Yv),tX=!!(Xv&&VF&&$F&&jF),iX=class{constructor(e,t,i,r){this.stringify=e,this.mapOpts=i.map||{},this.root=t,this.opts=i,this.css=r,this.originalCSS=r,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let e;this.isInline()?e="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?e=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?e=this.mapOpts.annotation(this.opts.to,this.root):e=this.outputFile()+".map";let t=`
`;this.css.includes(`\r
`)&&(t=`\r
`),this.css+=t+"/*# sourceMappingURL="+e+" */"}applyPrevMaps(){for(let e of this.previous()){let t=this.toUrl(this.path(e.file)),i=e.root||Xv(e.file),r;this.mapOpts.sourcesContent===!1?(r=new HF(e.text),r.sourcesContent&&(r.sourcesContent=null)):r=e.consumer(),this.map.applySourceMap(r,t,this.toUrl(this.path(i)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],e.type==="comment"&&e.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(t)}else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),tX&&eX&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,t=>{e+=t}),[e]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=Yv.fromSourceMap(e,{ignoreInvalidMapping:!0})}else this.map=new Yv({file:this.outputFile(),ignoreInvalidMapping:!0}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new Yv({file:this.outputFile(),ignoreInvalidMapping:!0});let e=1,t=1,i="<no source>",r={generated:{column:0,line:0},original:{column:0,line:0},source:""},s,o;this.stringify(this.root,(a,l,c)=>{if(this.css+=a,l&&c!=="end"&&(r.generated.line=e,r.generated.column=t-1,l.source&&l.source.start?(r.source=this.sourcePath(l),r.original.line=l.source.start.line,r.original.column=l.source.start.column-1,this.map.addMapping(r)):(r.source=i,r.original.line=1,r.original.column=0,this.map.addMapping(r))),s=a.match(/\n/g),s?(e+=s.length,o=a.lastIndexOf(`
`),t=a.length-o):t+=a.length,l&&c!=="start"){let u=l.parent||{raws:{}};(!(l.type==="decl"||l.type==="atrule"&&!l.nodes)||l!==u.last||u.raws.semicolon)&&(l.source&&l.source.end?(r.source=this.sourcePath(l),r.original.line=l.source.end.line,r.original.column=l.source.end.column-1,r.generated.line=e,r.generated.column=t-2,this.map.addMapping(r)):(r.source=i,r.original.line=1,r.original.column=0,r.generated.line=e,r.generated.column=t-1,this.map.addMapping(r)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(e=>e.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let e=this.mapOpts.annotation;return typeof e<"u"&&e!==!0?!1:this.previous().length?this.previous().some(t=>t.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(e=>e.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(e){if(this.mapOpts.absolute||e.charCodeAt(0)===60||/^\w+:\/\//.test(e))return e;let t=this.memoizedPaths.get(e);if(t)return t;let i=this.opts.to?Xv(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(i=Xv(VF(i,this.mapOpts.annotation)));let r=$F(i,e);return this.memoizedPaths.set(e,r),r}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}});else{let e=new QY(this.originalCSS,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}setSourcesContent(){let e={};if(this.root)this.root.walk(t=>{if(t.source){let i=t.source.input.from;if(i&&!e[i]){e[i]=!0;let r=this.usesFileUrls?this.toFileUrl(i):this.toUrl(this.path(i));this.map.setSourceContent(r,t.source.input.css)}}});else if(this.css){let t=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(t,this.css)}}sourcePath(e){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(e.source.input.from):this.toUrl(this.path(e.source.input.from))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}toFileUrl(e){let t=this.memoizedFileURLs.get(e);if(t)return t;if(uI){let i=uI(e).toString();return this.memoizedFileURLs.set(e,i),i}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(e){let t=this.memoizedURLs.get(e);if(t)return t;jF==="\\"&&(e=e.replace(/\\/g,"/"));let i=encodeURI(e).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(e,i),i}};var WF=iX;let nX=X0,bS=class extends nX{constructor(e){super(e),this.type="comment"}};var e_=bS;bS.default=bS;let{isClean:qF,my:KF}=wg,ZF=J0,YF=e_,rX=X0,XF,qx,Kx,JF;function QF(n){return n.map(e=>(e.nodes&&(e.nodes=QF(e.nodes)),delete e.source,e))}function eB(n){if(n[qF]=!1,n.proxyOf.nodes)for(let e of n.proxyOf.nodes)eB(e)}let pa=class tB extends rX{append(...e){for(let t of e){let i=this.normalize(t,this.last);for(let r of i)this.proxyOf.nodes.push(r)}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}each(e){if(!this.proxyOf.nodes)return;let t=this.getIterator(),i,r;for(;this.indexes[t]<this.proxyOf.nodes.length&&(i=this.indexes[t],r=e(this.proxyOf.nodes[i],i),r!==!1);)this.indexes[t]+=1;return delete this.indexes[t],r}every(e){return this.nodes.every(e)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}getProxyProcessor(){return{get(e,t){return t==="proxyOf"?e:e[t]?t==="each"||typeof t=="string"&&t.startsWith("walk")?(...i)=>e[t](...i.map(r=>typeof r=="function"?(s,o)=>r(s.toProxy(),o):r)):t==="every"||t==="some"?i=>e[t]((r,...s)=>i(r.toProxy(),...s)):t==="root"?()=>e.root().toProxy():t==="nodes"?e.nodes.map(i=>i.toProxy()):t==="first"||t==="last"?e[t].toProxy():e[t]:e[t]},set(e,t,i){return e[t]===i||(e[t]=i,(t==="name"||t==="params"||t==="selector")&&e.markDirty()),!0}}}index(e){return typeof e=="number"?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}insertAfter(e,t){let i=this.index(e),r=this.normalize(t,this.proxyOf.nodes[i]).reverse();i=this.index(e);for(let o of r)this.proxyOf.nodes.splice(i+1,0,o);let s;for(let o in this.indexes)s=this.indexes[o],i<s&&(this.indexes[o]=s+r.length);return this.markDirty(),this}insertBefore(e,t){let i=this.index(e),r=i===0?"prepend":!1,s=this.normalize(t,this.proxyOf.nodes[i],r).reverse();i=this.index(e);for(let a of s)this.proxyOf.nodes.splice(i,0,a);let o;for(let a in this.indexes)o=this.indexes[a],i<=o&&(this.indexes[a]=o+s.length);return this.markDirty(),this}normalize(e,t){if(typeof e=="string")e=QF(XF(e).nodes);else if(typeof e>"u")e=[];else if(Array.isArray(e)){e=e.slice(0);for(let r of e)r.parent&&r.parent.removeChild(r,"ignore")}else if(e.type==="root"&&this.type!=="document"){e=e.nodes.slice(0);for(let r of e)r.parent&&r.parent.removeChild(r,"ignore")}else if(e.type)e=[e];else if(e.prop){if(typeof e.value>"u")throw new Error("Value field is missed in node creation");typeof e.value!="string"&&(e.value=String(e.value)),e=[new ZF(e)]}else if(e.selector)e=[new qx(e)];else if(e.name)e=[new Kx(e)];else if(e.text)e=[new YF(e)];else throw new Error("Unknown node type in node creation");return e.map(r=>(r[KF]||tB.rebuild(r),r=r.proxyOf,r.parent&&r.parent.removeChild(r),r[qF]&&eB(r),typeof r.raws.before>"u"&&t&&typeof t.raws.before<"u"&&(r.raws.before=t.raws.before.replace(/\S/g,"")),r.parent=this.proxyOf,r))}prepend(...e){e=e.reverse();for(let t of e){let i=this.normalize(t,this.first,"prepend").reverse();for(let r of i)this.proxyOf.nodes.unshift(r);for(let r in this.indexes)this.indexes[r]=this.indexes[r]+i.length}return this.markDirty(),this}push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(e){e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);let t;for(let i in this.indexes)t=this.indexes[i],t>=e&&(this.indexes[i]=t-1);return this.markDirty(),this}replaceValues(e,t,i){return i||(i=t,t={}),this.walkDecls(r=>{t.props&&!t.props.includes(r.prop)||t.fast&&!r.value.includes(t.fast)||(r.value=r.value.replace(e,i))}),this.markDirty(),this}some(e){return this.nodes.some(e)}walk(e){return this.each((t,i)=>{let r;try{r=e(t,i)}catch(s){throw t.addToError(s)}return r!==!1&&t.walk&&(r=t.walk(e)),r})}walkAtRules(e,t){return t?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="atrule"&&e.test(i.name))return t(i,r)}):this.walk((i,r)=>{if(i.type==="atrule"&&i.name===e)return t(i,r)}):(t=e,this.walk((i,r)=>{if(i.type==="atrule")return t(i,r)}))}walkComments(e){return this.walk((t,i)=>{if(t.type==="comment")return e(t,i)})}walkDecls(e,t){return t?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="decl"&&e.test(i.prop))return t(i,r)}):this.walk((i,r)=>{if(i.type==="decl"&&i.prop===e)return t(i,r)}):(t=e,this.walk((i,r)=>{if(i.type==="decl")return t(i,r)}))}walkRules(e,t){return t?e instanceof RegExp?this.walk((i,r)=>{if(i.type==="rule"&&e.test(i.selector))return t(i,r)}):this.walk((i,r)=>{if(i.type==="rule"&&i.selector===e)return t(i,r)}):(t=e,this.walk((i,r)=>{if(i.type==="rule")return t(i,r)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};pa.registerParse=n=>{XF=n};pa.registerRule=n=>{qx=n};pa.registerAtRule=n=>{Kx=n};pa.registerRoot=n=>{JF=n};var fu=pa;pa.default=pa;pa.rebuild=n=>{n.type==="atrule"?Object.setPrototypeOf(n,Kx.prototype):n.type==="rule"?Object.setPrototypeOf(n,qx.prototype):n.type==="decl"?Object.setPrototypeOf(n,ZF.prototype):n.type==="comment"?Object.setPrototypeOf(n,YF.prototype):n.type==="root"&&Object.setPrototypeOf(n,JF.prototype),n[KF]=!0,n.nodes&&n.nodes.forEach(e=>{pa.rebuild(e)})};let sX=fu,iB,nB,Gp=class extends sX{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new iB(new nB,this,e).stringify()}};Gp.registerLazyResult=n=>{iB=n};Gp.registerProcessor=n=>{nB=n};var Zx=Gp;Gp.default=Gp;let xS=class{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let i=t.node.rangeBy(t);this.line=i.start.line,this.column=i.start.column,this.endLine=i.end.line,this.endColumn=i.end.column}for(let i in t)this[i]=t[i]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var rB=xS;xS.default=xS;let oX=rB,CS=class{constructor(e,t,i){this.processor=e,this.messages=[],this.root=t,this.opts=i,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let i=new oX(e,t);return this.messages.push(i),i}warnings(){return this.messages.filter(e=>e.type==="warning")}get content(){return this.css}};var Yx=CS;CS.default=CS;const kw=39,hI=34,hv=92,dI=47,dv=10,Xf=32,fv=12,pv=9,gv=13,aX=91,lX=93,cX=40,uX=41,hX=123,dX=125,fX=59,pX=42,gX=58,mX=64,mv=/[\t\n\f\r "#'()/;[\\\]{}]/g,vv=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,vX=/.[\r\n"'(/\\]/,fI=/[\da-f]/i;var yX=function(e,t={}){let i=e.css.valueOf(),r=t.ignoreErrors,s,o,a,l,c,u,f,p,m,y,_=i.length,w=0,T=[],x=[];function C(){return w}function I(z){throw e.error("Unclosed "+z,w)}function D(){return x.length===0&&w>=_}function B(z){if(x.length)return x.pop();if(w>=_)return;let Z=z?z.ignoreUnclosed:!1;switch(s=i.charCodeAt(w),s){case dv:case Xf:case pv:case gv:case fv:{o=w;do o+=1,s=i.charCodeAt(o);while(s===Xf||s===dv||s===pv||s===gv||s===fv);y=["space",i.slice(w,o)],w=o-1;break}case aX:case lX:case hX:case dX:case gX:case fX:case uX:{let q=String.fromCharCode(s);y=[q,q,w];break}case cX:{if(p=T.length?T.pop()[1]:"",m=i.charCodeAt(w+1),p==="url"&&m!==kw&&m!==hI&&m!==Xf&&m!==dv&&m!==pv&&m!==fv&&m!==gv){o=w;do{if(u=!1,o=i.indexOf(")",o+1),o===-1)if(r||Z){o=w;break}else I("bracket");for(f=o;i.charCodeAt(f-1)===hv;)f-=1,u=!u}while(u);y=["brackets",i.slice(w,o+1),w,o],w=o}else o=i.indexOf(")",w+1),l=i.slice(w,o+1),o===-1||vX.test(l)?y=["(","(",w]:(y=["brackets",l,w,o],w=o);break}case kw:case hI:{a=s===kw?"'":'"',o=w;do{if(u=!1,o=i.indexOf(a,o+1),o===-1)if(r||Z){o=w+1;break}else I("string");for(f=o;i.charCodeAt(f-1)===hv;)f-=1,u=!u}while(u);y=["string",i.slice(w,o+1),w,o],w=o;break}case mX:{mv.lastIndex=w+1,mv.test(i),mv.lastIndex===0?o=i.length-1:o=mv.lastIndex-2,y=["at-word",i.slice(w,o+1),w,o],w=o;break}case hv:{for(o=w,c=!0;i.charCodeAt(o+1)===hv;)o+=1,c=!c;if(s=i.charCodeAt(o+1),c&&s!==dI&&s!==Xf&&s!==dv&&s!==pv&&s!==gv&&s!==fv&&(o+=1,fI.test(i.charAt(o)))){for(;fI.test(i.charAt(o+1));)o+=1;i.charCodeAt(o+1)===Xf&&(o+=1)}y=["word",i.slice(w,o+1),w,o],w=o;break}default:{s===dI&&i.charCodeAt(w+1)===pX?(o=i.indexOf("*/",w+2)+1,o===0&&(r||Z?o=i.length:I("comment")),y=["comment",i.slice(w,o+1),w,o],w=o):(vv.lastIndex=w+1,vv.test(i),vv.lastIndex===0?o=i.length-1:o=vv.lastIndex-2,y=["word",i.slice(w,o+1),w,o],T.push(y),w=o);break}}return w++,y}function N(z){x.push(z)}return{back:N,endOfFile:D,nextToken:B,position:C}};let sB=fu,$y=class extends sB{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}};var Xx=$y;$y.default=$y;sB.registerAtRule($y);let oB=fu,aB,lB,yd=class extends oB{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}normalize(e,t,i){let r=super.normalize(e);if(t){if(i==="prepend")this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let s of r)s.raws.before=t.raws.before}return r}removeChild(e,t){let i=this.index(e);return!t&&i===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[i].raws.before),super.removeChild(e)}toResult(e={}){return new aB(new lB,this,e).stringify()}};yd.registerLazyResult=n=>{aB=n};yd.registerProcessor=n=>{lB=n};var Tg=yd;yd.default=yd;oB.registerRoot(yd);let Hp={comma(n){return Hp.split(n,[","],!0)},space(n){let e=[" ",`
`,"	"];return Hp.split(n,e)},split(n,e,t){let i=[],r="",s=!1,o=0,a=!1,l="",c=!1;for(let u of n)c?c=!1:u==="\\"?c=!0:a?u===l&&(a=!1):u==='"'||u==="'"?(a=!0,l=u):u==="("?o+=1:u===")"?o>0&&(o-=1):o===0&&e.includes(u)&&(s=!0),s?(r!==""&&i.push(r.trim()),r="",s=!1):r+=u;return(t||r!=="")&&i.push(r.trim()),i}};var cB=Hp;Hp.default=Hp;let uB=fu,_X=cB,Vy=class extends uB{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return _X.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,i=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(i)}};var Jx=Vy;Vy.default=Vy;uB.registerRule(Vy);let EX=J0,wX=yX,TX=e_,SX=Xx,bX=Tg,pI=Jx;const gI={empty:!0,space:!0};function xX(n){for(let e=n.length-1;e>=0;e--){let t=n[e],i=t[3]||t[2];if(i)return i}}let CX=class{constructor(e){this.input=e,this.root=new bX,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:e,start:{column:1,line:1,offset:0}}}atrule(e){let t=new SX;t.name=e[1].slice(1),t.name===""&&this.unnamedAtrule(t,e),this.init(t,e[2]);let i,r,s,o=!1,a=!1,l=[],c=[];for(;!this.tokenizer.endOfFile();){if(e=this.tokenizer.nextToken(),i=e[0],i==="("||i==="["?c.push(i==="("?")":"]"):i==="{"&&c.length>0?c.push("}"):i===c[c.length-1]&&c.pop(),c.length===0)if(i===";"){t.source.end=this.getPosition(e[2]),t.source.end.offset++,this.semicolon=!0;break}else if(i==="{"){a=!0;break}else if(i==="}"){if(l.length>0){for(s=l.length-1,r=l[s];r&&r[0]==="space";)r=l[--s];r&&(t.source.end=this.getPosition(r[3]||r[2]),t.source.end.offset++)}this.end(e);break}else l.push(e);else l.push(e);if(this.tokenizer.endOfFile()){o=!0;break}}t.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(t.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(t,"params",l),o&&(e=l[l.length-1],t.source.end=this.getPosition(e[3]||e[2]),t.source.end.offset++,this.spaces=t.raws.between,t.raws.between="")):(t.raws.afterName="",t.params=""),a&&(t.nodes=[],this.current=t)}checkMissedSemicolon(e){let t=this.colon(e);if(t===!1)return;let i=0,r;for(let s=t-1;s>=0&&(r=e[s],!(r[0]!=="space"&&(i+=1,i===2)));s--);throw this.input.error("Missed semicolon",r[0]==="word"?r[3]+1:r[2])}colon(e){let t=0,i,r,s;for(let[o,a]of e.entries()){if(i=a,r=i[0],r==="("&&(t+=1),r===")"&&(t-=1),t===0&&r===":")if(!s)this.doubleColon(i);else{if(s[0]==="word"&&s[1]==="progid")continue;return o}s=i}return!1}comment(e){let t=new TX;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]),t.source.end.offset++;let i=e[1].slice(2,-2);if(/^\s*$/.test(i))t.text="",t.raws.left=i,t.raws.right="";else{let r=i.match(/^(\s*)([^]*\S)(\s*)$/);t.text=r[2],t.raws.left=r[1],t.raws.right=r[3]}}createTokenizer(){this.tokenizer=wX(this.input)}decl(e,t){let i=new EX;this.init(i,e[0][2]);let r=e[e.length-1];for(r[0]===";"&&(this.semicolon=!0,e.pop()),i.source.end=this.getPosition(r[3]||r[2]||xX(e)),i.source.end.offset++;e[0][0]!=="word";)e.length===1&&this.unknownWord(e),i.raws.before+=e.shift()[1];for(i.source.start=this.getPosition(e[0][2]),i.prop="";e.length;){let c=e[0][0];if(c===":"||c==="space"||c==="comment")break;i.prop+=e.shift()[1]}i.raws.between="";let s;for(;e.length;)if(s=e.shift(),s[0]===":"){i.raws.between+=s[1];break}else s[0]==="word"&&/\w/.test(s[1])&&this.unknownWord([s]),i.raws.between+=s[1];(i.prop[0]==="_"||i.prop[0]==="*")&&(i.raws.before+=i.prop[0],i.prop=i.prop.slice(1));let o=[],a;for(;e.length&&(a=e[0][0],!(a!=="space"&&a!=="comment"));)o.push(e.shift());this.precheckMissedSemicolon(e);for(let c=e.length-1;c>=0;c--){if(s=e[c],s[1].toLowerCase()==="!important"){i.important=!0;let u=this.stringFrom(e,c);u=this.spacesFromEnd(e)+u,u!==" !important"&&(i.raws.important=u);break}else if(s[1].toLowerCase()==="important"){let u=e.slice(0),f="";for(let p=c;p>0;p--){let m=u[p][0];if(f.trim().indexOf("!")===0&&m!=="space")break;f=u.pop()[1]+f}f.trim().indexOf("!")===0&&(i.important=!0,i.raws.important=f,e=u)}if(s[0]!=="space"&&s[0]!=="comment")break}e.some(c=>c[0]!=="space"&&c[0]!=="comment")&&(i.raws.between+=o.map(c=>c[1]).join(""),o=[]),this.raw(i,"value",o.concat(e),t),i.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}emptyRule(e){let t=new pI;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let t=this.current.nodes[this.current.nodes.length-1];t&&t.type==="rule"&&!t.raws.ownSemicolon&&(t.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{column:t.col,line:t.line,offset:e}}init(e,t){this.current.push(e),e.source={input:this.input,start:this.getPosition(t)},e.raws.before=this.spaces,this.spaces="",e.type!=="comment"&&(this.semicolon=!1)}other(e){let t=!1,i=null,r=!1,s=null,o=[],a=e[1].startsWith("--"),l=[],c=e;for(;c;){if(i=c[0],l.push(c),i==="("||i==="[")s||(s=c),o.push(i==="("?")":"]");else if(a&&r&&i==="{")s||(s=c),o.push("}");else if(o.length===0)if(i===";")if(r){this.decl(l,a);return}else break;else if(i==="{"){this.rule(l);return}else if(i==="}"){this.tokenizer.back(l.pop()),t=!0;break}else i===":"&&(r=!0);else i===o[o.length-1]&&(o.pop(),o.length===0&&(s=null));c=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),o.length>0&&this.unclosedBracket(s),t&&r){if(!a)for(;l.length&&(c=l[l.length-1][0],!(c!=="space"&&c!=="comment"));)this.tokenizer.back(l.pop());this.decl(l,a)}else this.unknownWord(l)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e);break}this.endFile()}precheckMissedSemicolon(){}raw(e,t,i,r){let s,o,a=i.length,l="",c=!0,u,f;for(let p=0;p<a;p+=1)s=i[p],o=s[0],o==="space"&&p===a-1&&!r?c=!1:o==="comment"?(f=i[p-1]?i[p-1][0]:"empty",u=i[p+1]?i[p+1][0]:"empty",!gI[f]&&!gI[u]?l.slice(-1)===","?c=!1:l+=s[1]:c=!1):l+=s[1];if(!c){let p=i.reduce((m,y)=>m+y[1],"");e.raws[t]={raw:p,value:l}}e[t]=l}rule(e){e.pop();let t=new pI;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}spacesAndCommentsFromEnd(e){let t,i="";for(;e.length&&(t=e[e.length-1][0],!(t!=="space"&&t!=="comment"));)i=e.pop()[1]+i;return i}spacesAndCommentsFromStart(e){let t,i="";for(;e.length&&(t=e[0][0],!(t!=="space"&&t!=="comment"));)i+=e.shift()[1];return i}spacesFromEnd(e){let t,i="";for(;e.length&&(t=e[e.length-1][0],t==="space");)i=e.pop()[1]+i;return i}stringFrom(e,t){let i="";for(let r=t;r<e.length;r++)i+=e[r][1];return e.splice(t,e.length-t),i}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unnamedAtrule(e,t){throw this.input.error("At-rule without name",{offset:t[2]},{offset:t[2]+t[1].length})}};var RX=CX;let AX=fu,LX=RX,IX=Q0;function jy(n,e){let t=new IX(n,e),i=new LX(t);try{i.parse()}catch(r){throw r}return i.root}var Qx=jy;jy.default=jy;AX.registerParse(jy);let{isClean:to,my:PX}=wg,DX=WF,OX=Y0,kX=fu,MX=Zx,mI=Yx,NX=Qx,FX=Tg;const BX={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},UX={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},zX={Once:!0,postcssPlugin:!0,prepare:!0},_d=0;function Jf(n){return typeof n=="object"&&typeof n.then=="function"}function hB(n){let e=!1,t=BX[n.type];return n.type==="decl"?e=n.prop.toLowerCase():n.type==="atrule"&&(e=n.name.toLowerCase()),e&&n.append?[t,t+"-"+e,_d,t+"Exit",t+"Exit-"+e]:e?[t,t+"-"+e,t+"Exit",t+"Exit-"+e]:n.append?[t,_d,t+"Exit"]:[t,t+"Exit"]}function vI(n){let e;return n.type==="document"?e=["Document",_d,"DocumentExit"]:n.type==="root"?e=["Root",_d,"RootExit"]:e=hB(n),{eventIndex:0,events:e,iterator:0,node:n,visitorIndex:0,visitors:[]}}function RS(n){return n[to]=!1,n.nodes&&n.nodes.forEach(e=>RS(e)),n}let AS={},Ed=class dB{constructor(e,t,i){this.stringified=!1,this.processed=!1;let r;if(typeof t=="object"&&t!==null&&(t.type==="root"||t.type==="document"))r=RS(t);else if(t instanceof dB||t instanceof mI)r=RS(t.root),t.map&&(typeof i.map>"u"&&(i.map={}),i.map.inline||(i.map.inline=!1),i.map.prev=t.map);else{let s=NX;i.syntax&&(s=i.syntax.parse),i.parser&&(s=i.parser),s.parse&&(s=s.parse);try{r=s(t,i)}catch(o){this.processed=!0,this.error=o}r&&!r[PX]&&kX.rebuild(r)}this.result=new mI(e,r,i),this.helpers={...AS,postcss:AS,result:this.result},this.plugins=this.processor.plugins.map(s=>typeof s=="object"&&s.prepare?{...s,...s.prepare(this.result)}:s)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let i=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,e.name==="CssSyntaxError"&&!e.plugin?(e.plugin=i.postcssPlugin,e.setMessage()):i.postcssVersion}catch(r){console&&console.error&&console.error(r)}return e}prepareVisitors(){this.listeners={};let e=(t,i,r)=>{this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push([t,r])};for(let t of this.plugins)if(typeof t=="object")for(let i in t){if(!UX[i]&&/^[A-Z]/.test(i))throw new Error(`Unknown event ${i} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!zX[i])if(typeof t[i]=="object")for(let r in t[i])r==="*"?e(t,i,t[i][r]):e(t,i+"-"+r.toLowerCase(),t[i][r]);else typeof t[i]=="function"&&e(t,i,t[i])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],i=this.runOnRoot(t);if(Jf(i))try{await i}catch(r){throw this.handleError(r)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[to];){e[to]=!0;let t=[vI(e)];for(;t.length>0;){let i=this.visitTick(t);if(Jf(i))try{await i}catch(r){let s=t[t.length-1].node;throw this.handleError(r,s)}}}if(this.listeners.OnceExit)for(let[t,i]of this.listeners.OnceExit){this.result.lastPlugin=t;try{if(e.type==="document"){let r=e.nodes.map(s=>i(s,this.helpers));await Promise.all(r)}else await i(e,this.helpers)}catch(r){throw this.handleError(r)}}}return this.processed=!0,this.stringify()}runOnRoot(e){this.result.lastPlugin=e;try{if(typeof e=="object"&&e.Once){if(this.result.root.type==="document"){let t=this.result.root.nodes.map(i=>e.Once(i,this.helpers));return Jf(t[0])?Promise.all(t):t}return e.Once(this.result.root,this.helpers)}else if(typeof e=="function")return e(this.result.root,this.result)}catch(t){throw this.handleError(t)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=OX;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let r=new DX(t,this.result.root,this.result.opts).generate();return this.result.css=r[0],this.result.map=r[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins){let t=this.runOnRoot(e);if(Jf(t))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[to];)e[to]=!0,this.walkSync(e);if(this.listeners.OnceExit)if(e.type==="document")for(let t of e.nodes)this.visitSync(this.listeners.OnceExit,t);else this.visitSync(this.listeners.OnceExit,e)}return this.result}then(e,t){return this.async().then(e,t)}toString(){return this.css}visitSync(e,t){for(let[i,r]of e){this.result.lastPlugin=i;let s;try{s=r(t,this.helpers)}catch(o){throw this.handleError(o,t.proxyOf)}if(t.type!=="root"&&t.type!=="document"&&!t.parent)return!0;if(Jf(s))throw this.getAsyncError()}}visitTick(e){let t=e[e.length-1],{node:i,visitors:r}=t;if(i.type!=="root"&&i.type!=="document"&&!i.parent){e.pop();return}if(r.length>0&&t.visitorIndex<r.length){let[o,a]=r[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===r.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=o;try{return a(i.toProxy(),this.helpers)}catch(l){throw this.handleError(l,i)}}if(t.iterator!==0){let o=t.iterator,a;for(;a=i.nodes[i.indexes[o]];)if(i.indexes[o]+=1,!a[to]){a[to]=!0,e.push(vI(a));return}t.iterator=0,delete i.indexes[o]}let s=t.events;for(;t.eventIndex<s.length;){let o=s[t.eventIndex];if(t.eventIndex+=1,o===_d){i.nodes&&i.nodes.length&&(i[to]=!0,t.iterator=i.getIterator());return}else if(this.listeners[o]){t.visitors=this.listeners[o];return}}e.pop()}walkSync(e){e[to]=!0;let t=hB(e);for(let i of t)if(i===_d)e.nodes&&e.each(r=>{r[to]||this.walkSync(r)});else{let r=this.listeners[i];if(r&&this.visitSync(r,e.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};Ed.registerPostcss=n=>{AS=n};var fB=Ed;Ed.default=Ed;FX.registerLazyResult(Ed);MX.registerLazyResult(Ed);let GX=WF,HX=Y0,$X=Qx;const VX=Yx;let LS=class{constructor(e,t,i){t=t.toString(),this.stringified=!1,this._processor=e,this._css=t,this._opts=i,this._map=void 0;let r,s=HX;this.result=new VX(this._processor,r,this._opts),this.result.css=t;let o=this;Object.defineProperty(this.result,"root",{get(){return o.root}});let a=new GX(s,r,this._opts,t);if(a.isMap()){let[l,c]=a.generate();l&&(this.result.css=l),c&&(this.result.map=c)}else a.clearAnnotation(),this.result.css=a.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}sync(){if(this.error)throw this.error;return this.result}then(e,t){return this.async().then(e,t)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let e,t=$X;try{e=t(this._css,this._opts)}catch(i){this.error=i}if(this.error)throw this.error;return this._root=e,e}get[Symbol.toStringTag](){return"NoWorkResult"}};var jX=LS;LS.default=LS;let WX=jX,qX=fB,KX=Zx,ZX=Tg,$p=class{constructor(e=[]){this.version="8.4.38",this.plugins=this.normalize(e)}normalize(e){let t=[];for(let i of e)if(i.postcss===!0?i=i():i.postcss&&(i=i.postcss),typeof i=="object"&&Array.isArray(i.plugins))t=t.concat(i.plugins);else if(typeof i=="object"&&i.postcssPlugin)t.push(i);else if(typeof i=="function")t.push(i);else if(!(typeof i=="object"&&(i.parse||i.stringify)))throw new Error(i+" is not a PostCSS plugin");return t}process(e,t={}){return!this.plugins.length&&!t.parser&&!t.stringifier&&!t.syntax?new WX(this,e,t):new qX(this,e,t)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}};var YX=$p;$p.default=$p;ZX.registerProcessor($p);KX.registerProcessor($p);let XX=J0,JX=GF,QX=e_,eJ=Xx,tJ=Q0,iJ=Tg,nJ=Jx;function Vp(n,e){if(Array.isArray(n))return n.map(r=>Vp(r));let{inputs:t,...i}=n;if(t){e=[];for(let r of t){let s={...r,__proto__:tJ.prototype};s.map&&(s.map={...s.map,__proto__:JX.prototype}),e.push(s)}}if(i.nodes&&(i.nodes=n.nodes.map(r=>Vp(r,e))),i.source){let{inputId:r,...s}=i.source;i.source=s,r!=null&&(i.source.input=e[r])}if(i.type==="root")return new iJ(i);if(i.type==="decl")return new XX(i);if(i.type==="rule")return new nJ(i);if(i.type==="comment")return new QX(i);if(i.type==="atrule")return new eJ(i);throw new Error("Unknown node type: "+n.type)}var rJ=Vp;Vp.default=Vp;let sJ=Wx,pB=J0,oJ=fB,aJ=fu,e1=YX,lJ=Y0,cJ=rJ,gB=Zx,uJ=rB,mB=e_,vB=Xx,hJ=Yx,dJ=Q0,fJ=Qx,pJ=cB,yB=Jx,_B=Tg,gJ=X0;function ri(...n){return n.length===1&&Array.isArray(n[0])&&(n=n[0]),new e1(n)}ri.plugin=function(e,t){let i=!1;function r(...o){console&&console.warn&&!i&&(i=!0,console.warn(e+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),VR.LANG&&VR.LANG.startsWith("cn")&&console.warn(e+`: 里面 postcss.plugin 被弃用. 迁移指南:
https://www.w3ctech.com/topic/2226`));let a=t(...o);return a.postcssPlugin=e,a.postcssVersion=new e1().version,a}let s;return Object.defineProperty(r,"postcss",{get(){return s||(s=r()),s}}),r.process=function(o,a,l){return ri([r(l)]).process(o,a)},r};ri.stringify=lJ;ri.parse=fJ;ri.fromJSON=cJ;ri.list=pJ;ri.comment=n=>new mB(n);ri.atRule=n=>new vB(n);ri.decl=n=>new pB(n);ri.rule=n=>new yB(n);ri.root=n=>new _B(n);ri.document=n=>new gB(n);ri.CssSyntaxError=sJ;ri.Declaration=pB;ri.Container=aJ;ri.Processor=e1;ri.Document=gB;ri.Comment=mB;ri.Warning=uJ;ri.AtRule=vB;ri.Result=hJ;ri.Input=dJ;ri.Rule=yB;ri.Root=_B;ri.Node=gJ;oJ.registerPostcss(ri);var mJ=ri;ri.default=ri;const vJ=cF,yI=gY,{isPlainObject:yJ}=Vx,_I=IY,_J=PY,{parse:EJ}=mJ,wJ=["img","audio","video","picture","svg","object","map","iframe","embed"],TJ=["script","style"];function ap(n,e){n&&Object.keys(n).forEach(function(t){e(n[t],t)})}function Jo(n,e){return{}.hasOwnProperty.call(n,e)}function EI(n,e){const t=[];return ap(n,function(i){e(i)&&t.push(i)}),t}function SJ(n){for(const e in n)if(Jo(n,e))return!1;return!0}function bJ(n){return n.map(function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")}).join(", ")}var xJ=jp;const CJ=/^[^\0\t\n\f\r /<=>]+$/;function jp(n,e,t){if(n==null)return"";typeof n=="number"&&(n=n.toString());let i="",r="";function s(W,ie){const ne=this;this.tag=W,this.attribs=ie||{},this.tagPosition=i.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(w.length){const J=w[w.length-1];J.text+=ne.text}},this.updateParentNodeMediaChildren=function(){w.length&&wJ.includes(this.tag)&&w[w.length-1].mediaChildren.push(this.tag)}}e=Object.assign({},jp.defaults,e),e.parser=Object.assign({},RJ,e.parser);const o=function(W){return e.allowedTags===!1||(e.allowedTags||[]).indexOf(W)>-1};TJ.forEach(function(W){o(W)&&!e.allowVulnerableTags&&console.warn(`

⚠️ Your \`allowedTags\` option includes, \`${W}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const a=e.nonTextTags||["script","style","textarea","option"];let l,c;e.allowedAttributes&&(l={},c={},ap(e.allowedAttributes,function(W,ie){l[ie]=[];const ne=[];W.forEach(function(J){typeof J=="string"&&J.indexOf("*")>=0?ne.push(yI(J).replace(/\\\*/g,".*")):l[ie].push(J)}),ne.length&&(c[ie]=new RegExp("^("+ne.join("|")+")$"))}));const u={},f={},p={};ap(e.allowedClasses,function(W,ie){if(l&&(Jo(l,ie)||(l[ie]=[]),l[ie].push("class")),u[ie]=W,Array.isArray(W)){const ne=[];u[ie]=[],p[ie]=[],W.forEach(function(J){typeof J=="string"&&J.indexOf("*")>=0?ne.push(yI(J).replace(/\\\*/g,".*")):J instanceof RegExp?p[ie].push(J):u[ie].push(J)}),ne.length&&(f[ie]=new RegExp("^("+ne.join("|")+")$"))}});const m={};let y;ap(e.transformTags,function(W,ie){let ne;typeof W=="function"?ne=W:typeof W=="string"&&(ne=jp.simpleTransform(W)),ie==="*"?y=ne:m[ie]=ne});let _,w,T,x,C,I,D=!1;N();const B=new vJ.Parser({onopentag:function(W,ie){if(e.enforceHtmlBoundary&&W==="html"&&N(),C){I++;return}const ne=new s(W,ie);w.push(ne);let J=!1;const ce=!!ne.text;let se;if(Jo(m,W)&&(se=m[W](W,ie),ne.attribs=ie=se.attribs,se.text!==void 0&&(ne.innerText=se.text),W!==se.tagName&&(ne.name=W=se.tagName,x[_]=se.tagName)),y&&(se=y(W,ie),ne.attribs=ie=se.attribs,W!==se.tagName&&(ne.name=W=se.tagName,x[_]=se.tagName)),(!o(W)||e.disallowedTagsMode==="recursiveEscape"&&!SJ(T)||e.nestingLimit!=null&&_>=e.nestingLimit)&&(J=!0,T[_]=!0,(e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard")&&a.indexOf(W)!==-1&&(C=!0,I=1),T[_]=!0),_++,J){if(e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard")return;r=i,i=""}i+="<"+W,W==="script"&&(e.allowedScriptHostnames||e.allowedScriptDomains)&&(ne.innerText=""),(!l||Jo(l,W)||l["*"])&&ap(ie,function(te,Q){if(!CJ.test(Q)){delete ne.attribs[Q];return}if(te===""&&!e.allowedEmptyAttributes.includes(Q)&&(e.nonBooleanAttributes.includes(Q)||e.nonBooleanAttributes.includes("*"))){delete ne.attribs[Q];return}let _e=!1;if(!l||Jo(l,W)&&l[W].indexOf(Q)!==-1||l["*"]&&l["*"].indexOf(Q)!==-1||Jo(c,W)&&c[W].test(Q)||c["*"]&&c["*"].test(Q))_e=!0;else if(l&&l[W]){for(const fe of l[W])if(yJ(fe)&&fe.name&&fe.name===Q){_e=!0;let pe="";if(fe.multiple===!0){const Ce=te.split(" ");for(const xe of Ce)fe.values.indexOf(xe)!==-1&&(pe===""?pe=xe:pe+=" "+xe)}else fe.values.indexOf(te)>=0&&(pe=te);te=pe}}if(_e){if(e.allowedSchemesAppliedToAttributes.indexOf(Q)!==-1&&Z(W,te)){delete ne.attribs[Q];return}if(W==="script"&&Q==="src"){let fe=!0;try{const pe=q(te);if(e.allowedScriptHostnames||e.allowedScriptDomains){const Ce=(e.allowedScriptHostnames||[]).find(function(Le){return Le===pe.url.hostname}),xe=(e.allowedScriptDomains||[]).find(function(Le){return pe.url.hostname===Le||pe.url.hostname.endsWith(`.${Le}`)});fe=Ce||xe}}catch{fe=!1}if(!fe){delete ne.attribs[Q];return}}if(W==="iframe"&&Q==="src"){let fe=!0;try{const pe=q(te);if(pe.isRelativeUrl)fe=Jo(e,"allowIframeRelativeUrls")?e.allowIframeRelativeUrls:!e.allowedIframeHostnames&&!e.allowedIframeDomains;else if(e.allowedIframeHostnames||e.allowedIframeDomains){const Ce=(e.allowedIframeHostnames||[]).find(function(Le){return Le===pe.url.hostname}),xe=(e.allowedIframeDomains||[]).find(function(Le){return pe.url.hostname===Le||pe.url.hostname.endsWith(`.${Le}`)});fe=Ce||xe}}catch{fe=!1}if(!fe){delete ne.attribs[Q];return}}if(Q==="srcset")try{let fe=_J(te);if(fe.forEach(function(pe){Z("srcset",pe.url)&&(pe.evil=!0)}),fe=EI(fe,function(pe){return!pe.evil}),fe.length)te=bJ(EI(fe,function(pe){return!pe.evil})),ne.attribs[Q]=te;else{delete ne.attribs[Q];return}}catch{delete ne.attribs[Q];return}if(Q==="class"){const fe=u[W],pe=u["*"],Ce=f[W],xe=p[W],Le=f["*"],je=[Ce,Le].concat(xe).filter(function(Ke){return Ke});if(fe&&pe?te=le(te,_I(fe,pe),je):te=le(te,fe||pe,je),!te.length){delete ne.attribs[Q];return}}if(Q==="style"){if(e.parseStyleAttributes)try{const fe=EJ(W+" {"+te+"}",{map:!1}),pe=H(fe,e.allowedStyles);if(te=Y(pe),te.length===0){delete ne.attribs[Q];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+W+" {"+te+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete ne.attribs[Q];return}else if(e.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}i+=" "+Q,te&&te.length?i+='="'+z(te,!0)+'"':e.allowedEmptyAttributes.includes(Q)&&(i+='=""')}else delete ne.attribs[Q]}),e.selfClosing.indexOf(W)!==-1?i+=" />":(i+=">",ne.innerText&&!ce&&!e.textFilter&&(i+=z(ne.innerText),D=!0)),J&&(i=r+z(i),r="")},ontext:function(W){if(C)return;const ie=w[w.length-1];let ne;if(ie&&(ne=ie.tag,W=ie.innerText!==void 0?ie.innerText:W),e.disallowedTagsMode==="completelyDiscard"&&!o(ne))W="";else if((e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard")&&(ne==="script"||ne==="style"))i+=W;else{const J=z(W,!1);e.textFilter&&!D?i+=e.textFilter(J,ne):D||(i+=J)}if(w.length){const J=w[w.length-1];J.text+=W}},onclosetag:function(W,ie){if(C)if(I--,!I)C=!1;else return;const ne=w.pop();if(!ne)return;if(ne.tag!==W){w.push(ne);return}C=e.enforceHtmlBoundary?W==="html":!1,_--;const J=T[_];if(J){if(delete T[_],e.disallowedTagsMode==="discard"||e.disallowedTagsMode==="completelyDiscard"){ne.updateParentNodeText();return}r=i,i=""}if(x[_]&&(W=x[_],delete x[_]),e.exclusiveFilter&&e.exclusiveFilter(ne)){i=i.substr(0,ne.tagPosition);return}if(ne.updateParentNodeMediaChildren(),ne.updateParentNodeText(),e.selfClosing.indexOf(W)!==-1||ie&&!o(W)&&["escape","recursiveEscape"].indexOf(e.disallowedTagsMode)>=0){J&&(i=r,r="");return}i+="</"+W+">",J&&(i=r+z(i),r=""),D=!1}},e.parser);return B.write(n),B.end(),i;function N(){i="",_=0,w=[],T={},x={},C=!1,I=0}function z(W,ie){return typeof W!="string"&&(W=W+""),e.parser.decodeEntities&&(W=W.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ie&&(W=W.replace(/"/g,"&quot;"))),W=W.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ie&&(W=W.replace(/"/g,"&quot;")),W}function Z(W,ie){for(ie=ie.replace(/[\x00-\x20]+/g,"");;){const ce=ie.indexOf("<!--");if(ce===-1)break;const se=ie.indexOf("-->",ce+4);if(se===-1)break;ie=ie.substring(0,ce)+ie.substring(se+3)}const ne=ie.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!ne)return ie.match(/^[/\\]{2}/)?!e.allowProtocolRelative:!1;const J=ne[1].toLowerCase();return Jo(e.allowedSchemesByTag,W)?e.allowedSchemesByTag[W].indexOf(J)===-1:!e.allowedSchemes||e.allowedSchemes.indexOf(J)===-1}function q(W){if(W=W.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),W.startsWith("relative:"))throw new Error("relative: exploit attempt");let ie="relative://relative-site";for(let ce=0;ce<100;ce++)ie+=`/${ce}`;const ne=new URL(W,ie);return{isRelativeUrl:ne&&ne.hostname==="relative-site"&&ne.protocol==="relative:",url:ne}}function H(W,ie){if(!ie)return W;const ne=W.nodes[0];let J;return ie[ne.selector]&&ie["*"]?J=_I(ie[ne.selector],ie["*"]):J=ie[ne.selector]||ie["*"],J&&(W.nodes[0].nodes=ne.nodes.reduce(ee(J),[])),W}function Y(W){return W.nodes[0].nodes.reduce(function(ie,ne){return ie.push(`${ne.prop}:${ne.value}${ne.important?" !important":""}`),ie},[]).join(";")}function ee(W){return function(ie,ne){return Jo(W,ne.prop)&&W[ne.prop].some(function(ce){return ce.test(ne.value)})&&ie.push(ne),ie}}function le(W,ie,ne){return ie?(W=W.split(/\s+/),W.filter(function(J){return ie.indexOf(J)!==-1||ne.some(function(ce){return ce.test(J)})}).join(" ")):W}}const RJ={decodeEntities:!0};jp.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},allowedEmptyAttributes:["alt"],selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};jp.simpleTransform=function(n,e,t){return t=t===void 0?!0:t,e=e||{},function(i,r){let s;if(t)for(s in e)r[s]=e[s];else r=e;return{tagName:n,attribs:r}}};const AJ=hu(xJ);function LJ(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var EB={exports:{}};(function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=a.normalizePath(f.path),a.buildURLFromParts(f)}var p=a.parseURL(c);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return u.alwaysNormalize?(p.path=a.normalizePath(p.path),a.buildURLFromParts(p)):c;var m=a.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var y=r.exec(m.path);m.netLoc=y[1],m.path=y[2]}m.netLoc&&!m.path&&(m.path="/");var _={scheme:m.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(_.netLoc=m.netLoc,p.path[0]!=="/"))if(!p.path)_.path=m.path,p.params||(_.params=m.params,p.query||(_.query=m.query));else{var w=m.path,T=w.substring(0,w.lastIndexOf("/")+1)+p.path;_.path=a.normalizePath(T)}return _.path===null&&(_.path=u.alwaysNormalize?a.normalizePath(p.path):p.path),a.buildURLFromParts(_)},parseURL:function(l){var c=i.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()})(EB);var t1=EB.exports;function wI(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function gn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wI(Object(t),!0).forEach(function(i){DJ(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wI(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function IJ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function PJ(n){var e=IJ(n,"string");return typeof e=="symbol"?e:String(e)}function DJ(n,e,t){return e=PJ(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Vi(){return Vi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Vi.apply(this,arguments)}const Je=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},OJ=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=kJ},kJ=Number.MAX_SAFE_INTEGER||9007199254740991;let $=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n}({}),_t=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),be=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const Dc=function(){},IS={trace:Dc,debug:Dc,log:Dc,warn:Dc,info:Dc,error:Dc};let gp=IS;function MJ(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):Dc}function NJ(n,...e){e.forEach(function(t){gp[t]=n[t]?n[t].bind(n):MJ(t)})}function FJ(n,e){if(typeof console=="object"&&n===!0||typeof n=="object"){NJ(n,"debug","log","info","warn","error");try{gp.log(`Debug logs enabled for "${e}" in hls.js version 1.5.11`)}catch{gp=IS}}else gp=IS}const ge=gp,BJ=/^(\d+)x(\d+)$/,TI=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Li{constructor(e){typeof e=="string"&&(e=Li.parseAttrList(e)),Vi(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=BJ.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const i={},r='"';for(TI.lastIndex=0;(t=TI.exec(e))!==null;){let s=t[2];s.indexOf(r)===0&&s.lastIndexOf(r)===s.length-1&&(s=s.slice(1,-1));const o=t[1].trim();i[o]=s}return i}}function UJ(n){return n!=="ID"&&n!=="CLASS"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function zJ(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"}class wB{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const i=t.attr;for(const r in i)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==i[r]){ge.warn(`DATERANGE tag attribute: "${r}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=r;break}e=Vi(new Li({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);Je(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Je(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&Je(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class t_{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ni={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class TB{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ni.AUDIO]:null,[ni.VIDEO]:null,[ni.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=t1.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Mw extends TB{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new t_,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!Je(this.programDateTime))return null;const e=Je(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ni.AUDIO]=null,e[ni.VIDEO]=null,e[ni.AUDIOVIDEO]=null}}class GJ extends TB{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new t_,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const HJ=10;class $J{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?Je(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||HJ}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function i1(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function VJ(n){const e=PS(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function jJ(n){const e=function(i,r,s){const o=i[r];i[r]=i[s],i[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function WJ(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",o=r[1];s?(i.splice(-1,1),t=i1(o)):t=VJ(o)}}return t}function PS(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}const wd=typeof self<"u"?self:void 0;var bi={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},fr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function SI(n){switch(n){case fr.FAIRPLAY:return bi.FAIRPLAY;case fr.PLAYREADY:return bi.PLAYREADY;case fr.WIDEVINE:return bi.WIDEVINE;case fr.CLEARKEY:return bi.CLEARKEY}}var SB={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function qJ(n){if(n===SB.WIDEVINE)return bi.WIDEVINE}function bI(n){switch(n){case bi.FAIRPLAY:return fr.FAIRPLAY;case bi.PLAYREADY:return fr.PLAYREADY;case bi.WIDEVINE:return fr.WIDEVINE;case bi.CLEARKEY:return fr.CLEARKEY}}function Nw(n){const{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[bi.FAIRPLAY,bi.WIDEVINE,bi.PLAYREADY,bi.CLEARKEY].filter(r=>!!e[r]):[];return!i[bi.WIDEVINE]&&t&&i.push(bi.WIDEVINE),i}const bB=function(n){return wd!=null&&(n=wd.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function KJ(n,e,t,i){let r;switch(n){case bi.FAIRPLAY:r=["cenc","sinf"];break;case bi.WIDEVINE:case bi.PLAYREADY:r=["cenc"];break;case bi.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return ZJ(r,e,t,i)}function ZJ(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Kc(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const n1=(n,e)=>e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,xB=(n,e)=>e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Wp=(n,e)=>{const t=e;let i=0;for(;n1(n,e);){i+=10;const r=i_(n,e+6);i+=r,xB(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)},i_=(n,e)=>{let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t},YJ=(n,e)=>n1(n,e)&&i_(n,e+6)+10<=n.length-e,r1=n=>{const e=RB(n);for(let t=0;t<e.length;t++){const i=e[t];if(CB(i))return iQ(i)}},CB=n=>n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp",XJ=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=i_(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}},RB=n=>{let e=0;const t=[];for(;n1(n,e);){const i=i_(n,e+6);e+=10;const r=e+i;for(;e+8<r;){const s=XJ(n.subarray(e)),o=JJ(s);o&&t.push(o),e+=s.size+10}xB(n,e)&&(e+=10)}return t},JJ=n=>n.type==="PRIV"?QJ(n):n.type[0]==="W"?tQ(n):eQ(n),QJ=n=>{if(n.size<2)return;const e=uo(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},eQ=n=>{if(n.size<2)return;if(n.type==="TXXX"){let t=1;const i=uo(n.data.subarray(t),!0);t+=i.length+1;const r=uo(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=uo(n.data.subarray(1));return{key:n.type,data:e}},tQ=n=>{if(n.type==="WXXX"){if(n.size<2)return;let t=1;const i=uo(n.data.subarray(t),!0);t+=i.length+1;const r=uo(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=uo(n.data);return{key:n.type,data:e}},iQ=n=>{if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}},uo=(n,e=!1)=>{const t=nQ();if(t){const c=t.decode(n);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const i=n.length;let r,s,o,a="",l=0;for(;l<i;){if(r=n[l++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:s=n[l++],a+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[l++],o=n[l++],a+=String.fromCharCode((r&15)<<12|(s&63)<<6|(o&63)<<0);break}}return a};let Fw;function nQ(){if(!navigator.userAgent.includes("PlayStation 4"))return!Fw&&typeof self.TextDecoder<"u"&&(Fw=new self.TextDecoder("utf-8")),Fw}const io={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}},Wy=Math.pow(2,32)-1,rQ=[].push,AB={video:1,audio:2,id3:3,text:4};function Yi(n){return String.fromCharCode.apply(null,n)}function LB(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function gt(n,e){const t=IB(n,e);return t<0?4294967296+t:t}function xI(n,e){let t=gt(n,e);return t*=Math.pow(2,32),t+=gt(n,e+4),t}function IB(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Bw(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function sQ(n){const e=n.byteLength;for(let t=0;t<e;){const i=gt(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Lt(n,e){const t=[];if(!e.length)return t;const i=n.byteLength;for(let r=0;r<i;){const s=gt(n,r),o=Yi(n.subarray(r+4,r+8)),a=s>1?r+s:i;if(o===e[0])if(e.length===1)t.push(n.subarray(r+8,a));else{const l=Lt(n.subarray(r+8,a),e.slice(1));l.length&&rQ.apply(t,l)}r=a}return t}function oQ(n){const e=[],t=n[0];let i=8;const r=gt(n,i);i+=4;let s=0,o=0;t===0?(s=gt(n,i),o=gt(n,i+4),i+=8):(s=xI(n,i),o=xI(n,i+8),i+=16),i+=2;let a=n.length+o;const l=LB(n,i);i+=2;for(let c=0;c<l;c++){let u=i;const f=gt(n,u);u+=4;const p=f&2147483647;if((f&2147483648)>>>31===1)return ge.warn("SIDX has hierarchical references (not supported)"),null;const y=gt(n,u);u+=4,e.push({referenceSize:p,subsegmentDuration:y,info:{duration:y/r,start:a,end:a+p-1}}),a+=p,u+=4,i=u}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function PB(n){const e=[],t=Lt(n,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],o=Lt(s,["tkhd"])[0];if(o){let a=o[0];const l=gt(o,a===0?12:20),c=Lt(s,["mdia","mdhd"])[0];if(c){a=c[0];const u=gt(c,a===0?12:20),f=Lt(s,["mdia","hdlr"])[0];if(f){const p=Yi(f.subarray(8,12)),m={soun:ni.AUDIO,vide:ni.VIDEO}[p];if(m){const y=Lt(s,["mdia","minf","stbl","stsd"])[0],_=aQ(y);e[l]={timescale:u,type:m},e[m]=gn({timescale:u,id:l},_)}}}}}return Lt(n,["moov","mvex","trex"]).forEach(r=>{const s=gt(r,4),o=e[s];o&&(o.default={duration:gt(r,12),flags:gt(r,20)})}),e}function aQ(n){const e=n.subarray(8),t=e.subarray(86),i=Yi(e.subarray(4,8));let r=i;const s=i==="enca"||i==="encv";if(s){const a=Lt(e,[i])[0].subarray(i==="enca"?28:78);Lt(a,["sinf"]).forEach(c=>{const u=Lt(c,["schm"])[0];if(u){const f=Yi(u.subarray(4,8));if(f==="cbcs"||f==="cenc"){const p=Lt(c,["frma"])[0];p&&(r=Yi(p))}}})}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const o=Lt(t,["avcC"])[0];r+="."+yv(o[1])+yv(o[2])+yv(o[3]);break}case"mp4a":{const o=Lt(e,[i])[0],a=Lt(o.subarray(28),["esds"])[0];if(a&&a.length>12){let l=4;if(a[l++]!==3)break;l=Uw(a,l),l+=2;const c=a[l++];if(c&128&&(l+=2),c&64&&(l+=a[l++]),a[l++]!==4)break;l=Uw(a,l);const u=a[l++];if(u===64)r+="."+yv(u);else break;if(l+=12,a[l++]!==5)break;l=Uw(a,l);const f=a[l++];let p=(f&248)>>3;p===31&&(p+=1+((f&7)<<3)+((a[l]&224)>>5)),r+="."+p}break}case"hvc1":case"hev1":{const o=Lt(t,["hvcC"])[0],a=o[1],l=["","A","B","C"][a>>6],c=a&31,u=gt(o,2),f=(a&32)>>5?"H":"L",p=o[12],m=o.subarray(6,12);r+="."+l+c,r+="."+u.toString(16).toUpperCase(),r+="."+f+p;let y="";for(let _=m.length;_--;){const w=m[_];(w||y)&&(y="."+w.toString(16).toUpperCase()+y)}r+=y;break}case"dvh1":case"dvhe":{const o=Lt(t,["dvcC"])[0],a=o[2]>>1&127,l=o[2]<<5&32|o[3]>>3&31;r+="."+Qs(a)+"."+Qs(l);break}case"vp09":{const o=Lt(t,["vpcC"])[0],a=o[4],l=o[5],c=o[6]>>4&15;r+="."+Qs(a)+"."+Qs(l)+"."+Qs(c);break}case"av01":{const o=Lt(t,["av1C"])[0],a=o[1]>>>5,l=o[1]&31,c=o[2]>>>7?"H":"M",u=(o[2]&64)>>6,f=(o[2]&32)>>5,p=a===2&&u?f?12:10:u?10:8,m=(o[2]&16)>>4,y=(o[2]&8)>>3,_=(o[2]&4)>>2,w=o[2]&3;r+="."+a+"."+Qs(l)+c+"."+Qs(p)+"."+m+"."+y+_+w+"."+Qs(1)+"."+Qs(1)+"."+Qs(1)+"."+0;break}}return{codec:r,encrypted:s}}function Uw(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function yv(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Qs(n){return(n<10?"0":"")+n}function lQ(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&Lt(n,["moov","trak"]).forEach(r=>{const o=Lt(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Lt(o,["enca"]);const l=a.length>0;l||(a=Lt(o,["encv"])),a.forEach(c=>{const u=l?c.subarray(28):c.subarray(78);Lt(u,["sinf"]).forEach(p=>{const m=DB(p);if(m){const y=m.subarray(8,24);y.some(_=>_!==0)||(ge.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${io.hexDump(y)} -> ${io.hexDump(t)}`),m.set(t,8))}})})}),n}function DB(n){const e=Lt(n,["schm"])[0];if(e){const t=Yi(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Lt(n,["schi","tenc"])[0]}return ge.error("[eme] missing 'schm' box"),null}function cQ(n,e){return Lt(e,["moof","traf"]).reduce((t,i)=>{const r=Lt(i,["tfdt"])[0],s=r[0],o=Lt(i,["tfhd"]).reduce((a,l)=>{const c=gt(l,4),u=n[c];if(u){let f=gt(r,4);if(s===1){if(f===Wy)return ge.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;f*=Wy+1,f+=gt(r,8)}const p=u.timescale||9e4,m=f/p;if(Je(m)&&(a===null||m<a))return m}return a},null);return o!==null&&Je(o)&&(t===null||o<t)?o:t},null)}function uQ(n,e){let t=0,i=0,r=0;const s=Lt(n,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],l=Lt(a,["tfhd"])[0],c=gt(l,4),u=e[c];if(!u)continue;const f=u.default,p=gt(l,0)|(f==null?void 0:f.flags);let m=f==null?void 0:f.duration;p&8&&(p&2?m=gt(l,12):m=gt(l,8));const y=u.timescale||9e4,_=Lt(a,["trun"]);for(let w=0;w<_.length;w++){if(t=hQ(_[w]),!t&&m){const T=gt(_[w],4);t=m*T}u.type===ni.VIDEO?i+=t/y:u.type===ni.AUDIO&&(r+=t/y)}}if(i===0&&r===0){let o=1/0,a=0,l=0;const c=Lt(n,["sidx"]);for(let u=0;u<c.length;u++){const f=oQ(c[u]);if(f!=null&&f.references){o=Math.min(o,f.earliestPresentationTime/f.timescale);const p=f.references.reduce((m,y)=>m+y.info.duration||0,0);a=Math.max(a,p+f.earliestPresentationTime/f.timescale),l=a-o}}if(l&&Je(l))return l}return i||r}function hQ(n){const e=gt(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const r=gt(n,4);for(let s=0;s<r;s++){if(e&256){const o=gt(n,t);i+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return i}function dQ(n,e,t){Lt(e,["moof","traf"]).forEach(i=>{Lt(i,["tfhd"]).forEach(r=>{const s=gt(r,4),o=n[s];if(!o)return;const a=o.timescale||9e4;Lt(i,["tfdt"]).forEach(l=>{const c=l[0],u=t*a;if(u){let f=gt(l,4);if(c===0)f-=u,f=Math.max(f,0),Bw(l,4,f);else{f*=Math.pow(2,32),f+=gt(l,8),f-=u,f=Math.max(f,0);const p=Math.floor(f/(Wy+1)),m=Math.floor(f%(Wy+1));Bw(l,4,p),Bw(l,8,m)}}})})})}function fQ(n){const e={valid:null,remainder:null},t=Lt(n,["moof"]);if(t.length<2)return e.remainder=n,e;const i=t[t.length-1];return e.valid=Kc(n,0,i.byteOffset-8),e.remainder=Kc(n,i.byteOffset-8),e}function rs(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function CI(n,e){const t=[],i=e.samples,r=e.timescale,s=e.id;let o=!1;return Lt(i,["moof"]).map(l=>{const c=l.byteOffset-8;Lt(l,["traf"]).map(f=>{const p=Lt(f,["tfdt"]).map(m=>{const y=m[0];let _=gt(m,4);return y===1&&(_*=Math.pow(2,32),_+=gt(m,8)),_/r})[0];return p!==void 0&&(n=p),Lt(f,["tfhd"]).map(m=>{const y=gt(m,4),_=gt(m,0)&16777215,w=(_&1)!==0,T=(_&2)!==0,x=(_&8)!==0;let C=0;const I=(_&16)!==0;let D=0;const B=(_&32)!==0;let N=8;y===s&&(w&&(N+=8),T&&(N+=4),x&&(C=gt(m,N),N+=4),I&&(D=gt(m,N),N+=4),B&&(N+=4),e.type==="video"&&(o=pQ(e.codec)),Lt(f,["trun"]).map(z=>{const Z=z[0],q=gt(z,0)&16777215,H=(q&1)!==0;let Y=0;const ee=(q&4)!==0,le=(q&256)!==0;let W=0;const ie=(q&512)!==0;let ne=0;const J=(q&1024)!==0,ce=(q&2048)!==0;let se=0;const te=gt(z,4);let Q=8;H&&(Y=gt(z,Q),Q+=4),ee&&(Q+=4);let _e=Y+c;for(let fe=0;fe<te;fe++){if(le?(W=gt(z,Q),Q+=4):W=C,ie?(ne=gt(z,Q),Q+=4):ne=D,J&&(Q+=4),ce&&(Z===0?se=gt(z,Q):se=IB(z,Q),Q+=4),e.type===ni.VIDEO){let pe=0;for(;pe<ne;){const Ce=gt(i,_e);if(_e+=4,gQ(o,i[_e])){const xe=i.subarray(_e,_e+Ce);OB(xe,o?2:1,n+se/r,t)}_e+=Ce,pe+=Ce+4}}n+=W/r}}))})})}),t}function pQ(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function gQ(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function OB(n,e,t,i){const r=kB(n);let s=0;s+=e;let o=0,a=0,l=0;for(;s<r.length;){o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);const c=r.length-s;let u=s;if(a<c)s+=a;else if(a>c){ge.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(r[u++]===181){const p=LB(r,u);if(u+=2,p===49){const m=gt(r,u);if(u+=4,m===1195456820){const y=r[u++];if(y===3){const _=r[u++],w=31&_,T=64&_,x=T?2+w*3:0,C=new Uint8Array(x);if(T){C[0]=_;for(let I=1;I<x;I++)C[I]=r[u++]}i.push({type:y,payloadType:o,pts:t,bytes:C})}}}}}else if(o===5&&a>16){const f=[];for(let y=0;y<16;y++){const _=r[u++].toString(16);f.push(_.length==1?"0"+_:_),(y===3||y===5||y===7||y===9)&&f.push("-")}const p=a-16,m=new Uint8Array(p);for(let y=0;y<p;y++)m[y]=r[u++];i.push({payloadType:o,pts:t,uuid:f.join(""),userData:uo(m),userDataBytes:m})}}}function kB(n){const e=n.byteLength,t=[];let i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;const r=e-t.length,s=new Uint8Array(r);let o=0;for(i=0;i<r;o++,i++)o===t[0]&&(o++,t.shift()),s[i]=n[o];return s}function mQ(n){const e=n[0];let t="",i="",r=0,s=0,o=0,a=0,l=0,c=0;if(e===0){for(;Yi(n.subarray(c,c+1))!=="\0";)t+=Yi(n.subarray(c,c+1)),c+=1;for(t+=Yi(n.subarray(c,c+1)),c+=1;Yi(n.subarray(c,c+1))!=="\0";)i+=Yi(n.subarray(c,c+1)),c+=1;i+=Yi(n.subarray(c,c+1)),c+=1,r=gt(n,12),s=gt(n,16),a=gt(n,20),l=gt(n,24),c=28}else if(e===1){c+=4,r=gt(n,c),c+=4;const f=gt(n,c);c+=4;const p=gt(n,c);for(c+=4,o=2**32*f+p,OJ(o)||(o=Number.MAX_SAFE_INTEGER,ge.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=gt(n,c),c+=4,l=gt(n,c),c+=4;Yi(n.subarray(c,c+1))!=="\0";)t+=Yi(n.subarray(c,c+1)),c+=1;for(t+=Yi(n.subarray(c,c+1)),c+=1;Yi(n.subarray(c,c+1))!=="\0";)i+=Yi(n.subarray(c,c+1)),c+=1;i+=Yi(n.subarray(c,c+1)),c+=1}const u=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:u}}function vQ(n,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(n,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function yQ(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),vQ([112,115,115,104],new Uint8Array([i,0,0,0]),n,s,r,o,t||new Uint8Array)}function _Q(n){if(!(n instanceof ArrayBuffer)||n.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(n),i=t.getUint32(0);if(n.byteLength!==i&&i>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=io.hexDump(new Uint8Array(n,12,16));const s=t.getUint32(28);if(e.version===0){if(i-32<s)return null;e.data=new Uint8Array(n,32,s)}else if(e.version===1){e.kids=[];for(let o=0;o<s;o++)e.kids.push(new Uint8Array(n,32+o*16,16))}return e}let _v={};class qp{static clearKeyUriToKeyIdMap(){_v={}}constructor(e,t,i,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case fr.FAIRPLAY:case fr.WIDEVINE:case fr.PLAYREADY:case fr.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&ge.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=EQ(e);return new qp(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=WJ(this.uri);if(t)switch(this.keyFormat){case fr.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case fr.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=yQ(i,null,t);const r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(r)),o=s.substring(s.indexOf("<"),s.length),c=new DOMParser().parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(c){const u=c.childNodes[0]?c.childNodes[0].nodeValue:c.getAttribute("VALUE");if(u){const f=i1(u).subarray(0,16);jJ(f),this.keyId=f}}break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=_v[this.uri];if(!i){const r=Object.keys(_v).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),_v[this.uri]=i}this.keyId=i}return this}}function EQ(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const MB=/\{\$([a-zA-Z0-9-_]+)\}/g;function RI(n){return MB.test(n)}function lr(n,e,t){if(n.variableList!==null||n.hasVariableRefs)for(let i=t.length;i--;){const r=t[i],s=e[r];s&&(e[r]=DS(n,s))}}function DS(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(MB,i=>{const r=i.substring(2,i.length-1),s=t==null?void 0:t[r];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function AI(n,e,t){let i=n.variableList;i||(n.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))s=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,s=e.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function wQ(n,e,t){const i=e.IMPORT;if(t&&i in t){let r=n.variableList;r||(n.variableList=r={}),r[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function nu(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function TQ(n){return typeof self<"u"&&n===self.ManagedMediaSource}const qy={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function SQ(n,e){const t=qy[e];return!!t&&!!t[n.slice(0,4)]}function zw(n,e,t=!0){return!n.split(",").some(i=>!NB(i,e,t))}function NB(n,e,t=!0){var i;const r=nu(t);return(i=r==null?void 0:r.isTypeSupported(Kp(n,e)))!=null?i:!1}function Kp(n,e){return`${e}/mp4;codecs="${n}"`}function LI(n){if(n){const e=n.substring(0,4);return qy.video[e]}return 2}function Ky(n){return n.split(",").reduce((e,t)=>{const i=qy.video[t];return i?(i*2+e)/(e?3:2):(qy.audio[t]+e)/(e?2:1)},0)}const Gw={};function bQ(n,e=!0){if(Gw[n])return Gw[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[n];for(let i=0;i<t.length;i++)if(NB(t[i],"audio",e))return Gw[n]=t[i],t[i];return n}const xQ=/flac|opus/i;function Zy(n,e=!0){return n.replace(xQ,t=>bQ(t.toLowerCase(),e))}function II(n,e){return n&&n!=="mp4a"?n:e&&e.split(",")[0]}function CQ(n){const e=n.split(".");if(e.length>2){let t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t}return n}const PI=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,DI=/#EXT-X-MEDIA:(.*)/g,RQ=/^#EXT(?:INF|-X-TARGETDURATION):/m,OI=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),AQ=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class oo{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return t1.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return RQ.test(e)}static parseMasterPlaylist(e,t){const i=RI(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];PI.lastIndex=0;let o;for(;(o=PI.exec(e))!=null;)if(o[1]){var a;const c=new Li(o[1]);lr(r,c,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const u=DS(r,o[2]),f={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:oo.resolve(u,t)},p=c.decimalResolution("RESOLUTION");p&&(f.width=p.width,f.height=p.height),LQ(c.CODECS,f),(a=f.unknownCodecs)!=null&&a.length||s.push(f),r.levels.push(f)}else if(o[3]){const c=o[3],u=o[4];switch(c){case"SESSION-DATA":{const f=new Li(u);lr(r,f,["DATA-ID","LANGUAGE","VALUE","URI"]);const p=f["DATA-ID"];p&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[p]=f);break}case"SESSION-KEY":{const f=kI(u,t,r);f.encrypted&&f.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(f)):ge.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const f=new Li(u);lr(r,f,["NAME","VALUE","QUERYPARAM"]),AI(r,f,t)}break}case"CONTENT-STEERING":{const f=new Li(u);lr(r,f,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:oo.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=MI(u);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const s={},o=i.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(DI.lastIndex=0;(r=DI.exec(e))!==null;){const c=new Li(r[1]),u=c.TYPE;if(u){const f=a[u],p=s[u]||[];s[u]=p,lr(i,c,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const m=c.LANGUAGE,y=c["ASSOC-LANGUAGE"],_=c.CHANNELS,w=c.CHARACTERISTICS,T=c["INSTREAM-ID"],x={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||m||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:m,url:c.URI?oo.resolve(c.URI,t):""};if(y&&(x.assocLang=y),_&&(x.channels=_),w&&(x.characteristics=w),T&&(x.instreamId=T),f!=null&&f.length){const C=oo.findGroup(f,x.groupId)||f[0];NI(x,C,"audioCodec"),NI(x,C,"textCodec")}p.push(x)}}return s}static parseLevelPlaylist(e,t,i,r,s,o){const a=new $J(t),l=a.fragments;let c=null,u=0,f=0,p=0,m=0,y=null,_=new Mw(r,t),w,T,x,C=-1,I=!1,D=null;for(OI.lastIndex=0,a.m3u8=e,a.hasVariableRefs=RI(e);(w=OI.exec(e))!==null;){I&&(I=!1,_=new Mw(r,t),_.start=p,_.sn=u,_.cc=m,_.level=i,c&&(_.initSegment=c,_.rawProgramDateTime=c.rawProgramDateTime,c.rawProgramDateTime=null,D&&(_.setByteRange(D),D=null)));const Z=w[1];if(Z){_.duration=parseFloat(Z);const q=(" "+w[2]).slice(1);_.title=q||null,_.tagList.push(q?["INF",Z,q]:["INF",Z])}else if(w[3]){if(Je(_.duration)){_.start=p,x&&UI(_,x,a),_.sn=u,_.level=i,_.cc=m,l.push(_);const q=(" "+w[3]).slice(1);_.relurl=DS(a,q),FI(_,y),y=_,p+=_.duration,u++,f=0,I=!0}}else if(w[4]){const q=(" "+w[4]).slice(1);y?_.setByteRange(q,y):_.setByteRange(q)}else if(w[5])_.rawProgramDateTime=(" "+w[5]).slice(1),_.tagList.push(["PROGRAM-DATE-TIME",_.rawProgramDateTime]),C===-1&&(C=l.length);else{if(w=w[0].match(AQ),!w){ge.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<w.length&&!(typeof w[T]<"u");T++);const q=(" "+w[T]).slice(1),H=(" "+w[T+1]).slice(1),Y=w[T+2]?(" "+w[T+2]).slice(1):"";switch(q){case"PLAYLIST-TYPE":a.type=H.toUpperCase();break;case"MEDIA-SEQUENCE":u=a.startSN=parseInt(H);break;case"SKIP":{const ee=new Li(H);lr(a,ee,["RECENTLY-REMOVED-DATERANGES"]);const le=ee.decimalInteger("SKIPPED-SEGMENTS");if(Je(le)){a.skippedSegments=le;for(let ie=le;ie--;)l.unshift(null);u+=le}const W=ee.enumeratedString("RECENTLY-REMOVED-DATERANGES");W&&(a.recentlyRemovedDateranges=W.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(H),1);break;case"VERSION":a.version=parseInt(H);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(H||Y)&&_.tagList.push(Y?[H,Y]:[H]);break;case"DISCONTINUITY":m++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([q]);break;case"BITRATE":_.tagList.push([q,H]);break;case"DATERANGE":{const ee=new Li(H);lr(a,ee,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),lr(a,ee,ee.clientAttrs);const le=new wB(ee,a.dateRanges[ee.ID]);le.isValid||a.skippedSegments?a.dateRanges[le.id]=le:ge.warn(`Ignoring invalid DATERANGE tag: "${H}"`),_.tagList.push(["EXT-X-DATERANGE",H]);break}case"DEFINE":{{const ee=new Li(H);lr(a,ee,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ee?wQ(a,ee,o):AI(a,ee,t)}break}case"DISCONTINUITY-SEQUENCE":m=parseInt(H);break;case"KEY":{const ee=kI(H,t,a);if(ee.isSupported()){if(ee.method==="NONE"){x=void 0;break}x||(x={}),x[ee.keyFormat]&&(x=Vi({},x)),x[ee.keyFormat]=ee}else ge.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${H}"`);break}case"START":a.startTimeOffset=MI(H);break;case"MAP":{const ee=new Li(H);if(lr(a,ee,["BYTERANGE","URI"]),_.duration){const le=new Mw(r,t);BI(le,ee,i,x),c=le,_.initSegment=c,c.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=c.rawProgramDateTime)}else{const le=_.byteRangeEndOffset;if(le){const W=_.byteRangeStartOffset;D=`${le-W}@${W}`}else D=null;BI(_,ee,i,x),c=_,I=!0}break}case"SERVER-CONTROL":{const ee=new Li(H);a.canBlockReload=ee.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=ee.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&ee.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=ee.optionalFloat("PART-HOLD-BACK",0),a.holdBack=ee.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const ee=new Li(H);a.partTarget=ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ee=a.partList;ee||(ee=a.partList=[]);const le=f>0?ee[ee.length-1]:void 0,W=f++,ie=new Li(H);lr(a,ie,["BYTERANGE","URI"]);const ne=new GJ(ie,_,t,W,le);ee.push(ne),_.duration+=ne.duration;break}case"PRELOAD-HINT":{const ee=new Li(H);lr(a,ee,["URI"]),a.preloadHint=ee;break}case"RENDITION-REPORT":{const ee=new Li(H);lr(a,ee,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(ee);break}default:ge.warn(`line parsed but not handled: ${w}`);break}}}y&&!y.relurl?(l.pop(),p-=y.duration,a.partList&&(a.fragmentHint=y)):a.partList&&(FI(_,y),_.cc=m,a.fragmentHint=_,x&&UI(_,x,a));const B=l.length,N=l[0],z=l[B-1];if(p+=a.skippedSegments*a.targetduration,p>0&&B&&z){a.averagetargetduration=p/B;const Z=z.sn;a.endSN=Z!=="initSegment"?Z:0,a.live||(z.endList=!0),N&&(a.startCC=N.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(p+=a.fragmentHint.duration),a.totalduration=p,a.endCC=m,C>0&&IQ(l,C),a}}function kI(n,e,t){var i,r;const s=new Li(n);lr(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=(i=s.METHOD)!=null?i:"",a=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=(r=s.KEYFORMAT)!=null?r:"identity";a&&s.IV&&!l&&ge.error(`Invalid IV: ${s.IV}`);const f=a?oo.resolve(a,e):"",p=(c||"1").split("/").map(Number).filter(Number.isFinite);return new qp(o,f,u,p,l)}function MI(n){const t=new Li(n).decimalFloatingPoint("TIME-OFFSET");return Je(t)?t:null}function LQ(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(s=>SQ(s,i));r.length&&(e[`${i}Codec`]=r.join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function NI(n,e,t){const i=e[t];i&&(n[t]=i)}function IQ(n,e){let t=n[e];for(let i=e;i--;){const r=n[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function FI(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),Je(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function BI(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function UI(n,e,t){n.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(n)}var jt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},mt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function zI(n){const{type:e}=n;switch(e){case jt.AUDIO_TRACK:return mt.AUDIO;case jt.SUBTITLE_TRACK:return mt.SUBTITLE;default:return mt.MAIN}}function Hw(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class PQ{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off($.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:jt.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:s,url:o,deliveryDirectives:a}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:jt.LEVEL,url:o,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:jt.AUDIO_TRACK,url:s,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:jt.SUBTITLE_TRACK,url:s,deliveryDirectives:o})}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=r.context;if(c&&c.url===e.url&&c.level===e.level){ge.trace("[playlist-loader]: playlist request ongoing");return}ge.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===jt.MANIFEST?s=i.manifestLoadPolicy.default:s=Vi({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Je((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===jt.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===jt.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===jt.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,f=c.targetduration;if(u&&f){const p=Math.max(u*3,f*.8)*1e3;s=Vi({},s,{maxTimeToFirstByteMs:Math.min(p,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,u,f,p)=>{const m=this.getInternalLoader(f);this.resetInternalLoader(f.type);const y=c.data;if(y.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,f,new Error("no EXTM3U delimiter"),p||null,u);return}u.parsing.start=performance.now(),oo.isMediaPlaylist(y)?this.handleTrackOrLevelPlaylist(c,u,f,p||null,m):this.handleMasterPlaylist(c,u,f,p)},onError:(c,u,f,p)=>{this.handleNetworkError(u,f,!1,c,p)},onTimeout:(c,u,f)=>{this.handleNetworkError(u,f,!0,void 0,c)}};r.load(e,a,l)}handleMasterPlaylist(e,t,i,r){const s=this.hls,o=e.data,a=Hw(e,i),l=oo.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,i,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:u,sessionData:f,sessionKeys:p,startTimeOffset:m,variableList:y}=l;this.variableList=y;const{AUDIO:_=[],SUBTITLES:w,"CLOSED-CAPTIONS":T}=oo.parseMasterPlaylistMedia(o,a,l);_.length&&!_.some(C=>!C.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(ge.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Li({}),bitrate:0,url:""})),s.trigger($.MANIFEST_LOADED,{levels:u,audioTracks:_,subtitles:w,captions:T,contentSteering:c,url:a,stats:t,networkDetails:r,sessionData:f,sessionKeys:p,startTimeOffset:m,variableList:y})}handleTrackOrLevelPlaylist(e,t,i,r,s){const o=this.hls,{id:a,level:l,type:c}=i,u=Hw(e,i),f=0,p=Je(l)?l:Je(a)?a:0,m=zI(i),y=oo.parseLevelPlaylist(e.data,u,p,m,f,this.variableList);if(c===jt.MANIFEST){const _={attrs:new Li({}),bitrate:0,details:y,name:"",url:u};o.trigger($.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=y,this.handlePlaylistLoaded(y,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger($.ERROR,{type:_t.NETWORK_ERROR,details:be.MANIFEST_PARSING_ERROR,fatal:t.type===jt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let o=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===jt.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===jt.AUDIO_TRACK||e.type===jt.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);ge.warn(`[playlist-loader]: ${o}`);let l=be.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case jt.MANIFEST:l=i?be.MANIFEST_LOAD_TIMEOUT:be.MANIFEST_LOAD_ERROR,c=!0;break;case jt.LEVEL:l=i?be.LEVEL_LOAD_TIMEOUT:be.LEVEL_LOAD_ERROR,c=!1;break;case jt.AUDIO_TRACK:l=i?be.AUDIO_TRACK_LOAD_TIMEOUT:be.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case jt.SUBTITLE_TRACK:l=i?be.SUBTITLE_TRACK_LOAD_TIMEOUT:be.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const f={type:_t.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:s};if(r){const p=(t==null?void 0:t.url)||e.url;f.response=gn({url:p,data:void 0},r)}this.hls.trigger($.ERROR,f)}handlePlaylistLoaded(e,t,i,r,s,o){const a=this.hls,{type:l,level:c,id:u,groupId:f,deliveryDirectives:p}=r,m=Hw(t,r),y=zI(r),_=typeof r.level=="number"&&y===mt.MAIN?c:void 0;if(!e.fragments.length){const T=new Error("No Segments found in Playlist");a.trigger($.ERROR,{type:_t.NETWORK_ERROR,details:be.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:T,reason:T.message,response:t,context:r,level:_,parent:y,networkDetails:s,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const w=e.playlistParsingError;if(w){a.trigger($.ERROR,{type:_t.NETWORK_ERROR,details:be.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:w,reason:w.message,response:t,context:r,level:_,parent:y,networkDetails:s,stats:i});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case jt.MANIFEST:case jt.LEVEL:a.trigger($.LEVEL_LOADED,{details:e,level:_||0,id:u||0,stats:i,networkDetails:s,deliveryDirectives:p});break;case jt.AUDIO_TRACK:a.trigger($.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:p});break;case jt.SUBTITLE_TRACK:a.trigger($.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:f||"",stats:i,networkDetails:s,deliveryDirectives:p});break}}}function FB(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function BB(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){ge.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){ge.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function Wh(n){const e=n.mode;if(e==="disabled"&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);e==="disabled"&&(n.mode=e)}function OS(n,e,t,i){const r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=OQ(n.cues,e,t);for(let o=0;o<s.length;o++)(!i||i(s[o]))&&n.removeCue(s[o])}r==="disabled"&&(n.mode=r)}function DQ(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let i=0,r=t;for(;i<=r;){const s=Math.floor((r+i)/2);if(e<n[s].startTime)r=s-1;else if(e>n[s].startTime&&i<t)i=s+1;else return s}return n[i].startTime-e<e-n[r].startTime?i:r}function OQ(n,e,t){const i=[],r=DQ(n,e);if(r>-1)for(let s=r,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)i.push(a);else if(a.startTime>t)return i}return i}function Jv(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}var Rs={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const kQ=.25;function kS(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function GI(n,e,t,i,r){let s=new n(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(e,t,JSON.stringify(r?gn({type:r},i):i))}return s}const Ev=(()=>{const n=kS();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function $w(n,e){return n.getTime()/1e3-e}function MQ(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class NQ{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Wh(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return FB(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=kS();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Rs.emsg&&!i||!r)continue;const c=RB(s[a].data);if(c){const u=s[a].pts;let f=u+s[a].duration;f>Ev&&(f=Ev),f-u<=0&&(f=u+kQ);for(let m=0;m<c.length;m++){const y=c[m];if(!CB(y)){this.updateId3CueEnds(u,l);const _=GI(o,u,f,y,l);_&&this.id3Track.addCue(_)}}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const o=r[s];o.type===t&&o.startTime<e&&o.endTime===Ev&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let c;r==="audio"?c=u=>u.type===Rs.audioId3&&l:r==="video"?c=u=>u.type===Rs.emsg&&a:c=u=>u.type===Rs.audioId3&&l||u.type===Rs.emsg&&a,OS(s,t,i,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:s}=t,o=Object.keys(s);if(r){const u=Object.keys(i).filter(f=>!o.includes(f));for(let f=u.length;f--;){const p=u[f];Object.keys(i[p].cues).forEach(m=>{r.removeCue(i[p].cues[m])}),delete i[p]}}const a=t.fragments[t.fragments.length-1];if(o.length===0||!Je(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,c=kS();for(let u=0;u<o.length;u++){const f=o[u],p=s[f],m=$w(p.startDate,l),y=i[f],_=(y==null?void 0:y.cues)||{};let w=(y==null?void 0:y.durationKnown)||!1,T=Ev;const x=p.endDate;if(x)T=$w(x,l),w=!0;else if(p.endOnNext&&!w){const I=o.reduce((D,B)=>{if(B!==p.id){const N=s[B];if(N.class===p.class&&N.startDate>p.startDate&&(!D||p.startDate<D.startDate))return N}return D},null);I&&(T=$w(I.startDate,l),w=!0)}const C=Object.keys(p.attr);for(let I=0;I<C.length;I++){const D=C[I];if(!UJ(D))continue;const B=_[D];if(B)w&&!y.durationKnown&&(B.endTime=T);else if(c){let N=p.attr[D];zJ(D)&&(N=MQ(N));const z=GI(c,m,T,{key:D,data:N},Rs.dateRange);z&&(z.id=f,this.id3Track.addCue(z),_[D]=z)}}i[f]={cues:_,dateRange:p,durationKnown:w}}}}class FQ{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&i||t;(l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:o*r);const u=r;return c+Math.min(this.stallCount*1,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(e===null||t===null||i===null)return null;const r=i.edge,s=e-t-this.edgeStalled,o=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on($.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on($.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on($.ERROR,this.onError,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off($.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off($.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off($.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var i;t.details===be.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&ge.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||s===1||!t.live)return;const o=this.targetLatency;if(o===null)return;const a=i-o,l=Math.min(this.maxLatency,o+t.targetduration);if(a<l&&a>.05&&this.forwardBufferLength>1){const u=Math.min(2,Math.max(1,s)),f=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const MS=["NONE","TYPE-0","TYPE-1",null];function BQ(n){return MS.indexOf(n)>-1}const Yy=["SDR","PQ","HLG"];function UQ(n){return!!n&&Yy.indexOf(n)>-1}var Qv={No:"",Yes:"YES",v2:"v2"};function HI(n){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,r=i<e/2;return e&&r?t?Qv.v2:Qv.Yes:Qv.No}class $I{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Td{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return VI(this._audioGroups,e)}hasSubtitleGroup(e){return VI(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function VI(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Vw(n,e){const t=e.startPTS;if(Je(t)){let i=0,r;e.sn>n.sn?(i=t-n.start,r=n):(i=n.start-t,r=e),r.duration!==i&&(r.duration=i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.start=n.start+(n.minEndPTS-n.start):e.start=n.start+n.duration:e.start=Math.max(n.start-e.duration,0)}function UB(n,e,t,i,r,s){i-t<=0&&(ge.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let a=t,l=i;const c=e.startPTS,u=e.endPTS;if(Je(c)){const w=Math.abs(c-t);Je(e.deltaPTS)?e.deltaPTS=Math.max(w,e.deltaPTS):e.deltaPTS=w,a=Math.max(t,c),t=Math.min(t,c),r=Math.min(r,e.startDTS),l=Math.min(i,u),i=Math.max(i,u),s=Math.max(s,e.endDTS)}const f=t-e.start;e.start!==0&&(e.start=t),e.duration=i-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=r,e.endPTS=i,e.minEndPTS=l,e.endDTS=s;const p=e.sn;if(!n||p<n.startSN||p>n.endSN)return 0;let m;const y=p-n.startSN,_=n.fragments;for(_[y]=e,m=y;m>0;m--)Vw(_[m],_[m-1]);for(m=y;m<_.length-1;m++)Vw(_[m],_[m+1]);return n.fragmentHint&&Vw(_[_.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function zQ(n,e){let t=null;const i=n.fragments;for(let l=i.length-1;l>=0;l--){const c=i[l].initSegment;if(c){t=c;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let r=0,s;if($Q(n,e,(l,c)=>{l.relurl&&(r=l.cc-c.cc),Je(l.startPTS)&&Je(l.endPTS)&&(c.start=c.startPTS=l.startPTS,c.startDTS=l.startDTS,c.maxStartPTS=l.maxStartPTS,c.endPTS=l.endPTS,c.endDTS=l.endDTS,c.minEndPTS=l.minEndPTS,c.duration=l.endPTS-l.startPTS,c.duration&&(s=c),e.PTSKnown=e.alignedSliding=!0),c.elementaryStreams=l.elementaryStreams,c.loader=l.loader,c.stats=l.stats,l.initSegment&&(c.initSegment=l.initSegment,t=l.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(c=>{var u;c&&(!c.initSegment||c.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(c.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(l=>!l),e.deltaUpdateFailed){ge.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=GQ(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(r){ge.warn("discontinuity sliding from playlist, take drift into account");for(let l=0;l<o.length;l++)o[l].cc+=r}e.skippedSegments&&(e.startCC=e.fragments[0].cc),HQ(n.partList,e.partList,(l,c)=>{c.elementaryStreams=l.elementaryStreams,c.stats=l.stats}),s?UB(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):zB(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const l=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=l),e.driftEndTime=a,e.driftEnd=l}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}function GQ(n,e,t){const i=Vi({},n);return t&&t.forEach(r=>{delete i[r]}),Object.keys(e).forEach(r=>{const s=new wB(e[r].attr,i[r]);s.isValid?i[r]=s:ge.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[r].attr)}"`)}),i}function HQ(n,e,t){if(n&&e){let i=0;for(let r=0,s=n.length;r<=s;r++){const o=n[r],a=e[r+i];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):i--}}}function $Q(n,e,t){const i=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=r;c<=s;c++){const u=l[o+c];let f=a[c];i&&!f&&c<i&&(f=e.fragments[c]=u),u&&f&&t(u,f)}}function zB(n,e){const t=e.startSN+e.skippedSegments-n.startSN,i=n.fragments;t<0||t>=i.length||NS(e,i[t].start)}function NS(n,e){if(e){const t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function VQ(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const i=n.fragments;if(i.length&&t*4>e){const s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function jQ(n,e,t){if(!(n!=null&&n.details))return null;const i=n.details;let r=i.fragments[e-i.startSN];return r||(r=i.fragmentHint,r&&r.sn===e)?r:e<i.startSN&&t&&t.sn===e?t:null}function jI(n,e,t){var i;return n!=null&&n.details?GB((i=n.details)==null?void 0:i.partList,e,t):null}function GB(n,e,t){if(n)for(let i=n.length;i--;){const r=n[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function HB(n){n.forEach((e,t)=>{const{details:i}=e;i!=null&&i.fragments&&i.fragments.forEach(r=>{r.level=t})})}function Xy(n){switch(n.details){case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_TIMEOUT:case be.LEVEL_LOAD_TIMEOUT:case be.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function WI(n,e){const t=Xy(e);return n.default[`${t?"timeout":"error"}Retry`]}function s1(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function qI(n){return gn(gn({},n),{errorRetry:null,timeoutRetry:null})}function Jy(n,e,t,i){if(!n)return!1;const r=i==null?void 0:i.code,s=e<n.maxNumRetry&&(WQ(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,s):s}function WQ(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}const $B={search:function(n,e){let t=0,i=n.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=n[r];const o=e(s);if(o>0)t=r+1;else if(o<0)i=r-1;else return s}return null}};function qQ(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Je(e))return null;const i=n[0].programDateTime;if(e<(i||0))return null;const r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(ZQ(e,t,o))return o}return null}function Qy(n,e,t=0,i=0,r=.005){let s=null;if(n){s=e[n.sn-e[0].sn+1]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&FS(t,i,s)===0||KQ(s,n,Math.min(r,i))))return s;const o=$B.search(e,FS.bind(null,t,i));return o&&(o!==n||!s)?o:s}function KQ(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return n.start<=i}return!1}function FS(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function ZQ(n,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function YQ(n,e){return $B.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}var En={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},xs={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class XQ{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=ge.log.bind(ge,"[info]:"),this.warn=ge.warn.bind(ge,"[warning]:"),this.error=ge.error.bind(ge,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on($.ERROR,this.onError,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.ERROR,this.onError,this),e.off($.ERROR,this.onErrorOut,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===mt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i,r;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case be.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction={action:En.DoNothing,flags:xs.None};return}case be.FRAG_GAP:case be.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=En.SendAlternateToPenaltyBox;return}case be.LEVEL_EMPTY_ERROR:case be.LEVEL_PARSING_ERROR:{var a,l;const c=t.parent===mt.MAIN?t.level:s.loadLevel;t.details===be.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:typeof(o==null?void 0:o.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case be.AUDIO_TRACK_LOAD_ERROR:case be.AUDIO_TRACK_LOAD_TIMEOUT:case be.SUBTITLE_LOAD_ERROR:case be.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const c=s.levels[s.loadLevel];if(c&&(o.type===jt.AUDIO_TRACK&&c.hasAudioGroup(o.groupId)||o.type===jt.SUBTITLE_TRACK&&c.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=En.SendAlternateToPenaltyBox,t.errorAction.flags=xs.MoveAllAlternatesMatchingHost;return}}return;case be.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=s.levels[s.loadLevel],u=c==null?void 0:c.attrs["HDCP-LEVEL"];u?t.errorAction={action:En.SendAlternateToPenaltyBox,flags:xs.MoveAllAlternatesMatchingHDCP,hdcpLevel:u}:this.keySystemError(t)}return;case be.BUFFER_ADD_CODEC_ERROR:case be.REMUX_ALLOC_ERROR:case be.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(r=t.level)!=null?r:s.loadLevel);return;case be.INTERNAL_EXCEPTION:case be.BUFFER_APPENDING_ERROR:case be.BUFFER_FULL_ERROR:case be.LEVEL_SWITCH_ERROR:case be.BUFFER_STALLED_ERROR:case be.BUFFER_SEEK_OVER_HOLE:case be.BUFFER_NUDGE_ON_STALL:t.errorAction={action:En.DoNothing,flags:xs.None};return}t.type===_t.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=WI(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(Jy(r,s,Xy(e),e.response))return{action:En.RetryRequest,flags:xs.None,retryConfig:r,retryCount:s};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=WI(e.details.startsWith("key")?o:s,e),l=t.levels.reduce((u,f)=>u+f.fragmentError,0);if(r&&(e.details!==be.FRAG_GAP&&r.fragmentError++,Jy(a,l,Xy(e),e.response)))return{action:En.RetryRequest,flags:xs.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,i);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var s,o;const c=e.details;r.loadError++,c===be.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:f,loadLevel:p,minAutoLevel:m,maxAutoLevel:y}=i;i.autoLevelEnabled||(i.loadLevel=-1);const _=(s=e.frag)==null?void 0:s.type,T=(_===mt.AUDIO&&c===be.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===be.BUFFER_ADD_CODEC_ERROR||c===be.BUFFER_APPEND_ERROR))&&f.some(({audioCodec:B})=>r.audioCodec!==B),C=e.sourceBufferName==="video"&&(c===be.BUFFER_ADD_CODEC_ERROR||c===be.BUFFER_APPEND_ERROR)&&f.some(({codecSet:B,audioCodec:N})=>r.codecSet!==B&&r.audioCodec===N),{type:I,groupId:D}=(o=e.context)!=null?o:{};for(let B=f.length;B--;){const N=(B+p)%f.length;if(N!==p&&N>=m&&N<=y&&f[N].loadError===0){var a,l;const z=f[N];if(c===be.FRAG_GAP&&_===mt.MAIN&&e.frag){const Z=f[N].details;if(Z){const q=Qy(e.frag,Z.fragments,e.frag.start);if(q!=null&&q.gap)continue}}else{if(I===jt.AUDIO_TRACK&&z.hasAudioGroup(D)||I===jt.SUBTITLE_TRACK&&z.hasSubtitleGroup(D))continue;if(_===mt.AUDIO&&(a=r.audioGroups)!=null&&a.some(Z=>z.hasAudioGroup(Z))||_===mt.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(Z=>z.hasSubtitleGroup(Z))||T&&r.audioCodec===z.audioCodec||!T&&r.audioCodec!==z.audioCodec||C&&r.codecSet===z.codecSet)continue}u=N;break}}if(u>-1&&i.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:En.SendAlternateToPenaltyBox,flags:xs.None,nextAutoLevel:u}}return{action:En.SendAlternateToPenaltyBox,flags:xs.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case En.DoNothing:break;case En.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==be.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:o}=i;switch(r){case xs.None:this.switchLevel(e,o);break;case xs.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=MS[MS.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,o)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class o1{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=ge.log.bind(ge,`${t}:`),this.warn=ge.warn.bind(ge,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){ge.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=r[s],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=i&&HI(i);return new $I(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,i){const{details:r,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;if(r.advancedDateTime=Date.now()-a,r.live||i!=null&&i.live){if(r.reloaded(i),i&&this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),i&&r.fragments.length>0&&zQ(i,r),!this.canLoad||!r.live)return;let l,c,u;if(r.canBlockReload&&r.endSN&&r.advanced){const w=this.hls.config.lowLatencyMode,T=r.lastPartSn,x=r.endSN,C=r.lastPartIndex,I=C!==-1,D=T===x,B=w?0:C;I?(c=D?x+1:T,u=D?B:C+1):c=x+1;const N=r.age,z=N+r.ageHeader;let Z=Math.min(z-r.partTarget,r.targetduration*1.5);if(Z>0){if(i&&Z>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${Z} with playlist age: ${r.age}`),Z=0;else{const q=Math.floor(Z/r.targetduration);if(c+=q,u!==void 0){const H=Math.round(Z%r.targetduration/r.partTarget);u+=H}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${N.toFixed(2)}s goal: ${Z} skip sn ${q} to part ${u}`)}r.tuneInGoal=Z}if(l=this.getDeliveryDirectives(r,t.deliveryDirectives,c,u),w||!D){this.loadPlaylist(l);return}}else(r.canBlockReload||r.canSkipUntil)&&(l=this.getDeliveryDirectives(r,t.deliveryDirectives,c,u));const f=this.hls.mainForwardBufferInfo,p=f?f.end-f.len:0,m=(r.edge-p)*1e3,y=VQ(r,m);r.updated&&o>this.requestScheduled+y&&(this.requestScheduled=s.loading.start),c!==void 0&&r.canBlockReload?this.requestScheduled=s.loading.first+y-(r.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+y<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=y);let _=this.requestScheduled-o;_=Math.max(0,_),this.log(`reload live playlist ${e} in ${Math.round(_)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),_)}else this.clearTimer()}getDeliveryDirectives(e,t,i,r){let s=HI(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=Qv.No),new $I(i,r,s)}checkRetry(e){const t=e.details,i=Xy(e),r=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(s===En.RetryRequest||!r.resolved&&s===En.SendAlternateToPenaltyBox);if(l){var c;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(i&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=s1(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}class Eh{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class JQ{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Eh(e),this.fast_=new Eh(t),this.defaultTTFB_=r,this.ttfb_=new Eh(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new Eh(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Eh(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Eh(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const VB={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},KI={};function QQ(n,e,t,i,r,s){const o=n.audioCodec?n.audioGroups:null,a=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,c=l?parseInt(l):a?1/0:2;let u=null;if(o!=null&&o.length)try{o.length===1&&o[0]?u=e.groups[o[0]].channels:u=o.reduce((f,p)=>{if(p){const m=e.groups[p];if(!m)throw new Error(`Audio track group ${p} not found`);Object.keys(m.channels).forEach(y=>{f[y]=(f[y]||0)+m.channels[y]})}return f},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!u&&Je(c)&&Object.keys(u).some(f=>parseInt(f)>c)}function e2(n,e,t){const i=n.videoCodec,r=n.audioCodec;if(!i||!r||!t)return Promise.resolve(VB);const s={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(s.transferFunction=o.toLowerCase());const a=i.split(",").map(l=>({type:"media-source",video:gn(gn({},s),{},{contentType:Kp(l,"video")})}));return r&&n.audioGroups&&n.audioGroups.forEach(l=>{var c;l&&((c=e.groups[l])==null||c.tracks.forEach(u=>{if(u.groupId===l){const f=u.channels||"",p=parseFloat(f);Je(p)&&p>2&&a.push.apply(a,r.split(",").map(m=>({type:"media-source",audio:{contentType:Kp(m,"audio"),channels:""+p}})))}}))}),Promise.all(a.map(l=>{const c=t2(l);return KI[c]||(KI[c]=t.decodingInfo(l))})).then(l=>({supported:!l.some(c=>!c.supported),configurations:a,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:a,decodingInfoResults:[],error:l}))}function t2(n){const{audio:e,video:t}=n,i=t||e;if(i){const r=i.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${r}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${r}`}return""}function i2(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function n2(n,e){let t=!1,i=[];return n&&(t=n!=="SDR",i=[n]),e&&(i=e.allowedVideoRanges||Yy.slice(0),t=e.preferHDR!==void 0?e.preferHDR:i2(),t?i=i.filter(r=>r!=="SDR"):i=["SDR"]),{preferHDR:t,allowedVideoRanges:i}}function r2(n,e,t,i,r){const s=Object.keys(n),o=i==null?void 0:i.channels,a=i==null?void 0:i.audioCodec,l=o&&parseInt(o)===2;let c=!0,u=!1,f=1/0,p=1/0,m=1/0,y=0,_=[];const{preferHDR:w,allowedVideoRanges:T}=n2(e,r);for(let D=s.length;D--;){const B=n[s[D]];c=B.channels[2]>0,f=Math.min(f,B.minHeight),p=Math.min(p,B.minFramerate),m=Math.min(m,B.minBitrate);const N=T.filter(z=>B.videoRanges[z]>0);N.length>0&&(u=!0,_=N)}f=Je(f)?f:0,p=Je(p)?p:0;const x=Math.max(1080,f),C=Math.max(30,p);return m=Je(m)?m:t,t=Math.max(m,t),u||(e=void 0,_=[]),{codecSet:s.reduce((D,B)=>{const N=n[B];if(B===D)return D;if(N.minBitrate>t)return Ko(B,`min bitrate of ${N.minBitrate} > current estimate of ${t}`),D;if(!N.hasDefaultAudio)return Ko(B,"no renditions with default or auto-select sound found"),D;if(a&&B.indexOf(a.substring(0,4))%5!==0)return Ko(B,`audio codec preference "${a}" not found`),D;if(o&&!l){if(!N.channels[o])return Ko(B,`no renditions with ${o} channel sound found (channels options: ${Object.keys(N.channels)})`),D}else if((!a||l)&&c&&N.channels[2]===0)return Ko(B,"no renditions with stereo sound found"),D;return N.minHeight>x?(Ko(B,`min resolution of ${N.minHeight} > maximum of ${x}`),D):N.minFramerate>C?(Ko(B,`min framerate of ${N.minFramerate} > maximum of ${C}`),D):_.some(z=>N.videoRanges[z]>0)?N.maxScore<y?(Ko(B,`max score of ${N.maxScore} < selected max of ${y}`),D):D&&(Ky(B)>=Ky(D)||N.fragmentError>n[D].fragmentError)?D:(y=N.maxScore,B):(Ko(B,`no variants with VIDEO-RANGE of ${JSON.stringify(_)} found`),D)},void 0),videoRanges:_,preferHDR:w,minFramerate:p,minBitrate:m}}function Ko(n,e){ge.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function s2(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function o2(n,e,t,i){return n.slice(t,i+1).reduce((r,s)=>{if(!s.codecSet)return r;const o=s.audioGroups;let a=r[s.codecSet];a||(r[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,l),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const u=e.groups[c];u&&(a.hasDefaultAudio=a.hasDefaultAudio||e.hasDefaultAudio?u.hasDefault:u.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(u.channels).forEach(f=>{a.channels[f]=(a.channels[f]||0)+u.channels[f]}))}),r},{})}function ao(n,e,t){if("attrs"in n){const i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(Qh(n,r,t))return i}return-1}function Qh(n,e,t){const{groupId:i,name:r,lang:s,assocLang:o,characteristics:a,default:l}=n,c=n.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||e.lang===s)&&(s===void 0||e.assocLang===o)&&(l===void 0||e.default===l)&&(c===void 0||e.forced===c)&&(a===void 0||a2(a,e.characteristics))&&(t===void 0||t(n,e))}function a2(n,e=""){const t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function wh(n,e){const{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function l2(n,e,t,i,r){const s=e[i],a=e.reduce((p,m,y)=>{const _=m.uri;return(p[_]||(p[_]=[])).push(y),p},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));const l=s.videoRange,c=s.frameRate,u=s.codecSet.substring(0,4),f=ZI(e,i,p=>{if(p.videoRange!==l||p.frameRate!==c||p.codecSet.substring(0,4)!==u)return!1;const m=p.audioGroups,y=t.filter(_=>!m||m.indexOf(_.groupId)!==-1);return ao(n,y,r)>-1});return f>-1?f:ZI(e,i,p=>{const m=p.audioGroups,y=t.filter(_=>!m||m.indexOf(_.groupId)!==-1);return ao(n,y,r)>-1})}function ZI(n,e,t){for(let i=e;i;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}class c2{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:i,hls:r}=this,{autoLevelEnabled:s,media:o}=r;if(!t||!o)return;const a=performance.now(),l=i?i.stats:t.stats,c=i?i.duration:t.duration,u=a-l.loading.start,f=r.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||t.level<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||o.paused||!o.playbackRate||!o.readyState)return;const p=r.mainForwardBufferInfo;if(p===null)return;const m=this.bwEstimator.getEstimateTTFB(),y=Math.abs(o.playbackRate);if(u<=Math.max(m,1e3*(c/(y*2))))return;const _=p.len/y,w=l.loading.first?l.loading.first-l.loading.start:-1,T=l.loaded&&w>-1,x=this.getBwEstimate(),C=r.levels,I=C[t.level],D=l.total||Math.max(l.loaded,Math.round(c*I.averageBitrate/8));let B=T?u-w:u;B<1&&T&&(B=Math.min(u,l.loaded*8/x));const N=T?l.loaded*1e3/B:0,z=N?(D-l.loaded)/N:D*8/x+m/1e3;if(z<=_)return;const Z=N?N*8:x;let q=Number.POSITIVE_INFINITY,H;for(H=t.level-1;H>f;H--){const ee=C[H].maxBitrate;if(q=this.getTimeToLoadFrag(m/1e3,Z,c*ee,!C[H].details),q<_)break}if(q>=z||q>c*10)return;r.nextLoadLevel=r.nextAutoLevel=H,T?this.bwEstimator.sample(u-Math.min(m,w),l.loaded):this.bwEstimator.sampleTTFB(u);const Y=C[H].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>Y&&this.resetEstimator(Y),this.clearTimer(),ge.warn(`[abr] Fragment ${t.sn}${i?" part "+i.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${z.toFixed(3)} s
      Estimated load time for down switch fragment: ${q.toFixed(3)} s
      TTFB estimate: ${w|0} ms
      Current BW estimate: ${Je(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${H} @ ${Y|0} bps`),r.trigger($.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:i,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(ge.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new JQ(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off($.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case be.BUFFER_ADD_CODEC_ERROR:case be.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case be.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const o=performance.now(),a=s?s.stats:i.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(f,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,r){const s=e+i/t,o=r?this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,s=r.end-r.start;Je(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===mt.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered($.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==mt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return ge.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this,{maxAutoLevel:r,config:s,minAutoLevel:o}=i,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=s.abrBandWidthFactor,f=s.abrBandWidthUpFactor;if(c){const w=this.findBestLevel(l,o,r,c,0,u,f);if(w>=0)return w}let p=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const w=this.bitrateTestDelay;w&&(p=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-w,ge.info(`[abr] bitrate test took ${Math.round(1e3*w)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),u=f=1)}const m=this.findBestLevel(l,o,r,c,p,u,f);if(ge.info(`[abr] ${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`),m>-1)return m;const y=i.levels[o],_=i.levels[i.loadLevel];return(y==null?void 0:y.bitrate)<(_==null?void 0:_.bitrate)?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,o,a){var l;const c=r+s,u=this.lastLoadedFragLevel,f=u===-1?this.hls.firstLevel:u,{fragCurrent:p,partCurrent:m}=this,{levels:y,allAudioTracks:_,loadLevel:w,config:T}=this.hls;if(y.length===1)return 0;const x=y[f],C=!!(x!=null&&(l=x.details)!=null&&l.live),I=w===-1||u===-1;let D,B="SDR",N=(x==null?void 0:x.frameRate)||0;const{audioPreference:z,videoPreference:Z}=T,q=this.audioTracksByGroup||(this.audioTracksByGroup=s2(_));if(I){if(this.firstSelection!==-1)return this.firstSelection;const W=this.codecTiers||(this.codecTiers=o2(y,q,t,i)),ie=r2(W,B,e,z,Z),{codecSet:ne,videoRanges:J,minFramerate:ce,minBitrate:se,preferHDR:te}=ie;D=ne,B=te?J[J.length-1]:J[0],N=ce,e=Math.max(e,se),ge.log(`[abr] picked start tier ${JSON.stringify(ie)}`)}else D=x==null?void 0:x.codecSet,B=x==null?void 0:x.videoRange;const H=m?m.duration:p?p.duration:0,Y=this.bwEstimator.getEstimateTTFB()/1e3,ee=[];for(let W=i;W>=t;W--){var le;const ie=y[W],ne=W>f;if(!ie)continue;if(T.useMediaCapabilities&&!ie.supportedResult&&!ie.supportedPromise){const fe=navigator.mediaCapabilities;typeof(fe==null?void 0:fe.decodingInfo)=="function"&&QQ(ie,q,B,N,e,z)?(ie.supportedPromise=e2(ie,q,fe),ie.supportedPromise.then(pe=>{if(!this.hls)return;ie.supportedResult=pe;const Ce=this.hls.levels,xe=Ce.indexOf(ie);pe.error?ge.warn(`[abr] MediaCapabilities decodingInfo error: "${pe.error}" for level ${xe} ${JSON.stringify(pe)}`):pe.supported||(ge.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${xe} ${JSON.stringify(pe)}`),xe>-1&&Ce.length>1&&(ge.log(`[abr] Removing unsupported level ${xe}`),this.hls.removeLevel(xe)))})):ie.supportedResult=VB}if(D&&ie.codecSet!==D||B&&ie.videoRange!==B||ne&&N>ie.frameRate||!ne&&N>0&&N<ie.frameRate||ie.supportedResult&&!((le=ie.supportedResult.decodingInfoResults)!=null&&le[0].smooth)){ee.push(W);continue}const J=ie.details,ce=(m?J==null?void 0:J.partTarget:J==null?void 0:J.averagetargetduration)||H;let se;ne?se=a*e:se=o*e;const te=H&&r>=H*2&&s===0?y[W].averageBitrate:y[W].maxBitrate,Q=this.getTimeToLoadFrag(Y,se,te*ce,J===void 0);if(se>=te&&(W===u||ie.loadError===0&&ie.fragmentError===0)&&(Q<=Y||!Je(Q)||C&&!this.bitrateTestDelay||Q<c)){const fe=this.forcedAutoLevel;return W!==w&&(fe===-1||fe!==w)&&(ee.length&&ge.trace(`[abr] Skipped level(s) ${ee.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${y[ee[0]].codecs}" ${y[ee[0]].videoRange}; not compatible with "${x.codecs}" ${B}`),ge.info(`[abr] switch candidate:${f}->${W} adjustedbw(${Math.round(se)})-bitrate=${Math.round(se-te)} ttfb:${Y.toFixed(1)} avgDuration:${ce.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${Q.toFixed(1)} firstSelection:${I} codecSet:${D} videoRange:${B} hls.loadLevel:${w}`)),I&&(this.firstSelection=W),W}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls,r=Math.min(Math.max(e,i),t);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}}class u2{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var dn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class h2{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.BUFFER_APPENDED,this.onBufferAppended,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off($.BUFFER_APPENDED,this.onBufferAppended,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;const o=s.end;if(s.start<=e&&o!==null&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:i}=this,r=Object.keys(i);for(let s=r.length;s--;){const o=i[r[s]];if((o==null?void 0:o.body.type)===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,i,r){this.timeRanges&&(this.timeRanges[e]=t);const s=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||s>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===i&&this.removeFragment(a.body);return}const l=a.range[e];l&&l.time.some(c=>{const u=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return u&&this.removeFragment(a.body),u})})}detectPartialFragments(e){const t=this.timeRanges,{frag:i,part:r}=e;if(!t||i.sn==="initSegment")return;const s=Th(i),o=this.fragments[s];if(!o||o.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(l=>{const c=i.elementaryStreams[l];if(!c)return;const u=t[l],f=a||c.partial===!0;o.range[l]=this.getBufferedTimes(i,r,f,u)}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=i.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),wv(o)||this.removeParts(i.sn-1,i.type)):this.removeFragment(o.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter(r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=Th(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let u=0;u<r.length;u++){const f=r.start(u)-this.bufferPadding,p=r.end(u)+this.bufferPadding;if(c>=f&&l<=p){s.time.push({startPTS:Math.max(o,r.start(u)),endPTS:Math.min(a,r.end(u))});break}else if(o<p&&a>f){const m=Math.max(o,r.start(u)),y=Math.min(a,r.end(u));y>m&&(s.partial=!0,s.time.push({startPTS:m,endPTS:y}))}else if(a<=f)break}return s}getPartialFragment(e){let t=null,i,r,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&wv(u)&&(r=u.body.start-a,s=u.body.end+a,e>=r&&e<=s&&(i=Math.min(e-r,s-e),o<=i&&(t=u.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||wv(t))}getState(e){const t=Th(e),i=this.fragments[t];return i?i.buffered?wv(i)?dn.PARTIAL:dn.OK:dn.APPENDING:dn.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let o=0;o<i.length;o++){if(r=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onFragLoaded(e,t){const{frag:i,part:r}=t;if(i.sn==="initSegment"||i.bitrateTest)return;const s=r?null:t,o=Th(i);this.fragments[o]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s}=t;if(i.sn==="initSegment")return;const o=i.type;if(r){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(r)}this.timeRanges=s,Object.keys(s).forEach(a=>{const l=s[a];this.detectEvictedFragments(a,l,o,r)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Th(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==i||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Th(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=i.filter(s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function wv(n){var e,t,i;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((i=n.range.audiovideo)==null?void 0:i.partial))}function Th(n){return`${n.type}_${n.level}_${n.sn}`}const d2={length:0,start:()=>0,end:()=>0};class pi{static isBuffered(e,t){try{if(e){const i=pi.getBuffered(e);for(let r=0;r<i.length;r++)if(t>=i.start(r)&&t<=i.end(r))return!0}}catch{}return!1}static bufferInfo(e,t,i){try{if(e){const r=pi.getBuffered(e),s=[];let o;for(o=0;o<r.length;o++)s.push({start:r.start(o),end:r.end(o)});return this.bufferedInfo(s,t,i)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.sort(function(c,u){const f=c.start-u.start;return f||u.end-c.end});let r=[];if(i)for(let c=0;c<e.length;c++){const u=r.length;if(u){const f=r[u-1].end;e[c].start-f<i?e[c].end>f&&(r[u-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let s=0,o,a=t,l=t;for(let c=0;c<r.length;c++){const u=r[c].start,f=r[c].end;if(t+i>=u&&t<f)a=u,l=f,s=l-t;else if(t+i<u){o=u;break}}return{len:s,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return ge.log("failed to get media.buffered",t),d2}}}class a1{constructor(e,t,i,r=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Tv(),this.buffering={audio:Tv(),video:Tv(),audiovideo:Tv()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=o}}function Tv(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ey(n,e){for(let i=0,r=n.length;i<r;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function f2(n,e,t){return!!(e&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function p2(n,e){const t=n.fragments,i=e.fragments;if(!i.length||!t.length){ge.log("No fragments to align");return}const r=ey(t,i[0].cc);if(!r||r&&!r.startPTS){ge.log("No frag in previous level to align on");return}return r}function YI(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function jB(n,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)YI(t[i],n);e.fragmentHint&&YI(e.fragmentHint,n),e.alignedSliding=!0}function g2(n,e,t){e&&(m2(n,t,e),!t.alignedSliding&&e&&e0(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&zB(e,t))}function m2(n,e,t){if(f2(n,t,e)){const i=p2(t,e);i&&Je(i.start)&&(ge.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),jB(i.start,e))}}function e0(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(r=ey(i,o),s=ey(t,o)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=ey(t,r.cc)||t[Math.floor(t.length/2)]);const a=r.programDateTime,l=s.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(s.start-r.start);jB(c,n)}const XI=Math.pow(2,17);class v2{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Qo({type:_t.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(QI(e));return}else e.gap=!1;const c=this.loader=e.loader=s?new s(r):new o(r),u=JI(e),f=qI(r.fragLoadPolicy.default),p={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:XI};e.stats=c.stats,c.load(u,p,{onSuccess:(m,y,_,w)=>{this.resetLoader(e,c);let T=m.data;_.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),a({frag:e,part:null,payload:T,networkDetails:w})},onError:(m,y,_,w)=>{this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:gn({url:i,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:_,stats:w}))},onAbort:(m,y,_)=>{this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:_,stats:m}))},onTimeout:(m,y,_)=>{this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:_,stats:m}))},onProgress:(m,y,_,w)=>{t&&t({frag:e,part:null,payload:_,networkDetails:w})}})})}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(QI(e,t));return}const c=this.loader=e.loader=s?new s(r):new o(r),u=JI(e,t),f=qI(r.fragLoadPolicy.default),p={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:XI};t.stats=c.stats,c.load(u,p,{onSuccess:(m,y,_,w)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const T={frag:e,part:t,payload:m.data,networkDetails:w};i(T),a(T)},onError:(m,y,_,w)=>{this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:gn({url:u.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:_,stats:w}))},onAbort:(m,y,_)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:_,stats:m}))},onTimeout:(m,y,_)=>{this.resetLoader(e,c),l(new Qo({type:_t.NETWORK_ERROR,details:be.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:_,stats:m}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(i.loaded/s),l),f=(l-c)*Math.round(i.loaded/c);i.total=i.loaded+f}else i.total=Math.max(i.loaded,i.total);const o=i.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function JI(n,e=null){const t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Je(r)&&Je(s)){var o;let a=r,l=s;if(n.sn==="initSegment"&&((o=n.decryptdata)==null?void 0:o.method)==="AES-128"){const c=s-r;c%16&&(l=s+(16-c%16)),r!==0&&(i.resetIV=!0,a=r-16)}i.rangeStart=a,i.rangeEnd=l}return i}function QI(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:_t.MEDIA_ERROR,details:be.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new Qo(i)}class Qo extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class y2{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class _2{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function E2(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?Kc(n,0,e-t):n}class w2{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],o=i[2],a=i[3],l=this.invSubMix,c=l[0],u=l[1],f=l[2],p=l[3],m=new Uint32Array(256);let y=0,_=0,w=0;for(w=0;w<256;w++)w<128?m[w]=w<<1:m[w]=w<<1^283;for(w=0;w<256;w++){let T=_^_<<1^_<<2^_<<3^_<<4;T=T>>>8^T&255^99,e[y]=T,t[T]=y;const x=m[y],C=m[x],I=m[C];let D=m[T]*257^T*16843008;r[y]=D<<24|D>>>8,s[y]=D<<16|D>>>16,o[y]=D<<8|D>>>24,a[y]=D,D=I*16843009^C*65537^x*257^y*16843008,c[T]=D<<24|D>>>8,u[T]=D<<16|D>>>16,f[T]=D<<8|D>>>24,p[T]=D,y?(y=x^m[m[m[I^x]]],_^=m[m[_]]):y=_=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),f=this.sBox,p=this.rcon,m=this.invSubMix,y=m[0],_=m[1],w=m[2],T=m[3];let x,C;for(a=0;a<o;a++){if(a<s){x=c[a]=t[a];continue}C=x,a%s===0?(C=C<<8|C>>>24,C=f[C>>>24]<<24|f[C>>>16&255]<<16|f[C>>>8&255]<<8|f[C&255],C^=p[a/s|0]<<24):s>6&&a%s===4&&(C=f[C>>>24]<<24|f[C>>>16&255]<<16|f[C>>>8&255]<<8|f[C&255]),c[a]=x=(c[a-s]^C)>>>0}for(l=0;l<o;l++)a=o-l,l&3?C=c[a]:C=c[a-4],l<4||a<=4?u[l]=C:u[l]=y[f[C>>>24]]^_[f[C>>>16&255]]^w[f[C>>>8&255]]^T[f[C&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],u=a[2],f=a[3],p=this.uint8ArrayToUint32Array_(i);let m=p[0],y=p[1],_=p[2],w=p[3];const T=new Int32Array(e),x=new Int32Array(T.length);let C,I,D,B,N,z,Z,q,H,Y,ee,le,W,ie;const ne=this.networkToHostOrderSwap;for(;t<T.length;){for(H=ne(T[t]),Y=ne(T[t+1]),ee=ne(T[t+2]),le=ne(T[t+3]),N=H^s[0],z=le^s[1],Z=ee^s[2],q=Y^s[3],W=4,ie=1;ie<r;ie++)C=l[N>>>24]^c[z>>16&255]^u[Z>>8&255]^f[q&255]^s[W],I=l[z>>>24]^c[Z>>16&255]^u[q>>8&255]^f[N&255]^s[W+1],D=l[Z>>>24]^c[q>>16&255]^u[N>>8&255]^f[z&255]^s[W+2],B=l[q>>>24]^c[N>>16&255]^u[z>>8&255]^f[Z&255]^s[W+3],N=C,z=I,Z=D,q=B,W=W+4;C=o[N>>>24]<<24^o[z>>16&255]<<16^o[Z>>8&255]<<8^o[q&255]^s[W],I=o[z>>>24]<<24^o[Z>>16&255]<<16^o[q>>8&255]<<8^o[N&255]^s[W+1],D=o[Z>>>24]<<24^o[q>>16&255]<<16^o[N>>8&255]<<8^o[z&255]^s[W+2],B=o[q>>>24]<<24^o[N>>16&255]<<16^o[z>>8&255]<<8^o[Z&255]^s[W+3],x[t]=ne(C^m),x[t+1]=ne(B^y),x[t+2]=ne(D^_),x[t+3]=ne(I^w),m=H,y=Y,_=ee,w=le,t=t+4}return x.buffer}}const T2=16;class l1{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?E2(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i){return this.useSoftware?new Promise((r,s)=>{this.softwareDecrypt(new Uint8Array(e),t,i);const o=this.flush();o?r(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i)}softwareDecrypt(e,t,i){const{currentIV:r,currentResult:s,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=rs(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;r&&(i=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new w2),l.expandKey(t);const c=s;return this.currentResult=l.decrypt(a.buffer,0,i),this.currentIV=Kc(a,-16).buffer,c||null}webCryptoDecrypt(e,t,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i));this.key=t,this.fastAesKey=new _2(this.subtle,t)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new y2(this.subtle,new Uint8Array(i)).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(ge.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,i)))}onWebCryptoError(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%T2;return i!==e.length&&(t=Kc(e,0,i),this.remainderData=Kc(e,i)),t}logOnce(e){this.logEnabled&&(ge.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const S2={toString:function(n){let e="";const t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},Oe={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class c1 extends u2{constructor(e,t,i,r,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Oe.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=r,this.log=ge.log.bind(ge,`${r}:`),this.warn=ge.warn.bind(ge,`${r}:`),this.hls=e,this.fragmentLoader=new v2(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new l1(e.config),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Oe.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const i=t.partList;if(i!=null&&i.length){const s=i[i.length-1];return pi.isBuffered(this.media,s.start+s.duration/2)}const r=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Oe.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:i,mediaBuffer:r,state:s}=this,o=i?i.currentTime:0,a=pi.bufferInfo(r||i,o,e.maxBufferHole);if(this.log(`media seeking to ${Je(o)?o.toFixed(3):o}, state: ${s}`),this.state===Oe.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,c=t.start-l,u=t.start+t.duration+l;if(!a.len||u<a.start||c>a.end){const f=o>u;(o<c||f)&&(f&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off($.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=Oe.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;const o=this.state;if(this.fragContextChanged(e)){(o===Oe.FRAG_LOADING||!this.fragCurrent&&o===Oe.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=Oe.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger($.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===Oe.STOPPED||this.state===Oe.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===dn.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===dn.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger($.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{if(!i||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{payload:s}=i,o=e.decryptdata;if(s&&s.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).catch(l=>{throw r.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const c=self.performance.now();return r.trigger($.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:c}}),i.payload=l,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===Oe.STOPPED||this.state===Oe.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state=Oe.IDLE,e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var i,r,s,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===mt.MAIN?"level":"track"} ${e.level} (frag:[${((i=e.startPTS)!=null?i:NaN).toFixed(3)}-${((r=e.endPTS)!=null?r:NaN).toFixed(3)}] > buffer:${a?S2.toString(pi.getBuffered(a)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==mt.SUBTITLE){const u=e.elementaryStreams;if(!Object.keys(u).some(f=>!!u[f])){this.state=Oe.IDLE;return}}const c=(l=this.levels)==null?void 0:l[e.level];c!=null&&c.fragmentError&&(this.log(`Resetting level fragment error count of ${c.fragmentError} on frag buffered`),c.fragmentError=0)}this.state=Oe.IDLE,a&&(!this.loadedmetadata&&e.type==mt.MAIN&&a.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((o=this.fragPrevious)==null?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new a1(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=Oe.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger($.KEY_LOADED,u),this.state===Oe.KEY_LOADING&&(this.state=Oe.IDLE),u}),this.hls.trigger($.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const u=o.partList;if(u&&r){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(u,e,i);if(f>-1){const p=u[f];this.log(`Loading part sn: ${e.sn} p: ${p.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${f}-${u.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=Oe.FRAG_LOADING;let m;return a?m=a.then(y=>!y||this.fragContextChanged(y.frag)?null:this.doFragPartsLoad(e,p,t,r)).catch(y=>this.handleFragLoadError(y)):m=this.doFragPartsLoad(e,p,t,r).catch(y=>this.handleFragLoadError(y)),this.hls.trigger($.FRAG_LOADING,{frag:e,part:p,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(u,i))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(i.toFixed(3))}`),Je(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Oe.FRAG_LOADING;const l=this.config.progressive;let c;return l&&a?c=a.then(u=>!u||this.fragContextChanged(u==null?void 0:u.frag)?null:this.fragmentLoader.load(e,r)).catch(u=>this.handleFragLoadError(u)):c=Promise.all([this.fragmentLoader.load(e,l?r:void 0),a]).then(([u])=>(!l&&u&&r&&r(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger($.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,i,r){return new Promise((s,o)=>{var a;const l=[],c=(a=i.details)==null?void 0:a.partList,u=f=>{this.fragmentLoader.loadPart(e,f,r).then(p=>{l[f.index]=p;const m=p.part;this.hls.trigger($.FRAG_LOADED,p);const y=jI(i,e.sn,f.index+1)||GB(c,e.sn,f.index+1);if(y)u(y);else return s({frag:e,part:m,partsLoaded:l})}).catch(o)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===be.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger($.ERROR,t)}else this.hls.trigger($.ERROR,{type:_t.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Oe.PARSING){!this.fragCurrent&&this.state!==Oe.STOPPED&&this.state!==Oe.ERROR&&(this.state=Oe.IDLE);return}const{frag:i,part:r,level:s}=t,o=self.performance.now();i.stats.parsing.end=o,r&&(r.stats.parsing.end=o),this.updateLevelTiming(i,r,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${r}. The current chunk will not be buffered.`),null;const a=t[r],l=o>-1?jI(a,s,o):null,c=l?l.fragment:jQ(a,s,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,i,r,s){var o;if(!e||this.state!==Oe.PARSING)return;const{data1:a,data2:l}=e;let c=a;if(a&&l&&(c=rs(a,l)),!((o=c)!=null&&o.length))return;const u={type:e.type,frag:t,part:i,chunkMeta:r,parent:t.type,data:c};if(this.hls.trigger($.BUFFER_APPENDING,u),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!pi.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=pi.bufferInfo(t,i,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,r.end-o),i+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const i=this.getLoadPosition();return Je(i)?this.getFwdBufferInfoAtPos(e,i,t):null}getFwdBufferInfoAtPos(e,t,i){const{config:{maxBufferHole:r}}=this,s=pi.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&s.nextStart<o.end)return pi.bufferInfo(e,t,Math.max(s.nextStart,r))}return s}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,i=e||t.maxBufferLength,r=t.maxMaxBufferLength/2;return r>=i?(t.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=mt.MAIN){const i=this.fragmentTracker.getAppendedFrag(e,mt.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,o=i[0].start;let a;if(t.live){const l=s.initialLiveManifestSize;if(r<l)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${l})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o)&&(a=this.getInitialLiveFragment(t,i),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=i[0]);if(!a){const l=s.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===dn.OK||i===dn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(a===null)return a;if(e=a,o&&e&&!e.gap&&i.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(l!==null&&i.len+l.len>=s)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,r>-1&&i<c.start)break;const u=c.loaded;u?r=-1:(s||c.independent||o)&&c.fragment===t&&(r=a),s=u}return r}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=qQ(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];i.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=YQ(t,i.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:c}=r,u=i.partList,f=!!(r.lowLatencyMode&&u!=null&&u.length&&l);f&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn);let p;if(e<t){const m=e>t-c?0:c;p=Qy(s,o,e,m)}else p=o[o.length-1];if(p){const m=p.sn-i.startSN,y=this.fragmentTracker.getState(p);if((y===dn.OK||y===dn.PARTIAL&&p.gap)&&(s=p),s&&p.sn===s.sn&&(!f||u[0].fragment.sn>p.sn)&&s&&p.level===s.level){const w=o[m+1];p.sn<a&&this.fragmentTracker.getState(w)!==dn.OK?p=w:p=null}}return p}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=i.currentTime,o=e.fragments[0].start,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(r!==null&&i.duration>r&&(s<r||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&i.readyState<4||s<a-c)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragments[0].start,o=!t,a=e.alignedSliding&&Je(s);if(o||!a&&!s){const{fragPrevious:l}=this;g2(l,i,e);const c=e.fragments[0].start;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${r}`),c}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;if(i<t&&(i=-1),i===-1||this.lastCurrentTime===-1){const r=this.startTimeOffset!==null,s=r?this.startTimeOffset:e.startTimeOffset;s!==null&&Je(s)?(i=t+s,s<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Start time offset ${s} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Oe.FRAG_LOADING_WAITING_RETRY)&&(this.state=Oe.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const u=this.getCurrentContext(t.chunkMeta);u&&(t.frag=u.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=t.details===be.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:c}=o||{};if(o&&a===En.RetryRequest&&c){this.resetStartWhenNotLoaded(this.levelLastLoaded);const u=s1(c,l);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${u}ms`),o.resolved=!0,this.retryDate=self.performance.now()+u,this.state=Oe.FRAG_LOADING_WAITING_RETRY}else if(c&&o)if(this.resetFragmentErrors(e),l<c.maxNumRetry)!s&&a!==En.RemoveAlternatePermanently&&(o.resolved=!0);else{ge.warn(`${t.details} reached or exceeded max retry (${l})`);return}else(o==null?void 0:o.action)===En.SendAlternateToPenaltyBox?this.state=Oe.WAITING_LEVEL:this.state=Oe.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Oe.PARSING||this.state===Oe.PARSED){const t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===mt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Oe.STOPPED&&(this.state=Oe.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=pi.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===Oe.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Oe.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){var s;const o=i.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const f=u.endPTS-u.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${f})`),l||!1;const p=r?0:UB(o,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger($.LEVEL_PTS_UPDATED,{details:o,level:i,drift:p,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(i.fragmentError===0&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Oe.PARSED,this.hls.trigger($.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class WB{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=b2(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function b2(n,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}function x2(){return typeof __HLS_WORKER_BUNDLE__=="function"}function C2(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}function R2(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function no(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class u1{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=rs(this.cachedData,e),this.cachedData=null);let i=Wp(e,0),r=i?i.length:0,s;const o=this._audioTrack,a=this._id3Track,l=i?r1(i):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Je(l))&&(this.basePTS=A2(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Rs.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const u=this.appendFrame(o,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,s=r):r=c}else YJ(e,r)?(i=Wp(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Rs.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===c&&s!==c){const u=Kc(e,s);this.cachedData?this.cachedData=rs(this.cachedData,u):this.cachedData=u}}return{audioTrack:o,videoTrack:no(),id3Track:a,textTrack:no()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:no(),id3Track:this._id3Track,textTrack:no()}}destroy(){}}const A2=(n,e,t)=>{if(Je(n))return n*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};function L2(n,e,t,i){let r,s,o,a;const l=navigator.userAgent.toLowerCase(),c=i,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((e[t+2]&192)>>>6)+1;const f=(e[t+2]&60)>>>2;if(f>u.length-1){const p=new Error(`invalid ADTS sampling index:${f}`);n.emit($.ERROR,$.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}return o=(e[t+2]&1)<<2,o|=(e[t+3]&192)>>>6,ge.log(`manifest codec:${i}, ADTS type:${r}, samplingIndex:${f}`),/firefox/i.test(l)?f>=6?(r=5,a=new Array(4),s=f-3):(r=2,a=new Array(2),s=f):l.indexOf("android")!==-1?(r=2,a=new Array(2),s=f):(r=5,a=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&f>=6?s=f-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(f>=6&&o===1||/vivaldi/i.test(l))||!i&&o===1)&&(r=2,a=new Array(2)),s=f)),a[0]=r<<3,a[0]|=(f&14)>>1,a[1]|=(f&1)<<7,a[1]|=o<<3,r===5&&(a[1]|=(s&14)>>1,a[2]=(s&1)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:u[f],channelCount:o,codec:"mp4a.40."+r,manifestCodec:c}}function qB(n,e){return n[e]===255&&(n[e+1]&246)===240}function KB(n,e){return n[e+1]&1?7:9}function h1(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function I2(n,e){return e+5<n.length}function t0(n,e){return e+1<n.length&&qB(n,e)}function P2(n,e){return I2(n,e)&&qB(n,e)&&h1(n,e)<=n.length-e}function D2(n,e){if(t0(n,e)){const t=KB(n,e);if(e+t>=n.length)return!1;const i=h1(n,e);if(i<=t)return!1;const r=e+i;return r===n.length||t0(n,r)}return!1}function ZB(n,e,t,i,r){if(!n.samplerate){const s=L2(e,t,i,r);if(!s)return;n.config=s.config,n.samplerate=s.samplerate,n.channelCount=s.channelCount,n.codec=s.codec,n.manifestCodec=s.manifestCodec,ge.log(`parsed codec:${n.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function YB(n){return 1024*9e4/n}function O2(n,e){const t=KB(n,e);if(e+t<=n.length){const i=h1(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function XB(n,e,t,i,r){const s=YB(n.samplerate),o=i+r*s,a=O2(e,t);let l;if(a){const{frameLength:f,headerLength:p}=a,m=p+f,y=Math.max(0,t+m-e.length);y?(l=new Uint8Array(m-p),l.set(e.subarray(t+p,e.length),0)):l=e.subarray(t+p,t+m);const _={unit:l,pts:o};return y||n.samples.push(_),{sample:_,length:m,missing:y}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}let Sv=null;const k2=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],M2=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],N2=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],F2=[0,1,1,4];function JB(n,e,t,i,r){if(t+24>e.length)return;const s=QB(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=i+r*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function QB(n,e){const t=n[e+1]>>3&3,i=n[e+1]>>1&3,r=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-i:i===3?3:4,c=k2[l*14+r-1]*1e3,f=M2[(t===3?0:t===2?1:2)*3+s],p=a===3?1:2,m=N2[t][i],y=F2[i],_=m*8*y,w=Math.floor(m*c/f+o)*y;if(Sv===null){const C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sv=C?parseInt(C[1]):0}return!!Sv&&Sv<=87&&i===2&&c>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:f,channelCount:p,frameLength:w,samplesPerFrame:_}}}function d1(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function eU(n,e){return e+1<n.length&&d1(n,e)}function B2(n,e){return d1(n,e)&&4<=n.length-e}function tU(n,e){if(e+1<n.length&&d1(n,e)){const i=QB(n,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===n.length||eU(n,s)}return!1}class U2 extends u1{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wp(e,0);let i=(t==null?void 0:t.length)||0;if(tU(e,i))return!1;for(let r=e.length;i<r;i++)if(D2(e,i))return ge.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return P2(e,t)}appendFrame(e,t,i){ZB(e,this.observer,t,i,e.manifestCodec);const r=XB(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const z2=/\/emsg[-/]ID3/i;class G2{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=no("video",1),o=this.audioTrack=no("audio",1),a=this.txtTrack=no("text",1);if(this.id3Track=no("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=PB(e);if(l.video){const{id:c,timescale:u,codec:f}=l.video;s.id=c,s.timescale=a.timescale=u,s.codec=f}if(l.audio){const{id:c,timescale:u,codec:f}=l.audio;o.id=c,o.timescale=u,o.codec=f}a.id=AB.text,s.sampleDuration=0,s.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return sQ(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=rs(this.remainderData,e));const a=fQ(i);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=i;const o=this.extractID3Track(r,t);return s.samples=CI(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=CI(e,t),{videoTrack:t,audioTrack:no(),id3Track:r,textTrack:no()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=Lt(e.samples,["emsg"]);r&&r.forEach(s=>{const o=mQ(s);if(z2.test(o.schemeIdUri)){const a=Je(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;i.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Rs.emsg,duration:l})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const iU=(n,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=n[e];const a=Math.min(i,8),l=8-a;s[0]=4278190080>>>24+l<<l,r[0]=(o[0]&s[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,i-=a}return t};class H2 extends u1{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=nU(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Wp(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&r1(t)!==void 0&&iU(e,i)<16}}function nU(n,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+u>e.length)return-1;const f=e[t+6]>>5;let p=0;f===2?p+=2:(f&1&&f!==1&&(p+=2),f&4&&(p+=2));const m=(e[t+6]<<8|e[t+7])>>12-p&1,_=[2,1,2,3,3,4,4,5][f]+m,w=e[t+5]>>3,T=e[t+5]&7,x=new Uint8Array([s<<6|w<<1|T>>2,(T&3)<<6|f<<3|m<<2|l>>4,l<<4&224]),C=1536/a*9e4,I=i+r*C,D=e.subarray(t,t+u);return n.config=x,n.channelCount=_,n.samplerate=a,n.samples.push({unit:D,pts:I}),u}class $2{constructor(){this.VideoSample=null}createVideoSample(e,t,i,r){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:r,length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&ge.log(e.pts+"/"+e.dts+":"+e.debug)}}class eP{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&ge.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,i=8,r;for(let s=0;s<e;s++)i!==0&&(r=this.readEG(),i=(t+r+256)%256),t=i===0?t:i}readSPS(){let e=0,t=0,i=0,r=0,s,o,a;const l=this.readUByte.bind(this),c=this.readBits.bind(this),u=this.readUEG.bind(this),f=this.readBoolean.bind(this),p=this.skipBits.bind(this),m=this.skipEG.bind(this),y=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);l();const w=l();if(c(5),p(3),l(),y(),w===100||w===110||w===122||w===244||w===44||w===83||w===86||w===118||w===128){const B=u();if(B===3&&p(1),y(),y(),p(1),f())for(o=B!==3?8:12,a=0;a<o;a++)f()&&(a<6?_(16):_(64))}y();const T=u();if(T===0)u();else if(T===1)for(p(1),m(),m(),s=u(),a=0;a<s;a++)m();y(),p(1);const x=u(),C=u(),I=c(1);I===0&&p(1),p(1),f()&&(e=u(),t=u(),i=u(),r=u());let D=[1,1];if(f()&&f())switch(l()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((x+1)*16-e*2-t*2),height:(2-I)*(C+1)*16-(I?2:4)*(i+r),pixelRatio:D}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class V2 extends $2{parseAVCPES(e,t,i,r,s){const o=this.parseAVCNALu(e,i.data);let a=this.VideoSample,l,c=!1;i.data=null,a&&o.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"")),o.forEach(u=>{var f;switch(u.type){case 1:{let _=!1;l=!0;const w=u.data;if(c&&w.length>4){const T=new eP(w).readSliceType();(T===2||T===4||T===7||T===9)&&(_=!0)}if(_){var p;(p=a)!=null&&p.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),a.frame=!0,a.key=_;break}case 5:l=!0,(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts,"")),a.key=!0,a.frame=!0;break;case 6:{l=!0,OB(u.data,1,i.pts,t.samples);break}case 7:{var m,y;l=!0,c=!0;const _=u.data,T=new eP(_).readSPS();if(!e.sps||e.width!==T.width||e.height!==T.height||((m=e.pixelRatio)==null?void 0:m[0])!==T.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[_],e.duration=s;const x=_.subarray(1,4);let C="avc1.";for(let I=0;I<3;I++){let D=x[I].toString(16);D.length<2&&(D="0"+D),C+=D}e.codec=C}break}case 8:l=!0,e.pps=[u.data];break;case 9:l=!0,e.audFound=!0,a&&this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"");break;case 12:l=!0;break;default:l=!1,a&&(a.debug+="unknown NAL "+u.type+" ");break}a&&l&&a.units.push(u)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}parseAVCNALu(e,t){const i=t.byteLength;let r=e.naluState||0;const s=r,o=[];let a=0,l,c,u,f=-1,p=0;for(r===-1&&(f=0,p=t[0]&31,r=0,a=1);a<i;){if(l=t[a++],!r){r=l?0:1;continue}if(r===1){r=l?0:2;continue}if(!l)r=3;else if(l===1){if(c=a-r-1,f>=0){const m={data:t.subarray(f,c),type:p};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(s&&a<=4-s&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-s)),c>0&&(m.data=rs(m.data,t.subarray(0,c)),m.state=0))}a<i?(u=t[a]&31,f=a,p=u,r=0):r=-1}else r=0}if(f>=0&&r>=0){const m={data:t.subarray(f,i),type:p,state:r};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=rs(m.data,t))}return e.naluState=r,o}}class j2{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new l1(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const o=kB(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(i>=s.length);i++){const o=s[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,r,o),!this.decrypter.isSync()))return}}}}const on=188;class gl{constructor(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.videoParser=new V2}static probe(e){const t=gl.syncOffset(e);return t>0&&ge.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let i=Math.min(on*5,t-on)+1,r=0;for(;r<i;){let s=!1,o=-1,a=0;for(let l=r;l<t;l+=on)if(e[l]===71&&(t-l===on||e[l+on]===71)){if(a++,o===-1&&(o=l,o!==0&&(i=Math.min(o+on*99,e.length-on)+1)),s||(s=BS(e,l)===0),s&&a>1&&(o===0&&a>2||l+on>i))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:AB[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=gl.createTrack("video"),this._audioTrack=gl.createTrack("audio",r),this._id3Track=gl.createTrack("id3"),this._txtTrack=gl.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=o.pid,f=o.pesData,p=a.pid,m=l.pid,y=a.pesData,_=l.pesData,w=null,T=this.pmtParsed,x=this._pmtId,C=e.length;if(this.remainderData&&(e=rs(this.remainderData,e),C=e.length,this.remainderData=null),C<on&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const I=Math.max(0,gl.syncOffset(e));C-=(C-I)%on,C<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,C,e.buffer.byteLength-C));let D=0;for(let N=I;N<C;N+=on)if(e[N]===71){const z=!!(e[N+1]&64),Z=BS(e,N),q=(e[N+3]&48)>>4;let H;if(q>1){if(H=N+5+e[N+4],H===N+on)continue}else H=N+4;switch(Z){case u:z&&(f&&(s=Sh(f))&&this.videoParser.parseAVCPES(o,c,s,!1,this._duration),f={data:[],size:0}),f&&(f.data.push(e.subarray(H,N+on)),f.size+=N+on-H);break;case p:if(z){if(y&&(s=Sh(y)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(H,N+on)),y.size+=N+on-H);break;case m:z&&(_&&(s=Sh(_))&&this.parseID3PES(l,s),_={data:[],size:0}),_&&(_.data.push(e.subarray(H,N+on)),_.size+=N+on-H);break;case 0:z&&(H+=e[H]+1),x=this._pmtId=W2(e,H);break;case x:{z&&(H+=e[H]+1);const Y=q2(e,H,this.typeSupported,i,this.observer);u=Y.videoPid,u>0&&(o.pid=u,o.segmentCodec=Y.segmentVideoCodec),p=Y.audioPid,p>0&&(a.pid=p,a.segmentCodec=Y.segmentAudioCodec),m=Y.id3Pid,m>0&&(l.pid=m),w!==null&&!T&&(ge.warn(`MPEG-TS PMT found at ${N} after unknown PID '${w}'. Backtracking to sync byte @${I} to parse all TS packets.`),w=null,N=I-188),T=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=Z;break}}else D++;D>0&&i0(this.observer,new Error(`Found ${D} TS packet/s that do not start with 0x47`)),o.pesData=f,a.pesData=y,l.pesData=_;const B={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(B),B}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,o=i.pesData,a=t.pesData,l=r.pesData;let c;if(o&&(c=Sh(o))?(this.videoParser.parseAVCPES(i,s,c,!0,this._duration),i.pesData=null):i.pesData=o,a&&(c=Sh(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&ge.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=Sh(l))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new j2(this.observer,this.config,t);return this.decrypt(r,s)}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const f=r.missing,p=r.sample.unit.byteLength;if(f===-1)s=rs(r.sample.unit,s);else{const m=p-f;r.sample.unit.set(s.subarray(0,f),m),e.samples.push(r.sample),i=r.missing}}let o,a;for(o=i,a=s.length;o<a-1&&!t0(s,o);o++);if(o!==i){let f;const p=o<a-1;if(p?f=`AAC PES did not start with ADTS header,offset:${o}`:f="No ADTS header found in AAC PES",i0(this.observer,new Error(f),p),!p)return}ZB(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const f=YB(e.samplerate);l=r.sample.pts+f}else{ge.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;o<a;)if(u=XB(e,s,o,l,c),o+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;o<a-1&&!t0(s,o);o++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,o=0;const a=t.pts;if(a===void 0){ge.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(eU(i,o)){const l=JB(e,i,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){ge.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let o=0,a=0,l;for(;a<s&&(l=nU(e,i,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){ge.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Vi({},t,{type:this._videoTrack?Rs.emsg:Rs.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function BS(n,e){return((n[e+1]&31)<<8)+n[e+2]}function W2(n,e){return(n[e+10]&31)<<8|n[e+11]}function q2(n,e,t,i,r){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],a=e+3+o-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<a;){const c=BS(n,e),u=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){jw("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=c);break;case 21:s.id3Pid===-1&&(s.id3Pid=c);break;case 219:if(!i){jw("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=c,s.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?ge.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=c,s.segmentAudioCodec="mp3");break;case 193:if(!i){jw("AC-3");break}case 129:t.ac3?s.audioPid===-1&&(s.audioPid=c,s.segmentAudioCodec="ac3"):ge.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&u>0){let f=e+5,p=u;for(;p>2;){switch(n[f]){case 106:t.ac3!==!0?ge.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=c,s.segmentAudioCodec="ac3");break}const y=n[f+1]+2;f+=y,p-=y}}break;case 194:case 135:return i0(r,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return i0(r,new Error("Unsupported HEVC in M2TS found")),s}e+=u+5}return s}function i0(n,e,t){ge.warn(`parsing error: ${e.message}`),n.emit($.ERROR,$.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function jw(n){ge.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Sh(n){let e=0,t,i,r,s,o;const a=n.data;if(!n||n.size===0)return null;for(;a[0].length<19&&a.length>1;)a[0]=rs(a[0],a[1]),a.splice(1,1);if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(i=(t[4]<<8)+t[5],i&&i>n.size-6)return null;const c=t[7];c&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,c&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-o>60*9e4&&(ge.warn(`${Math.round((s-o)/9e4)}s delta between PTS and DTS, align them`),s=o)):o=s),r=t[8];let u=r+9;if(n.size<=u)return null;n.size-=u;const f=new Uint8Array(n.size);for(let p=0,m=a.length;p<m;p++){t=a[p];let y=t.byteLength;if(u)if(u>y){u-=y;continue}else t=t.subarray(u),y-=u,u=0;f.set(t,e),e+=y}return i&&(i-=r+3),{data:f,pts:s,dts:o,len:i}}return null}class K2 extends u1{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Wp(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&r1(t)!==void 0&&iU(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(tU(e,i))return ge.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return B2(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return JB(e,t,i,this.basePTS,this.frameIndex)}}class tP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const al=Math.pow(2,32)-1;class Ee{static init(){Ee.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Ee.types)Ee.types.hasOwnProperty(e)&&(Ee.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Ee.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Ee.STTS=Ee.STSC=Ee.STCO=s,Ee.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ee.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Ee.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Ee.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);Ee.FTYP=Ee.box(Ee.types.ftyp,o,l,o,a),Ee.DINF=Ee.box(Ee.types.dinf,Ee.box(Ee.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),r=0,i=8;r<s;r++)o.set(t[r],i),i+=t[r].byteLength;return o}static hdlr(e){return Ee.box(Ee.types.hdlr,Ee.HDLR_TYPES[e])}static mdat(e){return Ee.box(Ee.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(al+1)),r=Math.floor(t%(al+1));return Ee.box(Ee.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return Ee.box(Ee.types.mdia,Ee.mdhd(e.timescale,e.duration),Ee.hdlr(e.type),Ee.minf(e))}static mfhd(e){return Ee.box(Ee.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Ee.box(Ee.types.minf,Ee.box(Ee.types.smhd,Ee.SMHD),Ee.DINF,Ee.stbl(e)):Ee.box(Ee.types.minf,Ee.box(Ee.types.vmhd,Ee.VMHD),Ee.DINF,Ee.stbl(e))}static moof(e,t,i){return Ee.box(Ee.types.moof,Ee.mfhd(e),Ee.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=Ee.trak(e[t]);return Ee.box.apply(null,[Ee.types.moov,Ee.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(Ee.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=Ee.trex(e[t]);return Ee.box.apply(null,[Ee.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(al+1)),r=Math.floor(t%(al+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ee.box(Ee.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Ee.box(Ee.types.sdtp,i)}static stbl(e){return Ee.box(Ee.types.stbl,Ee.stsd(e),Ee.box(Ee.types.stts,Ee.STTS),Ee.box(Ee.types.stsc,Ee.STSC),Ee.box(Ee.types.stsz,Ee.STSZ),Ee.box(Ee.types.stco,Ee.STCO))}static avc1(e){let t=[],i=[],r,s,o;for(r=0;r<e.sps.length;r++)s=e.sps[r],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],o=s.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(s));const a=Ee.box(Ee.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,c=e.height,u=e.pixelRatio[0],f=e.pixelRatio[1];return Ee.box(Ee.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Ee.box(Ee.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Ee.box(Ee.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,f>>24,f>>16&255,f>>8&255,f&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return Ee.box(Ee.types.mp4a,Ee.audioStsd(e),Ee.box(Ee.types.esds,Ee.esds(e)))}static mp3(e){return Ee.box(Ee.types[".mp3"],Ee.audioStsd(e))}static ac3(e){return Ee.box(Ee.types["ac-3"],Ee.audioStsd(e),Ee.box(Ee.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?Ee.box(Ee.types.stsd,Ee.STSD,Ee.mp3(e)):e.segmentCodec==="ac3"?Ee.box(Ee.types.stsd,Ee.STSD,Ee.ac3(e)):Ee.box(Ee.types.stsd,Ee.STSD,Ee.mp4a(e)):Ee.box(Ee.types.stsd,Ee.STSD,Ee.avc1(e))}static tkhd(e){const t=e.id,i=e.duration*e.timescale,r=e.width,s=e.height,o=Math.floor(i/(al+1)),a=Math.floor(i%(al+1));return Ee.box(Ee.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const i=Ee.sdtp(e),r=e.id,s=Math.floor(t/(al+1)),o=Math.floor(t%(al+1));return Ee.box(Ee.types.traf,Ee.box(Ee.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),Ee.box(Ee.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),Ee.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,Ee.box(Ee.types.trak,Ee.tkhd(e),Ee.mdia(e))}static trex(e){const t=e.id;return Ee.box(Ee.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,o=new Uint8Array(s);let a,l,c,u,f,p;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<r;a++)l=i[a],c=l.duration,u=l.size,f=l.flags,p=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&61440,f.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*a);return Ee.box(Ee.types.trun,o)}static initSegment(e){Ee.types||Ee.init();const t=Ee.moov(e);return rs(Ee.FTYP,t)}}Ee.types=void 0;Ee.HDLR_TYPES=void 0;Ee.STTS=void 0;Ee.STSC=void 0;Ee.STCO=void 0;Ee.STSZ=void 0;Ee.VMHD=void 0;Ee.SMHD=void 0;Ee.STSD=void 0;Ee.FTYP=void 0;Ee.DINF=void 0;const rU=9e4;function f1(n,e,t=1,i=!1){const r=n*e*t;return i?Math.round(r):r}function Z2(n,e,t=1,i=!1){return f1(n,e,1/t,i)}function Qf(n,e=!1){return f1(n,1e3,1/rU,e)}function Y2(n,e=1){return f1(n,rU,1/e)}const X2=10*1e3,iP=1024,J2=1152,Q2=1536;let bh=null,Ww=null;class ty{constructor(e,t,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,bh===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);bh=o?parseInt(o[1]):0}if(Ww===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Ww=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){ge.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){ge.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){ge.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e.reduce((r,s)=>{const o=s.pts-r;return o<-4294967296?(t=!0,Qr(r,s.pts)):o>0?r:s.pts},e[0].pts);return t&&ge.debug("PTS rollover detected"),i}remux(e,t,i,r,s,o,a,l){let c,u,f,p,m,y,_=s,w=s;const T=e.pid>-1,x=t.pid>-1,C=t.samples.length,I=e.samples.length>0,D=a&&C>0||C>1;if((!T||I)&&(!x||D)||this.ISGenerated||a){if(this.ISGenerated){var N,z,Z,q;const le=this.videoTrackConfig;le&&(t.width!==le.width||t.height!==le.height||((N=t.pixelRatio)==null?void 0:N[0])!==((z=le.pixelRatio)==null?void 0:z[0])||((Z=t.pixelRatio)==null?void 0:Z[1])!==((q=le.pixelRatio)==null?void 0:q[1]))&&this.resetInitSegment()}else f=this.generateIS(e,t,s,o);const H=this.isVideoContiguous;let Y=-1,ee;if(D&&(Y=eee(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,Y>0){ge.warn(`[mp4-remuxer]: Dropped ${Y} out of ${C} video samples due to a missing keyframe`);const le=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(Y),t.dropped+=Y,w+=(t.samples[0].pts-le)/t.inputTimeScale,ee=w}else Y===-1&&(ge.warn(`[mp4-remuxer]: No keyframe found out of ${C} video samples`),y=!1);if(this.ISGenerated){if(I&&D){const le=this.getVideoStartPts(t.samples),ie=(Qr(e.samples[0].pts,le)-le)/t.inputTimeScale;_+=Math.max(0,ie),w+=Math.max(0,-ie)}if(I){if(e.samplerate||(ge.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,s,o)),u=this.remuxAudio(e,_,this.isAudioContiguous,o,x||D||l===mt.AUDIO?w:void 0),D){const le=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(ge.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,s,o)),c=this.remuxVideo(t,w,H,le)}}else D&&(c=this.remuxVideo(t,w,H,0));c&&(c.firstKeyFrame=Y,c.independent=Y!==-1,c.firstKeyFramePTS=ee)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(m=sU(i,s,this._initPTS,this._initDTS)),r.samples.length&&(p=oU(r,s,this._initPTS))),{audio:u,video:c,initSegment:f,independent:y,text:p,id3:m}}generateIS(e,t,i,r){const s=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let u=!c||r,f="audio/mp4",p,m,y;if(u&&(p=m=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):Ee.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(y=e.inputTimeScale,!c||y!==c.timescale?p=m=s[0].pts-Math.round(y*i):u=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ee.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(y=t.inputTimeScale,!c||y!==c.timescale){const _=this.getVideoStartPts(o),w=Math.round(y*i);m=Math.min(m,Qr(o[0].dts,_)-w),p=Math.min(p,_-w)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:p,timescale:y},this._initDTS={baseTime:m,timescale:y}):p=y=void 0,{tracks:l,initPTS:p,timescale:y}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS;let u=this.nextAvcDts,f=8,p=this.videoSampleDuration,m,y,_=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,T=!1;if(!i||u===null){const ce=t*s,se=o[0].pts-Qr(o[0].dts,o[0].pts);bh&&u!==null&&Math.abs(ce-se-u)<15e3?i=!0:u=ce-se}const x=c.baseTime*s/c.timescale;for(let ce=0;ce<l;ce++){const se=o[ce];se.pts=Qr(se.pts-x,u),se.dts=Qr(se.dts-x,u),se.dts<o[ce>0?ce-1:ce].dts&&(T=!0)}T&&o.sort(function(ce,se){const te=ce.dts-se.dts,Q=ce.pts-se.pts;return te||Q}),m=o[0].dts,y=o[o.length-1].dts;const C=y-m,I=C?Math.round(C/(l-1)):p||e.inputTimeScale/30;if(i){const ce=m-u,se=ce>I,te=ce<-1;if((se||te)&&(se?ge.warn(`AVC: ${Qf(ce,!0)} ms (${ce}dts) hole between fragments detected at ${t.toFixed(3)}`):ge.warn(`AVC: ${Qf(-ce,!0)} ms (${ce}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||u>=o[0].pts||bh)){m=u;const Q=o[0].pts-ce;if(se)o[0].dts=m,o[0].pts=Q;else for(let _e=0;_e<o.length&&!(o[_e].dts>Q);_e++)o[_e].dts-=ce,o[_e].pts-=ce;ge.log(`Video: Initial PTS/DTS adjusted: ${Qf(Q,!0)}/${Qf(m,!0)}, delta: ${Qf(ce,!0)} ms`)}}m=Math.max(0,m);let D=0,B=0,N=m;for(let ce=0;ce<l;ce++){const se=o[ce],te=se.units,Q=te.length;let _e=0;for(let fe=0;fe<Q;fe++)_e+=te[fe].data.length;B+=_e,D+=Q,se.length=_e,se.dts<N?(se.dts=N,N+=I/4|0||1):N=se.dts,_=Math.min(se.pts,_),w=Math.max(se.pts,w)}y=o[l-1].dts;const z=B+4*D+8;let Z;try{Z=new Uint8Array(z)}catch(ce){this.observer.emit($.ERROR,$.ERROR,{type:_t.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:ce,bytes:z,reason:`fail allocating video mdat ${z}`});return}const q=new DataView(Z.buffer);q.setUint32(0,z),Z.set(Ee.types.mdat,4);let H=!1,Y=Number.POSITIVE_INFINITY,ee=Number.POSITIVE_INFINITY,le=Number.NEGATIVE_INFINITY,W=Number.NEGATIVE_INFINITY;for(let ce=0;ce<l;ce++){const se=o[ce],te=se.units;let Q=0;for(let pe=0,Ce=te.length;pe<Ce;pe++){const xe=te[pe],Le=xe.data,je=xe.data.byteLength;q.setUint32(f,je),f+=4,Z.set(Le,f),f+=je,Q+=4+je}let _e;if(ce<l-1)p=o[ce+1].dts-se.dts,_e=o[ce+1].pts-se.pts;else{const pe=this.config,Ce=ce>0?se.dts-o[ce-1].dts:I;if(_e=ce>0?se.pts-o[ce-1].pts:I,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const xe=Math.floor(pe.maxBufferHole*s),Le=(r?_+r*s:this.nextAudioPts)-se.pts;Le>xe?(p=Le-Ce,p<0?p=Ce:H=!0,ge.log(`[mp4-remuxer]: It is approximately ${Le/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=Ce}else p=Ce}const fe=Math.round(se.pts-se.dts);Y=Math.min(Y,p),le=Math.max(le,p),ee=Math.min(ee,_e),W=Math.max(W,_e),a.push(new nP(se.key,p,Q,fe))}if(a.length){if(bh){if(bh<70){const ce=a[0].flags;ce.dependsOn=2,ce.isNonSync=0}}else if(Ww&&W-ee<le-Y&&I/le<.025&&a[0].cts===0){ge.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ce=m;for(let se=0,te=a.length;se<te;se++){const Q=ce+a[se].duration,_e=ce+a[se].cts;if(se<te-1){const fe=Q+a[se+1].cts;a[se].duration=fe-_e}else a[se].duration=se?a[se-1].duration:I;a[se].cts=0,ce=Q}}}p=H||!p?I:p,this.nextAvcDts=u=y+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const J={data1:Ee.moof(e.sequenceNumber++,m,Vi({},e,{samples:a})),data2:Z,startPTS:_/s,endPTS:(w+p)/s,startDTS:m/s,endDTS:u/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,J}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return J2;case"ac3":return Q2;default:return iP}}remuxAudio(e,t,i,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),u=c*l,f=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],y=s!==void 0;let _=e.samples,w=p?0:8,T=this.nextAudioPts||-1;const x=t*o,C=f.baseTime*o/f.timescale;if(this.isAudioContiguous=i=i||_.length&&T>0&&(r&&Math.abs(x-T)<9e3||Math.abs(Qr(_[0].pts-C,x)-T)<20*u),_.forEach(function(ie){ie.pts=Qr(ie.pts-C,x)}),!i||T<0){if(_=_.filter(ie=>ie.pts>=0),!_.length)return;s===0?T=0:r&&!y?T=Math.max(0,x):T=_[0].pts}if(e.segmentCodec==="aac"){const ie=this.config.maxAudioFramesDrift;for(let ne=0,J=T;ne<_.length;ne++){const ce=_[ne],se=ce.pts,te=se-J,Q=Math.abs(1e3*te/o);if(te<=-ie*u&&y)ne===0&&(ge.warn(`Audio frame @ ${(se/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*te/o)} ms.`),this.nextAudioPts=T=J=se);else if(te>=ie*u&&Q<X2&&y){let _e=Math.round(te/u);J=se-_e*u,J<0&&(_e--,J+=u),ne===0&&(this.nextAudioPts=T=J),ge.warn(`[mp4-remuxer]: Injecting ${_e} audio frame @ ${(J/o).toFixed(3)}s due to ${Math.round(1e3*te/o)} ms gap.`);for(let fe=0;fe<_e;fe++){const pe=Math.max(J,0);let Ce=tP.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Ce||(ge.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ce=ce.unit.subarray()),_.splice(ne,0,{unit:Ce,pts:pe}),J+=u,ne++}}ce.pts=J,J+=u}}let I=null,D=null,B,N=0,z=_.length;for(;z--;)N+=_[z].unit.byteLength;for(let ie=0,ne=_.length;ie<ne;ie++){const J=_[ie],ce=J.unit;let se=J.pts;if(D!==null){const Q=m[ie-1];Q.duration=Math.round((se-D)/l)}else if(i&&e.segmentCodec==="aac"&&(se=T),I=se,N>0){N+=w;try{B=new Uint8Array(N)}catch(Q){this.observer.emit($.ERROR,$.ERROR,{type:_t.MUX_ERROR,details:be.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:N,reason:`fail allocating audio mdat ${N}`});return}p||(new DataView(B.buffer).setUint32(0,N),B.set(Ee.types.mdat,4))}else return;B.set(ce,w);const te=ce.byteLength;w+=te,m.push(new nP(!0,c,te,0)),D=se}const Z=m.length;if(!Z)return;const q=m[m.length-1];this.nextAudioPts=T=D+l*q.duration;const H=p?new Uint8Array(0):Ee.moof(e.sequenceNumber++,I/l,Vi({},e,{samples:m}));e.samples=[];const Y=I/o,ee=T/o,W={data1:H,data2:B,startPTS:Y,endPTS:ee,startDTS:Y,endDTS:ee,type:"audio",hasAudio:!0,hasVideo:!1,nb:Z};return this.isAudioContiguous=!0,W}remuxEmptyAudio(e,t,i,r){const s=e.inputTimeScale,o=e.samplerate?e.samplerate:s,a=s/o,l=this.nextAudioPts,c=this._initDTS,u=c.baseTime*9e4/c.timescale,f=(l!==null?l:r.startDTS*s)+u,p=r.endDTS*s+u,m=a*iP,y=Math.ceil((p-f)/m),_=tP.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(ge.warn("[mp4-remuxer]: remux empty Audio"),!_){ge.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const w=[];for(let T=0;T<y;T++){const x=f+T*m;w.push({unit:_,pts:x,dts:x})}return e.samples=w,this.remuxAudio(e,t,i,!1)}}function Qr(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function eee(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function sU(n,e,t,i){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let a=0;a<r;a++){const l=n.samples[a];l.pts=Qr(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Qr(l.dts-i.baseTime*s/i.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function oU(n,e,t){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let o=0;o<i;o++){const a=n.samples[o];a.pts=Qr(a.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class nP{constructor(e,t,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=r,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class tee{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(lQ(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=PB(e);r.audio&&(t=rP(r.audio,ni.AUDIO)),r.video&&(i=rP(r.video,ni.VIDEO));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?s.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:ge.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,i,r,s,o){var a,l;let{initPTS:c,lastEndTime:u}=this;const f={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Je(u)||(u=this.lastEndTime=s||0);const p=t.samples;if(!(p!=null&&p.length))return f;const m={initPTS:void 0,timescale:1};let y=this.initData;if((a=y)!=null&&a.length||(this.generateInitSegment(p),y=this.initData),!((l=y)!=null&&l.length))return ge.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const _=uQ(p,y),w=cQ(y,p),T=w===null?s:w;(iee(c,T,s,_)||m.timescale!==c.timescale&&o)&&(m.initPTS=T-s,c&&c.timescale===1&&ge.warn(`Adjusting initPTS by ${m.initPTS-c.baseTime}`),this.initPTS=c={baseTime:m.initPTS,timescale:1});const x=e?T-c.baseTime/c.timescale:u,C=x+_;dQ(y,p,c.baseTime/c.timescale),_>0?this.lastEndTime=C:(ge.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const I=!!y.audio,D=!!y.video;let B="";I&&(B+="audio"),D&&(B+="video");const N={data1:p,startPTS:x,startDTS:x,endPTS:C,endDTS:C,type:B,hasAudio:I,hasVideo:D,nb:1,dropped:0};return f.audio=N.type==="audio"?N:void 0,f.video=N.type!=="audio"?N:void 0,f.initSegment=m,f.id3=sU(i,s,c,c),r.samples.length&&(f.text=oU(r,s,c)),f}}function iee(n,e,t,i){if(n===null)return!0;const r=Math.max(i,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>r}function rP(n,e){const t=n==null?void 0:n.codec;if(t&&t.length>4)return t;if(e===ni.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return Zy(t,!1);const i="mp4a.40.5";return ge.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${i}"`),i}return ge.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let ea;try{ea=self.performance.now.bind(self.performance)}catch{ge.debug("Unable to use Performance API on this environment"),ea=wd==null?void 0:wd.Date.now}const iy=[{demux:G2,remux:tee},{demux:gl,remux:ty},{demux:U2,remux:ty},{demux:K2,remux:ty}];iy.splice(2,0,{demux:H2,remux:ty});class sP{constructor(e,t,i,r,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=r,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=ea();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:f,accurateTimeOffset:p,timeOffset:m,initSegmentChange:y}=r||a,{audioCodec:_,videoCodec:w,defaultInitPts:T,duration:x,initSegmentData:C}=l,I=nee(o,t);if(I&&I.method==="AES-128"){const z=this.getDecrypter();if(z.isSync()){let Z=z.softwareDecrypt(o,I.key.buffer,I.iv.buffer);if(i.part>-1&&(Z=z.flush()),!Z)return s.executeEnd=ea(),qw(i);o=new Uint8Array(Z)}else return this.decryptionPromise=z.webCryptoDecrypt(o,I.key.buffer,I.iv.buffer).then(Z=>{const q=this.push(Z,null,i);return this.decryptionPromise=null,q}),this.decryptionPromise}const D=this.needsProbing(u,f);if(D){const z=this.configureTransmuxer(o);if(z)return ge.warn(`[transmuxer] ${z.message}`),this.observer.emit($.ERROR,$.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,fatal:!1,error:z,reason:z.message}),s.executeEnd=ea(),qw(i)}(u||f||y||D)&&this.resetInitSegment(C,_,w,x,t),(u||y||D)&&this.resetInitialTimestamp(T),c||this.resetContiguity();const B=this.transmux(o,I,m,p,i),N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,s.executeEnd=ea(),B}flush(e){const t=e.transmuxing;t.executeStart=ea();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(i){const f=i.flush();f&&o.push(this.push(f,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c)return t.executeEnd=ea(),[qw(e)];const u=l.flush(a);return ny(u)?u.then(f=>(this.flushRemux(o,f,e),o)):(this.flushRemux(o,u,e),o)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;ge.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const u=this.remuxer.remux(r,s,o,a,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:i}),i.transmuxing.executeEnd=ea()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,i,r),a.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,r,s):o=this.transmuxUnencrypted(e,i,r,s),o}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r,vendor:s}=this;let o;for(let p=0,m=iy.length;p<m;p++){var a;if((a=iy[p].demux)!=null&&a.probe(e)){o=iy[p];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,c=this.remuxer,u=o.remux,f=o.demux;(!c||!(c instanceof u))&&(this.remuxer=new u(i,t,r,s)),(!l||!(l instanceof f))&&(this.demuxer=new f(i,t,r),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new l1(this.config)),e}}function nee(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const qw=n=>({remuxResult:{},chunkMeta:n});function ny(n){return"then"in n&&n.then instanceof Function}class ree{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class see{constructor(e,t,i,r,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=o}}var aU={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,f,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new r(u,f||l,p),y=t?t+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],m]:l._events[y].push(m):(l._events[y]=m,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,f;if(this._eventsCount===0)return c;for(f in u=this._events)e.call(u,f)&&c.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var p=0,m=f.length,y=new Array(m);p<m;p++)y[p]=f[p].fn;return y},a.prototype.listenerCount=function(c){var u=t?t+c:c,f=this._events[u];return f?f.fn?1:f.length:0},a.prototype.emit=function(c,u,f,p,m,y){var _=t?t+c:c;if(!this._events[_])return!1;var w=this._events[_],T=arguments.length,x,C;if(w.fn){switch(w.once&&this.removeListener(c,w.fn,void 0,!0),T){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,u),!0;case 3:return w.fn.call(w.context,u,f),!0;case 4:return w.fn.call(w.context,u,f,p),!0;case 5:return w.fn.call(w.context,u,f,p,m),!0;case 6:return w.fn.call(w.context,u,f,p,m,y),!0}for(C=1,x=new Array(T-1);C<T;C++)x[C-1]=arguments[C];w.fn.apply(w.context,x)}else{var I=w.length,D;for(C=0;C<I;C++)switch(w[C].once&&this.removeListener(c,w[C].fn,void 0,!0),T){case 1:w[C].fn.call(w[C].context);break;case 2:w[C].fn.call(w[C].context,u);break;case 3:w[C].fn.call(w[C].context,u,f);break;case 4:w[C].fn.call(w[C].context,u,f,p);break;default:if(!x)for(D=1,x=new Array(T-1);D<T;D++)x[D-1]=arguments[D];w[C].fn.apply(w[C].context,x)}}return!0},a.prototype.on=function(c,u,f){return s(this,c,u,f,!1)},a.prototype.once=function(c,u,f){return s(this,c,u,f,!0)},a.prototype.removeListener=function(c,u,f,p){var m=t?t+c:c;if(!this._events[m])return this;if(!u)return o(this,m),this;var y=this._events[m];if(y.fn)y.fn===u&&(!p||y.once)&&(!f||y.context===f)&&o(this,m);else{for(var _=0,w=[],T=y.length;_<T;_++)(y[_].fn!==u||p&&!y[_].once||f&&y[_].context!==f)&&w.push(y[_]);w.length?this._events[m]=w.length===1?w[0]:w:o(this,m)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(aU);var oee=aU.exports,p1=LJ(oee);class lU{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const o=(c,u)=>{u=u||{},u.frag=this.frag,u.id=this.id,c===$.ERROR&&(this.error=u.error),this.hls.trigger(c,u)};this.observer=new p1,this.observer.on($.FRAG_DECRYPTED,o),this.observer.on($.ERROR,o);const a=nu(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||x2())){try{s.workerPath?(ge.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=R2(s.workerPath)):(ge.log(`injecting Web Worker for "${t}"`),this.workerContext=C2()),this.onwmsg=f=>this.onWorkerMessage(f);const{worker:u}=this.workerContext;u.addEventListener("message",this.onwmsg),u.onerror=f=>{const p=new Error(`${f.message}  (${f.filename}:${f.lineno})`);s.enableWorker=!1,ge.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger($.ERROR,{type:_t.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:p})},u.postMessage({cmd:"init",typeSupported:l,vendor:"",id:t,config:JSON.stringify(s)})}catch(u){ge.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.resetWorker(),this.error=null,this.transmuxer=new sP(this.observer,l,s,"",t)}return}this.transmuxer=new sP(this.observer,l,s,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,i,r,s,o,a,l,c,u){var f,p;c.transmuxing.start=self.performance.now();const{transmuxer:m}=this,y=o?o.start:s.start,_=s.decryptdata,w=this.frag,T=!(w&&s.cc===w.cc),x=!(w&&c.level===w.level),C=w?c.sn-w.sn:-1,I=this.part?c.part-this.part.index:-1,D=C===0&&c.id>1&&c.id===(w==null?void 0:w.stats.chunkCount),B=!x&&(C===1||C===0&&(I===1||D&&I<=0)),N=self.performance.now();(x||C||s.stats.parsing.start===0)&&(s.stats.parsing.start=N),o&&(I||!B)&&(o.stats.parsing.start=N);const z=!(w&&((f=s.initSegment)==null?void 0:f.url)===((p=w.initSegment)==null?void 0:p.url)),Z=new see(T,B,l,x,y,z);if(!B||T||z){ge.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${T}
        trackSwitch: ${x}
        contiguous: ${B}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${z}`);const q=new ree(i,r,t,a,u);this.configureTransmuxer(q)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:_,chunkMeta:c,state:Z},e instanceof ArrayBuffer?[e]:[]);else if(m){const q=m.push(e,_,c,Z);ny(q)?(m.async=!0,q.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,c,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(q))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let i=t.flush(e);ny(i)||t.async?(ny(i)||(i=Promise.resolve(i)),i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){ge.warn(`worker message received with no ${t?"event name":"data"}`);return}const i=this.hls;if(this.hls)switch(t.event){case"init":{var r;const s=(r=this.workerContext)==null?void 0:r.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":ge[t.data.logType]&&ge[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function cU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Sd(n[t].attrs,e[t].attrs))return!1;return!0}function Sd(n,e,t){const i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function US(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}const oP=100;class aee extends c1{constructor(e,t,i){super(e,t,i,"[audio-stream-controller]",mt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.ERROR,this.onError,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.ERROR,this.onError,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){if(i==="main"){const o=t.cc;this.initPTS[t.cc]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${r}`),this.videoTrackCC=o,this.state===Oe.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=Oe.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(oP),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=Oe.IDLE):(this.loadedmetadata=!1,this.state=Oe.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case Oe.IDLE:this.doTickIdle();break;case Oe.WAITING_TRACK:{var e;const{levels:i,trackId:r}=this,s=i==null||(e=i[r])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=Oe.WAITING_INIT_PTS}break}case Oe.FRAG_LOADING_WAITING_RETRY:{var t;const i=performance.now(),r=this.retryDate;if(!r||i>=r||(t=this.media)!=null&&t.seeking){const{levels:s,trackId:o}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[o])||null),this.state=Oe.IDLE}break}case Oe.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:r,part:s,cache:o,complete:a}=i;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=Oe.FRAG_LOADING;const l=o.flush(),c={frag:r,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),a&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),c=pi.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);FS(c.end,this.config.maxFragLookUpTolerance,r)<0&&(this.log(`Waiting fragment cc (${r.cc}) @ ${r.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=Oe.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Oe.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:i,trackId:r}=this,s=e.config;if(!i&&(this.startFragRequested||!s.startFragPrefetch)||!(t!=null&&t[r]))return;const o=t[r],a=o.details;if(!a||a.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(a)){this.state=Oe.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ni.AUDIO,mt.AUDIO));const c=this.getFwdBufferInfo(l,mt.AUDIO);if(c===null)return;const{bufferedTrack:u,switchingTrack:f}=this;if(!f&&this._streamEnded(c,a)){e.trigger($.BUFFER_EOS,{type:"audio"}),this.state=Oe.ENDED;return}const p=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,mt.MAIN),m=c.len,y=this.getMaxBufferLength(p==null?void 0:p.len),_=a.fragments,w=_[0].start;let T=this.flushing?this.getLoadPosition():c.end;if(f&&i){const D=this.getLoadPosition();u&&!Sd(f.attrs,u.attrs)&&(T=D),a.PTSKnown&&D<w&&(c.end>w||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=w+.05)}if(m>=y&&!f&&T<_[_.length-1].start)return;let x=this.getNextFragment(T,a),C=!1;if(x&&this.isLoopLoading(x,T)&&(C=!!x.gap,x=this.getNextFragmentLoopLoading(x,a,c,mt.MAIN,y)),!x){this.bufferFlushed=!0;return}const I=p&&x.start>p.end+a.targetduration;if(I||!(p!=null&&p.len)&&c.len){const D=this.getAppendedFrag(x.start,mt.MAIN);if(D===null||(C||(C=!!D.gap||!!I&&p.len===0),I&&!C||C&&c.nextStart&&c.nextStart<D.end))return}this.loadFragment(x,o,T)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Td(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(oP):this.resetTransmuxer(),i?(this.switchingTrack=t,this.state=Oe.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Oe.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger($.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:r}=this,{details:s,id:o}=t;if(!r){this.warn(`Audio tracks were reset while loading level ${o}`);return}this.log(`Audio track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const a=r[o];let l=0;if(s.live||(i=a.details)!=null&&i.live){this.checkLiveUpdate(s);const u=this.mainDetails;if(s.deltaUpdateFailed||!u)return;if(!a.details&&s.hasProgramDateTime&&u.hasProgramDateTime)e0(s,u),l=s.fragments[0].start;else{var c;l=this.alignPlaylists(s,a.details,(c=this.levelLastLoaded)==null?void 0:c.details)}}a.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,l),this.state===Oe.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=Oe.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const f=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new lU(this.hls,mt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[i.cc],y=(t=i.initSegment)==null?void 0:t.data;if(m!==void 0){const w=r?r.index:-1,T=w!==-1,x=new a1(i.level,i.sn,i.stats.chunkCount,s.byteLength,w,T);p.push(s,y,f,"",i,r,u.totalduration,!1,x,m)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:_}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new WB,complete:!1};_.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=Oe.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==mt.AUDIO){if(!this.loadedmetadata&&i.type===mt.MAIN){const s=this.videoBuffer||this.media;s&&pi.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger($.AUDIO_TRACK_SWITCHED,gn({},s)))}this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=Oe.ERROR;return}switch(t.details){case be.FRAG_GAP:case be.FRAG_PARSING_ERROR:case be.FRAG_DECRYPT_ERROR:case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(mt.AUDIO,t);break;case be.AUDIO_TRACK_LOAD_ERROR:case be.AUDIO_TRACK_LOAD_TIMEOUT:case be.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Oe.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===jt.AUDIO_TRACK&&(this.state=Oe.IDLE);break;case be.BUFFER_APPEND_ERROR:case be.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===be.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case be.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ni.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ni.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Oe.ENDED&&(this.state=Oe.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,mt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{details:f}=u,{audio:p,text:m,id3:y,initSegment:_}=s;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=Oe.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),_!=null&&_.tracks){const w=l.initSegment||l;this._bufferInitSegment(u,_.tracks,w,o),r.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:i,tracks:_.tracks})}if(p){const{startPTS:w,endPTS:T,startDTS:x,endDTS:C}=p;c&&(c.elementaryStreams[ni.AUDIO]={startPTS:w,endPTS:T,startDTS:x,endDTS:C}),l.setElementaryStreamInfo(ni.AUDIO,w,T,x,C),this.bufferFragmentData(p,l,c,o)}if(y!=null&&(t=y.samples)!=null&&t.length){const w=Vi({id:i,frag:l,details:f},y);r.trigger($.FRAG_PARSING_METADATA,w)}if(m){const w=Vi({id:i,frag:l,details:f},m);r.trigger($.FRAG_PARSING_USERDATA,w)}}_bufferInitSegment(e,t,i,r){if(this.state!==Oe.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.id="audio";const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger($.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:a};this.hls.trigger($.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||r===dn.NOT_LOADED||r===dn.PARTIAL){var s;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Oe.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragments[0].start!==t.details.fragments[0].start&&e0(t.details,o)}else this.startFragRequested=!0,super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:i}=this,r=i==null?void 0:i.attrs,s=e.attrs;t&&r&&(r.CHANNELS!==s.CHANNELS||i.name!==e.name||i.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger($.AUDIO_TRACK_SWITCHED,gn({},e))}}class lee extends o1{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off($.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(p=>!i||i.indexOf(p.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(p=>p.default)&&(this.selectDefaultTrack=!1),a.forEach((p,m)=>{p.id=m});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const p=ao(l,a,wh);if(p>-1)s=a[p];else{const m=ao(l,this.tracks);s=this.tracks[m]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const u={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger($.AUDIO_TRACKS_UPDATED,u);const f=this.trackId;if(c!==-1&&f===-1)this.setAudioTrack(c);else if(a.length&&f===-1){var o;const p=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(p.message),this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===jt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&Qh(e,r,wh))return r;const s=ao(e,this.tracksInGroup,wh);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=l2(e,t.levels,i,o,wh);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=ao(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger($.AUDIO_TRACK_SWITCHING,gn({},r)),s))return;const o=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Qh(e,r,wh)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(Qh({name:i,lang:r,assocLang:s,characteristics:o,audioCodec:a,channels:l},u,wh))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Sd(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(Sd(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const i=t.id,r=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${i} "${t.name}" lang:${t.lang} group:${r}`),this.clearTimer(),this.hls.trigger($.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:e||null})}}}const aP=500;class cee extends c1{constructor(e,t,i){super(e,t,i,"[subtitle-stream-controller]",mt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.ERROR,this.onError,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.ERROR,this.onError,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=Oe.IDLE,this.setInterval(aP),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragPrevious=i,this.state=Oe.IDLE,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=i.start;for(let c=0;c<s.length;c++)if(a>=s[c].start&&a<=s[c].end){o=s[c];break}const l=i.start+i.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null)}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(i,s,mt.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===mt.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===mt.SUBTITLE&&(t.details===be.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Oe.STOPPED&&(this.state=Oe.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&cU(this.levels,t)){this.levels=t.map(i=>new Td(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new Td(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,mt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(aP)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(i=l.details)!=null&&i.live){const f=this.mainDetails;if(o.deltaUpdateFailed||!f)return;const p=f.fragments[0];if(!l.details)o.hasProgramDateTime&&f.hasProgramDateTime?(e0(o,f),c=o.fragments[0].start):p&&(c=p.start,NS(o,c));else{var u;c=this.alignPlaylists(o,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&p&&(c=p.start,NS(o,c))}}l.details=o,this.levelLastLoaded=l,a===r&&(!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,c),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Oe.IDLE&&(Qy(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&r.method==="AES-128"){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(a=>{throw s.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger($.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=Oe.IDLE})}}doTick(){if(!this.media){this.state=Oe.IDLE;return}if(this.state===Oe.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details)return;const{config:r}=this,s=this.getLoadPosition(),o=pi.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:a,len:l}=o,c=this.getFwdBufferInfo(this.media,mt.MAIN),u=i.details,f=this.getMaxBufferLength(c==null?void 0:c.len)+u.levelTargetDuration;if(l>f)return;const p=u.fragments,m=p.length,y=u.edge;let _=null;const w=this.fragPrevious;if(a<y){const T=r.maxFragLookUpTolerance,x=a>y-T?0:T;_=Qy(w,p,Math.max(p[0].start,a),x),!_&&w&&w.start<p[0].start&&(_=p[0])}else _=p[m-1];if(!_)return;if(_=this.mapToInitFragWhenRequired(_),_.sn!=="initSegment"){const T=_.sn-u.startSN,x=p[T-1];x&&x.cc===_.cc&&this.fragmentTracker.getState(x)===dn.NOT_LOADED&&(_=x)}this.fragmentTracker.getState(_)===dn.NOT_LOADED&&this.loadFragment(_,i,a)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,i){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,i))}get mediaBufferTimeRanges(){return new uee(this.tracksBuffered[this.currentTrackId]||[])}}class uee{constructor(e){this.buffered=void 0;const t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}class hee extends o1{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Jv(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADING,this.onLevelLoading,this),e.off($.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off($.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off($.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Jv(this.media.textTracks).forEach(t=>{Wh(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(u=>!i||i.indexOf(u.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(u=>u.default)&&(this.selectDefaultTrack=!1),o.forEach((u,f)=>{u.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const u=ao(a,o);if(u>-1)s=o[u];else{const f=ao(a,this.tracks);s=this.tracks[f]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger($.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||Qh(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(Sd(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Sd(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(US(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===jt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&Qh(e,i))return i;const r=ao(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=ao(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const i=t.id,r=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger($.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Jv(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(s=>US(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Je(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:u}=r;this.hls.trigger($.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:u});const f=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(f)}}class dee{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,i){const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const i=new Promise(s=>{t=s}),r={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,e),i}executeNext(e){const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){ge.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${r}`),i.onError(r);const s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const lP=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class fee{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=i=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:i,mediaSource:r}=this;this.log("Media source opened"),i&&(i.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger($.MEDIA_ATTACHED,{media:i,mediaSource:r})),r&&r.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&ge.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=TQ(nu(e.config.preferManagedMediaSource)),this.log=ge.log.bind(ge,t),this.warn=ge.warn.bind(ge,t),this.error=ge.error.bind(ge,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.BUFFER_RESET,this.onBufferReset,this),e.on($.BUFFER_APPENDING,this.onBufferAppending,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.BUFFER_EOS,this.onBufferEos,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on($.LEVEL_UPDATED,this.onLevelUpdated,this),e.on($.FRAG_PARSED,this.onFragParsed,this),e.on($.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.BUFFER_RESET,this.onBufferReset,this),e.off($.BUFFER_APPENDING,this.onBufferAppending,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.BUFFER_EOS,this.onBufferEos,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off($.LEVEL_UPDATED,this.onLevelUpdated,this),e.off($.FRAG_PARSED,this.onFragParsed,this),e.off($.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new dee(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const i=this.media=t.media,r=nu(this.appendSource);if(i&&r){var s;const o=this.mediaSource=new r;this.log(`created media source: ${(s=o.constructor)==null?void 0:s.name}`),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&o instanceof l,cP(i),pee(i,a),i.load()}catch{i.src=a}else i.src=a;i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:i}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(r){this.warn(`onMediaDetaching: ${r.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(e.removeAttribute("src"),this.appendSource&&cP(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger($.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var i;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(r){this.warn(`onBufferReset ${e}`,r)}}onBufferCodecs(e,t){const i=this.getSourceBufferTypes().length,r=Object.keys(t);if(r.forEach(o=>{if(i){const l=this.tracks[o];if(l&&typeof l.buffer.changeType=="function"){var a;const{id:c,codec:u,levelCodec:f,container:p,metadata:m}=t[o],y=II(l.codec,l.levelCodec),_=y==null?void 0:y.replace(lP,"$1");let w=II(u,f);const T=(a=w)==null?void 0:a.replace(lP,"$1");if(w&&_!==T){o.slice(0,5)==="audio"&&(w=Zy(w,this.appendSource));const x=`${p};codecs=${w}`;this.appendChangeType(o,x),this.log(`switching codec ${y} to ${w}`),this.tracks[o]={buffer:l.buffer,codec:u,container:p,levelCodec:f,metadata:m,id:c}}}}else this.pendingTracks[o]=t[o]}),i)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${r.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:i}=this,r={execute:()=>{const s=this.sourceBuffer[e];s&&(this.log(`changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),i.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${e} SourceBuffer type`,s)}};i.append(r,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:i,operationQueue:r,tracks:s}=this,{data:o,type:a,frag:l,part:c,chunkMeta:u}=t,f=u.buffering[a],p=self.performance.now();f.start=p;const m=l.stats.buffering,y=c?c.stats.buffering:null;m.start===0&&(m.start=p),y&&y.start===0&&(y.start=p);const _=s.audio;let w=!1;a==="audio"&&(_==null?void 0:_.container)==="audio/mpeg"&&(w=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const T=l.start,x={execute:()=>{if(f.executeStart=self.performance.now(),w){const C=this.sourceBuffer[a];if(C){const I=T-C.timestampOffset;Math.abs(I)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${T} (delta: ${I}) sn: ${l.sn})`),C.timestampOffset=T)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();f.executeEnd=f.end=C,m.first===0&&(m.first=C),y&&y.first===0&&(y.first=C);const{sourceBuffer:I}=this,D={};for(const B in I)D[B]=pi.getBuffered(I[B]);this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger($.BUFFER_APPENDED,{type:a,frag:l,part:c,chunkMeta:u,parent:l.type,timeRanges:D})},onError:C=>{const I={type:_t.MEDIA_ERROR,parent:l.type,details:be.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:l,part:c,chunkMeta:u,error:C,err:C,fatal:!1};if(C.code===DOMException.QUOTA_EXCEEDED_ERR)I.details=be.BUFFER_FULL_ERROR;else{const D=++this.appendErrors[a];I.details=be.BUFFER_APPEND_ERROR,this.warn(`Failed ${D}/${i.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),D>=i.config.appendErrorMaxRetry&&(I.fatal=!0)}i.trigger($.ERROR,I)}};r.append(x,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:i}=this,r=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger($.BUFFER_FLUSHED,{type:s})},onError:o=>{this.warn(`Failed to remove from ${s} SourceBuffer`,o)}});t.type?i.append(r(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{i.append(r(s),s)})}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],o=r?r.elementaryStreams:i.elementaryStreams;o[ni.AUDIOVIDEO]?s.push("audiovideo"):(o[ni.AUDIO]&&s.push("audio"),o[ni.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:i.stats;this.hls.trigger($.FRAG_BUFFERED,{frag:i,part:r,stats:c,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(a,s)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((r,s)=>{const o=this.sourceBuffer[s];return o&&(!t.type||t.type===s)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${s} sourceBuffer now EOS`))),r&&!!(!o||o.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const o=this.sourceBuffer[s];o&&(o.ending=!1)});const{mediaSource:r}=this;if(!r||r.readyState!=="open"){r&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${r.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),r.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.getSourceBufferTypes().length)return;const s=e.config,o=i.currentTime,a=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Je(l)&&l>0){const c=Math.max(l,a),u=Math.floor(o/a)*a-c;this.flushBackBuffer(o,a,u)}if(Je(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const c=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),u=Math.max(c,a),f=Math.floor(o/a)*a+u;this.flushFrontBuffer(o,a,f)}}flushBackBuffer(e,t,i){const{details:r,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const l=s[a];if(l){const c=pi.getBuffered(l);if(c.length>0&&i>c.start(0)){if(this.hls.trigger($.BACK_BUFFER_REACHED,{bufferEnd:i}),r!=null&&r.live)this.hls.trigger($.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l.ended&&c.end(c.length-1)-e<t*2){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:a})}}})}flushFrontBuffer(e,t,i){const{sourceBuffer:r}=this;this.getSourceBufferTypes().forEach(o=>{const a=r[o];if(a){const l=pi.getBuffered(a),c=l.length;if(c<2)return;const u=l.start(c-1),f=l.end(c-1);if(i>u||e>=u&&e<=f)return;if(a.ended&&e-f<2*t){this.log(`Cannot flush ${o} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger($.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:o})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:i,mediaSource:r}=this,s=e.fragments[0].start+e.totalduration,o=i.duration,a=Je(r.duration)?r.duration:0;e.live&&t.config.liveDurationInfinity?(r.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>o||!Je(o))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),r.duration=s)}updateSeekableRange(e){const t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&t!=null&&t.setLiveSeekableRange){const s=Math.max(0,i[0].start),o=Math.max(s,s+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${s}-${o}.`),t.setLiveSeekableRange(s,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&(!e||r===2||"audiovideo"in i)){this.createSourceBuffers(i),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger($.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){var r;const o=e[s];if(!o)throw Error(`source buffer exists for track ${s}, however track does not`);let a=((r=o.levelCodec)==null?void 0:r.indexOf(","))===-1?o.levelCodec:o.codec;a&&s.slice(0,5)==="audio"&&(a=Zy(a,this.appendSource));const l=`${o.container};codecs=${a}`;this.log(`creating sourceBuffer(${l})`);try{const c=t[s]=i.addSourceBuffer(l),u=s;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(u,"bufferedchange",(f,p)=>{const m=p.removedRanges;m!=null&&m.length&&this.hls.trigger($.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:c,codec:a,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id}}catch(c){this.error(`error while trying to add sourceBuffer: ${c.message}`),this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:s,mimeType:l})}}}get mediaSrc(){var e;const t=((e=this.media)==null?void 0:e.firstChild)||this.media;return t==null?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:i}=this;i.current(e).onComplete(),i.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(r)}removeExecutor(e,t,i){const{media:r,mediaSource:s,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!r||!s||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),o.shiftAndExecuteNext(e);return}const c=Je(r.duration)?r.duration:1/0,u=Je(s.duration)?s.duration:1/0,f=Math.max(0,t),p=Math.min(i,c,u);p>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),l.remove(f,p)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.sourceBuffer[t];if(!i){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}i.ended=!1,i.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:i}=this,r=t.map(s=>i.appendBlocker(s));Promise.all(r).then(()=>{e(),t.forEach(s=>{const o=this.sourceBuffer[s];o!=null&&o.updating||i.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,i){const r=this.sourceBuffer[e];if(!r)return;const s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),r.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(i=>{t.removeEventListener(i.event,i.listener)})}}function cP(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function pee(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}const gee={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},uU=n=>String.fromCharCode(gee[n]||n),Cs=15,Zo=100,mee={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},vee={17:2,18:4,21:6,22:8,23:10,19:13,20:15},yee={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_ee={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Eee=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class wee{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;ge.log(`${this.time} [${e}] ${i}`)}}}const Ic=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class hU{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Tee{constructor(){this.uchar=" ",this.penState=new hU}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class See{constructor(e){this.chars=[],this.pos=0,this.currPenState=new hU,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Zo;t++)this.chars.push(new Tee);this.logger=e}equals(e){for(let t=0;t<Zo;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Zo;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Zo;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Zo&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Zo)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=uU(e);if(this.pos>=Zo){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Zo;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Zo;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Kw{constructor(e){this.rows=[],this.currRow=Cs-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Cs;t++)this.rows.push(new See(e));this.logger=e}reset(){for(let e=0;e<Cs;e++)this.rows[e].clear();this.currRow=Cs-1}equals(e){let t=!0;for(let i=0;i<Cs;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<Cs;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Cs;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Cs;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[s+c])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<Cs;s++){const o=this.rows[s].getTextString();o&&(r=s+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class uP{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Kw(i),this.nonDisplayedMemory=new Kw(i),this.lastOutputScreen=new Kw(i),this.currRollUpRow=this.displayedMemory.rows[Cs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Cs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class hP{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=xee(),this.logger=void 0;const r=this.logger=new wee;this.channels=[null,new uP(e,t,r),new uP(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,s=t[i+1]&127;let o=!1,a=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+Ic([t[i],t[i+1]])+"] -> ("+Ic([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(bee(r,s,l)){bv(null,null,l),this.logger.log(3,()=>"Repeated command ("+Ic([r,s])+") is dropped");continue}bv(r,s,this.cmdHistory),o=this.parseCmd(r,s),o||(o=this.parseMidrow(r,s)),o||(o=this.parsePAC(r,s)),o||(o=this.parseBackgroundAttributes(r,s))}else bv(null,null,l);if(!o&&(a=this.parseChars(r,s),a)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ic([r,s])+" orig: "+Ic([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ic([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?mee[e]:yee[e]:i=o===1?vee[e]:_ee[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+uU(o)+"' in channel "+i),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Ic(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=Eee[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}bv(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function bv(n,e,t){t.a=n,t.b=e}function bee(n,e,t){return t.a===n&&t.b===e}function xee(){return{a:null,b:null}}class xv{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var g1=function(){if(wd!=null&&wd.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function i(a){return t(n,a)}function r(a){return t(e,a)}function s(a,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const f in u)a[f]=u[f]}return a}function o(a,l,c){const u=this,f={enumerable:!0};u.hasBeenReset=!1;let p="",m=!1,y=a,_=l,w=c,T=null,x="",C=!0,I="auto",D="start",B=50,N="middle",z=50,Z="middle";Object.defineProperty(u,"id",s({},f,{get:function(){return p},set:function(q){p=""+q}})),Object.defineProperty(u,"pauseOnExit",s({},f,{get:function(){return m},set:function(q){m=!!q}})),Object.defineProperty(u,"startTime",s({},f,{get:function(){return y},set:function(q){if(typeof q!="number")throw new TypeError("Start time must be set to a number.");y=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},f,{get:function(){return _},set:function(q){if(typeof q!="number")throw new TypeError("End time must be set to a number.");_=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},f,{get:function(){return w},set:function(q){w=""+q,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},f,{get:function(){return T},set:function(q){T=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},f,{get:function(){return x},set:function(q){const H=i(q);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=H,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},f,{get:function(){return C},set:function(q){C=!!q,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},f,{get:function(){return I},set:function(q){if(typeof q!="number"&&q!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");I=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},f,{get:function(){return D},set:function(q){const H=r(q);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");D=H,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},f,{get:function(){return B},set:function(q){if(q<0||q>100)throw new Error("Position must be between 0 and 100.");B=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},f,{get:function(){return N},set:function(q){const H=r(q);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");N=H,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},f,{get:function(){return z},set:function(q){if(q<0||q>100)throw new Error("Size must be between 0 and 100.");z=q,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},f,{get:function(){return Z},set:function(q){const H=r(q);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");Z=H,this.hasBeenReset=!0}})),u.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class Cee{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function dU(n){function e(i,r,s,o){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Ree{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function fU(n,e,t,i){const r=i?n.split(i):[n];for(const s in r){if(typeof r[s]!="string")continue;const o=r[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const zS=new g1(0,0,""),Cv=zS.align==="middle"?"middle":"center";function Aee(n,e,t){const i=n;function r(){const a=dU(n);if(a===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const c=new Ree;fU(a,function(p,m){let y;switch(p){case"region":for(let _=t.length-1;_>=0;_--)if(t[_].id===m){c.set(p,t[_].region);break}break;case"vertical":c.alt(p,m,["rl","lr"]);break;case"line":y=m.split(","),c.integer(p,y[0]),c.percent(p,y[0])&&c.set("snapToLines",!1),c.alt(p,y[0],["auto"]),y.length===2&&c.alt("lineAlign",y[1],["start",Cv,"end"]);break;case"position":y=m.split(","),c.percent(p,y[0]),y.length===2&&c.alt("positionAlign",y[1],["start",Cv,"end","line-left","line-right","auto"]);break;case"size":c.percent(p,m);break;case"align":c.alt(p,m,["start",Cv,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&zS.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Cv);let f=c.get("position","auto");f==="auto"&&zS.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),o(),e.endTime=r(),o(),s(n,e)}function pU(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class Lee{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Cee,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,o=0;for(s=pU(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function r(s){fU(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new g1(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Aee(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Iee=/\r\n|\n\r|\n|\r/g,Zw=function(e,t,i=0){return e.slice(i,i+t.length)===t},Pee=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Je(t)||!Je(i)||!Je(r)||!Je(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t},Yw=function(e){let t=5381,i=e.length;for(;i;)t=t*33^e.charCodeAt(--i);return(t>>>0).toString()};function m1(n,e,t){return Yw(n.toString())+Yw(e.toString())+Yw(t)}const Dee=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function Oee(n,e,t,i,r,s,o){const a=new Lee,l=uo(new Uint8Array(n)).trim().replace(Iee,`
`).split(`
`),c=[],u=e?Y2(e.baseTime,e.timescale):0;let f="00:00.000",p=0,m=0,y,_=!0;a.oncue=function(w){const T=t[i];let x=t.ccOffset;const C=(p-u)/9e4;if(T!=null&&T.new&&(m!==void 0?x=t.ccOffset=T.start:Dee(t,i,C)),C){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}x=C-t.presentationOffset}const I=w.endTime-w.startTime,D=Qr((w.startTime+x-m)*9e4,r*9e4)/9e4;w.startTime=Math.max(D,0),w.endTime=Math.max(D+I,0);const B=w.text.trim();w.text=decodeURIComponent(encodeURIComponent(B)),w.id||(w.id=m1(w.startTime,w.endTime,B)),w.endTime>0&&c.push(w)},a.onparsingerror=function(w){y=w},a.onflush=function(){if(y){o(y);return}s(c)},l.forEach(w=>{if(_)if(Zw(w,"X-TIMESTAMP-MAP=")){_=!1,w.slice(16).split(",").forEach(T=>{Zw(T,"LOCAL:")?f=T.slice(6):Zw(T,"MPEGTS:")&&(p=parseInt(T.slice(7)))});try{m=Pee(f)/1e3}catch(T){y=T}return}else w===""&&(_=!1);a.parse(w+`
`)}),a.flush()}const Xw="stpp.ttml.im1t",gU=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mU=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,kee={left:"start",center:"center",right:"end",start:"start",end:"end"};function dP(n,e,t,i){const r=Lt(new Uint8Array(n),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(a=>uo(a)),o=Z2(e.baseTime,1,e.timescale);try{s.forEach(a=>t(Mee(a,o)))}catch(a){i(a)}}function Mee(n,e){const r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((f,p)=>(f[p]=r.getAttribute(`ttp:${p}`)||s[p],f),{}),a=r.getAttribute("xml:space")!=="preserve",l=fP(Jw(r,"styling","style")),c=fP(Jw(r,"layout","region")),u=Jw(r,"body","[begin]");return[].map.call(u,f=>{const p=vU(f,a);if(!p||!f.hasAttribute("begin"))return null;const m=eT(f.getAttribute("begin"),o),y=eT(f.getAttribute("dur"),o);let _=eT(f.getAttribute("end"),o);if(m===null)throw pP(f);if(_===null){if(y===null)throw pP(f);_=m+y}const w=new g1(m-e,_-e,p);w.id=m1(w.startTime,w.endTime,w.text);const T=c[f.getAttribute("region")],x=l[f.getAttribute("style")],C=Nee(T,x,l),{textAlign:I}=C;if(I){const D=kee[I];D&&(w.lineAlign=D),w.align=I}return Vi(w,C),w}).filter(f=>f!==null)}function Jw(n,e,t){const i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function fP(n){return n.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function vU(n,e){return[].slice.call(n.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?vU(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function Nee(n,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),s.reduce((a,l)=>{const c=Qw(e,i,l)||Qw(n,i,l)||Qw(r,i,l);return c&&(a[l]=c),a},{})}function Qw(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function pP(n){return new Error(`Could not parse ttml timestamp ${n}`)}function eT(n,e){if(!n)return null;let t=dU(n);return t===null&&(gU.test(n)?t=Fee(n,e):mU.test(n)&&(t=Bee(n,e))),t}function Fee(n,e){const t=gU.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function Bee(n,e){const t=mU.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Uee{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=mP(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on($.FRAG_LOADING,this.onFragLoading,this),e.on($.FRAG_LOADED,this.onFragLoaded,this),e.on($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on($.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off($.FRAG_LOADING,this.onFragLoading,this),e.off($.FRAG_LOADED,this.onFragLoaded,this),e.off($.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off($.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off($.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off($.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off($.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new xv(this,"textTrack1"),t=new xv(this,"textTrack2"),i=new xv(this,"textTrack3"),r=new xv(this,"textTrack4");this.cea608Parser1=new hP(1,e,t),this.cea608Parser2=new hP(3,i,r)}}addCues(e,t,i,r,s){let o=!1;for(let a=s.length;a--;){const l=s[a],c=zee(l[0],l[1],t,i);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),o=!0,c/(i-t)>.5))return}if(o||s.push([t,i]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,i,r)}else{const a=this.Cues.newCue(null,t,i,r);this.hls.trigger($.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s}){const{unparsedVttFrags:o}=this;i==="main"&&(this.initPTS[t.cc]={baseTime:r,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded($.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(gP(s,{name:e,lang:t,attrs:{}}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)i[e]=a,Wh(i[e]),FB(i[e],r);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Wh(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=mP(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)Wh(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===Xw);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(cU(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,a=o?Jv(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(a){let f=null;for(let p=0;p<a.length;p++)if(a[p]&&gP(a[p],l)){f=a[p],a[p]=null;break}f&&(u=f)}if(u)Wh(u);else{const f=yU(l);u=this.createTextTrack(f,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&ge.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger($.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,o=this.captionsProperties[s];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===mt.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,u=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&o&&(c!==a+1||c===a&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===mt.SUBTITLE)if(r.byteLength){const s=i.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),a&&a.textCodec===Xw?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;dP(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{ge.log(`Failed to parse IMSC1: ${r}`),i.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[i.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=i.initSegment)!=null&&t.data?rs(i.initSegment.data,new Uint8Array(r)):r;Oee(c,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,u=>{this._appendCues(u,i.level),l.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},u=>{const f=u.message==="Missing initPTS for VTT MPEGTS";f?o.push(e):this._fallbackToIMSC1(i,r),ge.log(`Failed to parse VTT cue: ${u}`),!(f&&a>i.cc)&&l.trigger($.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:u})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||dP(t,this.initPTS[e.cc],()=>{i.textCodec=Xw,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>BB(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger($.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===mt.SUBTITLE&&this.onFragLoaded($.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!i||!r)return;const{frag:s,samples:o}=t;if(!(s.type===mt.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const c=this.extractCea608Data(l);i.addData(o[a].pts,c[0]),r.addData(o[a].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>OS(a[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>OS(a[l],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const u=3&o;(u===0||u===1)&&(t[u].push(a),t[u].push(l))}}return t}}function yU(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function gP(n,e){return!!n&&n.kind===yU(e)&&US(e,n)}function zee(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function mP(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class v1{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.BUFFER_CODECS,this.onBufferCodecs,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off($.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off($.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.BUFFER_CODECS,this.onBufferCodecs,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Je(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&ge.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,v1.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,i);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){s=a;break}}return s}}class Gee{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on($.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,o=i-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,c=this.hls;if(c.trigger($.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:i}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let u=c.currentLevel;ge.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger($.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Rv="[eme]";class ed{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ed.CDMCleanupPromise?[ed.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=ge.debug.bind(ge,Rv),this.log=ge.log.bind(ge,Rv),this.warn=ge.warn.bind(ge,Rv),this.error=ge.error.bind(ge,Rv),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on($.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off($.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off($.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off($.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off($.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===bi.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,a,l)=>!!o&&l.indexOf(o)===a,r=t.map(o=>o.audioCodec).filter(i),s=t.map(o=>o.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,r,s).then(f=>o({keySystem:u,mediaKeys:f})).catch(f=>{c.length?l(c):f instanceof Jr?a(f):a(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return bB===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=KJ(e,t,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let o=s==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(r)}`),o=this.requestMediaKeySystemAccess(e,r);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),c.then(f=>f?this.setMediaKeysServerCertificate(u,e,f):u))),a.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),a.mediaKeys})}return o.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${io.hexDump(e.keyId||[])}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return io.hexDump(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${io.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const r=Nw(this.config),s=e.map(SI).filter(o=>!!o&&r.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:o})=>{const a=bI(o);a?t(a):i(new Error(`Unable to find format for key-system "${o}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(o,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:t});return this.generateRequestWithPreferredKeySession(l,"cenc",t.pssh,"playlist-key")}))),s.catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Jr?this.hls.trigger($.ERROR,e.data):this.hls.trigger($.ERROR,{type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=SI(e.keyFormat),s=r?[r]:Nw(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Nw(this.config)),e.length===0)throw new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:i}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),i===null)return;let r,s;if(t==="sinf"&&this.config.drmSystems[bi.FAIRPLAY]){const u=Yi(new Uint8Array(i));try{const f=i1(JSON.parse(u).sinf),p=DB(new Uint8Array(f));if(!p)return;r=p.subarray(8,24),s=bi.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const u=_Q(i);if(u===null)return;u.version===0&&u.systemId===SB.WIDEVINE&&u.data&&(r=u.data.subarray(8,24)),s=qJ(u.systemId)}if(!s||!r)return;const o=io.hexDump(r),{keyIdToKeySessionPromise:a,mediaKeySessions:l}=this;let c=a[o];for(let u=0;u<l.length;u++){const f=l[u],p=f.decryptdata;if(p.pssh||!p.keyId)continue;const m=io.hexDump(p.keyId);if(o===m||p.uri.replace(/-/g,"").indexOf(o)!==-1){c=a[m],delete a[m],p.pssh=new Uint8Array(i),p.keyId=r,c=a[o]=c.then(()=>this.generateRequestWithPreferredKeySession(f,t,i,"encrypted-event-key-match"));break}}c||(c=a[o]=this.getKeySystemSelectionPromise([s]).then(({keySystem:u,mediaKeys:f})=>{var p;this.throwIfDestroyed();const m=new qp("ISO-23001-7",o,(p=bI(u))!=null?p:"");return m.pssh=new Uint8Array(i),m.keyId=r,this.attemptSetMediaKeys(u,f).then(()=>{this.throwIfDestroyed();const y=this.createMediaKeySessionContext({decryptdata:m,keySystem:u,mediaKeys:f});return this.generateRequestWithPreferredKeySession(y,t,i,"encrypted-event-no-match")})})),c.catch(u=>this.handleError(u))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var s,o;const a=(s=this.config.drmSystems)==null||(o=s[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const y=a.call(this.hls,t,i,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,i=e.decryptdata.pssh=y.initData?new Uint8Array(y.initData):null}catch(y){var l;if(this.warn(y.message),(l=this.hls)!=null&&l.config.debug)throw y}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${c} (init data type: ${t} length: ${i?i.byteLength:null})`);const u=new p1,f=e._onmessage=y=>{const _=e.mediaKeysSession;if(!_){u.emit("error",new Error("invalid state"));return}const{messageType:w,message:T}=y;this.log(`"${w}" message event for session "${_.sessionId}" message size: ${T.byteLength}`),w==="license-request"||w==="license-renewal"?this.renewLicense(e,T).catch(x=>{this.handleError(x),u.emit("error",x)}):w==="license-release"?e.keySystem===bi.FAIRPLAY&&(this.updateKeySession(e,PS("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${w}"`)},p=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const w=e.keyStatus;u.emit("keyStatus",w),w==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",f),e.mediaKeysSession.addEventListener("keystatuseschange",p);const m=new Promise((y,_)=>{u.on("error",_),u.on("keyStatus",w=>{w.startsWith("usable")?y():w==="output-restricted"?_(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):w==="internal-error"?_(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${w}"`)):w==="expired"?_(new Error("key expired while generating request")):this.warn(`unhandled key status change "${w}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var y;this.log(`Request generated for key-session "${(y=e.mediaKeysSession)==null?void 0:y.sessionId}" keyId: ${c}`)}).catch(y=>{throw new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_NO_SESSION,error:y,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>m).catch(y=>{throw u.removeAllListeners(),this.removeSession(e),y}).then(()=>(u.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${io.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${io.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(p,m,y,_)=>{o(p.data)},onError:(p,m,y,_)=>{a(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:gn({url:l.url,data:void 0},p)},`"${e}" certificate request failed (${s}). Status: ${p.code} (${p.text})`))},onTimeout:(p,m,y)=>{a(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(p,m,y)=>{a(new Error("aborted"))}};r.load(l,u,f)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(o=>{s(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let u;for(let f=0,p=s.length;f<p;f++){var o,a;u=s[f];const m=(o=u.querySelector("name"))==null?void 0:o.textContent,y=(a=u.querySelector("value"))==null?void 0:a.textContent;m&&y&&e.setRequestHeader(m,y)}}const l=r.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return PS(atob(c))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const o=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(u){this.error(u)}r(l)}else{const l=i.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)s(new Jr({type:_t.KEY_SYSTEM_ERROR,details:be.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==bi.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},qp.clearKeyUriToKeyIdMap();const i=t.length;ed.CDMCleanupPromise=Promise.all(t.map(r=>this.removeSession(r)).concat(e==null?void 0:e.setMediaKeys(null).catch(r=>{this.log(`Could not clear media keys: ${r}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);return r>-1&&this.mediaKeySessions.splice(r,1),t.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>t.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}ed.CDMCleanupPromise=void 0;class Jr extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var On;(function(n){n.MANIFEST="m",n.AUDIO="a",n.VIDEO="v",n.MUXED="av",n.INIT="i",n.CAPTION="c",n.TIMED_TEXT="tt",n.KEY="k",n.OTHER="o"})(On||(On={}));var GS;(function(n){n.DASH="d",n.HLS="h",n.SMOOTH="s",n.OTHER="o"})(GS||(GS={}));var Gc;(function(n){n.OBJECT="CMCD-Object",n.REQUEST="CMCD-Request",n.SESSION="CMCD-Session",n.STATUS="CMCD-Status"})(Gc||(Gc={}));const Hee={[Gc.OBJECT]:["br","d","ot","tb"],[Gc.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Gc.SESSION]:["cid","pr","sf","sid","st","v"],[Gc.STATUS]:["bs","rtp"]};class bd{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(i=>i instanceof bd?i:new bd(i))),this.value=e,this.params=t}}class _U{constructor(e){this.description=void 0,this.description=e}}const $ee="Dict";function Vee(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function jee(n,e,t,i){return new Error(`failed to ${n} "${Vee(e)}" as ${t}`,{cause:i})}const vP="Bare Item",Wee="Boolean",qee="Byte Sequence",Kee="Decimal",Zee="Integer";function Yee(n){return n<-999999999999999||999999999999999<n}const Xee=/[\x00-\x1f\x7f]+/,Jee="Token",Qee="Key";function mo(n,e,t){return jee("serialize",n,e,t)}function ete(n){if(typeof n!="boolean")throw mo(n,Wee);return n?"?1":"?0"}function tte(n){return btoa(String.fromCharCode(...n))}function ite(n){if(ArrayBuffer.isView(n)===!1)throw mo(n,qee);return`:${tte(n)}:`}function EU(n){if(Yee(n))throw mo(n,Zee);return n.toString()}function nte(n){return`@${EU(n.getTime()/1e3)}`}function wU(n,e){if(n<0)return-wU(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}function rte(n){const e=wU(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw mo(n,Kee);const t=e.toString();return t.includes(".")?t:`${t}.0`}const ste="String";function ote(n){if(Xee.test(n))throw mo(n,ste);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function ate(n){return n.description||n.toString().slice(7,-1)}function yP(n){const e=ate(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw mo(e,Jee);return e}function HS(n){switch(typeof n){case"number":if(!Je(n))throw mo(n,vP);return Number.isInteger(n)?EU(n):rte(n);case"string":return ote(n);case"symbol":return yP(n);case"boolean":return ete(n);case"object":if(n instanceof Date)return nte(n);if(n instanceof Uint8Array)return ite(n);if(n instanceof _U)return yP(n);default:throw mo(n,vP)}}function $S(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw mo(n,Qee);return n}function y1(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${$S(e)}`:`;${$S(e)}=${HS(t)}`).join("")}function TU(n){return n instanceof bd?`${HS(n.value)}${y1(n.params)}`:HS(n)}function lte(n){return`(${n.value.map(TU).join(" ")})${y1(n.params)}`}function cte(n,e={whitespace:!0}){if(typeof n!="object")throw mo(n,$ee);const t=n instanceof Map?n.entries():Object.entries(n),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof bd||(s=new bd(s));let o=$S(r);return s.value===!0?o+=y1(s.params):(o+="=",Array.isArray(s.value)?o+=lte(s):o+=TU(s)),o}).join(`,${i}`)}function ute(n,e){return cte(n,e)}const hte=n=>n==="ot"||n==="sf"||n==="st",dte=n=>typeof n=="number"?Je(n):n!=null&&n!==""&&n!==!1;function fte(n,e){const t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;const r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")}function pte(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}const ry=n=>Math.round(n),gte=(n,e)=>(e!=null&&e.baseUrl&&(n=fte(n,e.baseUrl)),encodeURIComponent(n)),Av=n=>ry(n/100)*100,mte={br:ry,d:ry,bl:Av,dl:Av,mtp:Av,nor:gte,rtp:Av,tb:ry};function vte(n,e){const t={};if(n==null||typeof n!="object")return t;const i=Object.keys(n).sort(),r=Vi({},mte,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return i.forEach(o=>{if(s!=null&&s(o))return;let a=n[o];const l=r[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||dte(a)&&(hte(o)&&typeof a=="string"&&(a=new _U(a)),t[o]=a))}),t}function SU(n,e={}){return n?ute(vte(n,e),Vi({whitespace:!1},e)):""}function yte(n,e={}){if(!n)return{};const t=Object.entries(n),i=Object.entries(Hee).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),r=t.reduce((s,o)=>{var a,l;const[c,u]=o,f=((a=i.find(p=>p[1].includes(c)))==null?void 0:a[0])||Gc.REQUEST;return(l=s[f])!=null||(s[f]={}),s[f][c]=u,s},{});return Object.entries(r).reduce((s,[o,a])=>(s[o]=SU(a,e),s),{})}function _te(n,e,t){return Vi(n,yte(e,t))}const Ete="CMCD";function wte(n,e={}){if(!n)return"";const t=SU(n,e);return`${Ete}=${encodeURIComponent(t)}`}const _P=/CMCD=[^&#]+/;function Tte(n,e,t){const i=wte(e,t);if(!i)return n;if(_P.test(n))return n.replace(_P,i);const r=n.includes("?")?"&":"?";return`${n}${r}${i}`}class Ste{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:On.MANIFEST,su:!this.initialized})}catch(s){ge.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const s=r.frag,o=this.hls.levels[s.level],a=this.getObjectType(s),l={d:s.duration*1e3,ot:a};(a===On.VIDEO||a===On.AUDIO||a==On.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(r,l)}catch(s){ge.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||pte(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHED,this.onMediaDetached,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHED,this.onMediaDetached,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:GS.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Vi(t,this.createData());const i=t.ot===On.INIT||t.ot===On.VIDEO||t.ot===On.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((s,o)=>(r.includes(o)&&(s[o]=t[o]),s),{})),this.useHeaders?(e.headers||(e.headers={}),_te(e.headers,t)):e.url=Tte(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return On.TIMED_TEXT;if(e.sn==="initSegment")return On.INIT;if(t==="audio")return On.AUDIO;if(t==="main")return this.hls.audioTracks.length?On.VIDEO:On.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===On.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,o=s>-1?s+1:r.levels.length;i=r.levels.slice(0,o)}for(const s of i)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,i=e===On.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:pi.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const bte=3e5;class xte{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=ge.log.bind(ge,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===En.SendAlternateToPenaltyBox&&i.flags===xs.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this.pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&r?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&r&&(s=r.reduce((a,l)=>(a.indexOf(l.pathwayId)===-1&&a.push(l.pathwayId),a),[])),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==o),i.resolved||ge.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>bte&&delete i[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in i)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,HB(t),this.hls.trigger($.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===jt.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===jt.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(u=>{const f=new Li(u.attrs);f["PATHWAY-ID"]=o;const p=f.AUDIO&&`${f.AUDIO}_clone_${o}`,m=f.SUBTITLES&&`${f.SUBTITLES}_clone_${o}`;p&&(i[f.AUDIO]=p,f.AUDIO=p),m&&(r[f.SUBTITLES]=m,f.SUBTITLES=m);const y=bU(u.uri,f["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),_=new Td({attrs:f,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:y,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let w=1;w<u.audioGroups.length;w++)_.addGroupId("audio",`${u.audioGroups[w]}_clone_${o}`);if(u.subtitleGroups)for(let w=1;w<u.subtitleGroups.length;w++)_.addGroupId("text",`${u.subtitleGroups[w]}_clone_${o}`);return _});t.push(...c),EP(this.audioTracks,i,l,o),EP(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,f,p,m)=>{this.log(`Loaded steering manifest: "${r}"`);const y=u.data;if(y.VERSION!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":_,"PATHWAY-CLONES":w,"PATHWAY-PRIORITY":T}=y;if(_)try{this.uri=new self.URL(_,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${_}`);return}this.scheduleRefresh(this.uri||p.url),w&&this.clonePathways(w);const x={steeringManifest:y,url:r.toString()};this.hls.trigger($.STEERING_MANIFEST_LOADED,x),T&&this.updatePathwayPriority(T)},onError:(u,f,p,m)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${f.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let y=this.timeToLoad*1e3;if(u.code===429){const _=this.loader;if(typeof(_==null?void 0:_.getResponseHeader)=="function"){const w=_.getResponseHeader("Retry-After");w&&(y=parseFloat(w)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,y)},onTimeout:(u,f,p)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function EP(n,e,t,i){n&&Object.keys(e).forEach(r=>{const s=n.filter(o=>o.groupId===r).map(o=>{const a=Vi({},o);return a.details=void 0,a.attrs=new Li(a.attrs),a.url=a.attrs.URI=bU(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=i,a});n.push(...s)})}function bU(n,e,t,i){const{HOST:r,PARAMS:s,[t]:o}=i;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return r&&!a&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}const Cte=/^age:\s*[\d.]+\s*$/im;class xU{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new t_,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{this.callbacks.onError({code:i.status,text:o.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=i.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&Je(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a=t.responseType!=="text";if(o>=200&&o<300&&(a&&t.response||t.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=a?t.response:t.responseText,c=t.responseType==="arraybuffer"?l.byteLength:l.length;if(i.loaded=i.total=c,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const u=this.callbacks.onProgress;if(u&&u(i,e,l,t),!this.callbacks)return;const f={url:t.responseURL,data:l,code:o};this.callbacks.onSuccess(f,i,e,t)}else{const l=s.loadPolicy.errorRetry,c=i.retry,u={url:e.url,data:void 0,code:o};Jy(l,c,!1,u)?this.retry(l):(ge.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,i))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Jy(e,t,!0))this.retry(e);else{var i;ge.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=s1(e,i.retry),i.retry++,ge.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Cte.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Rte(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Ate=/(\d+)-(\d+)\/(\d+)/;class wP{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Dte,this.controller=new self.AbortController,this.stats=new t_}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=Lte(e,this.controller.signal),o=i.onProgress,a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=c&&Je(c)?c:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},t.timeout),self.fetch(this.request).then(f=>{this.response=this.loader=f;const p=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,e,this.response)},u-(p-r.loading.start)),!f.ok){const{status:m,statusText:y}=f;throw new Ote(y||"fetch, bad network response",m,f)}return r.loading.first=p,r.total=Pte(f.headers)||r.total,o&&Je(t.highWaterMark)?this.loadProgressively(f,r,e,t.highWaterMark,o):a?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=f[l];m&&(r.loaded=r.total=m);const y={url:p.url,data:f,code:p.status};o&&!Je(t.highWaterMark)&&o(r,e,f,p),i.onSuccess(y,r,e,p)}).catch(f=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const p=f&&f.code||0,m=f?f.message:null;i.onError({code:p,text:m},e,f?f.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const o=new WB,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&s(t,i,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const u=c.value,f=u.length;return t.loaded+=f,f<r||o.dataLength?(o.push(u),o.dataLength>=r&&s(t,i,o.flush(),e)):s(t,i,u,e),l()}).catch(()=>Promise.reject());return l()}}function Lte(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Vi({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function Ite(n){const e=Ate.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Pte(n){const e=n.get("Content-Range");if(e){const i=Ite(e);if(Je(i))return i}const t=n.get("Content-Length");if(t)return parseInt(t)}function Dte(n,e){return new self.Request(n.url,e)}class Ote extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const kte=/\s/,Mte={newCue(n,e,t,i){const r=[];let s,o,a,l,c;const u=self.VTTCue||self.TextTrackCue;for(let p=0;p<i.rows.length;p++)if(s=i.rows[p],a=!0,l=0,c="",!s.isEmpty()){var f;for(let _=0;_<s.chars.length;_++)kte.test(s.chars[_].uchar)&&a?l++:(c+=s.chars[_].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=pU(c.trim()),y=m1(e,t,m);n!=null&&(f=n.cues)!=null&&f.getCueById(y)||(o=new u(e,t,m),o.id=y,o.line=p+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return n&&r.length&&(r.sort((p,m)=>p.line==="auto"||m.line==="auto"?0:p.line>8&&m.line>8?m.line-p.line:p.line-m.line),r.forEach(p=>BB(n,p))),r}},Nte={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},CU=gn(gn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:xU,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:c2,bufferController:fee,capLevelController:v1,errorController:XQ,fpsController:Gee,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:bB,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:Nte},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Fte()),{},{subtitleStreamController:cee,subtitleTrackController:hee,timelineController:Uee,audioStreamController:aee,audioTrackController:lee,emeController:ed,cmcdController:Ste,contentSteeringController:xte});function Fte(){return{cueHandler:Mte,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Bte(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=VS(n),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(s=>{const o=`${s==="level"?"playlist":s}LoadPolicy`,a=e[o]===void 0,l=[];r.forEach(c=>{const u=`${s}Loading${c}`,f=e[u];if(f!==void 0&&a){l.push(u);const p=t[o].default;switch(e[o]={default:p},c){case"TimeOut":p.maxLoadTimeMs=f,p.maxTimeToFirstByteMs=f;break;case"MaxRetry":p.errorRetry.maxNumRetry=f,p.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":p.errorRetry.retryDelayMs=f,p.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=f,p.timeoutRetry.maxRetryDelayMs=f;break}}}),l.length&&ge.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),gn(gn({},t),e)}function VS(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(VS):Object.keys(n).reduce((e,t)=>(e[t]=VS(n[t]),e),{}):n}function Ute(n){const e=n.loader;e!==wP&&e!==xU?(ge.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):Rte()&&(n.loader=wP,n.progressive=!0,n.enableSoftwareAES=!0,ge.log("[config]: Progressive streaming enabled, using FetchLoader"))}let tT;class zte extends o1{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_LOADED,this.onManifestLoaded,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this),e.on($.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_LOADED,this.onManifestLoaded,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this),e.off($.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],s={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(u=>{var f,p;const m=u.attrs;let{audioCodec:y,videoCodec:_}=u;((f=y)==null?void 0:f.indexOf("mp4a.40.34"))!==-1&&(tT||(tT=/chrome|firefox/i.test(navigator.userAgent)),tT&&(u.audioCodec=y=void 0)),y&&(u.audioCodec=y=Zy(y,i)),((p=_)==null?void 0:p.indexOf("avc1"))===0&&(_=u.videoCodec=CQ(_));const{width:w,height:T,unknownCodecs:x}=u;if(a||(a=!!(w&&T)),l||(l=!!_),c||(c=!!y),x!=null&&x.length||y&&!zw(y,"audio",i)||_&&!zw(_,"video",i))return;const{CODECS:C,"FRAME-RATE":I,"HDCP-LEVEL":D,"PATHWAY-ID":B,RESOLUTION:N,"VIDEO-RANGE":z}=m,q=`${`${B||"."}-`}${u.bitrate}-${N}-${I}-${C}-${z}-${D}`;if(s[q])if(s[q].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const H=o[q]+=1;u.attrs["PATHWAY-ID"]=new Array(H+1).join(".");const Y=new Td(u);s[q]=Y,r.push(Y)}else s[q].addGroupId("audio",m.AUDIO),s[q].addGroupId("text",m.SUBTITLES);else{const H=new Td(u);s[q]=H,o[q]=1,r.push(H)}}),this.filterAndSortMediaOptions(r,t,a,l,c)}filterAndSortMediaOptions(e,t,i,r,s){let o=[],a=[],l=e;if((i||r)&&s&&(l=l.filter(({videoCodec:y,videoRange:_,width:w,height:T})=>(!!y||!!(w&&T))&&UQ(_))),l.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const y=new Error("no level with compatible codecs found in manifest");this.hls.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:y,reason:y.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:y}=this.hls.config;o=t.audioTracks.filter(_=>!_.audioCodec||zw(_.audioCodec,"audio",y)),TP(o)}t.subtitles&&(a=t.subtitles,TP(a));const c=l.slice(0);l.sort((y,_)=>{if(y.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&y.height!==_.height)return y.height-_.height;if(y.frameRate!==_.frameRate)return y.frameRate-_.frameRate;if(y.videoRange!==_.videoRange)return Yy.indexOf(y.videoRange)-Yy.indexOf(_.videoRange);if(y.videoCodec!==_.videoCodec){const w=LI(y.videoCodec),T=LI(_.videoCodec);if(w!==T)return T-w}if(y.uri===_.uri&&y.codecSet!==_.codecSet){const w=Ky(y.codecSet),T=Ky(_.codecSet);if(w!==T)return T-w}return y.averageBitrate!==_.averageBitrate?y.averageBitrate-_.averageBitrate:0});let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let y=0;y<c.length;y++)if(c[y].pathwayId===l[0].pathwayId){u=c[y];break}}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===u){var f;this._firstLevel=y;const _=u.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${_}`),((f=this.hls.userConfig)==null?void 0:f.abrEwmaDefaultEstimate)===void 0){const T=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);T>w&&w===CU.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const p=s&&!r,m={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:!p&&o.some(y=>!!y.url)};this.hls.trigger($.MANIFEST_PARSED,m),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),f=e<0;if(this.hls.trigger($.ERROR,{type:_t.OTHER_ERROR,details:be.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:u,reason:u.message}),f)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&o.details&&r&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${i}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger($.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const u=this.switchParams(o.uri,r==null?void 0:r.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===jt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===mt.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,o=this._levels[r];if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}r===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0),this.playlistLoaded(r,t,o.details)):(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){let r=i.uri;if(e)try{r=e.addDirectives(r)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const s=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} ${r}`),this.clearTimer(),this.hls.trigger($.LEVEL_LOADING,{url:r,level:t,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const i=this._levels.filter((r,s)=>s!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(o=>o.level=-1)),!1));HB(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger($.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger($.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function TP(n){const e={};n.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}class Gte{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=be.KEY_LOAD_ERROR,i,r,s){return new Qo({type:_t.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:r}=e;for(let s=0;s<t.length;s++){const o=t[s];if(r<=o.cc&&(i==="initSegment"||o.sn==="initSegment"||i<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,c))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((i=a)!=null&&i.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((r=a)!=null&&r.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,be.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,i))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=i.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(p,m,y,_)=>{const{frag:w,keyInfo:T,url:x}=y;if(!w.decryptdata||T!==this.keyUriToKeyInfo[x])return a(this.createKeyLoadError(w,be.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),_));T.decryptdata.key=w.decryptdata.key=new Uint8Array(p.data),w.keyLoader=null,T.loader=null,o({frag:w,keyInfo:T})},onError:(p,m,y,_)=>{this.resetLoader(m),a(this.createKeyLoadError(t,be.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),y,gn({url:l.url,data:void 0},p)))},onTimeout:(p,m,y)=>{this.resetLoader(m),a(this.createKeyLoadError(t,be.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(p,m,y)=>{this.resetLoader(m),a(this.createKeyLoadError(t,be.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};s.load(l,u,f)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}function RU(){return self.SourceBuffer||self.WebKitSourceBuffer}function AU(){if(!nu())return!1;const e=RU();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function Hte(){if(!AU())return!1;const n=nu();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Kp(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Kp(e,"audio"))))}function $te(){var n;const e=RU();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const Vte=250,sy=2,jte=.1,Wte=.05;class qte{constructor(e,t,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:i,media:r,stalled:s}=this;if(r===null)return;const{currentTime:o,seeking:a}=r,l=this.seeking&&!a,c=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,a||(this.nudgeRetry=0),s!==null){if(this.stallReported){const w=self.performance.now()-s;ge.warn(`playback not stuck anymore @${o}, after ${Math.round(w)}ms`),this.stallReported=!1}this.stalled=null}return}if(c||l){this.stalled=null;return}if(r.paused&&!a||r.ended||r.playbackRate===0||!pi.getBuffered(r).length){this.nudgeRetry=0;return}const u=pi.bufferInfo(r,o,0),f=u.nextStart||0;if(a){const w=u.len>sy,T=!f||t&&t.start<=o||f-o>sy&&!this.fragmentTracker.getPartialFragment(o);if(w||T)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var p;if(!(u.len>0)&&!f)return;const T=Math.max(f,u.start||0)-o,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=(x==null||(p=x.details)==null?void 0:p.live)?x.details.targetduration*2:sy,D=this.fragmentTracker.getPartialFragment(o);if(T>0&&(T<=I||D)){r.paused||this._trySkipBufferHole(D);return}}const m=self.performance.now();if(s===null){this.stalled=m;return}const y=m-s;if(!a&&y>=Vte&&(this._reportStall(u),!this.media))return;const _=pi.bufferInfo(r,o,i.maxBufferHole);this._tryFixBufferStall(_,y)}_tryFixBufferStall(e,t){const{config:i,fragmentTracker:r,media:s}=this;if(s===null)return;const o=s.currentTime,a=r.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-o<i.maxBufferHole)&&t>i.highBufferWatchdogPeriod*1e3&&(ge.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;const s=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(e)})`);ge.warn(s.message),t.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:i,media:r}=this;if(r===null)return 0;const s=r.currentTime,o=pi.bufferInfo(r,s,0),a=s<o.start?o.start:o.nextStart;if(a){const l=o.len<=t.maxBufferHole,c=o.len>0&&o.len<1&&r.readyState<3,u=a-s;if(u>0&&(l||c)){if(u>t.maxBufferHole){const{fragmentTracker:p}=this;let m=!1;if(s===0){const y=p.getAppendedFrag(0,mt.MAIN);y&&a<y.end&&(m=!0)}if(!m){const y=e||p.getAppendedFrag(s,mt.MAIN);if(y){let _=!1,w=y.end;for(;w<a;){const T=p.getPartialFragment(w);if(T)w+=T.duration;else{_=!0;break}}if(_)return 0}}}const f=Math.max(a+Wte,s+jte);if(ge.warn(`skipping hole, adjusting currentTime from ${s} to ${f}`),this.moved=!0,this.stalled=null,r.currentTime=f,e&&!e.gap){const p=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${f}`);i.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:e})}return f}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:i,nudgeRetry:r}=this;if(i===null)return;const s=i.currentTime;if(this.nudgeRetry++,r<e.nudgeMaxRetry){const o=s+(r+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${s} to ${o}`);ge.warn(a.message),i.currentTime=o,t.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);ge.error(o.message),t.trigger($.ERROR,{type:_t.MEDIA_ERROR,details:be.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}const Kte=100;class Zte extends c1{constructor(e,t,i){super(e,t,i,"[stream-controller]",mt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on($.MEDIA_ATTACHED,this.onMediaAttached,this),e.on($.MEDIA_DETACHING,this.onMediaDetaching,this),e.on($.MANIFEST_LOADING,this.onManifestLoading,this),e.on($.MANIFEST_PARSED,this.onManifestParsed,this),e.on($.LEVEL_LOADING,this.onLevelLoading,this),e.on($.LEVEL_LOADED,this.onLevelLoaded,this),e.on($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on($.ERROR,this.onError,this),e.on($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on($.BUFFER_CREATED,this.onBufferCreated,this),e.on($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on($.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off($.MEDIA_ATTACHED,this.onMediaAttached,this),e.off($.MEDIA_DETACHING,this.onMediaDetaching,this),e.off($.MANIFEST_LOADING,this.onManifestLoading,this),e.off($.MANIFEST_PARSED,this.onManifestParsed,this),e.off($.LEVEL_LOADED,this.onLevelLoaded,this),e.off($.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off($.ERROR,this.onError,this),e.off($.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off($.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off($.BUFFER_CREATED,this.onBufferCreated,this),e.off($.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off($.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off($.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:i}=this;if(this.stopLoad(),this.setInterval(Kte),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=Oe.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Oe.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Oe.WAITING_LEVEL:{const{levels:t,level:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r)){if(this.waitForCdnTuneIn(s))break;this.state=Oe.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Oe.IDLE;break}break}case Oe.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,level:s}=this,o=r==null?void 0:r[s];this.resetStartWhenNotLoaded(o||null),this.state=Oe.IDLE}}break}this.state===Oe.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=e.nextLoadLevel;if(!(i!=null&&i[s]))return;const o=i[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const _={};this.altAudio&&(_.type="video"),this.hls.trigger($.BUFFER_EOS,_),this.state=Oe.ENDED;return}e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=o.details;if(!c||this.state===Oe.WAITING_LEVEL||c.live&&this.levelLastLoaded!==o){this.level=s,this.state=Oe.WAITING_LEVEL;return}const u=a.len,f=this.getMaxBufferLength(o.maxBitrate);if(u>=f)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:a.end;let m=this.getNextFragment(p,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==dn.OK){var y;const w=((y=this.backtrackFragment)!=null?y:m).sn-c.startSN,T=c.fragments[w-1];T&&m.cc===T.cc&&(m=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,p)){if(!m.gap){const w=this.audioOnly&&!this.altAudio?ni.AUDIO:ni.VIDEO,T=(w===ni.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,w,mt.MAIN)}m=this.getNextFragmentLoopLoading(m,c,a,mt.MAIN,f)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,p))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);this.fragCurrent=e,r===dn.NOT_LOADED||r===dn.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,i)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,mt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,u=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Oe.KEY_LOADING:case Oe.FRAG_LOADING:case Oe.FRAG_LOADING_WAITING_RETRY:case Oe.PARSING:case Oe.PARSED:this.state=Oe.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new qte(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;Je(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger($.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let i=!1,r=!1;t.levels.forEach(s=>{const o=s.audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&r&&!$te(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==Oe.IDLE)return;const r=i[t.level];(!r.details||r.details.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(r.details))&&(this.state=Oe.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r}=this,s=t.level,o=t.details,a=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=r[s],c=this.fragCurrent;c&&(this.state===Oe.FRAG_LOADING||this.state===Oe.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let u=0;if(o.live||(i=l.details)!=null&&i.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;u=this.alignPlaylists(o,l.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(l.details=o,this.levelLastLoaded=l,this.hls.trigger($.LEVEL_UPDATED,{details:o,level:s}),this.state===Oe.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=Oe.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:i,part:r,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const a=o[i.level],l=a.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const c=a.videoCodec,u=l.PTSKnown||!l.live,f=(t=i.initSegment)==null?void 0:t.data,p=this._getAudioCodec(a),m=this.transmuxer=this.transmuxer||new lU(this.hls,mt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=r?r.index:-1,_=y!==-1,w=new a1(i.level,i.sn,i.stats.chunkCount,s.byteLength,y,_),T=this.initPTS[i.cc];m.push(s,f,p,c,i,r,l.totalduration,u,w,T)}onAudioTrackSwitching(e,t){const i=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;i&&(s.trigger($.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger($.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=t.id,r=!!this.hls.audioTracks[i].url;if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,o=!1;for(const a in i){const l=i[a];if(l.id==="main"){if(s=a,r=l,a==="video"){const c=i[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i&&i.type!==mt.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Oe.PARSED&&(this.state=Oe.IDLE);return}const s=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(e,t){var i;if(t.fatal){this.state=Oe.ERROR;return}switch(t.details){case be.FRAG_GAP:case be.FRAG_PARSING_ERROR:case be.FRAG_DECRYPT_ERROR:case be.FRAG_LOAD_ERROR:case be.FRAG_LOAD_TIMEOUT:case be.KEY_LOAD_ERROR:case be.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(mt.MAIN,t);break;case be.LEVEL_LOAD_ERROR:case be.LEVEL_LOAD_TIMEOUT:case be.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Oe.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===jt.LEVEL&&(this.state=Oe.IDLE);break;case be.BUFFER_APPEND_ERROR:case be.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===be.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case be.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!pi.getBuffered(e).length){const i=this.state!==Oe.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=Oe.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ni.AUDIO||this.audioOnly&&!this.altAudio){const i=(t===ni.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,t,mt.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=pi.getBuffered(e),o=(r.length?r.start(0):0)-i;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),i+=o,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${t}`),e.currentTime=i}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this;if(!i||this.fragContextChanged(e))return;t.fragmentError=0,this.state=Oe.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),r.trigger($.FRAG_LOADED,i),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i="main",{hls:r}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:u}=a,{video:f,text:p,id3:m,initSegment:y}=s,{details:_}=u,w=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=Oe.PARSING,y){if(y!=null&&y.tracks){const C=l.initSegment||l;this._bufferInitSegment(u,y.tracks,C,o),r.trigger($.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:i,tracks:y.tracks})}const T=y.initPTS,x=y.timescale;Je(T)&&(this.initPTS[l.cc]={baseTime:T,timescale:x},r.trigger($.INIT_PTS_FOUND,{frag:l,id:i,initPTS:T,timescale:x}))}if(f&&_&&l.sn!=="initSegment"){const T=_.fragments[l.sn-1-_.startSN],x=l.sn===_.startSN,C=!T||l.cc>T.cc;if(s.independent!==!1){const{startPTS:I,endPTS:D,startDTS:B,endDTS:N}=f;if(c)c.elementaryStreams[f.type]={startPTS:I,endPTS:D,startDTS:B,endDTS:N};else if(f.firstKeyFrame&&f.independent&&o.id===1&&!C&&(this.couldBacktrack=!0),f.dropped&&f.independent){const z=this.getMainFwdBufferInfo(),Z=(z?z.end:this.getLoadPosition())+this.config.maxBufferHole,q=f.firstKeyFramePTS?f.firstKeyFramePTS:I;if(!x&&Z<q-this.config.maxBufferHole&&!C){this.backtrack(l);return}else C&&(l.gap=!0);l.setElementaryStreamInfo(f.type,l.start,D,l.start,N,!0)}else x&&I>sy&&(l.gap=!0);l.setElementaryStreamInfo(f.type,I,D,B,N),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(f,l,c,o,x||C)}else if(x||C)l.gap=!0;else{this.backtrack(l);return}}if(w){const{startPTS:T,endPTS:x,startDTS:C,endDTS:I}=w;c&&(c.elementaryStreams[ni.AUDIO]={startPTS:T,endPTS:x,startDTS:C,endDTS:I}),l.setElementaryStreamInfo(ni.AUDIO,T,x,C,I),this.bufferFragmentData(w,l,c,o)}if(_&&m!=null&&(t=m.samples)!=null&&t.length){const T={id:i,frag:l,details:_,samples:m.samples};r.trigger($.FRAG_PARSING_METADATA,T)}if(_&&p){const T={id:i,frag:l,details:_,samples:p.samples};r.trigger($.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,r){if(this.state!==Oe.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let l=e.audioCodec;const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const u=s.metadata;u&&"channelCount"in u&&(u.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger($.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const u=t[l].initSegment;u!=null&&u.byteLength&&this.hls.trigger($.BUFFER_APPENDING,{type:l,data:u,frag:i,part:null,chunkMeta:r,parent:i.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,mt.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Oe.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(pi.isBuffered(e,i)?t=this.getAppendedFrag(i):pi.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger($.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger($.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,i=this.currentFrag;if(i&&Je(t)&&Je(i.programDateTime)){const r=i.programDateTime+(t-i.start)*1e3;return new Date(r)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Fn{static get version(){return"1.5.11"}static isMSESupported(){return AU()}static isSupported(){return Hte()}static getMediaSource(){return nu()}static get Events(){return $}static get ErrorTypes(){return _t}static get ErrorDetails(){return be}static get DefaultConfig(){return Fn.defaultConfig?Fn.defaultConfig:CU}static set DefaultConfig(e){Fn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new p1,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,FJ(e.debug||!1,"Hls instance");const t=this.config=Bte(Fn.DefaultConfig,e);this.userConfig=e,t.progressive&&Ute(t);const{abrController:i,bufferController:r,capLevelController:s,errorController:o,fpsController:a}=t,l=new o(this),c=this.abrController=new i(this),u=this.bufferController=new r(this),f=this.capLevelController=new s(this),p=new a(this),m=new PQ(this),y=new NQ(this),_=t.contentSteeringController,w=_?new _(this):null,T=this.levelController=new zte(this,w),x=new h2(this),C=new Gte(this.config),I=this.streamController=new Zte(this,x,C);f.setStreamController(I),p.setStreamController(I);const D=[m,T,I];w&&D.splice(1,0,w),this.networkControllers=D;const B=[c,u,f,p,y,x];this.audioTrackController=this.createController(t.audioTrackController,D);const N=t.audioStreamController;N&&D.push(new N(this,x,C)),this.subtitleTrackController=this.createController(t.subtitleTrackController,D);const z=t.subtitleStreamController;z&&D.push(new z(this,x,C)),this.createController(t.timelineController,B),C.emeController=this.emeController=this.createController(t.emeController,B),this.cmcdController=this.createController(t.cmcdController,B),this.latencyController=this.createController(FQ,B),this.coreComponents=B,D.push(l);const Z=l.onErrorOut;typeof Z=="function"&&this.on($.ERROR,Z,l)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(ge.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===$.ERROR;this.trigger($.ERROR,{type:_t.OTHER_ERROR,details:be.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){ge.log("destroy"),this.trigger($.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){ge.log("attachMedia"),this._media=e,this.trigger($.MEDIA_ATTACHING,{media:e})}detachMedia(){ge.log("detachMedia"),this.trigger($.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,i=this.url,r=this.url=t1.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,ge.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger($.MANIFEST_LOADING,{url:e})}startLoad(e=-1){ge.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){ge.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){ge.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){ge.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){ge.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){ge.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){ge.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){ge.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){ge.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(ge.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){BQ(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let s=r;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Fn.defaultConfig=void 0;function Yte(n,e=globalThis==null?void 0:globalThis.document){const t=go(n);M.useEffect(()=>{const i=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",i),()=>e.removeEventListener("keydown",i)},[t,e])}const jS="dismissableLayer.update",Xte="dismissableLayer.pointerDownOutside",Jte="dismissableLayer.focusOutside";let SP;const Qte=M.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),LU=M.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:a,onDismiss:l,...c}=n,u=M.useContext(Qte),[f,p]=M.useState(null),m=(t=f==null?void 0:f.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,y]=M.useState({}),_=vi(e,z=>p(z)),w=Array.from(u.layers),[T]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),x=w.indexOf(T),C=f?w.indexOf(f):-1,I=u.layersWithOutsidePointerEventsDisabled.size>0,D=C>=x,B=eie(z=>{const Z=z.target,q=[...u.branches].some(H=>H.contains(Z));!D||q||(s==null||s(z),a==null||a(z),z.defaultPrevented||l==null||l())},m),N=tie(z=>{const Z=z.target;[...u.branches].some(H=>H.contains(Z))||(o==null||o(z),a==null||a(z),z.defaultPrevented||l==null||l())},m);return Yte(z=>{C===u.layers.size-1&&(r==null||r(z),!z.defaultPrevented&&l&&(z.preventDefault(),l()))},m),M.useEffect(()=>{if(f)return i&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(SP=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(f)),u.layers.add(f),bP(),()=>{i&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=SP)}},[f,m,i,u]),M.useEffect(()=>()=>{f&&(u.layers.delete(f),u.layersWithOutsidePointerEventsDisabled.delete(f),bP())},[f,u]),M.useEffect(()=>{const z=()=>y({});return document.addEventListener(jS,z),()=>document.removeEventListener(jS,z)},[]),M.createElement(Gt.div,Ze({},c,{ref:_,style:{pointerEvents:I?D?"auto":"none":void 0,...n.style},onFocusCapture:Dt(n.onFocusCapture,N.onFocusCapture),onBlurCapture:Dt(n.onBlurCapture,N.onBlurCapture),onPointerDownCapture:Dt(n.onPointerDownCapture,B.onPointerDownCapture)}))});function eie(n,e=globalThis==null?void 0:globalThis.document){const t=go(n),i=M.useRef(!1),r=M.useRef(()=>{});return M.useEffect(()=>{const s=a=>{if(a.target&&!i.current){let l=function(){IU(Xte,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>i.current=!0}}function tie(n,e=globalThis==null?void 0:globalThis.document){const t=go(n),i=M.useRef(!1);return M.useEffect(()=>{const r=s=>{s.target&&!i.current&&IU(Jte,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function bP(){const n=new CustomEvent(jS);document.dispatchEvent(n)}function IU(n,e,t,{discrete:i}){const r=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(n,e,{once:!0}),i?F7(r,s):r.dispatchEvent(s)}let iT=0;function PU(){M.useEffect(()=>{var n,e;const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(n=t[0])!==null&&n!==void 0?n:xP()),document.body.insertAdjacentElement("beforeend",(e=t[1])!==null&&e!==void 0?e:xP()),iT++,()=>{iT===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(i=>i.remove()),iT--}},[])}function xP(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}const nT="focusScope.autoFocusOnMount",rT="focusScope.autoFocusOnUnmount",CP={bubbles:!1,cancelable:!0},DU=M.forwardRef((n,e)=>{const{loop:t=!1,trapped:i=!1,onMountAutoFocus:r,onUnmountAutoFocus:s,...o}=n,[a,l]=M.useState(null),c=go(r),u=go(s),f=M.useRef(null),p=vi(e,_=>l(_)),m=M.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;M.useEffect(()=>{if(i){let _=function(C){if(m.paused||!a)return;const I=C.target;a.contains(I)?f.current=I:hl(f.current,{select:!0})},w=function(C){if(m.paused||!a)return;const I=C.relatedTarget;I!==null&&(a.contains(I)||hl(f.current,{select:!0}))},T=function(C){if(document.activeElement===document.body)for(const D of C)D.removedNodes.length>0&&hl(a)};document.addEventListener("focusin",_),document.addEventListener("focusout",w);const x=new MutationObserver(T);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",_),document.removeEventListener("focusout",w),x.disconnect()}}},[i,a,m.paused]),M.useEffect(()=>{if(a){AP.add(m);const _=document.activeElement;if(!a.contains(_)){const T=new CustomEvent(nT,CP);a.addEventListener(nT,c),a.dispatchEvent(T),T.defaultPrevented||(iie(aie(OU(a)),{select:!0}),document.activeElement===_&&hl(a))}return()=>{a.removeEventListener(nT,c),setTimeout(()=>{const T=new CustomEvent(rT,CP);a.addEventListener(rT,u),a.dispatchEvent(T),T.defaultPrevented||hl(_??document.body,{select:!0}),a.removeEventListener(rT,u),AP.remove(m)},0)}}},[a,c,u,m]);const y=M.useCallback(_=>{if(!t&&!i||m.paused)return;const w=_.key==="Tab"&&!_.altKey&&!_.ctrlKey&&!_.metaKey,T=document.activeElement;if(w&&T){const x=_.currentTarget,[C,I]=nie(x);C&&I?!_.shiftKey&&T===I?(_.preventDefault(),t&&hl(C,{select:!0})):_.shiftKey&&T===C&&(_.preventDefault(),t&&hl(I,{select:!0})):T===x&&_.preventDefault()}},[t,i,m.paused]);return M.createElement(Gt.div,Ze({tabIndex:-1},o,{ref:p,onKeyDown:y}))});function iie(n,{select:e=!1}={}){const t=document.activeElement;for(const i of n)if(hl(i,{select:e}),document.activeElement!==t)return}function nie(n){const e=OU(n),t=RP(e,n),i=RP(e.reverse(),n);return[t,i]}function OU(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function RP(n,e){for(const t of n)if(!rie(t,{upTo:e}))return t}function rie(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function sie(n){return n instanceof HTMLInputElement&&"select"in n}function hl(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&sie(n)&&e&&n.select()}}const AP=oie();function oie(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=LP(n,e),n.unshift(e)},remove(e){var t;n=LP(n,e),(t=n[0])===null||t===void 0||t.resume()}}}function LP(n,e){const t=[...n],i=t.indexOf(e);return i!==-1&&t.splice(i,1),t}function aie(n){return n.filter(e=>e.tagName!=="A")}const lie=["top","right","bottom","left"],lo=Math.min,Pr=Math.max,n0=Math.round,Lv=Math.floor,Ol=n=>({x:n,y:n}),cie={left:"right",right:"left",bottom:"top",top:"bottom"},uie={start:"end",end:"start"};function WS(n,e,t){return Pr(n,lo(e,t))}function ga(n,e){return typeof n=="function"?n(e):n}function ma(n){return n.split("-")[0]}function Wd(n){return n.split("-")[1]}function _1(n){return n==="x"?"y":"x"}function E1(n){return n==="y"?"height":"width"}function qd(n){return["top","bottom"].includes(ma(n))?"y":"x"}function w1(n){return _1(qd(n))}function hie(n,e,t){t===void 0&&(t=!1);const i=Wd(n),r=w1(n),s=E1(r);let o=r==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=r0(o)),[o,r0(o)]}function die(n){const e=r0(n);return[qS(n),e,qS(e)]}function qS(n){return n.replace(/start|end/g,e=>uie[e])}function fie(n,e,t){const i=["left","right"],r=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?r:i:e?i:r;case"left":case"right":return e?s:o;default:return[]}}function pie(n,e,t,i){const r=Wd(n);let s=fie(ma(n),t==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(qS)))),s}function r0(n){return n.replace(/left|right|bottom|top/g,e=>cie[e])}function gie(n){return{top:0,right:0,bottom:0,left:0,...n}}function kU(n){return typeof n!="number"?gie(n):{top:n,right:n,bottom:n,left:n}}function s0(n){const{x:e,y:t,width:i,height:r}=n;return{width:i,height:r,top:t,left:e,right:e+i,bottom:t+r,x:e,y:t}}function IP(n,e,t){let{reference:i,floating:r}=n;const s=qd(e),o=w1(e),a=E1(o),l=ma(e),c=s==="y",u=i.x+i.width/2-r.width/2,f=i.y+i.height/2-r.height/2,p=i[a]/2-r[a]/2;let m;switch(l){case"top":m={x:u,y:i.y-r.height};break;case"bottom":m={x:u,y:i.y+i.height};break;case"right":m={x:i.x+i.width,y:f};break;case"left":m={x:i.x-r.width,y:f};break;default:m={x:i.x,y:i.y}}switch(Wd(e)){case"start":m[o]-=p*(t&&c?-1:1);break;case"end":m[o]+=p*(t&&c?-1:1);break}return m}const mie=async(n,e,t)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:n,floating:e,strategy:r}),{x:u,y:f}=IP(c,i,l),p=i,m={},y=0;for(let _=0;_<a.length;_++){const{name:w,fn:T}=a[_],{x,y:C,data:I,reset:D}=await T({x:u,y:f,initialPlacement:i,placement:p,strategy:r,middlewareData:m,rects:c,platform:o,elements:{reference:n,floating:e}});u=x??u,f=C??f,m={...m,[w]:{...m[w],...I}},D&&y<=50&&(y++,typeof D=="object"&&(D.placement&&(p=D.placement),D.rects&&(c=D.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:r}):D.rects),{x:u,y:f}=IP(c,p,l)),_=-1)}return{x:u,y:f,placement:p,strategy:r,middlewareData:m}};async function Zp(n,e){var t;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:f="floating",altBoundary:p=!1,padding:m=0}=ga(e,n),y=kU(m),w=a[p?f==="floating"?"reference":"floating":f],T=s0(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(w)))==null||t?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=f==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,C=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),I=await(s.isElement==null?void 0:s.isElement(C))?await(s.getScale==null?void 0:s.getScale(C))||{x:1,y:1}:{x:1,y:1},D=s0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:C,strategy:l}):x);return{top:(T.top-D.top+y.top)/I.y,bottom:(D.bottom-T.bottom+y.bottom)/I.y,left:(T.left-D.left+y.left)/I.x,right:(D.right-T.right+y.right)/I.x}}const vie=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:i,placement:r,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=ga(n,e)||{};if(c==null)return{};const f=kU(u),p={x:t,y:i},m=w1(r),y=E1(m),_=await o.getDimensions(c),w=m==="y",T=w?"top":"left",x=w?"bottom":"right",C=w?"clientHeight":"clientWidth",I=s.reference[y]+s.reference[m]-p[m]-s.floating[y],D=p[m]-s.reference[m],B=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let N=B?B[C]:0;(!N||!await(o.isElement==null?void 0:o.isElement(B)))&&(N=a.floating[C]||s.floating[y]);const z=I/2-D/2,Z=N/2-_[y]/2-1,q=lo(f[T],Z),H=lo(f[x],Z),Y=q,ee=N-_[y]-H,le=N/2-_[y]/2+z,W=WS(Y,le,ee),ie=!l.arrow&&Wd(r)!=null&&le!==W&&s.reference[y]/2-(le<Y?q:H)-_[y]/2<0,ne=ie?le<Y?le-Y:le-ee:0;return{[m]:p[m]+ne,data:{[m]:W,centerOffset:le-W-ne,...ie&&{alignmentOffset:ne}},reset:ie}}}),yie=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:f=!0,fallbackPlacements:p,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:_=!0,...w}=ga(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const T=ma(r),x=ma(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),I=p||(x||!_?[r0(a)]:die(a));!p&&y!=="none"&&I.push(...pie(a,_,y,C));const D=[a,...I],B=await Zp(e,w),N=[];let z=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&N.push(B[T]),f){const Y=hie(r,o,C);N.push(B[Y[0]],B[Y[1]])}if(z=[...z,{placement:r,overflows:N}],!N.every(Y=>Y<=0)){var Z,q;const Y=(((Z=s.flip)==null?void 0:Z.index)||0)+1,ee=D[Y];if(ee)return{data:{index:Y,overflows:z},reset:{placement:ee}};let le=(q=z.filter(W=>W.overflows[0]<=0).sort((W,ie)=>W.overflows[1]-ie.overflows[1])[0])==null?void 0:q.placement;if(!le)switch(m){case"bestFit":{var H;const W=(H=z.map(ie=>[ie.placement,ie.overflows.filter(ne=>ne>0).reduce((ne,J)=>ne+J,0)]).sort((ie,ne)=>ie[1]-ne[1])[0])==null?void 0:H[0];W&&(le=W);break}case"initialPlacement":le=a;break}if(r!==le)return{reset:{placement:le}}}return{}}}};function PP(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function DP(n){return lie.some(e=>n[e]>=0)}const _ie=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:i="referenceHidden",...r}=ga(n,e);switch(i){case"referenceHidden":{const s=await Zp(e,{...r,elementContext:"reference"}),o=PP(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:DP(o)}}}case"escaped":{const s=await Zp(e,{...r,altBoundary:!0}),o=PP(s,t.floating);return{data:{escapedOffsets:o,escaped:DP(o)}}}default:return{}}}}};async function Eie(n,e){const{placement:t,platform:i,elements:r}=n,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=ma(t),a=Wd(t),l=qd(t)==="y",c=["left","top"].includes(o)?-1:1,u=s&&l?-1:1,f=ga(e,n);let{mainAxis:p,crossAxis:m,alignmentAxis:y}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...f};return a&&typeof y=="number"&&(m=a==="end"?y*-1:y),l?{x:m*u,y:p*c}:{x:p*c,y:m*u}}const wie=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,i;const{x:r,y:s,placement:o,middlewareData:a}=e,l=await Eie(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:o}}}}},Tie=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:w=>{let{x:T,y:x}=w;return{x:T,y:x}}},...l}=ga(n,e),c={x:t,y:i},u=await Zp(e,l),f=qd(ma(r)),p=_1(f);let m=c[p],y=c[f];if(s){const w=p==="y"?"top":"left",T=p==="y"?"bottom":"right",x=m+u[w],C=m-u[T];m=WS(x,m,C)}if(o){const w=f==="y"?"top":"left",T=f==="y"?"bottom":"right",x=y+u[w],C=y-u[T];y=WS(x,y,C)}const _=a.fn({...e,[p]:m,[f]:y});return{..._,data:{x:_.x-t,y:_.y-i}}}}},Sie=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:i,placement:r,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=ga(n,e),u={x:t,y:i},f=qd(r),p=_1(f);let m=u[p],y=u[f];const _=ga(a,e),w=typeof _=="number"?{mainAxis:_,crossAxis:0}:{mainAxis:0,crossAxis:0,..._};if(l){const C=p==="y"?"height":"width",I=s.reference[p]-s.floating[C]+w.mainAxis,D=s.reference[p]+s.reference[C]-w.mainAxis;m<I?m=I:m>D&&(m=D)}if(c){var T,x;const C=p==="y"?"width":"height",I=["top","left"].includes(ma(r)),D=s.reference[f]-s.floating[C]+(I&&((T=o.offset)==null?void 0:T[f])||0)+(I?0:w.crossAxis),B=s.reference[f]+s.reference[C]+(I?0:((x=o.offset)==null?void 0:x[f])||0)-(I?w.crossAxis:0);y<D?y=D:y>B&&(y=B)}return{[p]:m,[f]:y}}}},bie=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:i,platform:r,elements:s}=e,{apply:o=()=>{},...a}=ga(n,e),l=await Zp(e,a),c=ma(t),u=Wd(t),f=qd(t)==="y",{width:p,height:m}=i.floating;let y,_;c==="top"||c==="bottom"?(y=c,_=u===(await(r.isRTL==null?void 0:r.isRTL(s.floating))?"start":"end")?"left":"right"):(_=c,y=u==="end"?"top":"bottom");const w=m-l.top-l.bottom,T=p-l.left-l.right,x=lo(m-l[y],w),C=lo(p-l[_],T),I=!e.middlewareData.shift;let D=x,B=C;if(f?B=u||I?lo(C,T):T:D=u||I?lo(x,w):w,I&&!u){const z=Pr(l.left,0),Z=Pr(l.right,0),q=Pr(l.top,0),H=Pr(l.bottom,0);f?B=p-2*(z!==0||Z!==0?z+Z:Pr(l.left,l.right)):D=m-2*(q!==0||H!==0?q+H:Pr(l.top,l.bottom))}await o({...e,availableWidth:B,availableHeight:D});const N=await r.getDimensions(s.floating);return p!==N.width||m!==N.height?{reset:{rects:!0}}:{}}}};function Kd(n){return MU(n)?(n.nodeName||"").toLowerCase():"#document"}function Mr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Ta(n){var e;return(e=(MU(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function MU(n){return n instanceof Node||n instanceof Mr(n).Node}function vo(n){return n instanceof Element||n instanceof Mr(n).Element}function yo(n){return n instanceof HTMLElement||n instanceof Mr(n).HTMLElement}function OP(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Mr(n).ShadowRoot}function Sg(n){const{overflow:e,overflowX:t,overflowY:i,display:r}=Is(n);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!["inline","contents"].includes(r)}function xie(n){return["table","td","th"].includes(Kd(n))}function T1(n){const e=S1(),t=Is(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(t.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(t.contain||"").includes(i))}function Cie(n){let e=kl(n);for(;yo(e)&&!xd(e);){if(T1(e))return e;e=kl(e)}return null}function S1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function xd(n){return["html","body","#document"].includes(Kd(n))}function Is(n){return Mr(n).getComputedStyle(n)}function n_(n){return vo(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function kl(n){if(Kd(n)==="html")return n;const e=n.assignedSlot||n.parentNode||OP(n)&&n.host||Ta(n);return OP(e)?e.host:e}function NU(n){const e=kl(n);return xd(e)?n.ownerDocument?n.ownerDocument.body:n.body:yo(e)&&Sg(e)?e:NU(e)}function Yp(n,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=NU(n),s=r===((i=n.ownerDocument)==null?void 0:i.body),o=Mr(r);return s?e.concat(o,o.visualViewport||[],Sg(r)?r:[],o.frameElement&&t?Yp(o.frameElement):[]):e.concat(r,Yp(r,[],t))}function FU(n){const e=Is(n);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=yo(n),s=r?n.offsetWidth:t,o=r?n.offsetHeight:i,a=n0(t)!==s||n0(i)!==o;return a&&(t=s,i=o),{width:t,height:i,$:a}}function b1(n){return vo(n)?n:n.contextElement}function td(n){const e=b1(n);if(!yo(e))return Ol(1);const t=e.getBoundingClientRect(),{width:i,height:r,$:s}=FU(e);let o=(s?n0(t.width):t.width)/i,a=(s?n0(t.height):t.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Rie=Ol(0);function BU(n){const e=Mr(n);return!S1()||!e.visualViewport?Rie:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Aie(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Mr(n)?!1:e}function ru(n,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=n.getBoundingClientRect(),s=b1(n);let o=Ol(1);e&&(i?vo(i)&&(o=td(i)):o=td(n));const a=Aie(s,t,i)?BU(s):Ol(0);let l=(r.left+a.x)/o.x,c=(r.top+a.y)/o.y,u=r.width/o.x,f=r.height/o.y;if(s){const p=Mr(s),m=i&&vo(i)?Mr(i):i;let y=p,_=y.frameElement;for(;_&&i&&m!==y;){const w=td(_),T=_.getBoundingClientRect(),x=Is(_),C=T.left+(_.clientLeft+parseFloat(x.paddingLeft))*w.x,I=T.top+(_.clientTop+parseFloat(x.paddingTop))*w.y;l*=w.x,c*=w.y,u*=w.x,f*=w.y,l+=C,c+=I,y=Mr(_),_=y.frameElement}}return s0({width:u,height:f,x:l,y:c})}const Lie=[":popover-open",":modal"];function x1(n){return Lie.some(e=>{try{return n.matches(e)}catch{return!1}})}function Iie(n){let{elements:e,rect:t,offsetParent:i,strategy:r}=n;const s=r==="fixed",o=Ta(i),a=e?x1(e.floating):!1;if(i===o||a&&s)return t;let l={scrollLeft:0,scrollTop:0},c=Ol(1);const u=Ol(0),f=yo(i);if((f||!f&&!s)&&((Kd(i)!=="body"||Sg(o))&&(l=n_(i)),yo(i))){const p=ru(i);c=td(i),u.x=p.x+i.clientLeft,u.y=p.y+i.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x,y:t.y*c.y-l.scrollTop*c.y+u.y}}function Pie(n){return Array.from(n.getClientRects())}function UU(n){return ru(Ta(n)).left+n_(n).scrollLeft}function Die(n){const e=Ta(n),t=n_(n),i=n.ownerDocument.body,r=Pr(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Pr(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-t.scrollLeft+UU(n);const a=-t.scrollTop;return Is(i).direction==="rtl"&&(o+=Pr(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function Oie(n,e){const t=Mr(n),i=Ta(n),r=t.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;const c=S1();(!c||c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a,y:l}}function kie(n,e){const t=ru(n,!0,e==="fixed"),i=t.top+n.clientTop,r=t.left+n.clientLeft,s=yo(n)?td(n):Ol(1),o=n.clientWidth*s.x,a=n.clientHeight*s.y,l=r*s.x,c=i*s.y;return{width:o,height:a,x:l,y:c}}function kP(n,e,t){let i;if(e==="viewport")i=Oie(n,t);else if(e==="document")i=Die(Ta(n));else if(vo(e))i=kie(e,t);else{const r=BU(n);i={...e,x:e.x-r.x,y:e.y-r.y}}return s0(i)}function zU(n,e){const t=kl(n);return t===e||!vo(t)||xd(t)?!1:Is(t).position==="fixed"||zU(t,e)}function Mie(n,e){const t=e.get(n);if(t)return t;let i=Yp(n,[],!1).filter(a=>vo(a)&&Kd(a)!=="body"),r=null;const s=Is(n).position==="fixed";let o=s?kl(n):n;for(;vo(o)&&!xd(o);){const a=Is(o),l=T1(o);!l&&a.position==="fixed"&&(r=null),(s?!l&&!r:!l&&a.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||Sg(o)&&!l&&zU(n,o))?i=i.filter(u=>u!==o):r=a,o=kl(o)}return e.set(n,i),i}function Nie(n){let{element:e,boundary:t,rootBoundary:i,strategy:r}=n;const o=[...t==="clippingAncestors"?x1(e)?[]:Mie(e,this._c):[].concat(t),i],a=o[0],l=o.reduce((c,u)=>{const f=kP(e,u,r);return c.top=Pr(f.top,c.top),c.right=lo(f.right,c.right),c.bottom=lo(f.bottom,c.bottom),c.left=Pr(f.left,c.left),c},kP(e,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Fie(n){const{width:e,height:t}=FU(n);return{width:e,height:t}}function Bie(n,e,t){const i=yo(e),r=Ta(e),s=t==="fixed",o=ru(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Ol(0);if(i||!i&&!s)if((Kd(e)!=="body"||Sg(r))&&(a=n_(e)),i){const f=ru(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else r&&(l.x=UU(r));const c=o.left+a.scrollLeft-l.x,u=o.top+a.scrollTop-l.y;return{x:c,y:u,width:o.width,height:o.height}}function sT(n){return Is(n).position==="static"}function MP(n,e){return!yo(n)||Is(n).position==="fixed"?null:e?e(n):n.offsetParent}function GU(n,e){const t=Mr(n);if(x1(n))return t;if(!yo(n)){let r=kl(n);for(;r&&!xd(r);){if(vo(r)&&!sT(r))return r;r=kl(r)}return t}let i=MP(n,e);for(;i&&xie(i)&&sT(i);)i=MP(i,e);return i&&xd(i)&&sT(i)&&!T1(i)?t:i||Cie(n)||t}const Uie=async function(n){const e=this.getOffsetParent||GU,t=this.getDimensions,i=await t(n.floating);return{reference:Bie(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function zie(n){return Is(n).direction==="rtl"}const Gie={convertOffsetParentRelativeRectToViewportRelativeRect:Iie,getDocumentElement:Ta,getClippingRect:Nie,getOffsetParent:GU,getElementRects:Uie,getClientRects:Pie,getDimensions:Fie,getScale:td,isElement:vo,isRTL:zie};function Hie(n,e){let t=null,i;const r=Ta(n);function s(){var a;clearTimeout(i),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const{left:c,top:u,width:f,height:p}=n.getBoundingClientRect();if(a||e(),!f||!p)return;const m=Lv(u),y=Lv(r.clientWidth-(c+f)),_=Lv(r.clientHeight-(u+p)),w=Lv(c),x={rootMargin:-m+"px "+-y+"px "+-_+"px "+-w+"px",threshold:Pr(0,lo(1,l))||1};let C=!0;function I(D){const B=D[0].intersectionRatio;if(B!==l){if(!C)return o();B?o(!1,B):i=setTimeout(()=>{o(!1,1e-7)},1e3)}C=!1}try{t=new IntersectionObserver(I,{...x,root:r.ownerDocument})}catch{t=new IntersectionObserver(I,x)}t.observe(n)}return o(!0),s}function $ie(n,e,t,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=b1(n),u=r||s?[...c?Yp(c):[],...Yp(e)]:[];u.forEach(T=>{r&&T.addEventListener("scroll",t,{passive:!0}),s&&T.addEventListener("resize",t)});const f=c&&a?Hie(c,t):null;let p=-1,m=null;o&&(m=new ResizeObserver(T=>{let[x]=T;x&&x.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var C;(C=m)==null||C.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let y,_=l?ru(n):null;l&&w();function w(){const T=ru(n);_&&(T.x!==_.x||T.y!==_.y||T.width!==_.width||T.height!==_.height)&&t(),_=T,y=requestAnimationFrame(w)}return t(),()=>{var T;u.forEach(x=>{r&&x.removeEventListener("scroll",t),s&&x.removeEventListener("resize",t)}),f==null||f(),(T=m)==null||T.disconnect(),m=null,l&&cancelAnimationFrame(y)}}const Vie=wie,jie=Tie,Wie=yie,qie=bie,Kie=_ie,NP=vie,Zie=Sie,Yie=(n,e,t)=>{const i=new Map,r={platform:Gie,...t},s={...r.platform,_c:i};return mie(n,e,{...r,platform:s})};var oy=typeof document<"u"?M.useLayoutEffect:M.useEffect;function o0(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,i,r;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(i=t;i--!==0;)if(!o0(n[i],e[i]))return!1;return!0}if(r=Object.keys(n),t=r.length,t!==Object.keys(e).length)return!1;for(i=t;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=t;i--!==0;){const s=r[i];if(!(s==="_owner"&&n.$$typeof)&&!o0(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function HU(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function FP(n,e){const t=HU(n);return Math.round(e*t)/t}function BP(n){const e=M.useRef(n);return oy(()=>{e.current=n}),e}function Xie(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,f]=M.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[p,m]=M.useState(i);o0(p,i)||m(i);const[y,_]=M.useState(null),[w,T]=M.useState(null),x=M.useCallback(ne=>{ne!==B.current&&(B.current=ne,_(ne))},[]),C=M.useCallback(ne=>{ne!==N.current&&(N.current=ne,T(ne))},[]),I=s||y,D=o||w,B=M.useRef(null),N=M.useRef(null),z=M.useRef(u),Z=l!=null,q=BP(l),H=BP(r),Y=M.useCallback(()=>{if(!B.current||!N.current)return;const ne={placement:e,strategy:t,middleware:p};H.current&&(ne.platform=H.current),Yie(B.current,N.current,ne).then(J=>{const ce={...J,isPositioned:!0};ee.current&&!o0(z.current,ce)&&(z.current=ce,du.flushSync(()=>{f(ce)}))})},[p,e,t,H]);oy(()=>{c===!1&&z.current.isPositioned&&(z.current.isPositioned=!1,f(ne=>({...ne,isPositioned:!1})))},[c]);const ee=M.useRef(!1);oy(()=>(ee.current=!0,()=>{ee.current=!1}),[]),oy(()=>{if(I&&(B.current=I),D&&(N.current=D),I&&D){if(q.current)return q.current(I,D,Y);Y()}},[I,D,Y,q,Z]);const le=M.useMemo(()=>({reference:B,floating:N,setReference:x,setFloating:C}),[x,C]),W=M.useMemo(()=>({reference:I,floating:D}),[I,D]),ie=M.useMemo(()=>{const ne={position:t,left:0,top:0};if(!W.floating)return ne;const J=FP(W.floating,u.x),ce=FP(W.floating,u.y);return a?{...ne,transform:"translate("+J+"px, "+ce+"px)",...HU(W.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:J,top:ce}},[t,a,W.floating,u.x,u.y]);return M.useMemo(()=>({...u,update:Y,refs:le,elements:W,floatingStyles:ie}),[u,Y,le,W,ie])}const Jie=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:i,padding:r}=typeof n=="function"?n(t):n;return i&&e(i)?i.current!=null?NP({element:i.current,padding:r}).fn(t):{}:i?NP({element:i,padding:r}).fn(t):{}}}},Qie=(n,e)=>({...Vie(n),options:[n,e]}),ene=(n,e)=>({...jie(n),options:[n,e]}),tne=(n,e)=>({...Zie(n),options:[n,e]}),ine=(n,e)=>({...Wie(n),options:[n,e]}),nne=(n,e)=>({...qie(n),options:[n,e]}),rne=(n,e)=>({...Kie(n),options:[n,e]}),sne=(n,e)=>({...Jie(n),options:[n,e]}),one=M.forwardRef((n,e)=>{const{children:t,width:i=10,height:r=5,...s}=n;return M.createElement(Gt.svg,Ze({},s,{ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),n.asChild?t:M.createElement("polygon",{points:"0,0 30,0 15,10"}))}),ane=one,$U="Popper",[VU,r_]=ks($U),[lne,jU]=VU($U),cne=n=>{const{__scopePopper:e,children:t}=n,[i,r]=M.useState(null);return M.createElement(lne,{scope:e,anchor:i,onAnchorChange:r},t)},une="PopperAnchor",hne=M.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:i,...r}=n,s=jU(une,t),o=M.useRef(null),a=vi(e,o);return M.useEffect(()=>{s.onAnchorChange((i==null?void 0:i.current)||o.current)}),i?null:M.createElement(Gt.div,Ze({},r,{ref:a}))}),WU="PopperContent",[dne,fne]=VU(WU),pne=M.forwardRef((n,e)=>{var t,i,r,s,o,a,l,c;const{__scopePopper:u,side:f="bottom",sideOffset:p=0,align:m="center",alignOffset:y=0,arrowPadding:_=0,avoidCollisions:w=!0,collisionBoundary:T=[],collisionPadding:x=0,sticky:C="partial",hideWhenDetached:I=!1,updatePositionStrategy:D="optimized",onPlaced:B,...N}=n,z=jU(WU,u),[Z,q]=M.useState(null),H=vi(e,ii=>q(ii)),[Y,ee]=M.useState(null),le=Ox(Y),W=(t=le==null?void 0:le.width)!==null&&t!==void 0?t:0,ie=(i=le==null?void 0:le.height)!==null&&i!==void 0?i:0,ne=f+(m!=="center"?"-"+m:""),J=typeof x=="number"?x:{top:0,right:0,bottom:0,left:0,...x},ce=Array.isArray(T)?T:[T],se=ce.length>0,te={padding:J,boundary:ce.filter(yne),altBoundary:se},{refs:Q,floatingStyles:_e,placement:fe,isPositioned:pe,middlewareData:Ce}=Xie({strategy:"fixed",placement:ne,whileElementsMounted:(...ii)=>$ie(...ii,{animationFrame:D==="always"}),elements:{reference:z.anchor},middleware:[Qie({mainAxis:p+ie,alignmentAxis:y}),w&&ene({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?tne():void 0,...te}),w&&ine({...te}),nne({...te,apply:({elements:ii,rects:Yt,availableWidth:k,availableHeight:X})=>{const{width:ve,height:Pe}=Yt.reference,Ae=ii.floating.style;Ae.setProperty("--radix-popper-available-width",`${k}px`),Ae.setProperty("--radix-popper-available-height",`${X}px`),Ae.setProperty("--radix-popper-anchor-width",`${ve}px`),Ae.setProperty("--radix-popper-anchor-height",`${Pe}px`)}}),Y&&sne({element:Y,padding:_}),_ne({arrowWidth:W,arrowHeight:ie}),I&&rne({strategy:"referenceHidden",...te})]}),[xe,Le]=qU(fe),je=go(B);Xn(()=>{pe&&(je==null||je())},[pe,je]);const Ke=(r=Ce.arrow)===null||r===void 0?void 0:r.x,lt=(s=Ce.arrow)===null||s===void 0?void 0:s.y,ct=((o=Ce.arrow)===null||o===void 0?void 0:o.centerOffset)!==0,[Ht,Vt]=M.useState();return Xn(()=>{Z&&Vt(window.getComputedStyle(Z).zIndex)},[Z]),M.createElement("div",{ref:Q.setFloating,"data-radix-popper-content-wrapper":"",style:{..._e,transform:pe?_e.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ht,"--radix-popper-transform-origin":[(a=Ce.transformOrigin)===null||a===void 0?void 0:a.x,(l=Ce.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:n.dir},M.createElement(dne,{scope:u,placedSide:xe,onArrowChange:ee,arrowX:Ke,arrowY:lt,shouldHideArrow:ct},M.createElement(Gt.div,Ze({"data-side":xe,"data-align":Le},N,{ref:H,style:{...N.style,animation:pe?void 0:"none",opacity:(c=Ce.hide)!==null&&c!==void 0&&c.referenceHidden?0:void 0}}))))}),gne="PopperArrow",mne={top:"bottom",right:"left",bottom:"top",left:"right"},vne=M.forwardRef(function(e,t){const{__scopePopper:i,...r}=e,s=fne(gne,i),o=mne[s.placedSide];return M.createElement("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0}},M.createElement(ane,Ze({},r,{ref:t,style:{...r.style,display:"block"}})))});function yne(n){return n!==null}const _ne=n=>({name:"transformOrigin",options:n,fn(e){var t,i,r,s,o;const{placement:a,rects:l,middlewareData:c}=e,f=((t=c.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,p=f?0:n.arrowWidth,m=f?0:n.arrowHeight,[y,_]=qU(a),w={start:"0%",center:"50%",end:"100%"}[_],T=((i=(r=c.arrow)===null||r===void 0?void 0:r.x)!==null&&i!==void 0?i:0)+p/2,x=((s=(o=c.arrow)===null||o===void 0?void 0:o.y)!==null&&s!==void 0?s:0)+m/2;let C="",I="";return y==="bottom"?(C=f?w:`${T}px`,I=`${-m}px`):y==="top"?(C=f?w:`${T}px`,I=`${l.floating.height+m}px`):y==="right"?(C=`${-m}px`,I=f?w:`${x}px`):y==="left"&&(C=`${l.floating.width+m}px`,I=f?w:`${x}px`),{data:{x:C,y:I}}}});function qU(n){const[e,t="center"]=n.split("-");return[e,t]}const KU=cne,ZU=hne,YU=pne,Ene=vne,wne=M.forwardRef((n,e)=>{var t;const{container:i=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...r}=n;return i?Hj.createPortal(M.createElement(Gt.div,Ze({},r,{ref:e})),i):null});var Tne=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},xh=new WeakMap,Iv=new WeakMap,Pv={},oT=0,XU=function(n){return n&&(n.host||XU(n.parentNode))},Sne=function(n,e){return e.map(function(t){if(n.contains(t))return t;var i=XU(t);return i&&n.contains(i)?i:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},bne=function(n,e,t,i){var r=Sne(e,Array.isArray(n)?n:[n]);Pv[t]||(Pv[t]=new WeakMap);var s=Pv[t],o=[],a=new Set,l=new Set(r),c=function(f){!f||a.has(f)||(a.add(f),c(f.parentNode))};r.forEach(c);var u=function(f){!f||l.has(f)||Array.prototype.forEach.call(f.children,function(p){if(a.has(p))u(p);else try{var m=p.getAttribute(i),y=m!==null&&m!=="false",_=(xh.get(p)||0)+1,w=(s.get(p)||0)+1;xh.set(p,_),s.set(p,w),o.push(p),_===1&&y&&Iv.set(p,!0),w===1&&p.setAttribute(t,"true"),y||p.setAttribute(i,"true")}catch(T){console.error("aria-hidden: cannot operate on ",p,T)}})};return u(e),a.clear(),oT++,function(){o.forEach(function(f){var p=xh.get(f)-1,m=s.get(f)-1;xh.set(f,p),s.set(f,m),p||(Iv.has(f)||f.removeAttribute(i),Iv.delete(f)),m||f.removeAttribute(t)}),oT--,oT||(xh=new WeakMap,xh=new WeakMap,Iv=new WeakMap,Pv={})}},JU=function(n,e,t){t===void 0&&(t="data-aria-hidden");var i=Array.from(Array.isArray(n)?n:[n]),r=Tne(n);return r?(i.push.apply(i,Array.from(r.querySelectorAll("[aria-live]"))),bne(i,r,t,"aria-hidden")):function(){return null}},ro=function(){return ro=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},ro.apply(this,arguments)};function QU(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(t[i[r]]=n[i[r]]);return t}function xne(n,e,t){for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))}var ay="right-scroll-bar-position",ly="width-before-scroll-bar",Cne="with-scroll-bars-hidden",Rne="--removed-body-scroll-bar-size";function aT(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Ane(n,e){var t=M.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(i){var r=t.value;r!==i&&(t.value=i,t.callback(i,r))}}}})[0];return t.callback=e,t.facade}var Lne=typeof window<"u"?M.useLayoutEffect:M.useEffect,UP=new WeakMap;function Ine(n,e){var t=Ane(null,function(i){return n.forEach(function(r){return aT(r,i)})});return Lne(function(){var i=UP.get(t);if(i){var r=new Set(i),s=new Set(n),o=t.current;r.forEach(function(a){s.has(a)||aT(a,null)}),s.forEach(function(a){r.has(a)||aT(a,o)})}UP.set(t,n)},[n]),t}function Pne(n){return n}function Dne(n,e){e===void 0&&(e=Pne);var t=[],i=!1,r={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,i);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(i=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){i=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(s),o=t}var l=function(){var u=o;o=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){o.push(u),c()},filter:function(u){return o=o.filter(u),t}}}};return r}function One(n){n===void 0&&(n={});var e=Dne(null);return e.options=ro({async:!0,ssr:!1},n),e}var e4=function(n){var e=n.sideCar,t=QU(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=e.read();if(!i)throw new Error("Sidecar medium not found");return M.createElement(i,ro({},t))};e4.isSideCarExport=!0;function kne(n,e){return n.useMedium(e),e4}var t4=One(),lT=function(){},s_=M.forwardRef(function(n,e){var t=M.useRef(null),i=M.useState({onScrollCapture:lT,onWheelCapture:lT,onTouchMoveCapture:lT}),r=i[0],s=i[1],o=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,f=n.shards,p=n.sideCar,m=n.noIsolation,y=n.inert,_=n.allowPinchZoom,w=n.as,T=w===void 0?"div":w,x=QU(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),C=p,I=Ine([t,e]),D=ro(ro({},x),r);return M.createElement(M.Fragment,null,u&&M.createElement(C,{sideCar:t4,removeScrollBar:c,shards:f,noIsolation:m,inert:y,setCallbacks:s,allowPinchZoom:!!_,lockRef:t}),o?M.cloneElement(M.Children.only(a),ro(ro({},D),{ref:I})):M.createElement(T,ro({},D,{className:l,ref:I}),a))});s_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};s_.classNames={fullWidth:ly,zeroRight:ay};var Mne=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Nne(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Mne();return e&&n.setAttribute("nonce",e),n}function Fne(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Bne(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Une=function(){var n=0,e=null;return{add:function(t){n==0&&(e=Nne())&&(Fne(e,t),Bne(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},zne=function(){var n=Une();return function(e,t){M.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},i4=function(){var n=zne(),e=function(t){var i=t.styles,r=t.dynamic;return n(i,r),null};return e},Gne={left:0,top:0,right:0,gap:0},cT=function(n){return parseInt(n||"",10)||0},Hne=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],i=e[n==="padding"?"paddingTop":"marginTop"],r=e[n==="padding"?"paddingRight":"marginRight"];return[cT(t),cT(i),cT(r)]},$ne=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Gne;var e=Hne(n),t=document.documentElement.clientWidth,i=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,i-t+e[2]-e[0])}},Vne=i4(),id="data-scroll-locked",jne=function(n,e,t,i){var r=n.left,s=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(Cne,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(id,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(i,";"),t==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(ay,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(ly,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(ay," .").concat(ay,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(ly," .").concat(ly,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(id,`] {
    `).concat(Rne,": ").concat(a,`px;
  }
`)},zP=function(){var n=parseInt(document.body.getAttribute(id)||"0",10);return isFinite(n)?n:0},Wne=function(){M.useEffect(function(){return document.body.setAttribute(id,(zP()+1).toString()),function(){var n=zP()-1;n<=0?document.body.removeAttribute(id):document.body.setAttribute(id,n.toString())}},[])},qne=function(n){var e=n.noRelative,t=n.noImportant,i=n.gapMode,r=i===void 0?"margin":i;Wne();var s=M.useMemo(function(){return $ne(r)},[r]);return M.createElement(Vne,{styles:jne(s,!e,r,t?"":"!important")})},KS=!1;if(typeof window<"u")try{var Dv=Object.defineProperty({},"passive",{get:function(){return KS=!0,!0}});window.addEventListener("test",Dv,Dv),window.removeEventListener("test",Dv,Dv)}catch{KS=!1}var Ch=KS?{passive:!1}:!1,Kne=function(n){return n.tagName==="TEXTAREA"},n4=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Kne(n)&&t[e]==="visible")},Zne=function(n){return n4(n,"overflowY")},Yne=function(n){return n4(n,"overflowX")},GP=function(n,e){var t=e;do{typeof ShadowRoot<"u"&&t instanceof ShadowRoot&&(t=t.host);var i=r4(n,t);if(i){var r=s4(n,t),s=r[1],o=r[2];if(s>o)return!0}t=t.parentNode}while(t&&t!==document.body);return!1},Xne=function(n){var e=n.scrollTop,t=n.scrollHeight,i=n.clientHeight;return[e,t,i]},Jne=function(n){var e=n.scrollLeft,t=n.scrollWidth,i=n.clientWidth;return[e,t,i]},r4=function(n,e){return n==="v"?Zne(e):Yne(e)},s4=function(n,e){return n==="v"?Xne(e):Jne(e)},Qne=function(n,e){return n==="h"&&e==="rtl"?-1:1},ere=function(n,e,t,i,r){var s=Qne(n,window.getComputedStyle(e).direction),o=s*i,a=t.target,l=e.contains(a),c=!1,u=o>0,f=0,p=0;do{var m=s4(n,a),y=m[0],_=m[1],w=m[2],T=_-w-s*y;(y||T)&&r4(n,a)&&(f+=T,p+=y),a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(f===0||!r)||!u&&(p===0||!r))&&(c=!0),c},Ov=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},HP=function(n){return[n.deltaX,n.deltaY]},$P=function(n){return n&&"current"in n?n.current:n},tre=function(n,e){return n[0]===e[0]&&n[1]===e[1]},ire=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},nre=0,Rh=[];function rre(n){var e=M.useRef([]),t=M.useRef([0,0]),i=M.useRef(),r=M.useState(nre++)[0],s=M.useState(function(){return i4()})[0],o=M.useRef(n);M.useEffect(function(){o.current=n},[n]),M.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(r));var _=xne([n.lockRef.current],(n.shards||[]).map($P)).filter(Boolean);return _.forEach(function(w){return w.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),_.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(r))})}}},[n.inert,n.lockRef.current,n.shards]);var a=M.useCallback(function(_,w){if("touches"in _&&_.touches.length===2)return!o.current.allowPinchZoom;var T=Ov(_),x=t.current,C="deltaX"in _?_.deltaX:x[0]-T[0],I="deltaY"in _?_.deltaY:x[1]-T[1],D,B=_.target,N=Math.abs(C)>Math.abs(I)?"h":"v";if("touches"in _&&N==="h"&&B.type==="range")return!1;var z=GP(N,B);if(!z)return!0;if(z?D=N:(D=N==="v"?"h":"v",z=GP(N,B)),!z)return!1;if(!i.current&&"changedTouches"in _&&(C||I)&&(i.current=D),!D)return!0;var Z=i.current||D;return ere(Z,w,_,Z==="h"?C:I,!0)},[]),l=M.useCallback(function(_){var w=_;if(!(!Rh.length||Rh[Rh.length-1]!==s)){var T="deltaY"in w?HP(w):Ov(w),x=e.current.filter(function(D){return D.name===w.type&&D.target===w.target&&tre(D.delta,T)})[0];if(x&&x.should){w.cancelable&&w.preventDefault();return}if(!x){var C=(o.current.shards||[]).map($P).filter(Boolean).filter(function(D){return D.contains(w.target)}),I=C.length>0?a(w,C[0]):!o.current.noIsolation;I&&w.cancelable&&w.preventDefault()}}},[]),c=M.useCallback(function(_,w,T,x){var C={name:_,delta:w,target:T,should:x};e.current.push(C),setTimeout(function(){e.current=e.current.filter(function(I){return I!==C})},1)},[]),u=M.useCallback(function(_){t.current=Ov(_),i.current=void 0},[]),f=M.useCallback(function(_){c(_.type,HP(_),_.target,a(_,n.lockRef.current))},[]),p=M.useCallback(function(_){c(_.type,Ov(_),_.target,a(_,n.lockRef.current))},[]);M.useEffect(function(){return Rh.push(s),n.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",l,Ch),document.addEventListener("touchmove",l,Ch),document.addEventListener("touchstart",u,Ch),function(){Rh=Rh.filter(function(_){return _!==s}),document.removeEventListener("wheel",l,Ch),document.removeEventListener("touchmove",l,Ch),document.removeEventListener("touchstart",u,Ch)}},[]);var m=n.removeScrollBar,y=n.inert;return M.createElement(M.Fragment,null,y?M.createElement(s,{styles:ire(r)}):null,m?M.createElement(qne,{gapMode:"margin"}):null)}const sre=kne(t4,rre);var C1=M.forwardRef(function(n,e){return M.createElement(s_,ro({},n,{ref:e,sideCar:sre}))});C1.classNames=s_.classNames;const o4="Popover",[a4,Lme]=ks(o4,[r_]),o_=r_(),[ore,Zd]=a4(o4),are=n=>{const{__scopePopover:e,children:t,open:i,defaultOpen:r,onOpenChange:s,modal:o=!1}=n,a=o_(e),l=M.useRef(null),[c,u]=M.useState(!1),[f=!1,p]=Dl({prop:i,defaultProp:r,onChange:s});return M.createElement(KU,a,M.createElement(ore,{scope:e,contentId:Vl(),triggerRef:l,open:f,onOpenChange:p,onOpenToggle:M.useCallback(()=>p(m=>!m),[p]),hasCustomAnchor:c,onCustomAnchorAdd:M.useCallback(()=>u(!0),[]),onCustomAnchorRemove:M.useCallback(()=>u(!1),[]),modal:o},t))},lre="PopoverTrigger",cre=M.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=Zd(lre,t),s=o_(t),o=vi(e,r.triggerRef),a=M.createElement(Gt.button,Ze({type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":c4(r.open)},i,{ref:o,onClick:Dt(n.onClick,r.onOpenToggle)}));return r.hasCustomAnchor?a:M.createElement(ZU,Ze({asChild:!0},s),a)}),ure="PopoverPortal",[Ime,hre]=a4(ure,{forceMount:void 0}),Xp="PopoverContent",dre=M.forwardRef((n,e)=>{const t=hre(Xp,n.__scopePopover),{forceMount:i=t.forceMount,...r}=n,s=Zd(Xp,n.__scopePopover);return M.createElement(z0,{present:i||s.open},s.modal?M.createElement(fre,Ze({},r,{ref:e})):M.createElement(pre,Ze({},r,{ref:e})))}),fre=M.forwardRef((n,e)=>{const t=Zd(Xp,n.__scopePopover),i=M.useRef(null),r=vi(e,i),s=M.useRef(!1);return M.useEffect(()=>{const o=i.current;if(o)return JU(o)},[]),M.createElement(C1,{as:gd,allowPinchZoom:!0},M.createElement(l4,Ze({},n,{ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Dt(n.onCloseAutoFocus,o=>{var a;o.preventDefault(),s.current||(a=t.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:Dt(n.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;s.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Dt(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})))}),pre=M.forwardRef((n,e)=>{const t=Zd(Xp,n.__scopePopover),i=M.useRef(!1),r=M.useRef(!1);return M.createElement(l4,Ze({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o;if((o=n.onCloseAutoFocus)===null||o===void 0||o.call(n,s),!s.defaultPrevented){var a;i.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),s.preventDefault()}i.current=!1,r.current=!1},onInteractOutside:s=>{var o,a;(o=n.onInteractOutside)===null||o===void 0||o.call(n,s),s.defaultPrevented||(i.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const l=s.target;((a=t.triggerRef.current)===null||a===void 0?void 0:a.contains(l))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}}))}),l4=M.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...f}=n,p=Zd(Xp,t),m=o_(t);return PU(),M.createElement(DU,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:r,onUnmountAutoFocus:s},M.createElement(LU,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>p.onOpenChange(!1)},M.createElement(YU,Ze({"data-state":c4(p.open),role:"dialog",id:p.contentId},m,f,{ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),gre="PopoverClose",mre=M.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=Zd(gre,t);return M.createElement(Gt.button,Ze({type:"button"},i,{ref:e,onClick:Dt(n.onClick,()=>r.onOpenChange(!1))}))}),vre=M.forwardRef((n,e)=>{const{__scopePopover:t,...i}=n,r=o_(t);return M.createElement(Ene,Ze({},r,i,{ref:e}))});function c4(n){return n?"open":"closed"}const yre=are,_re=cre,Ere=dre,wre=mre,Tre=vre;function VP(n,[e,t]){return Math.min(t,Math.max(e,n))}const Sre=M.forwardRef((n,e)=>M.createElement(Gt.span,Ze({},n,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}))),bre=[" ","Enter","ArrowUp","ArrowDown"],xre=[" ","Enter"],a_="Select",[l_,c_,Cre]=FN(a_),[Yd,Pme]=ks(a_,[Cre,r_]),R1=r_(),[Rre,pu]=Yd(a_),[Are,Lre]=Yd(a_),Ire=n=>{const{__scopeSelect:e,children:t,open:i,defaultOpen:r,onOpenChange:s,value:o,defaultValue:a,onValueChange:l,dir:c,name:u,autoComplete:f,disabled:p,required:m}=n,y=R1(e),[_,w]=M.useState(null),[T,x]=M.useState(null),[C,I]=M.useState(!1),D=H0(c),[B=!1,N]=Dl({prop:i,defaultProp:r,onChange:s}),[z,Z]=Dl({prop:o,defaultProp:a,onChange:l}),q=M.useRef(null),H=_?!!_.closest("form"):!0,[Y,ee]=M.useState(new Set),le=Array.from(Y).map(W=>W.props.value).join(";");return M.createElement(KU,y,M.createElement(Rre,{required:m,scope:e,trigger:_,onTriggerChange:w,valueNode:T,onValueNodeChange:x,valueNodeHasChildren:C,onValueNodeHasChildrenChange:I,contentId:Vl(),value:z,onValueChange:Z,open:B,onOpenChange:N,dir:D,triggerPointerDownPosRef:q,disabled:p},M.createElement(l_.Provider,{scope:e},M.createElement(Are,{scope:n.__scopeSelect,onNativeOptionAdd:M.useCallback(W=>{ee(ie=>new Set(ie).add(W))},[]),onNativeOptionRemove:M.useCallback(W=>{ee(ie=>{const ne=new Set(ie);return ne.delete(W),ne})},[])},t)),H?M.createElement(p4,{key:le,"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:f,value:z,onChange:W=>Z(W.target.value),disabled:p},z===void 0?M.createElement("option",{value:""}):null,Array.from(Y)):null))},Pre="SelectTrigger",Dre=M.forwardRef((n,e)=>{const{__scopeSelect:t,disabled:i=!1,...r}=n,s=R1(t),o=pu(Pre,t),a=o.disabled||i,l=vi(e,o.onTriggerChange),c=c_(t),[u,f,p]=g4(y=>{const _=c().filter(x=>!x.disabled),w=_.find(x=>x.value===o.value),T=m4(_,y,w);T!==void 0&&o.onValueChange(T.value)}),m=()=>{a||(o.onOpenChange(!0),p())};return M.createElement(ZU,Ze({asChild:!0},s),M.createElement(Gt.button,Ze({type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":f4(o.value)?"":void 0},r,{ref:l,onClick:Dt(r.onClick,y=>{y.currentTarget.focus()}),onPointerDown:Dt(r.onPointerDown,y=>{const _=y.target;_.hasPointerCapture(y.pointerId)&&_.releasePointerCapture(y.pointerId),y.button===0&&y.ctrlKey===!1&&(m(),o.triggerPointerDownPosRef.current={x:Math.round(y.pageX),y:Math.round(y.pageY)},y.preventDefault())}),onKeyDown:Dt(r.onKeyDown,y=>{const _=u.current!=="";!(y.ctrlKey||y.altKey||y.metaKey)&&y.key.length===1&&f(y.key),!(_&&y.key===" ")&&bre.includes(y.key)&&(m(),y.preventDefault())})})))}),Ore="SelectValue",kre=M.forwardRef((n,e)=>{const{__scopeSelect:t,className:i,style:r,children:s,placeholder:o="",...a}=n,l=pu(Ore,t),{onValueNodeHasChildrenChange:c}=l,u=s!==void 0,f=vi(e,l.onValueNodeChange);return Xn(()=>{c(u)},[c,u]),M.createElement(Gt.span,Ze({},a,{ref:f,style:{pointerEvents:"none"}}),f4(l.value)?M.createElement(M.Fragment,null,o):s)}),Mre=M.forwardRef((n,e)=>{const{__scopeSelect:t,children:i,...r}=n;return M.createElement(Gt.span,Ze({"aria-hidden":!0},r,{ref:e}),i||"▼")}),Nre=n=>M.createElement(wne,Ze({asChild:!0},n)),Cd="SelectContent",Fre=M.forwardRef((n,e)=>{const t=pu(Cd,n.__scopeSelect),[i,r]=M.useState();if(Xn(()=>{r(new DocumentFragment)},[]),!t.open){const s=i;return s?du.createPortal(M.createElement(u4,{scope:n.__scopeSelect},M.createElement(l_.Slot,{scope:n.__scopeSelect},M.createElement("div",null,n.children))),s):null}return M.createElement(Bre,Ze({},n,{ref:e}))}),ta=10,[u4,gu]=Yd(Cd),Bre=M.forwardRef((n,e)=>{const{__scopeSelect:t,position:i="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:s,onPointerDownOutside:o,side:a,sideOffset:l,align:c,alignOffset:u,arrowPadding:f,collisionBoundary:p,collisionPadding:m,sticky:y,hideWhenDetached:_,avoidCollisions:w,...T}=n,x=pu(Cd,t),[C,I]=M.useState(null),[D,B]=M.useState(null),N=vi(e,xe=>I(xe)),[z,Z]=M.useState(null),[q,H]=M.useState(null),Y=c_(t),[ee,le]=M.useState(!1),W=M.useRef(!1);M.useEffect(()=>{if(C)return JU(C)},[C]),PU();const ie=M.useCallback(xe=>{const[Le,...je]=Y().map(ct=>ct.ref.current),[Ke]=je.slice(-1),lt=document.activeElement;for(const ct of xe)if(ct===lt||(ct==null||ct.scrollIntoView({block:"nearest"}),ct===Le&&D&&(D.scrollTop=0),ct===Ke&&D&&(D.scrollTop=D.scrollHeight),ct==null||ct.focus(),document.activeElement!==lt))return},[Y,D]),ne=M.useCallback(()=>ie([z,C]),[ie,z,C]);M.useEffect(()=>{ee&&ne()},[ee,ne]);const{onOpenChange:J,triggerPointerDownPosRef:ce}=x;M.useEffect(()=>{if(C){let xe={x:0,y:0};const Le=Ke=>{var lt,ct,Ht,Vt;xe={x:Math.abs(Math.round(Ke.pageX)-((lt=(ct=ce.current)===null||ct===void 0?void 0:ct.x)!==null&&lt!==void 0?lt:0)),y:Math.abs(Math.round(Ke.pageY)-((Ht=(Vt=ce.current)===null||Vt===void 0?void 0:Vt.y)!==null&&Ht!==void 0?Ht:0))}},je=Ke=>{xe.x<=10&&xe.y<=10?Ke.preventDefault():C.contains(Ke.target)||J(!1),document.removeEventListener("pointermove",Le),ce.current=null};return ce.current!==null&&(document.addEventListener("pointermove",Le),document.addEventListener("pointerup",je,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Le),document.removeEventListener("pointerup",je,{capture:!0})}}},[C,J,ce]),M.useEffect(()=>{const xe=()=>J(!1);return window.addEventListener("blur",xe),window.addEventListener("resize",xe),()=>{window.removeEventListener("blur",xe),window.removeEventListener("resize",xe)}},[J]);const[se,te]=g4(xe=>{const Le=Y().filter(lt=>!lt.disabled),je=Le.find(lt=>lt.ref.current===document.activeElement),Ke=m4(Le,xe,je);Ke&&setTimeout(()=>Ke.ref.current.focus())}),Q=M.useCallback((xe,Le,je)=>{const Ke=!W.current&&!je;(x.value!==void 0&&x.value===Le||Ke)&&(Z(xe),Ke&&(W.current=!0))},[x.value]),_e=M.useCallback(()=>C==null?void 0:C.focus(),[C]),fe=M.useCallback((xe,Le,je)=>{const Ke=!W.current&&!je;(x.value!==void 0&&x.value===Le||Ke)&&H(xe)},[x.value]),pe=i==="popper"?jP:Ure,Ce=pe===jP?{side:a,sideOffset:l,align:c,alignOffset:u,arrowPadding:f,collisionBoundary:p,collisionPadding:m,sticky:y,hideWhenDetached:_,avoidCollisions:w}:{};return M.createElement(u4,{scope:t,content:C,viewport:D,onViewportChange:B,itemRefCallback:Q,selectedItem:z,onItemLeave:_e,itemTextRefCallback:fe,focusSelectedItem:ne,selectedItemText:q,position:i,isPositioned:ee,searchRef:se},M.createElement(C1,{as:gd,allowPinchZoom:!0},M.createElement(DU,{asChild:!0,trapped:x.open,onMountAutoFocus:xe=>{xe.preventDefault()},onUnmountAutoFocus:Dt(r,xe=>{var Le;(Le=x.trigger)===null||Le===void 0||Le.focus({preventScroll:!0}),xe.preventDefault()})},M.createElement(LU,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:xe=>xe.preventDefault(),onDismiss:()=>x.onOpenChange(!1)},M.createElement(pe,Ze({role:"listbox",id:x.contentId,"data-state":x.open?"open":"closed",dir:x.dir,onContextMenu:xe=>xe.preventDefault()},T,Ce,{onPlaced:()=>le(!0),ref:N,style:{display:"flex",flexDirection:"column",outline:"none",...T.style},onKeyDown:Dt(T.onKeyDown,xe=>{const Le=xe.ctrlKey||xe.altKey||xe.metaKey;if(xe.key==="Tab"&&xe.preventDefault(),!Le&&xe.key.length===1&&te(xe.key),["ArrowUp","ArrowDown","Home","End"].includes(xe.key)){let Ke=Y().filter(lt=>!lt.disabled).map(lt=>lt.ref.current);if(["ArrowUp","End"].includes(xe.key)&&(Ke=Ke.slice().reverse()),["ArrowUp","ArrowDown"].includes(xe.key)){const lt=xe.target,ct=Ke.indexOf(lt);Ke=Ke.slice(ct+1)}setTimeout(()=>ie(Ke)),xe.preventDefault()}})}))))))}),Ure=M.forwardRef((n,e)=>{const{__scopeSelect:t,onPlaced:i,...r}=n,s=pu(Cd,t),o=gu(Cd,t),[a,l]=M.useState(null),[c,u]=M.useState(null),f=vi(e,N=>u(N)),p=c_(t),m=M.useRef(!1),y=M.useRef(!0),{viewport:_,selectedItem:w,selectedItemText:T,focusSelectedItem:x}=o,C=M.useCallback(()=>{if(s.trigger&&s.valueNode&&a&&c&&_&&w&&T){const N=s.trigger.getBoundingClientRect(),z=c.getBoundingClientRect(),Z=s.valueNode.getBoundingClientRect(),q=T.getBoundingClientRect();if(s.dir!=="rtl"){const lt=q.left-z.left,ct=Z.left-lt,Ht=N.left-ct,Vt=N.width+Ht,ii=Math.max(Vt,z.width),Yt=window.innerWidth-ta,k=VP(ct,[ta,Yt-ii]);a.style.minWidth=Vt+"px",a.style.left=k+"px"}else{const lt=z.right-q.right,ct=window.innerWidth-Z.right-lt,Ht=window.innerWidth-N.right-ct,Vt=N.width+Ht,ii=Math.max(Vt,z.width),Yt=window.innerWidth-ta,k=VP(ct,[ta,Yt-ii]);a.style.minWidth=Vt+"px",a.style.right=k+"px"}const H=p(),Y=window.innerHeight-ta*2,ee=_.scrollHeight,le=window.getComputedStyle(c),W=parseInt(le.borderTopWidth,10),ie=parseInt(le.paddingTop,10),ne=parseInt(le.borderBottomWidth,10),J=parseInt(le.paddingBottom,10),ce=W+ie+ee+J+ne,se=Math.min(w.offsetHeight*5,ce),te=window.getComputedStyle(_),Q=parseInt(te.paddingTop,10),_e=parseInt(te.paddingBottom,10),fe=N.top+N.height/2-ta,pe=Y-fe,Ce=w.offsetHeight/2,xe=w.offsetTop+Ce,Le=W+ie+xe,je=ce-Le;if(Le<=fe){const lt=w===H[H.length-1].ref.current;a.style.bottom="0px";const ct=c.clientHeight-_.offsetTop-_.offsetHeight,Ht=Math.max(pe,Ce+(lt?_e:0)+ct+ne),Vt=Le+Ht;a.style.height=Vt+"px"}else{const lt=w===H[0].ref.current;a.style.top="0px";const Ht=Math.max(fe,W+_.offsetTop+(lt?Q:0)+Ce)+je;a.style.height=Ht+"px",_.scrollTop=Le-fe+_.offsetTop}a.style.margin=`${ta}px 0`,a.style.minHeight=se+"px",a.style.maxHeight=Y+"px",i==null||i(),requestAnimationFrame(()=>m.current=!0)}},[p,s.trigger,s.valueNode,a,c,_,w,T,s.dir,i]);Xn(()=>C(),[C]);const[I,D]=M.useState();Xn(()=>{c&&D(window.getComputedStyle(c).zIndex)},[c]);const B=M.useCallback(N=>{N&&y.current===!0&&(C(),x==null||x(),y.current=!1)},[C,x]);return M.createElement(zre,{scope:t,contentWrapper:a,shouldExpandOnScrollRef:m,onScrollButtonChange:B},M.createElement("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:I}},M.createElement(Gt.div,Ze({},r,{ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}}))))}),jP=M.forwardRef((n,e)=>{const{__scopeSelect:t,align:i="start",collisionPadding:r=ta,...s}=n,o=R1(t);return M.createElement(YU,Ze({},o,s,{ref:e,align:i,collisionPadding:r,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[zre,A1]=Yd(Cd,{}),WP="SelectViewport",Gre=M.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=gu(WP,t),s=A1(WP,t),o=vi(e,r.onViewportChange),a=M.useRef(0);return M.createElement(M.Fragment,null,M.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),M.createElement(l_.Slot,{scope:t},M.createElement(Gt.div,Ze({"data-radix-select-viewport":"",role:"presentation"},i,{ref:o,style:{position:"relative",flex:1,overflow:"auto",...i.style},onScroll:Dt(i.onScroll,l=>{const c=l.currentTarget,{contentWrapper:u,shouldExpandOnScrollRef:f}=s;if(f!=null&&f.current&&u){const p=Math.abs(a.current-c.scrollTop);if(p>0){const m=window.innerHeight-ta*2,y=parseFloat(u.style.minHeight),_=parseFloat(u.style.height),w=Math.max(y,_);if(w<m){const T=w+p,x=Math.min(m,T),C=T-x;u.style.height=x+"px",u.style.bottom==="0px"&&(c.scrollTop=C>0?C:0,u.style.justifyContent="flex-end")}}}a.current=c.scrollTop})}))))}),Hre="SelectGroup",[$re,Vre]=Yd(Hre),jre=M.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=Vl();return M.createElement($re,{scope:t,id:r},M.createElement(Gt.div,Ze({role:"group","aria-labelledby":r},i,{ref:e})))}),Wre="SelectLabel",qre=M.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n,r=Vre(Wre,t);return M.createElement(Gt.div,Ze({id:r.id},i,{ref:e}))}),ZS="SelectItem",[Kre,h4]=Yd(ZS),Zre=M.forwardRef((n,e)=>{const{__scopeSelect:t,value:i,disabled:r=!1,textValue:s,...o}=n,a=pu(ZS,t),l=gu(ZS,t),c=a.value===i,[u,f]=M.useState(s??""),[p,m]=M.useState(!1),y=vi(e,T=>{var x;return(x=l.itemRefCallback)===null||x===void 0?void 0:x.call(l,T,i,r)}),_=Vl(),w=()=>{r||(a.onValueChange(i),a.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return M.createElement(Kre,{scope:t,value:i,disabled:r,textId:_,isSelected:c,onItemTextChange:M.useCallback(T=>{f(x=>{var C;return x||((C=T==null?void 0:T.textContent)!==null&&C!==void 0?C:"").trim()})},[])},M.createElement(l_.ItemSlot,{scope:t,value:i,disabled:r,textValue:u},M.createElement(Gt.div,Ze({role:"option","aria-labelledby":_,"data-highlighted":p?"":void 0,"aria-selected":c&&p,"data-state":c?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1},o,{ref:y,onFocus:Dt(o.onFocus,()=>m(!0)),onBlur:Dt(o.onBlur,()=>m(!1)),onPointerUp:Dt(o.onPointerUp,w),onPointerMove:Dt(o.onPointerMove,T=>{if(r){var x;(x=l.onItemLeave)===null||x===void 0||x.call(l)}else T.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Dt(o.onPointerLeave,T=>{if(T.currentTarget===document.activeElement){var x;(x=l.onItemLeave)===null||x===void 0||x.call(l)}}),onKeyDown:Dt(o.onKeyDown,T=>{var x;((x=l.searchRef)===null||x===void 0?void 0:x.current)!==""&&T.key===" "||(xre.includes(T.key)&&w(),T.key===" "&&T.preventDefault())})}))))}),kv="SelectItemText",Yre=M.forwardRef((n,e)=>{const{__scopeSelect:t,className:i,style:r,...s}=n,o=pu(kv,t),a=gu(kv,t),l=h4(kv,t),c=Lre(kv,t),[u,f]=M.useState(null),p=vi(e,T=>f(T),l.onItemTextChange,T=>{var x;return(x=a.itemTextRefCallback)===null||x===void 0?void 0:x.call(a,T,l.value,l.disabled)}),m=u==null?void 0:u.textContent,y=M.useMemo(()=>M.createElement("option",{key:l.value,value:l.value,disabled:l.disabled},m),[l.disabled,l.value,m]),{onNativeOptionAdd:_,onNativeOptionRemove:w}=c;return Xn(()=>(_(y),()=>w(y)),[_,w,y]),M.createElement(M.Fragment,null,M.createElement(Gt.span,Ze({id:l.textId},s,{ref:p})),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?du.createPortal(s.children,o.valueNode):null)}),Xre="SelectItemIndicator",Jre=M.forwardRef((n,e)=>{const{__scopeSelect:t,...i}=n;return h4(Xre,t).isSelected?M.createElement(Gt.span,Ze({"aria-hidden":!0},i,{ref:e})):null}),qP="SelectScrollUpButton",Qre=M.forwardRef((n,e)=>{const t=gu(qP,n.__scopeSelect),i=A1(qP,n.__scopeSelect),[r,s]=M.useState(!1),o=vi(e,i.onScrollButtonChange);return Xn(()=>{if(t.viewport&&t.isPositioned){let a=function(){const c=l.scrollTop>0;s(c)};const l=t.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[t.viewport,t.isPositioned]),r?M.createElement(d4,Ze({},n,{ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=t;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}})):null}),KP="SelectScrollDownButton",ese=M.forwardRef((n,e)=>{const t=gu(KP,n.__scopeSelect),i=A1(KP,n.__scopeSelect),[r,s]=M.useState(!1),o=vi(e,i.onScrollButtonChange);return Xn(()=>{if(t.viewport&&t.isPositioned){let a=function(){const c=l.scrollHeight-l.clientHeight,u=Math.ceil(l.scrollTop)<c;s(u)};const l=t.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[t.viewport,t.isPositioned]),r?M.createElement(d4,Ze({},n,{ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=t;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}})):null}),d4=M.forwardRef((n,e)=>{const{__scopeSelect:t,onAutoScroll:i,...r}=n,s=gu("SelectScrollButton",t),o=M.useRef(null),a=c_(t),l=M.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return M.useEffect(()=>()=>l(),[l]),Xn(()=>{var c;const u=a().find(f=>f.ref.current===document.activeElement);u==null||(c=u.ref.current)===null||c===void 0||c.scrollIntoView({block:"nearest"})},[a]),M.createElement(Gt.div,Ze({"aria-hidden":!0},r,{ref:e,style:{flexShrink:0,...r.style},onPointerDown:Dt(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(i,50))}),onPointerMove:Dt(r.onPointerMove,()=>{var c;(c=s.onItemLeave)===null||c===void 0||c.call(s),o.current===null&&(o.current=window.setInterval(i,50))}),onPointerLeave:Dt(r.onPointerLeave,()=>{l()})}))});function f4(n){return n===""||n===void 0}const p4=M.forwardRef((n,e)=>{const{value:t,...i}=n,r=M.useRef(null),s=vi(e,r),o=kx(t);return M.useEffect(()=>{const a=r.current,l=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==t&&u){const f=new Event("change",{bubbles:!0});u.call(a,t),a.dispatchEvent(f)}},[o,t]),M.createElement(Sre,{asChild:!0},M.createElement("select",Ze({},i,{ref:s,defaultValue:t})))});p4.displayName="BubbleSelect";function g4(n){const e=go(n),t=M.useRef(""),i=M.useRef(0),r=M.useCallback(o=>{const a=t.current+o;e(a),function l(c){t.current=c,window.clearTimeout(i.current),c!==""&&(i.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),s=M.useCallback(()=>{t.current="",window.clearTimeout(i.current)},[]);return M.useEffect(()=>()=>window.clearTimeout(i.current),[]),[t,r,s]}function m4(n,e,t){const r=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let o=tse(n,Math.max(s,0));r.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==t?l:void 0}function tse(n,e){return n.map((t,i)=>n[(e+i)%n.length])}const ise=Ire,nse=Dre,rse=Fre,sse=qre,ose=Zre,v4="Switch",[ase,Dme]=ks(v4),[lse,cse]=ase(v4),use=M.forwardRef((n,e)=>{const{__scopeSwitch:t,name:i,checked:r,defaultChecked:s,required:o,disabled:a,value:l="on",onCheckedChange:c,...u}=n,[f,p]=M.useState(null),m=vi(e,x=>p(x)),y=M.useRef(!1),_=f?!!f.closest("form"):!0,[w=!1,T]=Dl({prop:r,defaultProp:s,onChange:c});return M.createElement(lse,{scope:t,checked:w,disabled:a},M.createElement(Gt.button,Ze({type:"button",role:"switch","aria-checked":w,"aria-required":o,"data-state":y4(w),"data-disabled":a?"":void 0,disabled:a,value:l},u,{ref:m,onClick:Dt(n.onClick,x=>{T(C=>!C),_&&(y.current=x.isPropagationStopped(),y.current||x.stopPropagation())})})),_&&M.createElement(fse,{control:f,bubbles:!y.current,name:i,value:l,checked:w,required:o,disabled:a,style:{transform:"translateX(-100%)"}}))}),hse="SwitchThumb",dse=M.forwardRef((n,e)=>{const{__scopeSwitch:t,...i}=n,r=cse(hse,t);return M.createElement(Gt.span,Ze({"data-state":y4(r.checked),"data-disabled":r.disabled?"":void 0},i,{ref:e}))}),fse=n=>{const{control:e,checked:t,bubbles:i=!0,...r}=n,s=M.useRef(null),o=kx(t),a=Ox(e);return M.useEffect(()=>{const l=s.current,c=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(c,"checked").set;if(o!==t&&f){const p=new Event("click",{bubbles:i});f.call(l,t),l.dispatchEvent(p)}},[o,t,i]),M.createElement("input",Ze({type:"checkbox","aria-hidden":!0,defaultChecked:t},r,{tabIndex:-1,ref:s,style:{...n.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function y4(n){return n?"checked":"unchecked"}const pse=use,gse=dse,mse=n=>{const e=n.toString().split(":"),t=Math.ceil(parseInt(e[0])),i=Math.ceil(parseInt(e[1])),r=yse(Math.ceil(parseInt(e[2])),2);let s=`${t!==0&&i<10?(i+"").padStart(2,"0"):i}:${r}`;return t!==0&&(s=`${t}:${s}`),s},_4=n=>{const e=new Date(n*1e3).toISOString().substr(11,8);return mse(e)},E4=(n,e)=>{if(typeof n!="object"||n===null)return e;for(const t in e)typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])?(n[t]||(n[t]={}),n[t]=E4(n[t],e[t])):n[t]=e[t];return n},vse=n=>n.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0),w4=(n,e)=>Object.hasOwn(n,e)?n[e].toString():void 0,yse=(n,e)=>String(n).padStart(e,"0"),_se={behavior:"smooth",block:"center"},nd={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:_se}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1,localeText:{contentSearch:{tabLabel:"Search Results",formPlaceholder:"Enter search words",noSearchResults:"No search results",loading:"Loading...",moreResults:"more results"}}};function T4(n){let e={...nd.informationPanel.vtt.autoScroll};return typeof n=="object"&&(e="enabled"in n?n:{enabled:!0,settings:n}),n===!1&&(e.enabled=!1),Ese(e.settings),e}function Ese({behavior:n,block:e}){const t=["auto","instant","smooth"],i=["center","end","nearest","start"];if(!t.includes(n))throw TypeError(`'${n}' not in ${t.join(" | ")}`);if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`)}var ZP,YP;const wse=T4((YP=(ZP=nd==null?void 0:nd.informationPanel)==null?void 0:ZP.vtt)==null?void 0:YP.autoScroll);var XP;const u_={activeCanvas:"",activeManifest:"",OSDImageLoaded:!1,collection:{},configOptions:nd,customDisplays:[],plugins:[],isAutoScrollEnabled:wse.enabled,isAutoScrolling:!1,isInformationOpen:(XP=nd==null?void 0:nd.informationPanel)==null?void 0:XP.open,isLoaded:!1,isUserScrolling:void 0,vault:new Fp,contentSearchVault:new Fp,openSeadragonViewer:null,viewerId:Hd()},S4=F.createContext(u_),b4=F.createContext(u_);function Tse(n,e){switch(e.type){case"updateActiveCanvas":return e.canvasId||(e.canvasId=""),{...n,activeCanvas:e.canvasId};case"updateActiveManifest":return{...n,activeManifest:e.manifestId};case"updateOSDImageLoaded":return{...n,OSDImageLoaded:e.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...n,isAutoScrollEnabled:e.isAutoScrollEnabled};case"updateAutoScrolling":return{...n,isAutoScrolling:e.isAutoScrolling};case"updateCollection":return{...n,collection:e.collection};case"updateConfigOptions":return{...n,configOptions:E4(n.configOptions,e.configOptions)};case"updateInformationOpen":return{...n,isInformationOpen:e.isInformationOpen};case"updateIsLoaded":return{...n,isLoaded:e.isLoaded};case"updateUserScrolling":return{...n,isUserScrolling:e.isUserScrolling};case"updateOpenSeadragonViewer":return{...n,openSeadragonViewer:e.openSeadragonViewer};case"updateViewerId":return{...n,viewerId:e.viewerId};default:throw new Error(`Unhandled action type: ${e.type}`)}}const Sse=({initialState:n=u_,children:e})=>{const[t,i]=M.useReducer(Tse,n);return F.createElement(S4.Provider,{value:t},F.createElement(b4.Provider,{value:i},e))};function Pi(){const n=F.useContext(S4);if(n===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return n}function ss(){const n=F.useContext(b4);if(n===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return n}const bse=async(n,e)=>{const t=n.get({id:e,type:"Canvas"});if(!(t!=null&&t.annotations)||!t.annotations[0])return[];const i=n.get(t.annotations).filter(s=>s.items?s:!1),r=[];for(const s of i)if(s.items.length>0){const o=s.label||{none:["Annotations"]};r.push({...s,label:o})}else{let o={};try{o=await n.load(s.id)}catch(a){console.log(a)}if(o.items&&o.items.length>0){const a=o.label||{none:["Annotations"]};r.push({...o,label:a})}}return r},x4=async(n,e,t,i)=>{if(i==null||i.q==null)return{label:{none:[t]}};const r=`${e}?q=${i.q.trim()}`;let s;try{s=await n.load(r)}catch{return console.log("Could not load content search."),{}}return s.label==null&&(s.label={none:[t]}),s},C4=(n,e,t,i)=>{var r,s;const o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},a=l=>{if(l){if(!l.body||!l.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",l);return}let c=l.body;Array.isArray(c)&&(c=c[0]);const u=n.get(c.id);if(!u)return;switch(t){case"painting":return l.target===e.id&&l.motivation&&l.motivation[0]==="painting"&&i.includes(u.type)&&(l.body=u),!!l;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(o.canvas=n.get(e),o.canvas&&(o.annotationPage=n.get(o.canvas.items[0]),o.accompanyingCanvas=(r=o.canvas)!=null&&r.accompanyingCanvas?n.get((s=o.canvas)==null?void 0:s.accompanyingCanvas):void 0),o.annotationPage){const l=n.get(o.annotationPage.items).map(u=>({body:n.get(u.body[0].id),motivation:u.motivation,type:"Annotation"})),c=[];l.forEach(u=>{u.body.type==="Choice"?u.body.items.forEach(f=>c.push({...u,id:f.id,body:n.get(f.id)})):c.push(u)}),o.annotations=c.filter(a)}return o},Xd=(n,e="en")=>{if(!n)return"";if(!n[e]){const t=Object.getOwnPropertyNames(n);if(t.length>0)return n[t[0]]}return n[e]},a0=(n,e)=>{const t=C4(n,{id:e,type:"Canvas"},"painting",["Image","Sound","Video"]);if(t.annotations.length!==0&&t.annotations&&t.annotations)return t.annotations.map(i=>i==null?void 0:i.body)},xse=(n,e,t,i)=>{const r=[];if(e.canvas&&e.canvas.thumbnail.length>0){const s=n.get(e.canvas.thumbnail[0]);r.push(s)}if(e.annotations[0]){if(e.annotations[0].thumbnail&&e.annotations[0].thumbnail.length>0){const o=n.get(e.annotations[0].thumbnail[0]);r.push(o)}if(!e.annotations[0].body)return;const s=e.annotations[0].body;s.type==="Image"&&r.push(s)}return r.length===0?void 0:{id:r[0].id,format:r[0].format,type:r[0].type,width:t,height:i}};let Zc=window.OpenSeadragon;if(!Zc&&(Zc=$d,!Zc))throw new Error("OpenSeadragon is missing.");const JP="http://www.w3.org/2000/svg";Zc.Viewer&&(Zc.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new L1(this),this._svgOverlayInfo)});const L1=function(n){const e=this;this._viewer=n,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(JP,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(JP,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){e.resize()}),this._viewer.addHandler("open",function(){e.resize()}),this._viewer.addHandler("rotate",function(){e.resize()}),this._viewer.addHandler("flip",function(){e.resize()}),this._viewer.addHandler("resize",function(){e.resize()}),this.resize()};L1.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const n=this._viewer.viewport.pixelFromPoint(new Zc.Point(0,0),!0),e=this._viewer.viewport.getZoom(!0),t=this._viewer.viewport.getRotation(),i=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let s=r*e;const o=s;i&&(s=-s,n.x=-n.x+r),this._node.setAttribute("transform","translate("+n.x+","+n.y+") scale("+s+","+o+") rotate("+t+")")},onClick:function(n,e){new Zc.MouseTracker({element:n,clickHandler:e}).setTracking(!0)}};const Cse=n=>new L1(n),R4=n=>{var e,t,i,r,s;let o={id:typeof n=="string"?n:n.source};if(typeof n=="string"){if(n.includes("#xywh=")){const a=n.split("#xywh=");if(a&&a[1]){const[l,c,u,f]=a[1].split(",").map(p=>Number(p));o={id:a[0],rect:{x:l,y:c,w:u,h:f}}}}else if(n.includes("#t=")){const a=n.split("#t=");a&&a[1]&&(o={id:a[0],t:a[1]})}}else if(typeof n=="object"){if(((e=n.selector)==null?void 0:e.type)==="PointSelector")o={id:n.source,point:{x:n.selector.x,y:n.selector.y}};else if(((t=n.selector)==null?void 0:t.type)==="SvgSelector")o={id:n.source,svg:n.selector.value};else if(((i=n.selector)==null?void 0:i.type)==="FragmentSelector"&&(r=n.selector)!=null&&r.value.includes("xywh=")&&n.source.type=="Canvas"&&n.source.id){const a=(s=n.selector)==null?void 0:s.value.split("xywh=");if(a&&a[1]){const[l,c,u,f]=a[1].split(",").map(p=>Number(p));o={id:n.source.id,rect:{x:l,y:c,w:u,h:f}}}}}return o},Rse=n=>fetch(`${n.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(e=>{console.error(`The IIIF tilesource ${n.replace(/\/$/,"")}/info.json failed to load: ${e}`)}),Ase=n=>{let e,t;if(Array.isArray(n)&&(e=n[0],e)){let i;"@id"in e?i=e["@id"]:i=e.id,t=i}return t},I1=n=>{var e;let t,i;if(Dse(n))t=n,i={};else{const r=JSON.parse(Q7(n));switch(r==null?void 0:r.type){case"SpecificResource":case"Range":case"Annotation":t=r==null?void 0:r.target.partOf[0].id,i={manifest:t,canvas:r==null?void 0:r.target.id};break;case"Canvas":t=r==null?void 0:r.partOf[0].id,i={manifest:t,canvas:r==null?void 0:r.id};break;case"Manifest":t=r==null?void 0:r.id,i={collection:(e=r==null?void 0:r.partOf[0])==null?void 0:e.id,manifest:r==null?void 0:r.id};break;case"Collection":t=r==null?void 0:r.id,i={collection:t};break}}return{resourceId:t,active:i}},Lse=n=>{const{resourceId:e,active:t}=I1(n);return t.collection||t.manifest||e},Ise=(n,e)=>{const t=e.items.map(s=>s.id),{active:i}=I1(n),r=i.canvas;return t.includes(r)?r:t[0]},Pse=(n,e)=>{const{active:t}=I1(n),i=t.manifest,r=e.items.filter(s=>s.type==="Manifest").map(s=>s.id);return r.length==0?null:r.includes(i)?i:r[0]},Dse=n=>{try{new URL(n)}catch{return!1}return!0};var Jp=(n=>(n.TiledImage="tiledImage",n.SimpleImage="simpleImage",n))(Jp||{});function A4(n,e,t,i,r){if(!n)return;const s=1/e.width;i.forEach(o=>{if(!o.target)return;const a=R4(o.target),{point:l,rect:c,svg:u}=a;if(c){const{x:f,y:p,w:m,h:y}=c;kse(n,f*s,p*s,m*s,y*s,t,r)}if(l){const{x:f,y:p}=l,m=`
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg">
          <circle cx="${f}" cy="${p}" r="20" />
        </svg>
      `;QP(n,m,t,s,r)}u&&QP(n,u,t,s,r)})}function Ose(n,e,t){let i,r,s=40,o=40;e.rect&&(i=e.rect.x,r=e.rect.y,s=e.rect.w,o=e.rect.h),e.point&&(i=e.point.x,r=e.point.y);const a=1/n.width;return new $d.Rect(i*a-s*a/2*(t-1),r*a-o*a/2*(t-1),s*a*t,o*a*t)}function kse(n,e,t,i,r,s,o){const a=new $d.Rect(e,t,i,r),l=document.createElement("div");if(s){const{backgroundColor:c,opacity:u,borderType:f,borderColor:p,borderWidth:m}=s;l.style.backgroundColor=c,l.style.opacity=u,l.style.border=`${f} ${m} ${p}`,l.className=o}n.addOverlay(l,a)}function Mse(n){if(!n)return null;const e=document.createElement("template");return e.innerHTML=n.trim(),e.content.children[0]}function QP(n,e,t,i,r){const s=Mse(e);if(s)for(const o of s.children)L4(n,o,t,i,r)}function L4(n,e,t,i,r){var s;if(e.nodeName==="#text")Fse(e);else{const o=Nse(e,t,i),a=Cse(n);a.node().append(o),(s=a._svg)==null||s.setAttribute("class",r),e.childNodes.forEach(l=>{L4(n,l,t,i,r)})}}function Nse(n,e,t){let i=!1,r=!1,s=!1,o=!1;const a=document.createElementNS("http://www.w3.org/2000/svg",n.nodeName);if(n.attributes.length>0)for(let l=0;l<n.attributes.length;l++){const c=n.attributes[l];switch(c.name){case"fill":s=!0;break;case"stroke":i=!0;break;case"stroke-width":r=!0;break;case"fill-opacity":o=!0;break}a.setAttribute(c.name,c.textContent)}return i||(a.style.stroke=e==null?void 0:e.borderColor),r||(a.style.strokeWidth=e==null?void 0:e.borderWidth),s||(a.style.fill=e==null?void 0:e.backgroundColor),o||(a.style.fillOpacity=e==null?void 0:e.opacity),a.setAttribute("transform",`scale(${t})`),a}function Fse(n){n.textContent&&(n.textContent.includes(`
`)||console.log("nodeName:",n.nodeName,", textContent:",n.textContent,", childNodes.length",n.childNodes.length))}const Bse=n=>{const e=Array.isArray(n==null?void 0:n.service)&&(n==null?void 0:n.service.length)>0,t=e?Ase(n==null?void 0:n.service):n==null?void 0:n.id,i=e?Jp.TiledImage:Jp.SimpleImage;return{uri:t,imageType:i}},Use=(n,e)=>{const t=e?Jp.TiledImage:Jp.SimpleImage;return{uri:n,imageType:t}};function I4(n,e){if(!n)return;e.startsWith(".")||(e="."+e);const t=document.querySelectorAll(e);t&&t.forEach(i=>n.removeOverlay(i))}function YS(n,e,t,i){const r=R4(t),{point:s,rect:o,svg:a}=r;if(s||o||a){const l=Ose(i,r,e);n==null||n.viewport.fitBounds(l)}}function zse(n,e,t,i,r){var s;if(!(e!=null&&e.items)||(e==null?void 0:e.items.length)===0)return;const o=[];e.items.forEach(a=>{const l=n.get(a.id);typeof l.target=="string"&&l.target.startsWith(i.id)&&o.push(l)}),t&&(s=r.contentSearch)!=null&&s.overlays&&A4(t,i,r.contentSearch.overlays,o,"content-search-overlay")}const uT=209,Gse={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${uT} 100% 38.2%)`,accentMuted:`hsl(${uT} 80% 61.8%)`,accentAlt:`hsl(${uT} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},P1={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:Ge,css:Ome,keyframes:D1,createTheme:kme}=Ix({theme:Gse,media:P1}),Hse=Ge("div",{display:"flex",flexDirection:"column",alignItems:"center"}),$se=Ge("p",{fontWeight:"bold",fontSize:"x-large"}),Vse=Ge("span",{fontSize:"medium"}),O1=({error:n})=>{const{message:e}=n;return F.createElement(Hse,{role:"alert"},F.createElement($se,{"data-testid":"headline"},"Something went wrong"),e&&F.createElement(Vse,null,`Error message: ${e}`," "))},P4=Ge("div",{position:"relative",zIndex:"0"}),D4=Ge("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden","@sm":{flexDirection:"column"}}),O4=Ge("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),k4=Ge(Y7,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),M4=Ge(X7,{width:"100%",display:"flex"}),jse=Ge("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),Wse=Ge("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${D4}`]:{flexGrow:"1"},[`& ${O4}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${P4}`]:{display:"none"},[`& ${k4}`]:{margin:"1rem"},[`& ${M4}`]:{height:"100%"}}}}),qse=Ge(tK,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Kse=Ge(iK,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),Mv=Ge(nK,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),Nv=Ge(rK,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Zse=({handleScroll:n,children:e,className:t})=>F.createElement("div",{className:t,onScroll:n},e),Yse=Ge(Zse,{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),N4={position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none"},F4=Ge("button",{textAlign:"left","&:hover":{color:"$accent"}}),Xse=Ge("div",{display:"flex",flexDirection:"column",width:"100%"}),Jse=Ge("div",{...N4}),Qse=Ge("div",{"&:hover":{color:"$accent"}}),eD=({value:n,handleClick:e})=>F.createElement(F4,{onClick:e},n),eoe=({value:n,handleClick:e})=>F.createElement(Qse,{dangerouslySetInnerHTML:{__html:n},onClick:e}),toe=()=>{function n(r){return r.map(s=>{const o=s.identifier||Hd();return{...s,identifier:o}})}function e(r){var s;const o=[],a=[],l=n(r);for(const c of l){for(;a.length>0&&a[a.length-1].end<=c.start;)a.pop();a.length>0?(a[a.length-1].children||(a[a.length-1].children=[]),(s=a[a.length-1].children)==null||s.push(c),a.push(c)):(o.push(c),a.push(c))}return o}function t(r,s=[]){return s.some(o=>r.start>=o.start&&r.end<=o.end)}function i(r=[]){return r.sort((s,o)=>s.start-o.start)}return{addIdentifiersToParsedCues:n,createNestedCues:e,isChild:t,orderCuesByTime:i}},tD=D1({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),ioe=Ge(YN,{display:"flex",flexDirection:"column",width:"100%"}),B4=Ge(XN,{...N4,"@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:tD,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:tD,boxSizing:"content-box","@sm":{content:"unset"}}}}),noe=750,roe=n=>{for(;n&&n!==document.body;){const e=window.getComputedStyle(n).overflowY;if(e!=="visible"&&e!=="hidden"&&n.scrollHeight>n.clientHeight)return n;n=n.parentNode}return null},soe=({label:n,start:e,end:t})=>{var i,r;const s=ss(),{configOptions:o,isAutoScrollEnabled:a,isUserScrolling:l}=Pi(),c=(r=(i=o==null?void 0:o.informationPanel)==null?void 0:i.vtt)==null?void 0:r.autoScroll,[u,f]=M.useState(!1),p=M.useRef(null),m=document.getElementById("clover-iiif-video");M.useEffect(()=>(m==null||m.addEventListener("timeupdate",()=>{const{currentTime:_}=m;f(e<=_&&_<t)}),()=>document.removeEventListener("timeupdate",()=>{})),[t,e,m]),M.useEffect(()=>{var _;const w=T=>{s({type:"updateAutoScrolling",isAutoScrolling:!0}),T(),setTimeout(()=>s({type:"updateAutoScrolling",isAutoScrolling:!1}),noe)};if(a&&u&&p.current&&!l){const T=p.current;if(T&&T instanceof HTMLElement){const x=roe(T);if(x&&x instanceof HTMLElement){let C;switch((_=c==null?void 0:c.settings)==null?void 0:_.block){case"center":const I=x.getBoundingClientRect();C=T.offsetTop+T.offsetHeight-Math.floor((I.bottom-I.top)/2);break;case"end":C=T.offsetTop+T.offsetHeight-(x.clientHeight-T.clientHeight)+2;break;default:C=T.offsetTop-2;break}w(()=>{var I;return x.scrollTo({top:C,left:0,behavior:(I=c==null?void 0:c.settings)==null?void 0:I.behavior})})}}}},[c,u,l,a,s]);const y=()=>{m&&(m.pause(),m.currentTime=e,m.play())};return F.createElement(B4,{ref:p,"aria-checked":u,"data-testid":"information-panel-cue",onClick:y,value:n},n,F.createElement("strong",null,_4(e)))},ooe=Ge("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${B4}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),U4=({items:n})=>F.createElement(ooe,null,n.map(e=>{const{text:t,start:i,end:r,children:s,identifier:o}=e;return F.createElement("li",{key:o},F.createElement(soe,{label:t,start:i,end:r}),s&&F.createElement(U4,{items:s}))})),aoe=({label:n,vttUri:e})=>{const[t,i]=F.useState([]),{createNestedCues:r,orderCuesByTime:s}=toe(),[o,a]=F.useState();return M.useEffect(()=>{e&&fetch(e,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(l=>l.text()).then(l=>{const c=VK.parse(l).cues,u=s(c),f=r(u);i(f)}).catch(l=>{console.error(e,l.toString()),a(l)})},[e]),F.createElement(ioe,{"data-testid":"annotation-item-vtt","aria-label":`navigate ${Xd(n,"en")}`},o&&F.createElement("div",{"data-testid":"error-message"},"Network Error: ",o.toString()),F.createElement(U4,{items:t}))},loe=({caption:n,handleClick:e,imageUri:t})=>F.createElement(F4,{onClick:e},F.createElement("img",{src:t,alt:`A visual annotation for ${n}`}),F.createElement("span",null,n)),coe=({annotation:n})=>{var e,t;const{target:i}=n,r=Pi(),{openSeadragonViewer:s,vault:o,activeCanvas:a,configOptions:l}=r,c=n.body.map(_=>o.get(_.id)),u=((e=c.find(_=>_.format))==null?void 0:e.format)||"",f=((t=c.find(_=>_.value))==null?void 0:t.value)||"",p=o.get({id:a,type:"Canvas"});function m(){var _;if(!i)return;const w=((_=l.annotationOverlays)==null?void 0:_.zoomLevel)||1;YS(s,w,i,p)}function y(){var _,w;switch(u){case"text/plain":return F.createElement(eD,{value:f,handleClick:m});case"text/html":return F.createElement(eoe,{value:f,handleClick:m});case"text/vtt":return F.createElement(aoe,{label:c[0].label,vttUri:c[0].id||""});case((_=u.match(/^image\//))==null?void 0:_.input):const T=((w=c.find(x=>{var C;return!((C=x.id)!=null&&C.includes("vault://"))}))==null?void 0:w.id)||"";return F.createElement(loe,{caption:f,handleClick:m,imageUri:T});default:return F.createElement(eD,{value:f,handleClick:m})}}return F.createElement(Jse,null,y())},uoe=({annotationPage:n})=>{var e;const t=Pi(),{vault:i}=t;if(!n||!n.items||((e=n.items)==null?void 0:e.length)===0)return F.createElement(F.Fragment,null);const r=n.items.map(s=>i.get(s.id));return r?F.createElement(Xse,{"data-testid":"annotation-page"},r==null?void 0:r.map(s=>F.createElement(coe,{key:s.id,annotation:s}))):F.createElement(F.Fragment,null)},hoe=Ge("button",{textAlign:"left","&:hover":{color:"$accent"}}),doe=Ge("li",{margin:"0.25rem 0"}),foe=Ge("ol",{listStyleType:"auto",marginBottom:"1rem",listStylePosition:"inside"}),poe=Ge("div",{margin:"0.5rem 1.618rem"}),goe=Ge("div",{fontWeight:"bold"}),moe=Ge("div",{marginBottom:"1rem"}),voe=({value:n,handleClick:e,target:t,canvas:i})=>F.createElement(hoe,{onClick:e,"data-target":t,"data-canvas":i},n),yoe=({annotation:n,activeContentSearchTarget:e,setActiveContentSearchTarget:t})=>{var i,r,s;const o=ss(),a=Pi(),{openSeadragonViewer:l,vault:c,contentSearchVault:u,activeCanvas:f,configOptions:p,OSDImageLoaded:m}=a,y=c.get({id:f,type:"Canvas"}),_=((i=n.body.map(D=>u.get(D.id)).find(D=>D.value))==null?void 0:i.value)||"";let w;n.target&&typeof n.target=="string"&&(w=n.target);let T;if(w){const D=w.split("#xywh");D.length>1&&(T=D[0])}const x=((s=(r=p.contentSearch)==null?void 0:r.overlays)==null?void 0:s.zoomLevel)||1;M.useEffect(()=>{m&&l&&n.target&&n.target==e&&YS(l,x,w,y)},[l,m]);function C(D){if(!l)return;const B=JSON.parse(D.target.dataset.target),N=D.target.dataset.canvas;f===N?YS(l,x,w,y):(o({type:"updateOSDImageLoaded",OSDImageLoaded:!1}),o({type:"updateActiveCanvas",canvasId:N}),t(B))}const I=JSON.stringify(w);return F.createElement(doe,null,F.createElement(voe,{target:I,canvas:T,value:_,handleClick:C}))},_oe=({annotationPage:n})=>{var e,t,i;const r=Pi(),{contentSearchVault:s,configOptions:o}=r,[a,l]=M.useState(),c=(e=o.contentSearch)==null?void 0:e.searchResultsLimit,u=(t=o.localeText)==null?void 0:t.contentSearch;function f(y){const _={};return y.items.forEach(w=>{const T=s.get(w.id);let x="";if(T.label){const C=Xd(T.label);C&&(x=C[0])}_[x]==null&&(_[x]=[]),_[x].push(T)}),_}function p(y){return(c?y.slice(0,c):y).map((_,w)=>F.createElement(yoe,{key:w,annotation:_,activeContentSearchTarget:a,setActiveContentSearchTarget:l}))}function m(y){if(c){const _=y.length-c;if(_>0)return F.createElement(moe,null,_," ",u==null?void 0:u.moreResults)}}return!n||!n.items||((i=n.items)==null?void 0:i.length)===0?F.createElement("p",null,u==null?void 0:u.noSearchResults):F.createElement(F.Fragment,null,Object.entries(f(n)).map(([y,_],w)=>F.createElement("div",{key:w},F.createElement(goe,{className:"content-search-results-title"},y),F.createElement(foe,{className:"content-search-results"},p(_)),m(_))))},Eoe=Ge("div",{".content-search-form":{display:"flex",marginBottom:"1rem"},input:{padding:".25rem",marginRight:"1rem"}}),woe=Ge("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Toe=({searchServiceUrl:n,setContentSearchResource:e,setLoading:t})=>{var i;const[r,s]=M.useState(),o=Pi(),{contentSearchVault:a,openSeadragonViewer:l,configOptions:c}=o,u=(i=c.localeText)==null?void 0:i.contentSearch;async function f(m){m.preventDefault();const y=u==null?void 0:u.tabLabel;if(l&&n){if(!r||r.trim()===""){e({label:{none:[y]}});return}t(!0),x4(a,n,y,{q:r}).then(_=>{e(_),t(!1)})}}const p=m=>{m.preventDefault(),s(m.target.value)};return F.createElement(Eoe,null,F.createElement(aZ,{onSubmit:f,className:"content-search-form"},F.createElement(lZ,{className:"FormField",name:"searchTerms",onChange:p},F.createElement(cZ,{placeholder:u==null?void 0:u.formPlaceholder})),F.createElement(uZ,{asChild:!0},F.createElement(woe,{type:"submit"},F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},F.createElement("title",null,"Search"),F.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},Soe=({searchServiceUrl:n,setContentSearchResource:e,activeCanvas:t,annotationPage:i})=>{const[r,s]=M.useState(!1);return F.createElement(poe,null,F.createElement(Toe,{searchServiceUrl:n,setContentSearchResource:e,activeCanvas:t,setLoading:s}),!r&&F.createElement(_oe,{annotationPage:i}),r&&F.createElement("span",null,"Loading..."))},boe=Ge("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),xoe=Ge("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),z4=(n,e="none")=>{if(!n)return null;if(typeof n=="string")return[n];if(!n[e]){const t=Object.getOwnPropertyNames(n);if(t.length>0)return n[t[0]]}return!n[e]||!Array.isArray(n[e])?null:n[e]},Ps=(n,e="none",t=", ")=>{const i=z4(n,e);return Array.isArray(i)?i.join(`${t}`):i};function Coe(n){return{__html:Roe(n)}}function To(n,e){const t=Object.keys(n).filter(r=>e.includes(r)?null:r),i=new Object;return t.forEach(r=>{i[r]=n[r]}),i}function Roe(n){return AJ(n,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Aoe=Ge("span",{}),xl=n=>{const{as:e,label:t}=n,i=To(n,["as","label"]);return F.createElement(Aoe,{as:e,...i},Ps(t,i.lang))},Loe=(n,e="200,",t="full")=>{Array.isArray(n)&&(n=n[0]);const{id:i,service:r}=n;let s;if(!r)return i;if(Array.isArray(n.service)&&n.service.length>0&&(s=r[0]),s){if(s["@id"])return`${s["@id"]}/${t}/${e}/0/default.jpg`;if(s.id)return`${s.id}/${t}/${e}/0/default.jpg`}},iD=Ge("img",{objectFit:"cover"}),Ioe=n=>{const e=M.useRef(null),{contentResource:t,altAsLabel:i,region:r="full"}=n;let s;i&&(s=Ps(i));const o=To(n,["contentResource","altAsLabel"]),{type:a,id:l,width:c=200,height:u=200,duration:f}=t;M.useEffect(()=>{if(!l&&!e.current||["Image"].includes(a)||!l.includes("m3u8"))return;const y=new Fn;return e.current&&(y.attachMedia(e.current),y.on(Fn.Events.MEDIA_ATTACHED,function(){y.loadSource(l)})),y.on(Fn.Events.ERROR,function(_,w){if(w.fatal)switch(w.type){case Fn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${_} network error encountered, try to recover`),y.startLoad();break;case Fn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${_} media error encountered, try to recover`),y.recoverMediaError();break;default:y.destroy();break}}),()=>{y&&(y.detachMedia(),y.destroy())}},[l,a]);const p=M.useCallback(()=>{if(!e.current)return;let y=0,_=30;if(f&&(_=f),!l.split("#t=")&&f&&(y=f*.1),l.split("#t=").pop()){const T=l.split("#t=").pop();T&&(y=parseInt(T.split(",")[0]))}const w=e.current;w.autoplay=!0,w.currentTime=y,setTimeout(()=>p(),_*1e3)},[f,l]);M.useEffect(()=>p(),[p]);const m=Loe(t,`${c},${u}`,r);switch(a){case"Image":return F.createElement(iD,{as:"img",alt:s,css:{width:c,height:u},key:l,src:m,...o});case"Video":return F.createElement(iD,{as:"video",css:{width:c,height:u},disablePictureInPicture:!0,key:l,loop:!0,muted:!0,onPause:p,ref:e,src:l});default:return console.warn(`Resource type: ${a} is not valid or not yet supported in Primitives.`),F.createElement(F.Fragment,null)}},Poe=Ge("a",{}),Doe=n=>{const{children:e,homepage:t}=n,i=To(n,["children","homepage"]);return F.createElement(F.Fragment,null,t&&t.map(r=>{const s=Ps(r.label,i.lang);return F.createElement(Poe,{"aria-label":e?s:void 0,href:r.id,key:r.id,...i},e||s)}))},Ooe={delimiter:", "},k1=M.createContext(void 0),G4=()=>{const n=M.useContext(k1);if(n===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return n},M1=({children:n,initialState:e=Ooe})=>{const t=koe(e,"delimiter");return F.createElement(k1.Provider,{value:{delimiter:t}},n)},koe=(n,e)=>Object.hasOwn(n,e)?n[e].toString():void 0,Moe=Ge("span",{}),nD=n=>{const{as:e,markup:t}=n,{delimiter:i}=G4();if(!t)return F.createElement(F.Fragment,null);const r=To(n,["as","markup"]),s=Coe(Ps(t,r.lang,i));return F.createElement(Moe,{as:e,...r,dangerouslySetInnerHTML:s})},H4=n=>F.useContext(k1)?F.createElement(nD,{...n}):F.createElement(M1,null,F.createElement(nD,{...n})),Noe=({as:n="dd",lang:e,value:t})=>F.createElement(H4,{markup:t,as:n,lang:e}),Foe=Ge("span",{}),Boe=({as:n="dd",customValueContent:e,lang:t,value:i})=>{var r;const{delimiter:s}=G4(),o=(r=z4(i,t))==null?void 0:r.map(a=>M.cloneElement(e,{value:a}));return F.createElement(Foe,{as:n,lang:t},o==null?void 0:o.map((a,l)=>[l>0&&`${s}`,F.createElement(M.Fragment,{key:l},a)]))},$4=n=>{var e;const{item:t,lang:i,customValueContent:r}=n,{label:s,value:o}=t,a=(e=Ps(s))==null?void 0:e.replace(" ","-").toLowerCase();return F.createElement("div",{role:"group","data-label":a},F.createElement(xl,{as:"dt",label:s,lang:i}),r?F.createElement(Boe,{as:"dd",customValueContent:r,value:o,lang:i}):F.createElement(Noe,{as:"dd",value:o,lang:i}))};function Uoe(n,e){const t=e.filter(i=>{const{matchingLabel:r}=i,s=Object.keys(i.matchingLabel)[0],o=Ps(r,s);if(Ps(n,s)===o)return!0}).map(i=>i.Content);if(Array.isArray(t))return t[0]}const zoe=Ge("dl",{}),Goe=n=>{const{as:e,customValueContent:t,metadata:i}=n;if(!Array.isArray(i))return F.createElement(F.Fragment,null);const r=w4(n,"customValueDelimiter"),s=To(n,["as","customValueContent","customValueDelimiter","metadata"]);return F.createElement(M1,{...typeof r=="string"?{initialState:{delimiter:r}}:void 0},i.length>0&&F.createElement(zoe,{as:e,...s},i.map((o,a)=>{const l=t?Uoe(o.label,t):void 0;return F.createElement($4,{customValueContent:l,item:o,key:a,lang:s==null?void 0:s.lang})})))};Ge("li",{});Ge("ul",{});const Hoe=Ge("li",{}),$oe=Ge("ul",{}),Voe=n=>{const{as:e,rendering:t}=n,i=To(n,["as","rendering"]);return F.createElement($oe,{as:e},t&&t.map(r=>{const s=Ps(r.label,i.lang);return F.createElement(Hoe,{key:r.id},F.createElement("a",{href:r.id,...i,target:"_blank"},s||r.id))}))},joe=Ge("dl",{}),Woe=n=>{const{as:e,requiredStatement:t}=n;if(!t)return F.createElement(F.Fragment,null);const i=w4(n,"customValueDelimiter"),r=To(n,["as","customValueDelimiter","requiredStatement"]);return F.createElement(M1,{...typeof i=="string"?{initialState:{delimiter:i}}:void 0},F.createElement(joe,{as:e,...r},F.createElement($4,{item:t,lang:r.lang})))},qoe=Ge("li",{}),Koe=Ge("ul",{}),Zoe=n=>{const{as:e,seeAlso:t}=n,i=To(n,["as","seeAlso"]);return F.createElement(Koe,{as:e},t&&t.map(r=>{const s=Ps(r.label,i.lang);return F.createElement(qoe,{key:r.id},F.createElement("a",{href:r.id,...i},s||r.id))}))},Yoe=n=>{const{as:e,summary:t}=n,i=To(n,["as","customValueDelimiter","summary"]);return F.createElement(H4,{as:e,markup:t,...i})},V4=n=>{const{thumbnail:e,region:t}=n,i=To(n,["thumbnail"]);return F.createElement(F.Fragment,null,e&&e.map(r=>F.createElement(Ioe,{contentResource:r,key:r.id,region:t,...i})))},Xoe=({homepage:n})=>(n==null?void 0:n.length)===0?F.createElement(F.Fragment,null):F.createElement(F.Fragment,null,F.createElement("span",{className:"manifest-property-title"},"Homepage"),F.createElement(Doe,{homepage:n})),Joe=({id:n,htmlLabel:e,parent:t="manifest"})=>F.createElement(F.Fragment,null,F.createElement("span",{className:"manifest-property-title"},e),F.createElement("a",{href:n,target:"_blank",id:`iiif-${t}-id`},n)),Qoe=({metadata:n,parent:e="manifest"})=>n?F.createElement(F.Fragment,null,F.createElement(Goe,{metadata:n,id:`iiif-${e}-metadata`})):F.createElement(F.Fragment,null),eae=({rendering:n})=>(n==null?void 0:n.length)===0?F.createElement(F.Fragment,null):F.createElement(F.Fragment,null,F.createElement("span",{className:"manifest-property-title"},"Alternate formats"),F.createElement(Voe,{rendering:n})),tae=({requiredStatement:n,parent:e="manifest"})=>n?F.createElement(F.Fragment,null,F.createElement(Woe,{requiredStatement:n,id:`iiif-${e}-required-statement`})):F.createElement(F.Fragment,null),iae=({rights:n})=>n?F.createElement(F.Fragment,null,F.createElement("span",{className:"manifest-property-title"},"Rights"),F.createElement("a",{href:n,target:"_blank"},n)):F.createElement(F.Fragment,null),nae=({seeAlso:n})=>(n==null?void 0:n.length)===0?F.createElement(F.Fragment,null):F.createElement(F.Fragment,null,F.createElement("span",{className:"manifest-property-title"},"See Also"),F.createElement(Zoe,{seeAlso:n})),rae=({summary:n,parent:e="manifest"})=>n?F.createElement(F.Fragment,null,F.createElement(Yoe,{summary:n,as:"p",id:`iiif-${e}-summary`})):F.createElement(F.Fragment,null),sae=({label:n,thumbnail:e})=>(e==null?void 0:e.length)===0?F.createElement(F.Fragment,null):F.createElement(F.Fragment,null,F.createElement(V4,{altAsLabel:n||{none:["resource"]},thumbnail:e,style:{backgroundColor:"#6663",objectFit:"cover"}})),oae=()=>{const n=Pi(),{activeManifest:e,vault:t}=n,[i,r]=M.useState(),[s,o]=M.useState([]),[a,l]=M.useState([]),[c,u]=M.useState([]),[f,p]=M.useState([]);return M.useEffect(()=>{var m,y,_,w;const T=t.get(e);r(T),((m=T.homepage)==null?void 0:m.length)>0&&o(t.get(T.homepage)),((y=T.seeAlso)==null?void 0:y.length)>0&&l(t.get(T.seeAlso)),((_=T.rendering)==null?void 0:_.length)>0&&u(t.get(T.rendering)),((w=T.thumbnail)==null?void 0:w.length)>0&&p(t.get(T.thumbnail))},[e,t]),i?F.createElement(xoe,null,F.createElement(boe,null,F.createElement(sae,{thumbnail:f,label:i.label}),F.createElement(rae,{summary:i.summary}),F.createElement(Qoe,{metadata:i.metadata}),F.createElement(tae,{requiredStatement:i.requiredStatement}),F.createElement(iae,{rights:i.rights}),F.createElement(Xoe,{homepage:s}),F.createElement(nae,{seeAlso:a}),F.createElement(eae,{rendering:c}),F.createElement(Joe,{id:i.id,htmlLabel:"IIIF Manifest"}))):F.createElement(F.Fragment,null)};function aae(n){const e=[];return n.forEach(t=>{var i;(i=t.informationPanel)!=null&&i.component&&e.push(t)}),{pluginsWithInfoPanel:e}}const lae=1500,cae=({activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r})=>{const s=ss(),o=Pi(),{isAutoScrolling:a,isUserScrolling:l,vault:c,configOptions:u,plugins:f}=o,{informationPanel:p}=u,[m,y]=M.useState(),_=p==null?void 0:p.renderAbout,w=p==null?void 0:p.renderAnnotation,T=c.get({id:n,type:"Canvas"}),x=p==null?void 0:p.renderContentSearch,{pluginsWithInfoPanel:C}=aae(f);function I(N,z){var Z,q;const H=(Z=N==null?void 0:N.informationPanel)==null?void 0:Z.component;return H===void 0?F.createElement(F.Fragment,null):F.createElement(Nv,{key:z,value:N.id},F.createElement(G0,{FallbackComponent:O1},F.createElement(H,{...(q=N==null?void 0:N.informationPanel)==null?void 0:q.componentProps,canvas:T,useViewerDispatch:ss,useViewerState:Pi})))}M.useEffect(()=>{if(!m)if(p!=null&&p.defaultTab){const N=["manifest-about","manifest-content-search"];T.annotations.length>0&&T.annotations.forEach(z=>N.push(z.id)),N.includes(p==null?void 0:p.defaultTab)?y(p.defaultTab):y("manifest-about")}else _?y("manifest-about"):x?y("manifest-content-search"):e&&(e==null?void 0:e.length)>0?y(e[0].id):f.length>0&&y(f[0].id)},[p==null?void 0:p.defaultTab,n,m,_,x,e,r,T==null?void 0:T.annotations,f]);function D(){if(!a){clearTimeout(l);const N=setTimeout(()=>{s({type:"updateUserScrolling",isUserScrolling:void 0})},lae);s({type:"updateUserScrolling",isUserScrolling:N})}}const B=N=>{y(N)};return F.createElement(qse,{"data-testid":"information-panel",defaultValue:m,onValueChange:B,orientation:"horizontal",value:m,className:"clover-viewer-information-panel"},F.createElement(Kse,{"aria-label":"select chapter","data-testid":"information-panel-list"},_&&F.createElement(Mv,{value:"manifest-about"},"About"),x&&r&&F.createElement(Mv,{value:"manifest-content-search"},F.createElement(xl,{label:r.label})),w&&e&&e.map((N,z)=>F.createElement(Mv,{key:z,value:N.id},F.createElement(xl,{label:N.label}))),C&&C.map((N,z)=>{var Z;return F.createElement(Mv,{key:z,value:N.id},F.createElement(xl,{label:(Z=N.informationPanel)==null?void 0:Z.label}))})),F.createElement(Yse,{handleScroll:D},_&&F.createElement(Nv,{value:"manifest-about"},F.createElement(oae,null)),x&&r&&F.createElement(Nv,{value:"manifest-content-search"},F.createElement(Soe,{searchServiceUrl:t,setContentSearchResource:i,activeCanvas:n,annotationPage:r})),w&&e&&e.map(N=>F.createElement(Nv,{key:N.id,value:N.id},F.createElement(uoe,{annotationPage:N}))),C&&C.map((N,z)=>I(N,z))))},j4=Ge("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),uae=Ge("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),hT=Ge("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),hae=Ge("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),dae=Ge("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${j4}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),fae=(n,e)=>{M.useEffect(()=>{function t(i){i.key===n&&e()}return window.addEventListener("keyup",t),()=>window.removeEventListener("keyup",t)},[])},pae=()=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},F.createElement("title",null,"Arrow Back"),F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),gae=()=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},F.createElement("title",null,"Arrow Forward"),F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),mae=()=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},F.createElement("title",null,"Close"),F.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),vae=()=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},F.createElement("title",null,"Search"),F.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),yae=({handleCanvasToggle:n,handleFilter:e,activeIndex:t,canvasLength:i})=>{const[r,s]=M.useState(!1),[o,a]=M.useState(!1),[l,c]=M.useState(!1);M.useEffect(()=>{c(t===0),t===i-1?a(!0):a(!1)},[t,i]),fae("Escape",()=>{s(!1),e("")});const u=()=>{s(p=>!p),e("")},f=p=>e(p.target.value);return F.createElement(dae,{isToggle:r},F.createElement(j4,null,r&&F.createElement(uae,{autoFocus:!0,onChange:f,placeholder:"Search"}),!r&&F.createElement(hae,null,F.createElement(hT,{onClick:()=>n(-1),disabled:l,type:"button"},F.createElement(pae,null)),F.createElement("span",null,t+1," of ",i),F.createElement(hT,{onClick:()=>n(1),disabled:o,type:"button"},F.createElement(gae,null))),F.createElement(hT,{onClick:u,type:"button"},r?F.createElement(mae,null):F.createElement(vae,null))))},_ae=Ge(YN,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),Eae=()=>F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),wae=()=>F.createElement(F.Fragment,null,F.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),F.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),F.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Tae=()=>F.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Sae=()=>F.createElement(F.Fragment,null,F.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),bae=()=>F.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),xae=()=>F.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),W4=Ge("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Cae=({children:n})=>F.createElement("title",null,n),Bn=n=>F.createElement(W4,{...n,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},n.children);Bn.Title=Cae;Bn.Add=Eae;Bn.Audio=wae;Bn.Close=Tae;Bn.Download=Sae;Bn.Image=bae;Bn.Video=xae;const Rae=D1({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Aae=D1({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),q4=Ge(Tre,{fill:"$secondaryAlt"}),Lae=Ge(wre,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Iae=Ge(Ere,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Aae},'&[data-side="bottom"]':{animationName:Rae},'&[data-align="end"]':{[`& ${q4}`]:{margin:"0 0.7rem"}}}),Pae=Ge(_re,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),Dae=Ge(yre,{boxSizing:"content-box"}),Oae=n=>F.createElement(Pae,{...n},n.children),kae=n=>F.createElement(Iae,{...n},F.createElement(q4,null),F.createElement(Lae,null,F.createElement(Bn,{isSmall:!0},F.createElement(Bn.Close,null))),n.children),mu=({children:n})=>F.createElement(Dae,null,n);mu.Trigger=Oae;mu.Content=kae;const XS=Ge("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${W4}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),JS=Ge("span",{display:"flex"}),Mae=Ge("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Nae=Ge("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Fae=Ge(XN,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${JS}`]:{position:"absolute",right:"0",bottom:"0",[`& ${XS}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${JS}`]:{[`& ${XS}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),Bae=({type:n})=>{switch(n){case"Sound":return F.createElement(Bn.Audio,null);case"Image":return F.createElement(Bn.Image,null);case"Video":return F.createElement(Bn.Video,null);default:return F.createElement(Bn.Image,null)}},Uae=({canvas:n,canvasIndex:e,isActive:t,thumbnail:i,type:r,handleChange:s})=>F.createElement(Fae,{"aria-checked":t,"data-testid":"media-thumbnail","data-canvas":e,onClick:()=>s(n.id),value:n.id},F.createElement("figure",null,F.createElement("div",null,(i==null?void 0:i.id)&&F.createElement("img",{src:i.id,alt:n!=null&&n.label?Xd(n.label):""}),F.createElement(JS,null,F.createElement(XS,{isIcon:!0,"data-testid":"thumbnail-tag"},F.createElement(Mae,null),F.createElement(Bn,{"aria-label":r},F.createElement(Bae,{type:r})),["Video","Sound"].includes(r)&&F.createElement(Nae,null,_4(n.duration))))),(n==null?void 0:n.label)&&F.createElement("figcaption",{"data-testid":"fig-caption"},F.createElement(xl,{label:n.label})))),zae=n=>n.body?n.body.type:"Image",Gae=({items:n})=>{const e=ss(),t=Pi(),{activeCanvas:i,vault:r}=t,[s,o]=M.useState(""),[a,l]=M.useState([]),[c,u]=M.useState(0),f=F.useRef(null),p="painting",m=w=>{i!==w&&e({type:"updateActiveCanvas",canvasId:w})};M.useEffect(()=>{if(!a.length){const w=["Image","Sound","Video"],T=n.map(x=>C4(r,x,p,w)).filter(x=>x.annotations.length>0);l(T)}},[n,a.length,r]),M.useEffect(()=>{a.forEach((w,T)=>{w!=null&&w.canvas&&w.canvas.id===i&&u(T)})},[i,a]),M.useEffect(()=>{const w=document.querySelector(`[data-canvas="${c}"]`);if(w instanceof HTMLElement&&f.current){const T=w.offsetLeft-f.current.offsetWidth/2+w.offsetWidth/2;f.current.scrollTo({left:T,behavior:"smooth"})}},[c]);const y=w=>o(w),_=w=>{const T=a[c+w];T!=null&&T.canvas&&m(T.canvas.id)};return F.createElement(F.Fragment,null,F.createElement(yae,{handleFilter:y,handleCanvasToggle:_,activeIndex:c,canvasLength:a.length}),F.createElement(_ae,{"aria-label":"select item","data-testid":"media",ref:f},a.filter(w=>{var T;if((T=w.canvas)!=null&&T.label){const x=Xd(w.canvas.label);if(Array.isArray(x))return x[0].toLowerCase().includes(s.toLowerCase())}}).map((w,T)=>{var x,C;return F.createElement(Uae,{canvas:w.canvas,canvasIndex:T,handleChange:m,isActive:i===((x=w==null?void 0:w.canvas)==null?void 0:x.id),key:(C=w==null?void 0:w.canvas)==null?void 0:C.id,thumbnail:xse(r,w,200,200),type:zae(w.annotations[0])})})))},K4=Ge("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Z4=Ge("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Y4=Ge(Z4,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Hae=Ge("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${Y4}`]:{backgroundColor:"$accent"},[`${K4}`]:{backgroundColor:"#6662"}}}),$ae=Ge("div",{width:"100%",height:"100%"}),Vae=Ge("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),jae=Ge(nse,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Wae=Ge(rse,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),qae=Ge(ose,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),Kae=Ge(sse,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),X4=Ge(ise,{position:"relative",zIndex:"5",width:"100%"}),dT=({direction:n,title:e})=>{const t=()=>F.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),i=()=>F.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return F.createElement(Vae,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},F.createElement("title",null,e),n==="up"&&F.createElement(t,null),n==="down"&&F.createElement(i,null))},J4=({children:n,label:e,maxHeight:t,onValueChange:i,value:r})=>F.createElement(X4,{onValueChange:i,value:r},F.createElement(jae,{"data-testid":"select-button"},F.createElement(kre,{"data-testid":"select-button-value"}),F.createElement(Mre,null,F.createElement(dT,{direction:"down",title:"select"}))),F.createElement(Nre,null,F.createElement(Wae,{css:{maxHeight:`${t} !important`},"data-testid":"select-content"},F.createElement(Qre,null,F.createElement(dT,{direction:"up",title:"scroll up for more"})),F.createElement(Gre,null,F.createElement(jre,null,e&&F.createElement(Kae,null,F.createElement(xl,{"data-testid":"select-label",label:e})),n)),F.createElement(ese,null,F.createElement(dT,{direction:"down",title:"scroll down for more"}))))),Q4=n=>F.createElement(qae,{...n},n.thumbnail&&F.createElement(V4,{thumbnail:n.thumbnail}),F.createElement(Yre,null,F.createElement(xl,{label:n.label})),F.createElement(Jre,null)),QS=Ge("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),Zae=Ge("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Yae=Ge("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${QS}`]:{display:"block"}},false:{[`${QS}`]:{display:"none"}}}}}),Ah=({className:n,id:e,label:t,children:i})=>{const r=t.toLowerCase().replace(/\s/g,"-");return F.createElement(Z4,{id:e,className:n,"data-testid":"openseadragon-button","data-button":r},F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${e}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},F.createElement("title",{id:`${e}-svg-title`},t),i))},Xae=Ge("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),Jae=()=>F.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Qae=()=>F.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),ele=()=>F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),tle=()=>F.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),rD=()=>F.createElement(F.Fragment,null,F.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),F.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),ile=({_cloverViewerHasPlaceholder:n,config:e})=>{const t=Pi(),{activeCanvas:i,plugins:r,vault:s}=t,o=s.get({id:i,type:"Canvas"});function a(){return r.filter(l=>{var c;return(c=l.imageViewer)==null?void 0:c.controls}).map((l,c)=>{var u,f,p,m;const y=(f=(u=l.imageViewer)==null?void 0:u.controls)==null?void 0:f.component;return F.createElement(y,{key:c,...(m=(p=l==null?void 0:l.imageViewer)==null?void 0:p.controls)==null?void 0:m.componentProps,canvas:o,useViewerDispatch:ss,useViewerState:Pi})})}return F.createElement(Xae,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:n},e.showZoomControl&&F.createElement(F.Fragment,null,F.createElement(Ah,{id:e.zoomInButton,label:"zoom in"},F.createElement(Jae,null)),F.createElement(Ah,{id:e.zoomOutButton,label:"zoom out"},F.createElement(Qae,null))),e.showFullPageControl&&F.createElement(Ah,{id:e.fullPageButton,label:"full page"},F.createElement(ele,null)),e.showRotationControl&&F.createElement(F.Fragment,null,F.createElement(Ah,{id:e.rotateRightButton,label:"rotate right"},F.createElement(rD,null)),F.createElement(Ah,{id:e.rotateLeftButton,label:"rotate left"},F.createElement(rD,null))),e.showHomeControl&&F.createElement(Ah,{id:e.homeButton,label:"reset"},F.createElement(tle,null)),a())},nle=({ariaLabel:n,config:e,uri:t,_cloverViewerHasPlaceholder:i,imageType:r,openSeadragonCallback:s})=>{const[o,a]=M.useState(),[l,c]=M.useState(),u=ss(),f=M.useRef(!1);return M.useEffect(()=>(f.current||(f.current=!0,l||c($d(e))),()=>l==null?void 0:l.destroy()),[]),M.useEffect(()=>{l&&s&&s(l)},[l,s]),M.useEffect(()=>{l&&t!==o&&(l==null||l.forceRedraw(),a(t))},[l,o,t]),M.useEffect(()=>{if(o&&l)switch(r){case"simpleImage":l==null||l.addSimpleImage({url:o});break;case"tiledImage":Rse(o).then(p=>{try{if(!p)throw new Error(`No tile source found for ${o}`);l==null||l.addTiledImage({tileSource:p,success:()=>{typeof u=="function"&&u({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(m){console.error(m)}});break;default:l==null||l.close(),console.warn(`Unable to render ${o} in OpenSeadragon as type: "${r}"`);break}},[r,o]),F.createElement(Yae,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":e.id,hasNavigator:e.showNavigator},F.createElement(ile,{_cloverViewerHasPlaceholder:i,config:e}),e.showNavigator&&F.createElement(QS,{id:e.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),F.createElement(Zae,{id:e.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...n&&{"aria-label":n}}))};function rle(n){return{id:`openseadragon-${n}`,navigatorId:`openseadragon-navigator-${n}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${n}`,homeButton:`reset-${n}`,rotateLeftButton:`rotateLeft-${n}`,rotateRightButton:`rotateRight-${n}`,zoomInButton:`zoomIn-${n}`,zoomOutButton:`zoomOut-${n}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const sle=({_cloverViewerHasPlaceholder:n=!1,body:e,instanceId:t,isTiledImage:i=!1,label:r,src:s="",openSeadragonCallback:o,openSeadragonConfig:a={}})=>{const l=t||Hd(),c=typeof r=="string"?r:Ps(r),u={...rle(l),...a},{imageType:f,uri:p}=e?Bse(e):Use(s,i);return p?F.createElement(G0,{FallbackComponent:O1},F.createElement(nle,{_cloverViewerHasPlaceholder:n,ariaLabel:c,config:u,imageType:f,key:l,uri:p,openSeadragonCallback:o})):null},ole=({isMedia:n,label:e,placeholderCanvas:t,setIsInteractive:i})=>{const{vault:r}=Pi(),s=a0(r,t),o=s?s[0]:void 0,a=e?Xd(e):["placeholder image"];return F.createElement(K4,{onClick:()=>i(!0),isMedia:n,className:"clover-viewer-placeholder"},F.createElement("img",{src:(o==null?void 0:o.id)||"",alt:a.join(),height:o==null?void 0:o.height,width:o==null?void 0:o.width}))},ale=Ge("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),lle=F.forwardRef((n,e)=>{const t=F.useRef(null),i=M.useCallback(()=>{var s,o;if((s=e.current)!=null&&s.currentTime&&((o=e.current)==null?void 0:o.currentTime)>0)return;const a=e.current;if(!a)return;const l=new AudioContext,c=l.createMediaElementSource(a),u=l.createAnalyser(),f=t.current;if(!f)return;f.width=a.offsetWidth,f.height=a.offsetHeight;const p=f.getContext("2d");c.connect(u),u.connect(l.destination),u.fftSize=256;const m=u.frequencyBinCount,y=new Uint8Array(m);setInterval(function(){r(u,p,m,y,f.width,f.height)},20)},[e]);F.useEffect(()=>{!e||!e.current||(e.current.onplay=i)},[i,e]);function r(s,o,a,l,c,u){const f=c/a*2.6;let p,m=0;s.getByteFrequencyData(l),o.fillStyle="#000000",o.fillRect(0,0,c,u);for(let y=0;y<a;y++)p=l[y]*2,o.fillStyle="rgba(78, 42, 132, 1)",o.fillRect(m,u-p,f,p),m+=f+6}return F.createElement(ale,{ref:t,role:"presentation"})}),cle=Ge("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),ule=({resource:n,ignoreCaptionLabels:e})=>{const t=Xd(n.label,"en");return Array.isArray(t)&&t.some(i=>e.includes(i))?null:F.createElement("track",{key:n.id,src:n.id,label:Array.isArray(t)?t[0]:t,srcLang:"en","data-testid":"player-track"})},hle=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],dle=({allSources:n,annotationResources:e,painting:t})=>{const[i,r]=F.useState(0),[s,o]=F.useState(),a=F.useRef(null),l=(t==null?void 0:t.type)==="Sound",c=Pi(),{activeCanvas:u,configOptions:f,vault:p}=c;return M.useEffect(()=>{if(!t.id||!a.current)return;if(a!=null&&a.current){const _=a.current;_.src=t.id,_.load()}if(t.id.split(".").pop()!=="m3u8"&&t.format&&!hle.includes(t.format))return;const m={xhrSetup:function(_,w){_.withCredentials=!!f.withCredentials}},y=new Fn(m);return y.attachMedia(a.current),y.on(Fn.Events.MEDIA_ATTACHED,function(){y.loadSource(t.id)}),y.on(Fn.Events.ERROR,function(_,w){if(w.fatal)switch(w.type){case Fn.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${_} network error encountered, try to recover`),y.startLoad();break;case Fn.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${_} media error encountered, try to recover`),y.recoverMediaError();break;default:y.destroy();break}}),()=>{if(y&&a.current){const _=a.current;y.detachMedia(),y.destroy(),_.currentTime=0}}},[f.withCredentials,t.id]),M.useEffect(()=>{var m,y,_,w;const T=p.get(u),x=(m=T.accompanyingCanvas)!=null&&m.id?a0(p,(y=T.accompanyingCanvas)==null?void 0:y.id):null,C=(_=T.placeholderCanvas)!=null&&_.id?a0(p,(w=T.placeholderCanvas)==null?void 0:w.id):null;x&&C?o(i===0?C[0].id:x[0].id):(x&&o(x[0].id),C&&o(C[0].id))},[u,i,p]),M.useEffect(()=>{if(a!=null&&a.current){const m=a.current;return m==null||m.addEventListener("timeupdate",()=>r(m.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),F.createElement(cle,{css:{backgroundColor:f.canvasBackgroundColor,maxHeight:f.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},F.createElement("video",{id:"clover-iiif-video",key:t.id,ref:a,controls:!0,height:t.height,width:t.width,crossOrigin:"anonymous",poster:s,style:{maxHeight:f.canvasHeight,position:"relative",zIndex:"1"}},n.map(m=>F.createElement("source",{src:m.id,type:m.format,key:m.id})),(e==null?void 0:e.length)>0&&e.map(m=>{const y=[];return m.items.forEach(_=>{p.get(_.id).body.forEach(w=>{const T=p.get(w.id);y.push(T)})}),y.map(_=>F.createElement(ule,{resource:_,ignoreCaptionLabels:f.ignoreCaptionLabels||[],key:_.id}))}),"Sorry, your browser doesn't support embedded videos."),l&&F.createElement(lle,{ref:a}))},fle=()=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},F.createElement("title",{id:"close-svg-title"},"close"),F.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),ple=({isMedia:n})=>F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},F.createElement("title",{id:"open-svg-title"},"open"),n?F.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):F.createElement(F.Fragment,null,F.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),F.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),gle=({handleToggle:n,isInteractive:e,isMedia:t})=>F.createElement(Y4,{onClick:n,isInteractive:e,isMedia:t,"data-testid":"placeholder-toggle"},e?F.createElement(fle,null):F.createElement(ple,{isMedia:t})),mle=({activeCanvas:n,annotationResources:e,isMedia:t,painting:i})=>{var r,s,o,a,l;const[c,u]=F.useState(0),[f,p]=F.useState(!1),{configOptions:m,customDisplays:y,openSeadragonViewer:_,vault:w,viewerId:T}=Pi(),x=ss(),C=w.get(n),I=(r=C==null?void 0:C.placeholderCanvas)==null?void 0:r.id,D=!!I,B=(i==null?void 0:i.length)>1,N=I&&!f&&!t,z=`${T}-${vse(n+c)}`,Z=()=>p(!f),q=W=>{const ie=i.findIndex(ne=>ne.id===W);u(ie)},H=y.find(W=>{var ie;let ne=!1;const{canvasId:J,paintingFormat:ce}=W.target;if(Array.isArray(J)&&J.length>0&&(ne=J.includes(n)),Array.isArray(ce)&&ce.length>0){const se=((ie=i[c])==null?void 0:ie.format)||"";ne=!!(se&&ce.includes(se))}return ne}),Y=[];(o=(s=e[0])==null?void 0:s.items)==null||o.forEach(W=>{const ie=w.get(W.id);Y.push(ie)}),M.useEffect(()=>{var W;Y&&_&&(W=m.annotationOverlays)!=null&&W.renderOverlays&&(I4(_,"annotation-overlay"),A4(_,C,m.annotationOverlays,Y,"annotation-overlay"))},[C,Y,_,m]);const ee=W=>{W&&(_==null?void 0:_.id)!==`openseadragon-${z}`&&x({type:"updateOpenSeadragonViewer",openSeadragonViewer:W})},le=(a=H==null?void 0:H.display)==null?void 0:a.component;return F.createElement(Hae,{className:"clover-viewer-painting"},F.createElement($ae,{style:{backgroundColor:m.canvasBackgroundColor,height:m.canvasHeight==="auto"?"100%":m.canvasHeight}},I&&!t&&F.createElement(gle,{handleToggle:Z,isInteractive:f,isMedia:t}),N&&!t&&F.createElement(ole,{isMedia:t,label:C==null?void 0:C.label,placeholderCanvas:I,setIsInteractive:p}),!N&&!H&&(t?F.createElement(dle,{allSources:i,painting:i[c],annotationResources:e}):i&&F.createElement(sle,{_cloverViewerHasPlaceholder:D,body:i[c],instanceId:z,key:z,openSeadragonCallback:ee,openSeadragonConfig:m.openSeadragon})),!N&&le&&F.createElement(le,{id:n,annotationBody:i[c],...H==null?void 0:H.display.componentProps})),B&&F.createElement(J4,{value:(l=i[c])==null?void 0:l.id,onValueChange:q,maxHeight:"200px"},i==null?void 0:i.map(W=>F.createElement(Q4,{value:W==null?void 0:W.id,key:W==null?void 0:W.id,label:W==null?void 0:W.label}))))},vle=({activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r,isAudioVideo:s,items:o,painting:a})=>{const{isInformationOpen:l,configOptions:c}=Pi(),{informationPanel:u}=c,f=(u==null?void 0:u.renderAbout)&&l,p=(u==null?void 0:u.renderAnnotation)&&e.length>0&&!u.open;return F.createElement(D4,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},F.createElement(O4,null,F.createElement(mle,{activeCanvas:n,annotationResources:e,isMedia:s,painting:a}),f&&F.createElement(k4,null,F.createElement("span",null,l?"View Items":"More Information")),o.length>1&&F.createElement(P4,{className:"clover-viewer-media-wrapper"},F.createElement(Gae,{items:o,activeItem:0}))),(f||p)&&F.createElement(jse,null,F.createElement(M4,null,F.createElement(cae,{activeCanvas:n,annotationResources:e,searchServiceUrl:t,setContentSearchResource:i,contentSearchResource:r}))))},yle=Ge(mu.Trigger,{width:"30px",padding:"5px"}),e3=Ge(mu.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),_le=Ge("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Ele=Ge("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${X4}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),wle=Ge("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Tle=()=>{var n;const e=ss(),t=Pi(),{activeManifest:i,collection:r,configOptions:s,vault:o}=t,a=s==null?void 0:s.canvasHeight,l=c=>{e({type:"updateActiveManifest",manifestId:c}),e({type:"updateViewerId",viewerId:Hd()})};return F.createElement("div",{style:{margin:"0.75rem"}},F.createElement(J4,{label:r.label,maxHeight:a,value:i,onValueChange:l},(n=r==null?void 0:r.items)==null?void 0:n.map(c=>F.createElement(Q4,{value:c.id,key:c.id,thumbnail:c!=null&&c.thumbnail?o.get(c==null?void 0:c.thumbnail):void 0,label:c.label}))))},Sle=(n,e=2500)=>{const[t,i]=M.useState(),r=M.useCallback(()=>{navigator.clipboard.writeText(n).then(()=>i("copied"),()=>i("failed"))},[n]);return M.useEffect(()=>{if(!t)return;const s=setTimeout(()=>i(void 0),e);return()=>clearTimeout(s)},[t]),[t,r]},ble=Ge("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),xle=({status:n})=>n?F.createElement(ble,{"data-copy-status":n},n):null,sD=({textPrompt:n,textToCopy:e})=>{const[t,i]=Sle(e);return F.createElement("button",{onClick:i},n," ",F.createElement(xle,{status:t}))},Cle=()=>{const n="#ed1d33",e="#2873ab";return F.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},F.createElement("title",null,"IIIF Manifest Options"),F.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},F.createElement("g",{transform:"scale(0.1)"},F.createElement("path",{style:{fill:e},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),F.createElement("path",{style:{fill:e},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),F.createElement("path",{style:{fill:n},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),F.createElement("path",{style:{fill:n},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),F.createElement("path",{style:{fill:e},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),F.createElement("path",{style:{fill:e},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),F.createElement("path",{style:{fill:n},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Rle=Ge(pse,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Ale=Ge(gse,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Lle=Ge("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Ile=Ge("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Ple=()=>{var n;const{configOptions:e}=Pi(),t=ss(),[i,r]=M.useState((n=e==null?void 0:e.informationPanel)==null?void 0:n.open);return M.useEffect(()=>{t({type:"updateInformationOpen",isInformationOpen:i})},[i,t]),F.createElement(Ile,null,F.createElement(Lle,{htmlFor:"information-toggle",css:i?{opacity:"1"}:{}},"More Information"),F.createElement(Rle,{checked:i,onCheckedChange:()=>r(!i),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},F.createElement(Ale,null)))},Dle=Ge(mu.Trigger,{width:"30px",padding:"5px"}),Ole=Ge(e3,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function kle(n){const{vault:e}=Pi();try{const t=n&&e.get(n);if(!t)throw new Error(`Vault entity ${n} not found.`);return(t==null?void 0:t["@id"])||(t==null?void 0:t.id)}catch(t){return console.error(t),n}}function oD(n,e){const t=[];if(!n)return t;for(const i of n)if(i.id){const r=e.get(i.id);r&&t.push(r)}return t}function Mle(){const{activeCanvas:n,activeManifest:e,vault:t}=Pi(),[i,r]=M.useState({root:[],canvas:[]});return M.useEffect(()=>{const s=t.get(e),o=t.get(n),a=s==null?void 0:s.rendering,l=o==null?void 0:o.rendering,c=oD(a,t),u=oD(l,t);r({root:c,canvas:u})},[n,e,t]),{...i}}function aD(n,e){return n.map(({format:t,id:i,label:r})=>{const s=kle(i);return{format:t,id:s,label:Ps(r)||e}})}function Nle(){const n=Mle(),e=aD((n==null?void 0:n.root)||[],"Root Rendering Label"),t=aD((n==null?void 0:n.canvas)||[],"Canvas Rendering Label");return{allPages:e,individualPages:t}}const Fle=()=>{const{allPages:n,individualPages:e}=Nle(),t=n.length>0||e.length>0,i=r=>{window.open(r,"_blank")};return t?F.createElement(mu,null,F.createElement(Dle,{"data-testid":"download-button"},F.createElement(Bn,null,F.createElement(Bn.Download,null))),F.createElement(Ole,{"data-testid":"download-content"},e.length>0&&F.createElement(F.Fragment,null,F.createElement("h3",null,"Individual Pages"),F.createElement("ul",null,e.map(({format:r,id:s,label:o})=>F.createElement("li",{key:o},F.createElement("button",{onClick:()=>i(s)},o," (",r,")"))))),n.length>0&&F.createElement(F.Fragment,null,F.createElement("h3",null,"All Pages"),F.createElement("ul",null,n.map(({format:r,id:s,label:o})=>F.createElement("li",{key:o},F.createElement("button",{onClick:()=>i(s)},o," (",r,")"))))))):null},t3=n=>{const e=()=>window.matchMedia?window.matchMedia(n).matches:!1,[t,i]=M.useState(e);return M.useEffect(()=>{const r=()=>i(e);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)}),t},Ble=({manifestId:n,manifestLabel:e})=>{const t=Pi(),{collection:i,configOptions:r}=t,{informationPanel:s,showDownload:o,showIIIFBadge:a,showTitle:l}=r,c=o||a||(s==null?void 0:s.renderToggle),u=t3(P1.sm);return F.createElement(Ele,{className:"clover-viewer-header"},i!=null&&i.items?F.createElement(Tle,null):F.createElement(_le,{className:l?"":"visually-hidden"},l&&F.createElement(xl,{label:e,className:"label"})),c&&F.createElement(wle,null,o&&F.createElement(Fle,null),a&&F.createElement(mu,null,F.createElement(yle,null,F.createElement(Cle,null)),F.createElement(e3,null,(i==null?void 0:i.items)&&F.createElement("button",{onClick:f=>{f.preventDefault(),window.open(i.id,"_blank")}},"View Collection"),F.createElement("button",{onClick:f=>{f.preventDefault(),window.open(n,"_blank")}},"View Manifest")," ",(i==null?void 0:i.items)&&F.createElement(sD,{textPrompt:"Copy Collection URL",textToCopy:i.id}),F.createElement(sD,{textPrompt:"Copy Manifest URL",textToCopy:n}))),(s==null?void 0:s.renderToggle)&&!u&&F.createElement(Ple,null)))},Ule=(n=!1)=>{const[e,t]=M.useState(n);return M.useLayoutEffect(()=>{if(!e)return;const i=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=i}},[e]),M.useEffect(()=>{e!==n&&t(n)},[n]),[e,t]},zle=({manifest:n,theme:e,iiifContentSearchQuery:t})=>{var i;const r=Pi(),s=ss(),{activeCanvas:o,isInformationOpen:a,vault:l,contentSearchVault:c,configOptions:u,openSeadragonViewer:f}=r,p=["100%","auto"],m=(u==null?void 0:u.canvasHeight)&&p.includes(u==null?void 0:u.canvasHeight),[y,_]=M.useState(!1),[w,T]=M.useState(!1),[x,C]=M.useState([]),[I,D]=M.useState([]),[B,N]=M.useState(),[z,Z]=Ule(!1),q=t3(P1.sm),[H,Y]=M.useState(),ee=M.useCallback(W=>{s({type:"updateInformationOpen",isInformationOpen:W})},[s]);M.useEffect(()=>{var W;(W=u==null?void 0:u.informationPanel)!=null&&W.open&&ee(!q)},[q,(i=u==null?void 0:u.informationPanel)==null?void 0:i.open,ee]),M.useEffect(()=>{if(!q){Z(!1);return}Z(a)},[a,q,Z]),M.useEffect(()=>{const W=a0(l,o);W&&(T(["Sound","Video"].indexOf(W[0].type)>-1),C(W)),bse(l,o).then(ie=>{ie.length>0&&s({type:"updateInformationOpen",isInformationOpen:!0}),D(ie),_(ie.length!==0)})},[o,I.length,l,s]);const le=n.service.some(W=>W.type==="SearchService2");return M.useEffect(()=>{if(le){const W=n.service.find(ie=>ie.type==="SearchService2");W&&Y(W.id)}},[n,le]),M.useEffect(()=>{var W,ie,ne;H&&((W=u.informationPanel)==null?void 0:W.renderContentSearch)!==!1&&x4(c,H,(ne=(ie=u.localeText)==null?void 0:ie.contentSearch)==null?void 0:ne.tabLabel,t).then(J=>{N(J)})},[H]),M.useEffect(()=>{if(!f||!B)return;const W=l.get({id:o,type:"Canvas"});I4(f,"content-search-overlay"),zse(c,B,f,W,u)},[f,B]),F.createElement(G0,{FallbackComponent:O1},F.createElement(Wse,{className:`${e} clover-viewer`,css:{background:u==null?void 0:u.background},"data-body-locked":z,"data-absolute-position":m,"data-information-panel":y,"data-information-panel-open":a},F.createElement(Z7,{open:a,onOpenChange:ee},F.createElement(Ble,{manifestLabel:n.label,manifestId:n.id}),F.createElement(vle,{activeCanvas:o,painting:x,annotationResources:I,searchServiceUrl:H,setContentSearchResource:N,contentSearchResource:B,items:n.items,isAudioVideo:w}))))},lD={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gle(n){return{ok:n.status>=200&&n.status<300,status:n.status,statusText:n.statusText,headers:n.getAllResponseHeaders(),data:n.responseText,json:()=>JSON.parse(n.responseText)}}function cD(n,e=null){return{ok:!1,status:n.status,statusText:n.statusText,headers:n.getAllResponseHeaders(),data:e||n.statusText,json:()=>JSON.parse(e||n.statusText)}}function Hle(n,e=lD){const t=e.headers||lD.headers;return new Promise((i,r)=>{const s=new XMLHttpRequest;s.open("get",n),s.withCredentials=e.withCredentials,t&&Object.keys(t).forEach(o=>s.setRequestHeader(o,t[o])),s.onload=()=>{i(Gle(s))},s.onerror=()=>{r(cD(s,"Failed to make request."))},s.ontimeout=()=>{r(cD(s,"Request took longer than expected."))},s.send()})}const $le=({canvasIdCallback:n=()=>{},customDisplays:e=[],plugins:t=[],customTheme:i,iiifContent:r,id:s,manifestId:o,options:a,iiifContentSearchQuery:l})=>{var c,u,f;let p=r;s&&(p=s),o&&(p=o);const m=T4((u=(c=a==null?void 0:a.informationPanel)==null?void 0:c.vtt)==null?void 0:u.autoScroll);return F.createElement(Sse,{initialState:{...u_,customDisplays:e,plugins:t,isAutoScrollEnabled:m.enabled,isInformationOpen:!!((f=a==null?void 0:a.informationPanel)!=null&&f.open),vault:new Fp({customFetcher:y=>Hle(y,{withCredentials:a==null?void 0:a.withCredentials,headers:a==null?void 0:a.requestHeaders}).then(_=>JSON.parse(_.data))})}},F.createElement(Vle,{iiifContent:p,canvasIdCallback:n,customTheme:i,options:a,iiifContentSearchQuery:l}))},Vle=({canvasIdCallback:n,customTheme:e,iiifContent:t,options:i,iiifContentSearchQuery:r})=>{const s=ss(),o=Pi(),{activeCanvas:a,activeManifest:l,isLoaded:c,vault:u}=o,[f,p]=M.useState(),[m,y]=M.useState();let _={};return e&&(_=Pq("custom",e)),M.useEffect(()=>{n&&n(a)},[a,n]),M.useEffect(()=>{l&&u.loadManifest(l).then(w=>{y(w),s({type:"updateActiveCanvas",canvasId:Ise(t,w)})}).catch(w=>{console.error(`Manifest failed to load: ${w}`)}).finally(()=>{s({type:"updateIsLoaded",isLoaded:!0})})},[t,l,s,u]),M.useEffect(()=>{s({type:"updateConfigOptions",configOptions:i});const w=Lse(t);u.load(w).then(T=>{p(T)}).catch(T=>{console.error(`The IIIF resource ${t} failed to load: ${T}`)})},[s,t,i,u]),M.useEffect(()=>{if((f==null?void 0:f.type)==="Collection"){s({type:"updateCollection",collection:f});const w=Pse(t,f);w&&s({type:"updateActiveManifest",manifestId:w})}else(f==null?void 0:f.type)==="Manifest"&&s({type:"updateActiveManifest",manifestId:f.id})},[s,t,f]),c?!m||!m.items?(console.log(`The IIIF manifest ${t} failed to load.`),F.createElement(F.Fragment,null)):m.items.length===0?(console.log(`The IIIF manifest ${t} does not contain canvases.`),F.createElement(F.Fragment,null)):F.createElement(zle,{manifest:m,theme:_,key:m.id,iiifContentSearchQuery:r}):F.createElement(F.Fragment,null,"Loading")};let Yc=window.OpenSeadragon;if(!Yc&&(Yc=$d,!Yc))throw new Error("OpenSeadragon is missing.");const uD="http://www.w3.org/2000/svg";Yc.Viewer&&(Yc.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo?this._svgOverlayInfo:(this._svgOverlayInfo=new i3(this),this._svgOverlayInfo)});const i3=function(n){const e=this;this._viewer=n,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(uD,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(uD,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){e.resize()}),this._viewer.addHandler("open",function(){e.resize()}),this._viewer.addHandler("rotate",function(){e.resize()}),this._viewer.addHandler("flip",function(){e.resize()}),this._viewer.addHandler("resize",function(){e.resize()}),this.resize()};i3.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const n=this._viewer.viewport.pixelFromPoint(new Yc.Point(0,0),!0),e=this._viewer.viewport.getZoom(!0),t=this._viewer.viewport.getRotation(),i=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let s=r*e;const o=s;i&&(s=-s,n.x=-n.x+r),this._node.setAttribute("transform","translate("+n.x+","+n.y+") scale("+s+","+o+") rotate("+t+")")},onClick:function(n,e){new Yc.MouseTracker({element:n,clickHandler:e}).setTracking(!0)}};const jle=n=>fetch(`${n.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(e=>{console.error(`The IIIF tilesource ${n.replace(/\/$/,"")}/info.json failed to load: ${e}`)}),Wle=n=>{let e,t;if(Array.isArray(n)&&(e=n[0],e)){let i;"@id"in e?i=e["@id"]:i=e.id,t=i}return t};var Qp=(n=>(n.TiledImage="tiledImage",n.SimpleImage="simpleImage",n))(Qp||{});const qle=n=>{const e=Array.isArray(n==null?void 0:n.service)&&(n==null?void 0:n.service.length)>0,t=e?Wle(n==null?void 0:n.service):n==null?void 0:n.id,i=e?Qp.TiledImage:Qp.SimpleImage;return{uri:t,imageType:i}},Kle=(n,e)=>{const t=e?Qp.TiledImage:Qp.SimpleImage;return{uri:n,imageType:t}},fT=209,Zle={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${fT} 100% 38.2%)`,accentMuted:`hsl(${fT} 80% 61.8%)`,accentAlt:`hsl(${fT} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},Yle={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:Wl,css:Mme,keyframes:Nme,createTheme:Fme}=Ix({theme:Zle,media:Yle}),Xle=Wl("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Jle=Wl("p",{fontWeight:"bold",fontSize:"x-large"}),Qle=Wl("span",{fontSize:"medium"}),ece=({error:n})=>{const{message:e}=n;return F.createElement(Xle,{role:"alert"},F.createElement(Jle,{"data-testid":"headline"},"Something went wrong"),e&&F.createElement(Qle,null,`Error message: ${e}`," "))},eb=Wl("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),tce=Wl("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),ice=Wl("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${eb}`]:{display:"block"}},false:{[`${eb}`]:{display:"none"}}}}}),nce=Wl("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Lh=({className:n,id:e,label:t,children:i})=>{const r=t.toLowerCase().replace(/\s/g,"-");return F.createElement(nce,{id:e,className:n,"data-testid":"openseadragon-button","data-button":r},F.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${e}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},F.createElement("title",{id:`${e}-svg-title`},t),i))},rce=Wl("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),sce={behavior:"smooth",block:"center"},rd={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:sce}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1,localeText:{contentSearch:{tabLabel:"Search Results",formPlaceholder:"Enter search words",noSearchResults:"No search results",loading:"Loading...",moreResults:"more results"}}};function oce(n){let e={...rd.informationPanel.vtt.autoScroll};return typeof n=="object"&&(e="enabled"in n?n:{enabled:!0,settings:n}),n===!1&&(e.enabled=!1),ace(e.settings),e}function ace({behavior:n,block:e}){const t=["auto","instant","smooth"],i=["center","end","nearest","start"];if(!t.includes(n))throw TypeError(`'${n}' not in ${t.join(" | ")}`);if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`)}var hD,dD;const lce=oce((dD=(hD=rd==null?void 0:rd.informationPanel)==null?void 0:hD.vtt)==null?void 0:dD.autoScroll);var fD;const n3={activeCanvas:"",activeManifest:"",OSDImageLoaded:!1,collection:{},configOptions:rd,customDisplays:[],plugins:[],isAutoScrollEnabled:lce.enabled,isAutoScrolling:!1,isInformationOpen:(fD=rd==null?void 0:rd.informationPanel)==null?void 0:fD.open,isLoaded:!1,isUserScrolling:void 0,vault:new Fp,contentSearchVault:new Fp,openSeadragonViewer:null,viewerId:Hd()},cce=F.createContext(n3),uce=F.createContext(n3);function pD(){const n=F.useContext(cce);if(n===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return n}function r3(){const n=F.useContext(uce);if(n===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return n}const hce=()=>F.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),dce=()=>F.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),fce=()=>F.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),pce=()=>F.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),gD=()=>F.createElement(F.Fragment,null,F.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),F.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),gce=({_cloverViewerHasPlaceholder:n,config:e})=>{const t=pD(),{activeCanvas:i,plugins:r,vault:s}=t,o=s.get({id:i,type:"Canvas"});function a(){return r.filter(l=>{var c;return(c=l.imageViewer)==null?void 0:c.controls}).map((l,c)=>{var u,f,p,m;const y=(f=(u=l.imageViewer)==null?void 0:u.controls)==null?void 0:f.component;return F.createElement(y,{key:c,...(m=(p=l==null?void 0:l.imageViewer)==null?void 0:p.controls)==null?void 0:m.componentProps,canvas:o,useViewerDispatch:r3,useViewerState:pD})})}return F.createElement(rce,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:n},e.showZoomControl&&F.createElement(F.Fragment,null,F.createElement(Lh,{id:e.zoomInButton,label:"zoom in"},F.createElement(hce,null)),F.createElement(Lh,{id:e.zoomOutButton,label:"zoom out"},F.createElement(dce,null))),e.showFullPageControl&&F.createElement(Lh,{id:e.fullPageButton,label:"full page"},F.createElement(fce,null)),e.showRotationControl&&F.createElement(F.Fragment,null,F.createElement(Lh,{id:e.rotateRightButton,label:"rotate right"},F.createElement(gD,null)),F.createElement(Lh,{id:e.rotateLeftButton,label:"rotate left"},F.createElement(gD,null))),e.showHomeControl&&F.createElement(Lh,{id:e.homeButton,label:"reset"},F.createElement(pce,null)),a())},mce=({ariaLabel:n,config:e,uri:t,_cloverViewerHasPlaceholder:i,imageType:r,openSeadragonCallback:s})=>{const[o,a]=M.useState(),[l,c]=M.useState(),u=r3(),f=M.useRef(!1);return M.useEffect(()=>(f.current||(f.current=!0,l||c($d(e))),()=>l==null?void 0:l.destroy()),[]),M.useEffect(()=>{l&&s&&s(l)},[l,s]),M.useEffect(()=>{l&&t!==o&&(l==null||l.forceRedraw(),a(t))},[l,o,t]),M.useEffect(()=>{if(o&&l)switch(r){case"simpleImage":l==null||l.addSimpleImage({url:o});break;case"tiledImage":jle(o).then(p=>{try{if(!p)throw new Error(`No tile source found for ${o}`);l==null||l.addTiledImage({tileSource:p,success:()=>{typeof u=="function"&&u({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(m){console.error(m)}});break;default:l==null||l.close(),console.warn(`Unable to render ${o} in OpenSeadragon as type: "${r}"`);break}},[r,o]),F.createElement(ice,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":e.id,hasNavigator:e.showNavigator},F.createElement(gce,{_cloverViewerHasPlaceholder:i,config:e}),e.showNavigator&&F.createElement(eb,{id:e.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),F.createElement(tce,{id:e.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...n&&{"aria-label":n}}))};function vce(n){return{id:`openseadragon-${n}`,navigatorId:`openseadragon-navigator-${n}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${n}`,homeButton:`reset-${n}`,rotateLeftButton:`rotateLeft-${n}`,rotateRightButton:`rotateRight-${n}`,zoomInButton:`zoomIn-${n}`,zoomOutButton:`zoomOut-${n}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const yce=(n,e="none")=>{if(!n)return null;if(typeof n=="string")return[n];if(!n[e]){const t=Object.getOwnPropertyNames(n);if(t.length>0)return n[t[0]]}return!n[e]||!Array.isArray(n[e])?null:n[e]},_ce=(n,e="none",t=", ")=>{const i=yce(n,e);return Array.isArray(i)?i.join(`${t}`):i},Ece=({_cloverViewerHasPlaceholder:n=!1,body:e,instanceId:t,isTiledImage:i=!1,label:r,src:s="",openSeadragonCallback:o,openSeadragonConfig:a={}})=>{const l=t||Hd(),c=typeof r=="string"?r:_ce(r),u={...vce(l),...a},{imageType:f,uri:p}=e?qle(e):Kle(s,i);return p?F.createElement(G0,{FallbackComponent:ece},F.createElement(mce,{_cloverViewerHasPlaceholder:n,ariaLabel:c,config:u,imageType:f,key:l,uri:p,openSeadragonCallback:o})):null},wce={showTitle:!1,showIIIFBadge:!1,informationPanel:{renderToggle:!1,renderAbout:!1}};class N1 extends Os{connect(){kM(this.element).render(this.getViewer(this.protocolValue,this.urlValue))}getViewer(e,t){if(e=="Iiif")return M.createElement("div",{style:{height:400}},M.createElement(Ece,{src:t.replace(/\/info\.json$/,""),isTiledImage:!0}));if(e=="IiifManifest")return M.createElement($le,{iiifContent:t,options:wce});console.error(`Unsupported protocol name: "${e}"`)}}wn(N1,"values",{url:String,protocol:String});class F1 extends Os{connect(){fetch(this.urlValue).then(e=>e.json()).then(e=>{e&&(this.element.innerHTML=e.html)}).catch(e=>{console.error("Error loading oEmbed data:",e)})}}wn(F1,"values",{url:String});var tb={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,e){(function(t,i){i(e)})(wt,function(t){var i="1.9.4";function r(d){var v,S,R,O;for(S=1,R=arguments.length;S<R;S++){O=arguments[S];for(v in O)d[v]=O[v]}return d}var s=Object.create||function(){function d(){}return function(v){return d.prototype=v,new d}}();function o(d,v){var S=Array.prototype.slice;if(d.bind)return d.bind.apply(d,S.call(arguments,1));var R=S.call(arguments,2);return function(){return d.apply(v,R.length?R.concat(S.call(arguments)):arguments)}}var a=0;function l(d){return"_leaflet_id"in d||(d._leaflet_id=++a),d._leaflet_id}function c(d,v,S){var R,O,j,ae;return ae=function(){R=!1,O&&(j.apply(S,O),O=!1)},j=function(){R?O=arguments:(d.apply(S,arguments),setTimeout(ae,v),R=!0)},j}function u(d,v,S){var R=v[1],O=v[0],j=R-O;return d===R&&S?d:((d-O)%j+j)%j+O}function f(){return!1}function p(d,v){if(v===!1)return d;var S=Math.pow(10,v===void 0?6:v);return Math.round(d*S)/S}function m(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function y(d){return m(d).split(/\s+/)}function _(d,v){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?s(d.options):{});for(var S in v)d.options[S]=v[S];return d.options}function w(d,v,S){var R=[];for(var O in d)R.push(encodeURIComponent(S?O.toUpperCase():O)+"="+encodeURIComponent(d[O]));return(!v||v.indexOf("?")===-1?"?":"&")+R.join("&")}var T=/\{ *([\w_ -]+) *\}/g;function x(d,v){return d.replace(T,function(S,R){var O=v[R];if(O===void 0)throw new Error("No value provided for variable "+S);return typeof O=="function"&&(O=O(v)),O})}var C=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function I(d,v){for(var S=0;S<d.length;S++)if(d[S]===v)return S;return-1}var D="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function B(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var N=0;function z(d){var v=+new Date,S=Math.max(0,16-(v-N));return N=v+S,window.setTimeout(d,S)}var Z=window.requestAnimationFrame||B("RequestAnimationFrame")||z,q=window.cancelAnimationFrame||B("CancelAnimationFrame")||B("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function H(d,v,S){if(S&&Z===z)d.call(v);else return Z.call(window,o(d,v))}function Y(d){d&&q.call(window,d)}var ee={__proto__:null,extend:r,create:s,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:u,falseFn:f,formatNum:p,trim:m,splitWords:y,setOptions:_,getParamString:w,template:x,isArray:C,indexOf:I,emptyImageUrl:D,requestFn:Z,cancelFn:q,requestAnimFrame:H,cancelAnimFrame:Y};function le(){}le.extend=function(d){var v=function(){_(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},S=v.__super__=this.prototype,R=s(S);R.constructor=v,v.prototype=R;for(var O in this)Object.prototype.hasOwnProperty.call(this,O)&&O!=="prototype"&&O!=="__super__"&&(v[O]=this[O]);return d.statics&&r(v,d.statics),d.includes&&(W(d.includes),r.apply(null,[R].concat(d.includes))),r(R,d),delete R.statics,delete R.includes,R.options&&(R.options=S.options?s(S.options):{},r(R.options,d.options)),R._initHooks=[],R.callInitHooks=function(){if(!this._initHooksCalled){S.callInitHooks&&S.callInitHooks.call(this),this._initHooksCalled=!0;for(var j=0,ae=R._initHooks.length;j<ae;j++)R._initHooks[j].call(this)}},v},le.include=function(d){var v=this.prototype.options;return r(this.prototype,d),d.options&&(this.prototype.options=v,this.mergeOptions(d.options)),this},le.mergeOptions=function(d){return r(this.prototype.options,d),this},le.addInitHook=function(d){var v=Array.prototype.slice.call(arguments,1),S=typeof d=="function"?d:function(){this[d].apply(this,v)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(S),this};function W(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=C(d)?d:[d];for(var v=0;v<d.length;v++)d[v]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var ie={on:function(d,v,S){if(typeof d=="object")for(var R in d)this._on(R,d[R],v);else{d=y(d);for(var O=0,j=d.length;O<j;O++)this._on(d[O],v,S)}return this},off:function(d,v,S){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var R in d)this._off(R,d[R],v);else{d=y(d);for(var O=arguments.length===1,j=0,ae=d.length;j<ae;j++)O?this._off(d[j]):this._off(d[j],v,S)}return this},_on:function(d,v,S,R){if(typeof v!="function"){console.warn("wrong listener type: "+typeof v);return}if(this._listens(d,v,S)===!1){S===this&&(S=void 0);var O={fn:v,ctx:S};R&&(O.once=!0),this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(O)}},_off:function(d,v,S){var R,O,j;if(this._events&&(R=this._events[d],!!R)){if(arguments.length===1){if(this._firingCount)for(O=0,j=R.length;O<j;O++)R[O].fn=f;delete this._events[d];return}if(typeof v!="function"){console.warn("wrong listener type: "+typeof v);return}var ae=this._listens(d,v,S);if(ae!==!1){var me=R[ae];this._firingCount&&(me.fn=f,this._events[d]=R=R.slice()),R.splice(ae,1)}}},fire:function(d,v,S){if(!this.listens(d,S))return this;var R=r({},v,{type:d,target:this,sourceTarget:v&&v.sourceTarget||this});if(this._events){var O=this._events[d];if(O){this._firingCount=this._firingCount+1||1;for(var j=0,ae=O.length;j<ae;j++){var me=O[j],Te=me.fn;me.once&&this.off(d,Te,me.ctx),Te.call(me.ctx||this,R)}this._firingCount--}}return S&&this._propagateEvent(R),this},listens:function(d,v,S,R){typeof d!="string"&&console.warn('"string" type argument expected');var O=v;typeof v!="function"&&(R=!!v,O=void 0,S=void 0);var j=this._events&&this._events[d];if(j&&j.length&&this._listens(d,O,S)!==!1)return!0;if(R){for(var ae in this._eventParents)if(this._eventParents[ae].listens(d,v,S,R))return!0}return!1},_listens:function(d,v,S){if(!this._events)return!1;var R=this._events[d]||[];if(!v)return!!R.length;S===this&&(S=void 0);for(var O=0,j=R.length;O<j;O++)if(R[O].fn===v&&R[O].ctx===S)return O;return!1},once:function(d,v,S){if(typeof d=="object")for(var R in d)this._on(R,d[R],v,!0);else{d=y(d);for(var O=0,j=d.length;O<j;O++)this._on(d[O],v,S,!0)}return this},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[l(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[l(d)],this},_propagateEvent:function(d){for(var v in this._eventParents)this._eventParents[v].fire(d.type,r({layer:d.target,propagatedFrom:d.target},d),!0)}};ie.addEventListener=ie.on,ie.removeEventListener=ie.clearAllEventListeners=ie.off,ie.addOneTimeEventListener=ie.once,ie.fireEvent=ie.fire,ie.hasEventListeners=ie.listens;var ne=le.extend(ie);function J(d,v,S){this.x=S?Math.round(d):d,this.y=S?Math.round(v):v}var ce=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};J.prototype={clone:function(){return new J(this.x,this.y)},add:function(d){return this.clone()._add(se(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(se(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new J(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new J(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ce(this.x),this.y=ce(this.y),this},distanceTo:function(d){d=se(d);var v=d.x-this.x,S=d.y-this.y;return Math.sqrt(v*v+S*S)},equals:function(d){return d=se(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=se(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function se(d,v,S){return d instanceof J?d:C(d)?new J(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new J(d.x,d.y):new J(d,v,S)}function te(d,v){if(d)for(var S=v?[d,v]:d,R=0,O=S.length;R<O;R++)this.extend(S[R])}te.prototype={extend:function(d){var v,S;if(!d)return this;if(d instanceof J||typeof d[0]=="number"||"x"in d)v=S=se(d);else if(d=Q(d),v=d.min,S=d.max,!v||!S)return this;return!this.min&&!this.max?(this.min=v.clone(),this.max=S.clone()):(this.min.x=Math.min(v.x,this.min.x),this.max.x=Math.max(S.x,this.max.x),this.min.y=Math.min(v.y,this.min.y),this.max.y=Math.max(S.y,this.max.y)),this},getCenter:function(d){return se((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return se(this.min.x,this.max.y)},getTopRight:function(){return se(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var v,S;return typeof d[0]=="number"||d instanceof J?d=se(d):d=Q(d),d instanceof te?(v=d.min,S=d.max):v=S=d,v.x>=this.min.x&&S.x<=this.max.x&&v.y>=this.min.y&&S.y<=this.max.y},intersects:function(d){d=Q(d);var v=this.min,S=this.max,R=d.min,O=d.max,j=O.x>=v.x&&R.x<=S.x,ae=O.y>=v.y&&R.y<=S.y;return j&&ae},overlaps:function(d){d=Q(d);var v=this.min,S=this.max,R=d.min,O=d.max,j=O.x>v.x&&R.x<S.x,ae=O.y>v.y&&R.y<S.y;return j&&ae},isValid:function(){return!!(this.min&&this.max)},pad:function(d){var v=this.min,S=this.max,R=Math.abs(v.x-S.x)*d,O=Math.abs(v.y-S.y)*d;return Q(se(v.x-R,v.y-O),se(S.x+R,S.y+O))},equals:function(d){return d?(d=Q(d),this.min.equals(d.getTopLeft())&&this.max.equals(d.getBottomRight())):!1}};function Q(d,v){return!d||d instanceof te?d:new te(d,v)}function _e(d,v){if(d)for(var S=v?[d,v]:d,R=0,O=S.length;R<O;R++)this.extend(S[R])}_e.prototype={extend:function(d){var v=this._southWest,S=this._northEast,R,O;if(d instanceof pe)R=d,O=d;else if(d instanceof _e){if(R=d._southWest,O=d._northEast,!R||!O)return this}else return d?this.extend(Ce(d)||fe(d)):this;return!v&&!S?(this._southWest=new pe(R.lat,R.lng),this._northEast=new pe(O.lat,O.lng)):(v.lat=Math.min(R.lat,v.lat),v.lng=Math.min(R.lng,v.lng),S.lat=Math.max(O.lat,S.lat),S.lng=Math.max(O.lng,S.lng)),this},pad:function(d){var v=this._southWest,S=this._northEast,R=Math.abs(v.lat-S.lat)*d,O=Math.abs(v.lng-S.lng)*d;return new _e(new pe(v.lat-R,v.lng-O),new pe(S.lat+R,S.lng+O))},getCenter:function(){return new pe((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new pe(this.getNorth(),this.getWest())},getSouthEast:function(){return new pe(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof pe||"lat"in d?d=Ce(d):d=fe(d);var v=this._southWest,S=this._northEast,R,O;return d instanceof _e?(R=d.getSouthWest(),O=d.getNorthEast()):R=O=d,R.lat>=v.lat&&O.lat<=S.lat&&R.lng>=v.lng&&O.lng<=S.lng},intersects:function(d){d=fe(d);var v=this._southWest,S=this._northEast,R=d.getSouthWest(),O=d.getNorthEast(),j=O.lat>=v.lat&&R.lat<=S.lat,ae=O.lng>=v.lng&&R.lng<=S.lng;return j&&ae},overlaps:function(d){d=fe(d);var v=this._southWest,S=this._northEast,R=d.getSouthWest(),O=d.getNorthEast(),j=O.lat>v.lat&&R.lat<S.lat,ae=O.lng>v.lng&&R.lng<S.lng;return j&&ae},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,v){return d?(d=fe(d),this._southWest.equals(d.getSouthWest(),v)&&this._northEast.equals(d.getNorthEast(),v)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function fe(d,v){return d instanceof _e?d:new _e(d,v)}function pe(d,v,S){if(isNaN(d)||isNaN(v))throw new Error("Invalid LatLng object: ("+d+", "+v+")");this.lat=+d,this.lng=+v,S!==void 0&&(this.alt=+S)}pe.prototype={equals:function(d,v){if(!d)return!1;d=Ce(d);var S=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return S<=(v===void 0?1e-9:v)},toString:function(d){return"LatLng("+p(this.lat,d)+", "+p(this.lng,d)+")"},distanceTo:function(d){return Le.distance(this,Ce(d))},wrap:function(){return Le.wrapLatLng(this)},toBounds:function(d){var v=180*d/40075017,S=v/Math.cos(Math.PI/180*this.lat);return fe([this.lat-v,this.lng-S],[this.lat+v,this.lng+S])},clone:function(){return new pe(this.lat,this.lng,this.alt)}};function Ce(d,v,S){return d instanceof pe?d:C(d)&&typeof d[0]!="object"?d.length===3?new pe(d[0],d[1],d[2]):d.length===2?new pe(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new pe(d.lat,"lng"in d?d.lng:d.lon,d.alt):v===void 0?null:new pe(d,v,S)}var xe={latLngToPoint:function(d,v){var S=this.projection.project(d),R=this.scale(v);return this.transformation._transform(S,R)},pointToLatLng:function(d,v){var S=this.scale(v),R=this.transformation.untransform(d,S);return this.projection.unproject(R)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var v=this.projection.bounds,S=this.scale(d),R=this.transformation.transform(v.min,S),O=this.transformation.transform(v.max,S);return new te(R,O)},infinite:!1,wrapLatLng:function(d){var v=this.wrapLng?u(d.lng,this.wrapLng,!0):d.lng,S=this.wrapLat?u(d.lat,this.wrapLat,!0):d.lat,R=d.alt;return new pe(S,v,R)},wrapLatLngBounds:function(d){var v=d.getCenter(),S=this.wrapLatLng(v),R=v.lat-S.lat,O=v.lng-S.lng;if(R===0&&O===0)return d;var j=d.getSouthWest(),ae=d.getNorthEast(),me=new pe(j.lat-R,j.lng-O),Te=new pe(ae.lat-R,ae.lng-O);return new _e(me,Te)}},Le=r({},xe,{wrapLng:[-180,180],R:6371e3,distance:function(d,v){var S=Math.PI/180,R=d.lat*S,O=v.lat*S,j=Math.sin((v.lat-d.lat)*S/2),ae=Math.sin((v.lng-d.lng)*S/2),me=j*j+Math.cos(R)*Math.cos(O)*ae*ae,Te=2*Math.atan2(Math.sqrt(me),Math.sqrt(1-me));return this.R*Te}}),je=6378137,Ke={R:je,MAX_LATITUDE:85.0511287798,project:function(d){var v=Math.PI/180,S=this.MAX_LATITUDE,R=Math.max(Math.min(S,d.lat),-S),O=Math.sin(R*v);return new J(this.R*d.lng*v,this.R*Math.log((1+O)/(1-O))/2)},unproject:function(d){var v=180/Math.PI;return new pe((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*v,d.x*v/this.R)},bounds:function(){var d=je*Math.PI;return new te([-d,-d],[d,d])}()};function lt(d,v,S,R){if(C(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=v,this._c=S,this._d=R}lt.prototype={transform:function(d,v){return this._transform(d.clone(),v)},_transform:function(d,v){return v=v||1,d.x=v*(this._a*d.x+this._b),d.y=v*(this._c*d.y+this._d),d},untransform:function(d,v){return v=v||1,new J((d.x/v-this._b)/this._a,(d.y/v-this._d)/this._c)}};function ct(d,v,S,R){return new lt(d,v,S,R)}var Ht=r({},Le,{code:"EPSG:3857",projection:Ke,transformation:function(){var d=.5/(Math.PI*Ke.R);return ct(d,.5,-d,.5)}()}),Vt=r({},Ht,{code:"EPSG:900913"});function ii(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function Yt(d,v){var S="",R,O,j,ae,me,Te;for(R=0,j=d.length;R<j;R++){for(me=d[R],O=0,ae=me.length;O<ae;O++)Te=me[O],S+=(O?"L":"M")+Te.x+" "+Te.y;S+=v?nt.svg?"z":"x":""}return S||"M0 0"}var k=document.documentElement.style,X="ActiveXObject"in window,ve=X&&!document.addEventListener,Pe="msLaunchUri"in navigator&&!("documentMode"in document),Ae=hi("webkit"),Ve=hi("android"),ze=hi("android 2")||hi("android 3"),vt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),xt=Ve&&hi("Google")&&vt<537&&!("AudioNode"in window),It=!!window.opera,rt=!Pe&&hi("chrome"),Ot=hi("gecko")&&!Ae&&!It&&!X,G=!rt&&hi("safari"),U=hi("phantom"),K="OTransition"in k,re=navigator.platform.indexOf("Win")===0,Re=X&&"transition"in k,Me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ze,ot="MozPerspective"in k,Nt=!window.L_DISABLE_3D&&(Re||Me||ot)&&!K&&!U,tt=typeof orientation<"u"||hi("mobile"),Di=tt&&Ae,si=tt&&Me,ji=!window.PointerEvent&&window.MSPointerEvent,Qi=!!(window.PointerEvent||ji),en="ontouchstart"in window||!!window.TouchEvent,Fs=!window.L_NO_TOUCH&&(en||Qi),Yl=tt&&It,tn=tt&&Ot,cs=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,mn=function(){var d=!1;try{var v=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",f,v),window.removeEventListener("testPassiveEventSupport",f,v)}catch{}return d}(),zn=function(){return!!document.createElement("canvas").getContext}(),zi=!!(document.createElementNS&&ii("svg").createSVGRect),Ur=!!zi&&function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Bs=!zi&&function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var v=d.firstChild;return v.style.behavior="url(#default#VML)",v&&typeof v.adj=="object"}catch{return!1}}(),Oi=navigator.platform.indexOf("Mac")===0,xn=navigator.platform.indexOf("Linux")===0;function hi(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var nt={ie:X,ielt9:ve,edge:Pe,webkit:Ae,android:Ve,android23:ze,androidStock:xt,opera:It,chrome:rt,gecko:Ot,safari:G,phantom:U,opera12:K,win:re,ie3d:Re,webkit3d:Me,gecko3d:ot,any3d:Nt,mobile:tt,mobileWebkit:Di,mobileWebkit3d:si,msPointer:ji,pointer:Qi,touch:Fs,touchNative:en,mobileOpera:Yl,mobileGecko:tn,retina:cs,passiveEvents:mn,canvas:zn,svg:zi,vml:Bs,inlineSvg:Ur,mac:Oi,linux:xn},Xl=nt.msPointer?"MSPointerDown":"pointerdown",Eu=nt.msPointer?"MSPointerMove":"pointermove",Lg=nt.msPointer?"MSPointerUp":"pointerup",Ig=nt.msPointer?"MSPointerCancel":"pointercancel",tf={touchstart:Xl,touchmove:Eu,touchend:Lg,touchcancel:Ig},Us={touchstart:xi,touchmove:wu,touchend:wu,touchcancel:wu},So={},nf=!1;function R_(d,v,S){return v==="touchstart"&&A_(),Us[v]?(S=Us[v].bind(this,S),d.addEventListener(tf[v],S,!1),S):(console.warn("wrong event specified:",v),f)}function Pg(d,v,S){if(!tf[v]){console.warn("wrong event specified:",v);return}d.removeEventListener(tf[v],S,!1)}function Dg(d){So[d.pointerId]=d}function Og(d){So[d.pointerId]&&(So[d.pointerId]=d)}function rf(d){delete So[d.pointerId]}function A_(){nf||(document.addEventListener(Xl,Dg,!0),document.addEventListener(Eu,Og,!0),document.addEventListener(Lg,rf,!0),document.addEventListener(Ig,rf,!0),nf=!0)}function wu(d,v){if(v.pointerType!==(v.MSPOINTER_TYPE_MOUSE||"mouse")){v.touches=[];for(var S in So)v.touches.push(So[S]);v.changedTouches=[v],d(v)}}function xi(d,v){v.MSPOINTER_TYPE_TOUCH&&v.pointerType===v.MSPOINTER_TYPE_TOUCH&&Ci(v),wu(d,v)}function L_(d){var v={},S,R;for(R in d)S=d[R],v[R]=S&&S.bind?S.bind(d):S;return d=v,v.type="dblclick",v.detail=2,v.isTrusted=!1,v._simulated=!0,v}var sf=200;function kg(d,v){d.addEventListener("dblclick",v);var S=0,R;function O(j){if(j.detail!==1){R=j.detail;return}if(!(j.pointerType==="mouse"||j.sourceCapabilities&&!j.sourceCapabilities.firesTouchEvents)){var ae=Co(j);if(!(ae.some(function(Te){return Te instanceof HTMLLabelElement&&Te.attributes.for})&&!ae.some(function(Te){return Te instanceof HTMLInputElement||Te instanceof HTMLSelectElement}))){var me=Date.now();me-S<=sf?(R++,R===2&&v(L_(j))):R=1,S=me}}}return d.addEventListener("click",O),{dblclick:v,simDblclick:O}}function Tu(d,v){d.removeEventListener("dblclick",v.dblclick),d.removeEventListener("click",v.simDblclick)}var of=Ra(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ba=Ra(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Jl=ba==="webkitTransition"||ba==="OTransition"?ba+"End":"transitionend";function yr(d){return typeof d=="string"?document.getElementById(d):d}function Ql(d,v){var S=d.style[v]||d.currentStyle&&d.currentStyle[v];if((!S||S==="auto")&&document.defaultView){var R=document.defaultView.getComputedStyle(d,null);S=R?R[v]:null}return S==="auto"?null:S}function Rt(d,v,S){var R=document.createElement(d);return R.className=v||"",S&&S.appendChild(R),R}function _i(d){var v=d.parentNode;v&&v.removeChild(d)}function Su(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function xa(d){var v=d.parentNode;v&&v.lastChild!==d&&v.appendChild(d)}function us(d){var v=d.parentNode;v&&v.firstChild!==d&&v.insertBefore(d,v.firstChild)}function Ca(d,v){if(d.classList!==void 0)return d.classList.contains(v);var S=bu(d);return S.length>0&&new RegExp("(^|\\s)"+v+"(\\s|$)").test(S)}function bt(d,v){if(d.classList!==void 0)for(var S=y(v),R=0,O=S.length;R<O;R++)d.classList.add(S[R]);else if(!Ca(d,v)){var j=bu(d);af(d,(j?j+" ":"")+v)}}function di(d,v){d.classList!==void 0?d.classList.remove(v):af(d,m((" "+bu(d)+" ").replace(" "+v+" "," ")))}function af(d,v){d.className.baseVal===void 0?d.className=v:d.className.baseVal=v}function bu(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function Cn(d,v){"opacity"in d.style?d.style.opacity=v:"filter"in d.style&&Mg(d,v)}function Mg(d,v){var S=!1,R="DXImageTransform.Microsoft.Alpha";try{S=d.filters.item(R)}catch{if(v===1)return}v=Math.round(v*100),S?(S.Enabled=v!==100,S.Opacity=v):d.style.filter+=" progid:"+R+"(opacity="+v+")"}function Ra(d){for(var v=document.documentElement.style,S=0;S<d.length;S++)if(d[S]in v)return d[S];return!1}function _r(d,v,S){var R=v||new J(0,0);d.style[of]=(nt.ie3d?"translate("+R.x+"px,"+R.y+"px)":"translate3d("+R.x+"px,"+R.y+"px,0)")+(S?" scale("+S+")":"")}function ki(d,v){d._leaflet_pos=v,nt.any3d?_r(d,v):(d.style.left=v.x+"px",d.style.top=v.y+"px")}function hs(d){return d._leaflet_pos||new J(0,0)}var $t,Aa,xu;if("onselectstart"in document)$t=function(){Tt(window,"selectstart",Ci)},Aa=function(){oi(window,"selectstart",Ci)};else{var bo=Ra(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);$t=function(){if(bo){var d=document.documentElement.style;xu=d[bo],d[bo]="none"}},Aa=function(){bo&&(document.documentElement.style[bo]=xu,xu=void 0)}}function Cu(){Tt(window,"dragstart",Ci)}function Ru(){oi(window,"dragstart",Ci)}var ec,tc;function La(d){for(;d.tabIndex===-1;)d=d.parentNode;d.style&&(Er(),ec=d,tc=d.style.outlineStyle,d.style.outlineStyle="none",Tt(window,"keydown",Er))}function Er(){ec&&(ec.style.outlineStyle=tc,ec=void 0,tc=void 0,oi(window,"keydown",Er))}function ds(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function zr(d){var v=d.getBoundingClientRect();return{x:v.width/d.offsetWidth||1,y:v.height/d.offsetHeight||1,boundingClientRect:v}}var ic={__proto__:null,TRANSFORM:of,TRANSITION:ba,TRANSITION_END:Jl,get:yr,getStyle:Ql,create:Rt,remove:_i,empty:Su,toFront:xa,toBack:us,hasClass:Ca,addClass:bt,removeClass:di,setClass:af,getClass:bu,setOpacity:Cn,testProp:Ra,setTransform:_r,setPosition:ki,getPosition:hs,get disableTextSelection(){return $t},get enableTextSelection(){return Aa},disableImageDrag:Cu,enableImageDrag:Ru,preventOutline:La,restoreOutline:Er,getSizedParentNode:ds,getScale:zr};function Tt(d,v,S,R){if(v&&typeof v=="object")for(var O in v)cf(d,O,v[O],S);else{v=y(v);for(var j=0,ae=v.length;j<ae;j++)cf(d,v[j],S,R)}return this}var Wi="_leaflet_events";function oi(d,v,S,R){if(arguments.length===1)lf(d),delete d[Wi];else if(v&&typeof v=="object")for(var O in v)Au(d,O,v[O],S);else if(v=y(v),arguments.length===2)lf(d,function(me){return I(v,me)!==-1});else for(var j=0,ae=v.length;j<ae;j++)Au(d,v[j],S,R);return this}function lf(d,v){for(var S in d[Wi]){var R=S.split(/\d/)[0];(!v||v(R))&&Au(d,R,null,null,S)}}var xo={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function cf(d,v,S,R){var O=v+l(S)+(R?"_"+l(R):"");if(d[Wi]&&d[Wi][O])return this;var j=function(me){return S.call(R||d,me||window.event)},ae=j;!nt.touchNative&&nt.pointer&&v.indexOf("touch")===0?j=R_(d,v,j):nt.touch&&v==="dblclick"?j=kg(d,j):"addEventListener"in d?v==="touchstart"||v==="touchmove"||v==="wheel"||v==="mousewheel"?d.addEventListener(xo[v]||v,j,nt.passiveEvents?{passive:!1}:!1):v==="mouseenter"||v==="mouseleave"?(j=function(me){me=me||window.event,sc(d,me)&&ae(me)},d.addEventListener(xo[v],j,!1)):d.addEventListener(v,ae,!1):d.attachEvent("on"+v,j),d[Wi]=d[Wi]||{},d[Wi][O]=j}function Au(d,v,S,R,O){O=O||v+l(S)+(R?"_"+l(R):"");var j=d[Wi]&&d[Wi][O];if(!j)return this;!nt.touchNative&&nt.pointer&&v.indexOf("touch")===0?Pg(d,v,j):nt.touch&&v==="dblclick"?Tu(d,j):"removeEventListener"in d?d.removeEventListener(xo[v]||v,j,!1):d.detachEvent("on"+v,j),d[Wi][O]=null}function Gr(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function Lu(d){return cf(d,"wheel",Gr),this}function nc(d){return Tt(d,"mousedown touchstart dblclick contextmenu",Gr),d._leaflet_disable_click=!0,this}function Ci(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function wr(d){return Ci(d),Gr(d),this}function Co(d){if(d.composedPath)return d.composedPath();for(var v=[],S=d.target;S;)v.push(S),S=S.parentNode;return v}function rc(d,v){if(!v)return new J(d.clientX,d.clientY);var S=zr(v),R=S.boundingClientRect;return new J((d.clientX-R.left)/S.x-v.clientLeft,(d.clientY-R.top)/S.y-v.clientTop)}var I_=nt.linux&&nt.chrome?window.devicePixelRatio:nt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ng(d){return nt.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/I_:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function sc(d,v){var S=v.relatedTarget;if(!S)return!0;try{for(;S&&S!==d;)S=S.parentNode}catch{return!1}return S!==d}var Iu={__proto__:null,on:Tt,off:oi,stopPropagation:Gr,disableScrollPropagation:Lu,disableClickPropagation:nc,preventDefault:Ci,stop:wr,getPropagationPath:Co,getMousePosition:rc,getWheelDelta:Ng,isExternalTarget:sc,addListener:Tt,removeListener:oi},Pu=ne.extend({run:function(d,v,S,R){this.stop(),this._el=d,this._inProgress=!0,this._duration=S||.25,this._easeOutPower=1/Math.max(R||.5,.2),this._startPos=hs(d),this._offset=v.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=H(this._animate,this),this._step()},_step:function(d){var v=+new Date-this._startTime,S=this._duration*1e3;v<S?this._runFrame(this._easeOut(v/S),d):(this._runFrame(1),this._complete())},_runFrame:function(d,v){var S=this._startPos.add(this._offset.multiplyBy(d));v&&S._round(),ki(this._el,S),this.fire("step")},_complete:function(){Y(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),Bt=ne.extend({options:{crs:Ht,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,v){v=_(this,v),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),v.maxBounds&&this.setMaxBounds(v.maxBounds),v.zoom!==void 0&&(this._zoom=this._limitZoom(v.zoom)),v.center&&v.zoom!==void 0&&this.setView(Ce(v.center),v.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ba&&nt.any3d&&!nt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Tt(this._proxy,Jl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,v,S){if(v=v===void 0?this._zoom:this._limitZoom(v),d=this._limitCenter(Ce(d),v,this.options.maxBounds),S=S||{},this._stop(),this._loaded&&!S.reset&&S!==!0){S.animate!==void 0&&(S.zoom=r({animate:S.animate},S.zoom),S.pan=r({animate:S.animate,duration:S.duration},S.pan));var R=this._zoom!==v?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,v,S.zoom):this._tryAnimatedPan(d,S.pan);if(R)return clearTimeout(this._sizeTimer),this}return this._resetView(d,v,S.pan&&S.pan.noMoveStart),this},setZoom:function(d,v){return this._loaded?this.setView(this.getCenter(),d,{zoom:v}):(this._zoom=d,this)},zoomIn:function(d,v){return d=d||(nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,v)},zoomOut:function(d,v){return d=d||(nt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,v)},setZoomAround:function(d,v,S){var R=this.getZoomScale(v),O=this.getSize().divideBy(2),j=d instanceof J?d:this.latLngToContainerPoint(d),ae=j.subtract(O).multiplyBy(1-1/R),me=this.containerPointToLatLng(O.add(ae));return this.setView(me,v,{zoom:S})},_getBoundsCenterZoom:function(d,v){v=v||{},d=d.getBounds?d.getBounds():fe(d);var S=se(v.paddingTopLeft||v.padding||[0,0]),R=se(v.paddingBottomRight||v.padding||[0,0]),O=this.getBoundsZoom(d,!1,S.add(R));if(O=typeof v.maxZoom=="number"?Math.min(v.maxZoom,O):O,O===1/0)return{center:d.getCenter(),zoom:O};var j=R.subtract(S).divideBy(2),ae=this.project(d.getSouthWest(),O),me=this.project(d.getNorthEast(),O),Te=this.unproject(ae.add(me).divideBy(2).add(j),O);return{center:Te,zoom:O}},fitBounds:function(d,v){if(d=fe(d),!d.isValid())throw new Error("Bounds are not valid.");var S=this._getBoundsCenterZoom(d,v);return this.setView(S.center,S.zoom,v)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,v){return this.setView(d,this._zoom,{pan:v})},panBy:function(d,v){if(d=se(d).round(),v=v||{},!d.x&&!d.y)return this.fire("moveend");if(v.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Pu,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),v.noMoveStart||this.fire("movestart"),v.animate!==!1){bt(this._mapPane,"leaflet-pan-anim");var S=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,S,v.duration||.25,v.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,v,S){if(S=S||{},S.animate===!1||!nt.any3d)return this.setView(d,v,S);this._stop();var R=this.project(this.getCenter()),O=this.project(d),j=this.getSize(),ae=this._zoom;d=Ce(d),v=v===void 0?ae:v;var me=Math.max(j.x,j.y),Te=me*this.getZoomScale(ae,v),De=O.distanceTo(R)||1,We=1.42,ut=We*We;function Pt(ei){var Va=ei?-1:1,V_=ei?Te:me,j_=Te*Te-me*me+Va*ut*ut*De*De,Oo=2*V_*ut*De,ko=j_/Oo,Mo=Math.sqrt(ko*ko+1)-ko,ju=Mo<1e-9?-18:Math.log(Mo);return ju}function qi(ei){return(Math.exp(ei)-Math.exp(-ei))/2}function Gi(ei){return(Math.exp(ei)+Math.exp(-ei))/2}function $n(ei){return qi(ei)/Gi(ei)}var An=Pt(0);function Ha(ei){return me*(Gi(An)/Gi(An+We*ei))}function If(ei){return me*(Gi(An)*$n(An+We*ei)-qi(An))/ut}function qs(ei){return 1-Math.pow(1-ei,1.5)}var nm=Date.now(),Do=(Pt(1)-An)/We,jr=S.duration?1e3*S.duration:1e3*Do*.8;function $a(){var ei=(Date.now()-nm)/jr,Va=qs(ei)*Do;ei<=1?(this._flyToFrame=H($a,this),this._move(this.unproject(R.add(O.subtract(R).multiplyBy(If(Va)/De)),ae),this.getScaleZoom(me/Ha(Va),ae),{flyTo:!0})):this._move(d,v)._moveEnd(!0)}return this._moveStart(!0,S.noMoveStart),$a.call(this),this},flyToBounds:function(d,v){var S=this._getBoundsCenterZoom(d,v);return this.flyTo(S.center,S.zoom,v)},setMaxBounds:function(d){return d=fe(d),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),d.isValid()?(this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(d){var v=this.options.minZoom;return this.options.minZoom=d,this._loaded&&v!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var v=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&v!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,v){this._enforcingBounds=!0;var S=this.getCenter(),R=this._limitCenter(S,this._zoom,fe(d));return S.equals(R)||this.panTo(R,v),this._enforcingBounds=!1,this},panInside:function(d,v){v=v||{};var S=se(v.paddingTopLeft||v.padding||[0,0]),R=se(v.paddingBottomRight||v.padding||[0,0]),O=this.project(this.getCenter()),j=this.project(d),ae=this.getPixelBounds(),me=Q([ae.min.add(S),ae.max.subtract(R)]),Te=me.getSize();if(!me.contains(j)){this._enforcingBounds=!0;var De=j.subtract(me.getCenter()),We=me.extend(j).getSize().subtract(Te);O.x+=De.x<0?-We.x:We.x,O.y+=De.y<0?-We.y:We.y,this.panTo(this.unproject(O),v),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=r({animate:!1,pan:!0},d===!0?{animate:!0}:d);var v=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var S=this.getSize(),R=v.divideBy(2).round(),O=S.divideBy(2).round(),j=R.subtract(O);return!j.x&&!j.y?this:(d.animate&&d.pan?this.panBy(j):(d.pan&&this._rawPanBy(j),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:v,newSize:S}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=r({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var v=o(this._handleGeolocationResponse,this),S=o(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(v,S,d):navigator.geolocation.getCurrentPosition(v,S,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(this._container._leaflet_id){var v=d.code,S=d.message||(v===1?"permission denied":v===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:v,message:"Geolocation error: "+S+"."})}},_handleGeolocationResponse:function(d){if(this._container._leaflet_id){var v=d.coords.latitude,S=d.coords.longitude,R=new pe(v,S),O=R.toBounds(d.coords.accuracy*2),j=this._locateOptions;if(j.setView){var ae=this.getBoundsZoom(O);this.setView(R,j.maxZoom?Math.min(ae,j.maxZoom):ae)}var me={latlng:R,bounds:O,timestamp:d.timestamp};for(var Te in d.coords)typeof d.coords[Te]=="number"&&(me[Te]=d.coords[Te]);this.fire("locationfound",me)}},addHandler:function(d,v){if(!v)return this;var S=this[d]=new v(this);return this._handlers.push(S),this.options[d]&&S.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),_i(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Y(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)_i(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,v){var S="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),R=Rt("div",S,v||this._mapPane);return d&&(this._panes[d]=R),R},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),v=this.unproject(d.getBottomLeft()),S=this.unproject(d.getTopRight());return new _e(v,S)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,v,S){d=fe(d),S=se(S||[0,0]);var R=this.getZoom()||0,O=this.getMinZoom(),j=this.getMaxZoom(),ae=d.getNorthWest(),me=d.getSouthEast(),Te=this.getSize().subtract(S),De=Q(this.project(me,R),this.project(ae,R)).getSize(),We=nt.any3d?this.options.zoomSnap:1,ut=Te.x/De.x,Pt=Te.y/De.y,qi=v?Math.max(ut,Pt):Math.min(ut,Pt);return R=this.getScaleZoom(qi,R),We&&(R=Math.round(R/(We/100))*(We/100),R=v?Math.ceil(R/We)*We:Math.floor(R/We)*We),Math.max(O,Math.min(j,R))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new J(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,v){var S=this._getTopLeftPoint(d,v);return new te(S,S.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,v){var S=this.options.crs;return v=v===void 0?this._zoom:v,S.scale(d)/S.scale(v)},getScaleZoom:function(d,v){var S=this.options.crs;v=v===void 0?this._zoom:v;var R=S.zoom(d*S.scale(v));return isNaN(R)?1/0:R},project:function(d,v){return v=v===void 0?this._zoom:v,this.options.crs.latLngToPoint(Ce(d),v)},unproject:function(d,v){return v=v===void 0?this._zoom:v,this.options.crs.pointToLatLng(se(d),v)},layerPointToLatLng:function(d){var v=se(d).add(this.getPixelOrigin());return this.unproject(v)},latLngToLayerPoint:function(d){var v=this.project(Ce(d))._round();return v._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(Ce(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(fe(d))},distance:function(d,v){return this.options.crs.distance(Ce(d),Ce(v))},containerPointToLayerPoint:function(d){return se(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return se(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var v=this.containerPointToLayerPoint(se(d));return this.layerPointToLatLng(v)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ce(d)))},mouseEventToContainerPoint:function(d){return rc(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var v=this._container=yr(d);if(v){if(v._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Tt(v,"scroll",this._onScroll,this),this._containerId=l(v)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&nt.any3d,bt(d,"leaflet-container"+(nt.touch?" leaflet-touch":"")+(nt.retina?" leaflet-retina":"")+(nt.ielt9?" leaflet-oldie":"")+(nt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var v=Ql(d,"position");v!=="absolute"&&v!=="relative"&&v!=="fixed"&&v!=="sticky"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ki(this._mapPane,new J(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(bt(d.markerPane,"leaflet-zoom-hide"),bt(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,v,S){ki(this._mapPane,new J(0,0));var R=!this._loaded;this._loaded=!0,v=this._limitZoom(v),this.fire("viewprereset");var O=this._zoom!==v;this._moveStart(O,S)._move(d,v)._moveEnd(O),this.fire("viewreset"),R&&this.fire("load")},_moveStart:function(d,v){return d&&this.fire("zoomstart"),v||this.fire("movestart"),this},_move:function(d,v,S,R){v===void 0&&(v=this._zoom);var O=this._zoom!==v;return this._zoom=v,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),R?S&&S.pinch&&this.fire("zoom",S):((O||S&&S.pinch)&&this.fire("zoom",S),this.fire("move",S)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Y(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){ki(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[l(this._container)]=this;var v=d?oi:Tt;v(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&v(window,"resize",this._onResize,this),nt.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Y(this._resizeRequest),this._resizeRequest=H(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,v){for(var S=[],R,O=v==="mouseout"||v==="mouseover",j=d.target||d.srcElement,ae=!1;j;){if(R=this._targets[l(j)],R&&(v==="click"||v==="preclick")&&this._draggableMoved(R)){ae=!0;break}if(R&&R.listens(v,!0)&&(O&&!sc(j,d)||(S.push(R),O))||j===this._container)break;j=j.parentNode}return!S.length&&!ae&&!O&&this.listens(v,!0)&&(S=[this]),S},_isClickDisabled:function(d){for(;d&&d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var v=d.target||d.srcElement;if(!(!this._loaded||v._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(v))){var S=d.type;S==="mousedown"&&La(v),this._fireDOMEvent(d,S)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,v,S){if(d.type==="click"){var R=r({},d);R.type="preclick",this._fireDOMEvent(R,R.type,S)}var O=this._findEventTargets(d,v);if(S){for(var j=[],ae=0;ae<S.length;ae++)S[ae].listens(v,!0)&&j.push(S[ae]);O=j.concat(O)}if(O.length){v==="contextmenu"&&Ci(d);var me=O[0],Te={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var De=me.getLatLng&&(!me._radius||me._radius<=10);Te.containerPoint=De?this.latLngToContainerPoint(me.getLatLng()):this.mouseEventToContainerPoint(d),Te.layerPoint=this.containerPointToLayerPoint(Te.containerPoint),Te.latlng=De?me.getLatLng():this.layerPointToLatLng(Te.layerPoint)}for(ae=0;ae<O.length;ae++)if(O[ae].fire(v,Te,!0),Te.originalEvent._stopped||O[ae].options.bubblingMouseEvents===!1&&I(this._mouseEvents,v)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,v=this._handlers.length;d<v;d++)this._handlers[d].disable()},whenReady:function(d,v){return this._loaded?d.call(v||this,{target:this}):this.on("load",d,v),this},_getMapPanePos:function(){return hs(this._mapPane)||new J(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,v){var S=d&&v!==void 0?this._getNewPixelOrigin(d,v):this.getPixelOrigin();return S.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,v){var S=this.getSize()._divideBy(2);return this.project(d,v)._subtract(S)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,v,S){var R=this._getNewPixelOrigin(S,v);return this.project(d,v)._subtract(R)},_latLngBoundsToNewLayerBounds:function(d,v,S){var R=this._getNewPixelOrigin(S,v);return Q([this.project(d.getSouthWest(),v)._subtract(R),this.project(d.getNorthWest(),v)._subtract(R),this.project(d.getSouthEast(),v)._subtract(R),this.project(d.getNorthEast(),v)._subtract(R)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,v,S){if(!S)return d;var R=this.project(d,v),O=this.getSize().divideBy(2),j=new te(R.subtract(O),R.add(O)),ae=this._getBoundsOffset(j,S,v);return Math.abs(ae.x)<=1&&Math.abs(ae.y)<=1?d:this.unproject(R.add(ae),v)},_limitOffset:function(d,v){if(!v)return d;var S=this.getPixelBounds(),R=new te(S.min.add(d),S.max.add(d));return d.add(this._getBoundsOffset(R,v))},_getBoundsOffset:function(d,v,S){var R=Q(this.project(v.getNorthEast(),S),this.project(v.getSouthWest(),S)),O=R.min.subtract(d.min),j=R.max.subtract(d.max),ae=this._rebound(O.x,-j.x),me=this._rebound(O.y,-j.y);return new J(ae,me)},_rebound:function(d,v){return d+v>0?Math.round(d-v)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(v))},_limitZoom:function(d){var v=this.getMinZoom(),S=this.getMaxZoom(),R=nt.any3d?this.options.zoomSnap:1;return R&&(d=Math.round(d/R)*R),Math.max(v,Math.min(S,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){di(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,v){var S=this._getCenterOffset(d)._trunc();return(v&&v.animate)!==!0&&!this.getSize().contains(S)?!1:(this.panBy(S,v),!0)},_createAnimProxy:function(){var d=this._proxy=Rt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(v){var S=of,R=this._proxy.style[S];_r(this._proxy,this.project(v.center,v.zoom),this.getZoomScale(v.zoom,1)),R===this._proxy.style[S]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){_i(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),v=this.getZoom();_r(this._proxy,this.project(d,v),this.getZoomScale(v,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,v,S){if(this._animatingZoom)return!0;if(S=S||{},!this._zoomAnimated||S.animate===!1||this._nothingToAnimate()||Math.abs(v-this._zoom)>this.options.zoomAnimationThreshold)return!1;var R=this.getZoomScale(v),O=this._getCenterOffset(d)._divideBy(1-1/R);return S.animate!==!0&&!this.getSize().contains(O)?!1:(H(function(){this._moveStart(!0,S.noMoveStart||!1)._animateZoom(d,v,!0)},this),!0)},_animateZoom:function(d,v,S,R){this._mapPane&&(S&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=v,bt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:v,noUpdate:R}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&di(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function zs(d,v){return new Bt(d,v)}var Gn=le.extend({options:{position:"topright"},initialize:function(d){_(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var v=this._map;return v&&v.removeControl(this),this.options.position=d,v&&v.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var v=this._container=this.onAdd(d),S=this.getPosition(),R=d._controlCorners[S];return bt(v,"leaflet-control"),S.indexOf("bottom")!==-1?R.insertBefore(v,R.firstChild):R.appendChild(v),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(_i(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),Gs=function(d){return new Gn(d)};Bt.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},v="leaflet-",S=this._controlContainer=Rt("div",v+"control-container",this._container);function R(O,j){var ae=v+O+" "+v+j;d[O+j]=Rt("div",ae,S)}R("top","left"),R("top","right"),R("bottom","left"),R("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)_i(this._controlCorners[d]);_i(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var uf=Gn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,v,S,R){return S<R?-1:R<S?1:0}},initialize:function(d,v,S){_(this,S),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var R in d)this._addLayer(d[R],R);for(R in v)this._addLayer(v[R],R,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var v=0;v<this._layers.length;v++)this._layers[v].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return Gn.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,v){return this._addLayer(d,v),this._map?this._update():this},addOverlay:function(d,v){return this._addLayer(d,v,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var v=this._getLayer(l(d));return v&&this._layers.splice(this._layers.indexOf(v),1),this._map?this._update():this},expand:function(){bt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(bt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):di(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return di(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",v=this._container=Rt("div",d),S=this.options.collapsed;v.setAttribute("aria-haspopup",!0),nc(v),Lu(v);var R=this._section=Rt("section",d+"-list");S&&(this._map.on("click",this.collapse,this),Tt(v,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var O=this._layersLink=Rt("a",d+"-toggle",v);O.href="#",O.title="Layers",O.setAttribute("role","button"),Tt(O,{keydown:function(j){j.keyCode===13&&this._expandSafely()},click:function(j){Ci(j),this._expandSafely()}},this),S||this.expand(),this._baseLayersList=Rt("div",d+"-base",R),this._separator=Rt("div",d+"-separator",R),this._overlaysList=Rt("div",d+"-overlays",R),v.appendChild(R)},_getLayer:function(d){for(var v=0;v<this._layers.length;v++)if(this._layers[v]&&l(this._layers[v].layer)===d)return this._layers[v]},_addLayer:function(d,v,S){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:v,overlay:S}),this.options.sortLayers&&this._layers.sort(o(function(R,O){return this.options.sortFunction(R.layer,O.layer,R.name,O.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Su(this._baseLayersList),Su(this._overlaysList),this._layerControlInputs=[];var d,v,S,R,O=0;for(S=0;S<this._layers.length;S++)R=this._layers[S],this._addItem(R),v=v||R.overlay,d=d||!R.overlay,O+=R.overlay?0:1;return this.options.hideSingleBase&&(d=d&&O>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=v&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var v=this._getLayer(l(d.target)),S=v.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;S&&this._map.fire(S,v)},_createRadioElement:function(d,v){var S='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(v?' checked="checked"':"")+"/>",R=document.createElement("div");return R.innerHTML=S,R.firstChild},_addItem:function(d){var v=document.createElement("label"),S=this._map.hasLayer(d.layer),R;d.overlay?(R=document.createElement("input"),R.type="checkbox",R.className="leaflet-control-layers-selector",R.defaultChecked=S):R=this._createRadioElement("leaflet-base-layers_"+l(this),S),this._layerControlInputs.push(R),R.layerId=l(d.layer),Tt(R,"click",this._onInputClick,this);var O=document.createElement("span");O.innerHTML=" "+d.name;var j=document.createElement("span");v.appendChild(j),j.appendChild(R),j.appendChild(O);var ae=d.overlay?this._overlaysList:this._baseLayersList;return ae.appendChild(v),this._checkDisabledLayers(),v},_onInputClick:function(){if(!this._preventClick){var d=this._layerControlInputs,v,S,R=[],O=[];this._handlingClick=!0;for(var j=d.length-1;j>=0;j--)v=d[j],S=this._getLayer(v.layerId).layer,v.checked?R.push(S):v.checked||O.push(S);for(j=0;j<O.length;j++)this._map.hasLayer(O[j])&&this._map.removeLayer(O[j]);for(j=0;j<R.length;j++)this._map.hasLayer(R[j])||this._map.addLayer(R[j]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,v,S,R=this._map.getZoom(),O=d.length-1;O>=0;O--)v=d[O],S=this._getLayer(v.layerId).layer,v.disabled=S.options.minZoom!==void 0&&R<S.options.minZoom||S.options.maxZoom!==void 0&&R>S.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var d=this._section;this._preventClick=!0,Tt(d,"click",Ci),this.expand();var v=this;setTimeout(function(){oi(d,"click",Ci),v._preventClick=!1})}}),Du=function(d,v,S){return new uf(d,v,S)},Ia=Gn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var v="leaflet-control-zoom",S=Rt("div",v+" leaflet-bar"),R=this.options;return this._zoomInButton=this._createButton(R.zoomInText,R.zoomInTitle,v+"-in",S,this._zoomIn),this._zoomOutButton=this._createButton(R.zoomOutText,R.zoomOutTitle,v+"-out",S,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),S},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,v,S,R,O){var j=Rt("a",S,R);return j.innerHTML=d,j.href="#",j.title=v,j.setAttribute("role","button"),j.setAttribute("aria-label",v),nc(j),Tt(j,"click",wr),Tt(j,"click",O,this),Tt(j,"click",this._refocusOnMap,this),j},_updateDisabled:function(){var d=this._map,v="leaflet-disabled";di(this._zoomInButton,v),di(this._zoomOutButton,v),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(bt(this._zoomOutButton,v),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(bt(this._zoomInButton,v),this._zoomInButton.setAttribute("aria-disabled","true"))}});Bt.mergeOptions({zoomControl:!0}),Bt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ia,this.addControl(this.zoomControl))});var Fg=function(d){return new Ia(d)},Rn=Gn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var v="leaflet-control-scale",S=Rt("div",v),R=this.options;return this._addScales(R,v+"-line",S),d.on(R.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),S},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,v,S){d.metric&&(this._mScale=Rt("div",v,S)),d.imperial&&(this._iScale=Rt("div",v,S))},_update:function(){var d=this._map,v=d.getSize().y/2,S=d.distance(d.containerPointToLatLng([0,v]),d.containerPointToLatLng([this.options.maxWidth,v]));this._updateScales(S)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var v=this._getRoundNum(d),S=v<1e3?v+" m":v/1e3+" km";this._updateScale(this._mScale,S,v/d)},_updateImperial:function(d){var v=d*3.2808399,S,R,O;v>5280?(S=v/5280,R=this._getRoundNum(S),this._updateScale(this._iScale,R+" mi",R/S)):(O=this._getRoundNum(v),this._updateScale(this._iScale,O+" ft",O/v))},_updateScale:function(d,v,S){d.style.width=Math.round(this.options.maxWidth*S)+"px",d.innerHTML=v},_getRoundNum:function(d){var v=Math.pow(10,(Math.floor(d)+"").length-1),S=d/v;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:1,v*S}}),Pa=function(d){return new Rn(d)},hf='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ro=Gn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(nt.inlineSvg?hf+" ":"")+"Leaflet</a>"},initialize:function(d){_(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=Rt("div","leaflet-control-attribution"),nc(this._container);for(var v in d._layers)d._layers[v].getAttribution&&this.addAttribution(d._layers[v].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(this._map){var d=[];for(var v in this._attributions)this._attributions[v]&&d.push(v);var S=[];this.options.prefix&&S.push(this.options.prefix),d.length&&S.push(d.join(", ")),this._container.innerHTML=S.join(' <span aria-hidden="true">|</span> ')}}});Bt.mergeOptions({attributionControl:!0}),Bt.addInitHook(function(){this.options.attributionControl&&new Ro().addTo(this)});var P_=function(d){return new Ro(d)};Gn.Layers=uf,Gn.Zoom=Ia,Gn.Scale=Rn,Gn.Attribution=Ro,Gs.layers=Du,Gs.zoom=Fg,Gs.scale=Pa,Gs.attribution=P_;var Qn=le.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Qn.addTo=function(d,v){return d.addHandler(v,this),this};var df={Events:ie},Da=nt.touch?"touchstart mousedown":"mousedown",Tr=ne.extend({options:{clickTolerance:3},initialize:function(d,v,S,R){_(this,R),this._element=d,this._dragStartTarget=v||d,this._preventOutline=S},enable:function(){this._enabled||(Tt(this._dragStartTarget,Da,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Tr._dragging===this&&this.finishDrag(!0),oi(this._dragStartTarget,Da,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(this._enabled&&(this._moved=!1,!Ca(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){Tr._dragging===this&&this.finishDrag();return}if(!(Tr._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(Tr._dragging=this,this._preventOutline&&La(this._element),Cu(),$t(),!this._moving)){this.fire("down");var v=d.touches?d.touches[0]:d,S=ds(this._element);this._startPoint=new J(v.clientX,v.clientY),this._startPos=hs(this._element),this._parentScale=zr(S);var R=d.type==="mousedown";Tt(document,R?"mousemove":"touchmove",this._onMove,this),Tt(document,R?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var v=d.touches&&d.touches.length===1?d.touches[0]:d,S=new J(v.clientX,v.clientY)._subtract(this._startPoint);!S.x&&!S.y||Math.abs(S.x)+Math.abs(S.y)<this.options.clickTolerance||(S.x/=this._parentScale.x,S.y/=this._parentScale.y,Ci(d),this._moved||(this.fire("dragstart"),this._moved=!0,bt(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),bt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(S),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),ki(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(d){di(document.body,"leaflet-dragging"),this._lastTarget&&(di(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),oi(document,"mousemove touchmove",this._onMove,this),oi(document,"mouseup touchend touchcancel",this._onUp,this),Ru(),Aa();var v=this._moved&&this._moving;this._moving=!1,Tr._dragging=!1,v&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)})}});function ff(d,v,S){var R,O=[1,4,2,8],j,ae,me,Te,De,We,ut,Pt;for(j=0,We=d.length;j<We;j++)d[j]._code=Ao(d[j],v);for(me=0;me<4;me++){for(ut=O[me],R=[],j=0,We=d.length,ae=We-1;j<We;ae=j++)Te=d[j],De=d[ae],Te._code&ut?De._code&ut||(Pt=ku(De,Te,ut,v,S),Pt._code=Ao(Pt,v),R.push(Pt)):(De._code&ut&&(Pt=ku(De,Te,ut,v,S),Pt._code=Ao(Pt,v),R.push(Pt)),R.push(Te));d=R}return d}function Bg(d,v){var S,R,O,j,ae,me,Te,De,We;if(!d||d.length===0)throw new Error("latlngs not passed");er(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var ut=Ce([0,0]),Pt=fe(d),qi=Pt.getNorthWest().distanceTo(Pt.getSouthWest())*Pt.getNorthEast().distanceTo(Pt.getNorthWest());qi<1700&&(ut=pf(d));var Gi=d.length,$n=[];for(S=0;S<Gi;S++){var An=Ce(d[S]);$n.push(v.project(Ce([An.lat-ut.lat,An.lng-ut.lng])))}for(me=Te=De=0,S=0,R=Gi-1;S<Gi;R=S++)O=$n[S],j=$n[R],ae=O.y*j.x-j.y*O.x,Te+=(O.x+j.x)*ae,De+=(O.y+j.y)*ae,me+=ae*3;me===0?We=$n[0]:We=[Te/me,De/me];var Ha=v.unproject(se(We));return Ce([Ha.lat+ut.lat,Ha.lng+ut.lng])}function pf(d){for(var v=0,S=0,R=0,O=0;O<d.length;O++){var j=Ce(d[O]);v+=j.lat,S+=j.lng,R++}return Ce([v/R,S/R])}var D_={__proto__:null,clipPolygon:ff,polygonCenter:Bg,centroid:pf};function Ou(d,v){if(!v||!d.length)return d.slice();var S=v*v;return d=M_(d,S),d=k_(d,S),d}function Ug(d,v,S){return Math.sqrt(Lo(d,v,S,!0))}function O_(d,v,S){return Lo(d,v,S)}function k_(d,v){var S=d.length,R=typeof Uint8Array<"u"?Uint8Array:Array,O=new R(S);O[0]=O[S-1]=1,gf(d,O,v,0,S-1);var j,ae=[];for(j=0;j<S;j++)O[j]&&ae.push(d[j]);return ae}function gf(d,v,S,R,O){var j=0,ae,me,Te;for(me=R+1;me<=O-1;me++)Te=Lo(d[me],d[R],d[O],!0),Te>j&&(ae=me,j=Te);j>S&&(v[ae]=1,gf(d,v,S,R,ae),gf(d,v,S,ae,O))}function M_(d,v){for(var S=[d[0]],R=1,O=0,j=d.length;R<j;R++)N_(d[R],d[O])>v&&(S.push(d[R]),O=R);return O<j-1&&S.push(d[j-1]),S}var mf;function zg(d,v,S,R,O){var j=R?mf:Ao(d,S),ae=Ao(v,S),me,Te,De;for(mf=ae;;){if(!(j|ae))return[d,v];if(j&ae)return!1;me=j||ae,Te=ku(d,v,me,S,O),De=Ao(Te,S),me===j?(d=Te,j=De):(v=Te,ae=De)}}function ku(d,v,S,R,O){var j=v.x-d.x,ae=v.y-d.y,me=R.min,Te=R.max,De,We;return S&8?(De=d.x+j*(Te.y-d.y)/ae,We=Te.y):S&4?(De=d.x+j*(me.y-d.y)/ae,We=me.y):S&2?(De=Te.x,We=d.y+ae*(Te.x-d.x)/j):S&1&&(De=me.x,We=d.y+ae*(me.x-d.x)/j),new J(De,We,O)}function Ao(d,v){var S=0;return d.x<v.min.x?S|=1:d.x>v.max.x&&(S|=2),d.y<v.min.y?S|=4:d.y>v.max.y&&(S|=8),S}function N_(d,v){var S=v.x-d.x,R=v.y-d.y;return S*S+R*R}function Lo(d,v,S,R){var O=v.x,j=v.y,ae=S.x-O,me=S.y-j,Te=ae*ae+me*me,De;return Te>0&&(De=((d.x-O)*ae+(d.y-j)*me)/Te,De>1?(O=S.x,j=S.y):De>0&&(O+=ae*De,j+=me*De)),ae=d.x-O,me=d.y-j,R?ae*ae+me*me:new J(O,j)}function er(d){return!C(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function Gg(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),er(d)}function Hg(d,v){var S,R,O,j,ae,me,Te,De;if(!d||d.length===0)throw new Error("latlngs not passed");er(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var We=Ce([0,0]),ut=fe(d),Pt=ut.getNorthWest().distanceTo(ut.getSouthWest())*ut.getNorthEast().distanceTo(ut.getNorthWest());Pt<1700&&(We=pf(d));var qi=d.length,Gi=[];for(S=0;S<qi;S++){var $n=Ce(d[S]);Gi.push(v.project(Ce([$n.lat-We.lat,$n.lng-We.lng])))}for(S=0,R=0;S<qi-1;S++)R+=Gi[S].distanceTo(Gi[S+1])/2;if(R===0)De=Gi[0];else for(S=0,j=0;S<qi-1;S++)if(ae=Gi[S],me=Gi[S+1],O=ae.distanceTo(me),j+=O,j>R){Te=(j-R)/O,De=[me.x-Te*(me.x-ae.x),me.y-Te*(me.y-ae.y)];break}var An=v.unproject(se(De));return Ce([An.lat+We.lat,An.lng+We.lng])}var $g={__proto__:null,simplify:Ou,pointToSegmentDistance:Ug,closestPointOnSegment:O_,clipSegment:zg,_getEdgeIntersection:ku,_getBitCode:Ao,_sqClosestPointOnSegment:Lo,isFlat:er,_flat:Gg,polylineCenter:Hg},vf={project:function(d){return new J(d.lng,d.lat)},unproject:function(d){return new pe(d.y,d.x)},bounds:new te([-180,-90],[180,90])},yf={R:6378137,R_MINOR:6356752314245179e-9,bounds:new te([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var v=Math.PI/180,S=this.R,R=d.lat*v,O=this.R_MINOR/S,j=Math.sqrt(1-O*O),ae=j*Math.sin(R),me=Math.tan(Math.PI/4-R/2)/Math.pow((1-ae)/(1+ae),j/2);return R=-S*Math.log(Math.max(me,1e-10)),new J(d.lng*v*S,R)},unproject:function(d){for(var v=180/Math.PI,S=this.R,R=this.R_MINOR/S,O=Math.sqrt(1-R*R),j=Math.exp(-d.y/S),ae=Math.PI/2-2*Math.atan(j),me=0,Te=.1,De;me<15&&Math.abs(Te)>1e-7;me++)De=O*Math.sin(ae),De=Math.pow((1-De)/(1+De),O/2),Te=Math.PI/2-2*Math.atan(j*De)-ae,ae+=Te;return new pe(ae*v,d.x*v/S)}},F_={__proto__:null,LonLat:vf,Mercator:yf,SphericalMercator:Ke},B_=r({},Le,{code:"EPSG:3395",projection:yf,transformation:function(){var d=.5/(Math.PI*yf.R);return ct(d,.5,-d,.5)}()}),Vg=r({},Le,{code:"EPSG:4326",projection:vf,transformation:ct(1/180,1,-1/180,.5)}),U_=r({},xe,{projection:vf,transformation:ct(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,v){var S=v.lng-d.lng,R=v.lat-d.lat;return Math.sqrt(S*S+R*R)},infinite:!0});xe.Earth=Le,xe.EPSG3395=B_,xe.EPSG3857=Ht,xe.EPSG900913=Vt,xe.EPSG4326=Vg,xe.Simple=U_;var Sr=ne.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[l(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[l(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var v=d.target;if(v.hasLayer(this)){if(this._map=v,this._zoomAnimated=v._zoomAnimated,this.getEvents){var S=this.getEvents();v.on(S,this),this.once("remove",function(){v.off(S,this)},this)}this.onAdd(v),this.fire("add"),v.fire("layeradd",{layer:this})}}});Bt.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var v=l(d);return this._layers[v]?this:(this._layers[v]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var v=l(d);return this._layers[v]?(this._loaded&&d.onRemove(this),delete this._layers[v],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return l(d)in this._layers},eachLayer:function(d,v){for(var S in this._layers)d.call(v,this._layers[S]);return this},_addLayers:function(d){d=d?C(d)?d:[d]:[];for(var v=0,S=d.length;v<S;v++)this.addLayer(d[v])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[l(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var v=l(d);this._zoomBoundLayers[v]&&(delete this._zoomBoundLayers[v],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,v=-1/0,S=this._getZoomSpan();for(var R in this._zoomBoundLayers){var O=this._zoomBoundLayers[R].options;d=O.minZoom===void 0?d:Math.min(d,O.minZoom),v=O.maxZoom===void 0?v:Math.max(v,O.maxZoom)}this._layersMaxZoom=v===-1/0?void 0:v,this._layersMinZoom=d===1/0?void 0:d,S!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Hs=Sr.extend({initialize:function(d,v){_(this,v),this._layers={};var S,R;if(d)for(S=0,R=d.length;S<R;S++)this.addLayer(d[S])},addLayer:function(d){var v=this.getLayerId(d);return this._layers[v]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var v=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[v]&&this._map.removeLayer(this._layers[v]),delete this._layers[v],this},hasLayer:function(d){var v=typeof d=="number"?d:this.getLayerId(d);return v in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var v=Array.prototype.slice.call(arguments,1),S,R;for(S in this._layers)R=this._layers[S],R[d]&&R[d].apply(R,v);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,v){for(var S in this._layers)d.call(v,this._layers[S]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return l(d)}}),oc=function(d,v){return new Hs(d,v)},fs=Hs.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),Hs.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),Hs.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new _e;for(var v in this._layers){var S=this._layers[v];d.extend(S.getBounds?S.getBounds():S.getLatLng())}return d}}),jg=function(d,v){return new fs(d,v)},Io=le.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){_(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,v){var S=this._getIconUrl(d);if(!S){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var R=this._createImg(S,v&&v.tagName==="IMG"?v:null);return this._setIconStyles(R,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(R.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),R},_setIconStyles:function(d,v){var S=this.options,R=S[v+"Size"];typeof R=="number"&&(R=[R,R]);var O=se(R),j=se(v==="shadow"&&S.shadowAnchor||S.iconAnchor||O&&O.divideBy(2,!0));d.className="leaflet-marker-"+v+" "+(S.className||""),j&&(d.style.marginLeft=-j.x+"px",d.style.marginTop=-j.y+"px"),O&&(d.style.width=O.x+"px",d.style.height=O.y+"px")},_createImg:function(d,v){return v=v||document.createElement("img"),v.src=d,v},_getIconUrl:function(d){return nt.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function Wg(d){return new Io(d)}var Oa=Io.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof Oa.imagePath!="string"&&(Oa.imagePath=this._detectIconPath()),(this.options.imagePath||Oa.imagePath)+Io.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var v=function(S,R,O){var j=R.exec(S);return j&&j[O]};return d=v(d,/^url\((['"])?(.+)\1\)$/,2),d&&v(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=Rt("div","leaflet-default-icon-path",document.body),v=Ql(d,"background-image")||Ql(d,"backgroundImage");if(document.body.removeChild(d),v=this._stripUrl(v),v)return v;var S=document.querySelector('link[href$="leaflet.css"]');return S?S.href.substring(0,S.href.length-11-1):""}}),_f=Qn.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new Tr(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),bt(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&di(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var v=this._marker,S=v._map,R=this._marker.options.autoPanSpeed,O=this._marker.options.autoPanPadding,j=hs(v._icon),ae=S.getPixelBounds(),me=S.getPixelOrigin(),Te=Q(ae.min._subtract(me).add(O),ae.max._subtract(me).subtract(O));if(!Te.contains(j)){var De=se((Math.max(Te.max.x,j.x)-Te.max.x)/(ae.max.x-Te.max.x)-(Math.min(Te.min.x,j.x)-Te.min.x)/(ae.min.x-Te.min.x),(Math.max(Te.max.y,j.y)-Te.max.y)/(ae.max.y-Te.max.y)-(Math.min(Te.min.y,j.y)-Te.min.y)/(ae.min.y-Te.min.y)).multiplyBy(R);S.panBy(De,{animate:!1}),this._draggable._newPos._add(De),this._draggable._startPos._add(De),ki(v._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=H(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&(Y(this._panRequest),this._panRequest=H(this._adjustPan.bind(this,d)))},_onDrag:function(d){var v=this._marker,S=v._shadow,R=hs(v._icon),O=v._map.layerPointToLatLng(R);S&&ki(S,R),v._latlng=O,d.latlng=O,d.oldLatLng=this._oldLatLng,v.fire("move",d).fire("drag",d)},_onDragEnd:function(d){Y(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),ps=Sr.extend({options:{icon:new Oa,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,v){_(this,v),this._latlng=Ce(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var v=this._latlng;return this._latlng=Ce(d),this.update(),this.fire("move",{oldLatLng:v,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,v="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),S=d.icon.createIcon(this._icon),R=!1;S!==this._icon&&(this._icon&&this._removeIcon(),R=!0,d.title&&(S.title=d.title),S.tagName==="IMG"&&(S.alt=d.alt||"")),bt(S,v),d.keyboard&&(S.tabIndex="0",S.setAttribute("role","button")),this._icon=S,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Tt(S,"focus",this._panOnFocus,this);var O=d.icon.createShadow(this._shadow),j=!1;O!==this._shadow&&(this._removeShadow(),j=!0),O&&(bt(O,v),O.alt=""),this._shadow=O,d.opacity<1&&this._updateOpacity(),R&&this.getPane().appendChild(this._icon),this._initInteraction(),O&&j&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&oi(this._icon,"focus",this._panOnFocus,this),_i(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&_i(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&ki(this._icon,d),this._shadow&&ki(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var v=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(v)},_initInteraction:function(){if(this.options.interactive&&(bt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),_f)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new _f(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&Cn(this._icon,d),this._shadow&&Cn(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(d){var v=this.options.icon.options,S=v.iconSize?se(v.iconSize):se(0,0),R=v.iconAnchor?se(v.iconAnchor):se(0,0);d.panInside(this._latlng,{paddingTopLeft:R,paddingBottomRight:S.subtract(R)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function z_(d,v){return new ps(d,v)}var $s=Sr.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return _(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Mu=$s.extend({options:{fill:!0,radius:10},initialize:function(d,v){_(this,v),this._latlng=Ce(d),this._radius=this.options.radius},setLatLng:function(d){var v=this._latlng;return this._latlng=Ce(d),this.redraw(),this.fire("move",{oldLatLng:v,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var v=d&&d.radius||this._radius;return $s.prototype.setStyle.call(this,d),this.setRadius(v),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,v=this._radiusY||d,S=this._clickTolerance(),R=[d+S,v+S];this._pxBounds=new te(this._point.subtract(R),this._point.add(R))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function qg(d,v){return new Mu(d,v)}var Nu=Mu.extend({initialize:function(d,v,S){if(typeof v=="number"&&(v=r({},S,{radius:v})),_(this,v),this._latlng=Ce(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new _e(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:$s.prototype.setStyle,_project:function(){var d=this._latlng.lng,v=this._latlng.lat,S=this._map,R=S.options.crs;if(R.distance===Le.distance){var O=Math.PI/180,j=this._mRadius/Le.R/O,ae=S.project([v+j,d]),me=S.project([v-j,d]),Te=ae.add(me).divideBy(2),De=S.unproject(Te).lat,We=Math.acos((Math.cos(j*O)-Math.sin(v*O)*Math.sin(De*O))/(Math.cos(v*O)*Math.cos(De*O)))/O;(isNaN(We)||We===0)&&(We=j/Math.cos(Math.PI/180*v)),this._point=Te.subtract(S.getPixelOrigin()),this._radius=isNaN(We)?0:Te.x-S.project([De,d-We]).x,this._radiusY=Te.y-ae.y}else{var ut=R.unproject(R.project(this._latlng).subtract([this._mRadius,0]));this._point=S.latLngToLayerPoint(this._latlng),this._radius=this._point.x-S.latLngToLayerPoint(ut).x}this._updateBounds()}});function ac(d,v,S){return new Nu(d,v,S)}var Hn=$s.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,v){_(this,v),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var v=1/0,S=null,R=Lo,O,j,ae=0,me=this._parts.length;ae<me;ae++)for(var Te=this._parts[ae],De=1,We=Te.length;De<We;De++){O=Te[De-1],j=Te[De];var ut=R(d,O,j,!0);ut<v&&(v=ut,S=R(d,O,j))}return S&&(S.distance=Math.sqrt(v)),S},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Hg(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(d,v){return v=v||this._defaultShape(),d=Ce(d),v.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new _e,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return er(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var v=[],S=er(d),R=0,O=d.length;R<O;R++)S?(v[R]=Ce(d[R]),this._bounds.extend(v[R])):v[R]=this._convertLatLngs(d[R]);return v},_project:function(){var d=new te;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),v=new J(d,d);this._rawPxBounds&&(this._pxBounds=new te([this._rawPxBounds.min.subtract(v),this._rawPxBounds.max.add(v)]))},_projectLatlngs:function(d,v,S){var R=d[0]instanceof pe,O=d.length,j,ae;if(R){for(ae=[],j=0;j<O;j++)ae[j]=this._map.latLngToLayerPoint(d[j]),S.extend(ae[j]);v.push(ae)}else for(j=0;j<O;j++)this._projectLatlngs(d[j],v,S)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var v=this._parts,S,R,O,j,ae,me,Te;for(S=0,O=0,j=this._rings.length;S<j;S++)for(Te=this._rings[S],R=0,ae=Te.length;R<ae-1;R++)me=zg(Te[R],Te[R+1],d,R,!0),me&&(v[O]=v[O]||[],v[O].push(me[0]),(me[1]!==Te[R+1]||R===ae-2)&&(v[O].push(me[1]),O++))}},_simplifyPoints:function(){for(var d=this._parts,v=this.options.smoothFactor,S=0,R=d.length;S<R;S++)d[S]=Ou(d[S],v)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,v){var S,R,O,j,ae,me,Te=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(S=0,j=this._parts.length;S<j;S++)for(me=this._parts[S],R=0,ae=me.length,O=ae-1;R<ae;O=R++)if(!(!v&&R===0)&&Ug(d,me[O],me[R])<=Te)return!0;return!1}});function G_(d,v){return new Hn(d,v)}Hn._flat=Gg;var gs=Hn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Bg(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(d){var v=Hn.prototype._convertLatLngs.call(this,d),S=v.length;return S>=2&&v[0]instanceof pe&&v[0].equals(v[S-1])&&v.pop(),v},_setLatLngs:function(d){Hn.prototype._setLatLngs.call(this,d),er(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return er(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,v=this.options.weight,S=new J(v,v);if(d=new te(d.min.subtract(S),d.max.add(S)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var R=0,O=this._rings.length,j;R<O;R++)j=ff(this._rings[R],d,!0),j.length&&this._parts.push(j)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var v=!1,S,R,O,j,ae,me,Te,De;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(j=0,Te=this._parts.length;j<Te;j++)for(S=this._parts[j],ae=0,De=S.length,me=De-1;ae<De;me=ae++)R=S[ae],O=S[me],R.y>d.y!=O.y>d.y&&d.x<(O.x-R.x)*(d.y-R.y)/(O.y-R.y)+R.x&&(v=!v);return v||Hn.prototype._containsPoint.call(this,d,!0)}});function H_(d,v){return new gs(d,v)}var Hr=fs.extend({initialize:function(d,v){_(this,v),this._layers={},d&&this.addData(d)},addData:function(d){var v=C(d)?d:d.features,S,R,O;if(v){for(S=0,R=v.length;S<R;S++)O=v[S],(O.geometries||O.geometry||O.features||O.coordinates)&&this.addData(O);return this}var j=this.options;if(j.filter&&!j.filter(d))return this;var ae=ka(d,j);return ae?(ae.feature=Gu(d),ae.defaultOptions=ae.options,this.resetStyle(ae),j.onEachFeature&&j.onEachFeature(d,ae),this.addLayer(ae)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=r({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(v){this._setLayerStyle(v,d)},this)},_setLayerStyle:function(d,v){d.setStyle&&(typeof v=="function"&&(v=v(d.feature)),d.setStyle(v))}});function ka(d,v){var S=d.type==="Feature"?d.geometry:d,R=S?S.coordinates:null,O=[],j=v&&v.pointToLayer,ae=v&&v.coordsToLatLng||Bu,me,Te,De,We;if(!R&&!S)return null;switch(S.type){case"Point":return me=ae(R),Fu(j,d,me,v);case"MultiPoint":for(De=0,We=R.length;De<We;De++)me=ae(R[De]),O.push(Fu(j,d,me,v));return new fs(O);case"LineString":case"MultiLineString":return Te=lc(R,S.type==="LineString"?0:1,ae),new Hn(Te,v);case"Polygon":case"MultiPolygon":return Te=lc(R,S.type==="Polygon"?1:2,ae),new gs(Te,v);case"GeometryCollection":for(De=0,We=S.geometries.length;De<We;De++){var ut=ka({geometry:S.geometries[De],type:"Feature",properties:d.properties},v);ut&&O.push(ut)}return new fs(O);case"FeatureCollection":for(De=0,We=S.features.length;De<We;De++){var Pt=ka(S.features[De],v);Pt&&O.push(Pt)}return new fs(O);default:throw new Error("Invalid GeoJSON object.")}}function Fu(d,v,S,R){return d?d(v,S):new ps(S,R&&R.markersInheritOptions&&R)}function Bu(d){return new pe(d[1],d[0],d[2])}function lc(d,v,S){for(var R=[],O=0,j=d.length,ae;O<j;O++)ae=v?lc(d[O],v-1,S):(S||Bu)(d[O]),R.push(ae);return R}function Uu(d,v){return d=Ce(d),d.alt!==void 0?[p(d.lng,v),p(d.lat,v),p(d.alt,v)]:[p(d.lng,v),p(d.lat,v)]}function zu(d,v,S,R){for(var O=[],j=0,ae=d.length;j<ae;j++)O.push(v?zu(d[j],er(d[j])?0:v-1,S,R):Uu(d[j],R));return!v&&S&&O.length>0&&O.push(O[0].slice()),O}function Ma(d,v){return d.feature?r({},d.feature,{geometry:v}):Gu(v)}function Gu(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var Ef={toGeoJSON:function(d){return Ma(this,{type:"Point",coordinates:Uu(this.getLatLng(),d)})}};ps.include(Ef),Nu.include(Ef),Mu.include(Ef),Hn.include({toGeoJSON:function(d){var v=!er(this._latlngs),S=zu(this._latlngs,v?1:0,!1,d);return Ma(this,{type:(v?"Multi":"")+"LineString",coordinates:S})}}),gs.include({toGeoJSON:function(d){var v=!er(this._latlngs),S=v&&!er(this._latlngs[0]),R=zu(this._latlngs,S?2:v?1:0,!0,d);return v||(R=[R]),Ma(this,{type:(S?"Multi":"")+"Polygon",coordinates:R})}}),Hs.include({toMultiPoint:function(d){var v=[];return this.eachLayer(function(S){v.push(S.toGeoJSON(d).geometry.coordinates)}),Ma(this,{type:"MultiPoint",coordinates:v})},toGeoJSON:function(d){var v=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(v==="MultiPoint")return this.toMultiPoint(d);var S=v==="GeometryCollection",R=[];return this.eachLayer(function(O){if(O.toGeoJSON){var j=O.toGeoJSON(d);if(S)R.push(j.geometry);else{var ae=Gu(j);ae.type==="FeatureCollection"?R.push.apply(R,ae.features):R.push(ae)}}}),S?Ma(this,{geometries:R,type:"GeometryCollection"}):{type:"FeatureCollection",features:R}}});function Kg(d,v){return new Hr(d,v)}var br=Kg,Vs=Sr.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,v,S){this._url=d,this._bounds=fe(v),_(this,S)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(bt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){_i(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&xa(this._image),this},bringToBack:function(){return this._map&&us(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=fe(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",v=this._image=d?this._url:Rt("img");if(bt(v,"leaflet-image-layer"),this._zoomAnimated&&bt(v,"leaflet-zoom-animated"),this.options.className&&bt(v,this.options.className),v.onselectstart=f,v.onmousemove=f,v.onload=o(this.fire,this,"load"),v.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(v.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=v.src;return}v.src=this._url,v.alt=this.options.alt},_animateZoom:function(d){var v=this._map.getZoomScale(d.zoom),S=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;_r(this._image,S,v)},_reset:function(){var d=this._image,v=new te(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),S=v.getSize();ki(d,v.min),d.style.width=S.x+"px",d.style.height=S.y+"px"},_updateOpacity:function(){Cn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),Zg=function(d,v,S){return new Vs(d,v,S)},wf=Vs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",v=this._image=d?this._url:Rt("video");if(bt(v,"leaflet-image-layer"),this._zoomAnimated&&bt(v,"leaflet-zoom-animated"),this.options.className&&bt(v,this.options.className),v.onselectstart=f,v.onmousemove=f,v.onloadeddata=o(this.fire,this,"load"),d){for(var S=v.getElementsByTagName("source"),R=[],O=0;O<S.length;O++)R.push(S[O].src);this._url=S.length>0?R:[v.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(v.style,"objectFit")&&(v.style.objectFit="fill"),v.autoplay=!!this.options.autoplay,v.loop=!!this.options.loop,v.muted=!!this.options.muted,v.playsInline=!!this.options.playsInline;for(var j=0;j<this._url.length;j++){var ae=Rt("source");ae.src=this._url[j],v.appendChild(ae)}}});function Yg(d,v,S){return new wf(d,v,S)}var Tf=Vs.extend({_initImage:function(){var d=this._image=this._url;bt(d,"leaflet-image-layer"),this._zoomAnimated&&bt(d,"leaflet-zoom-animated"),this.options.className&&bt(d,this.options.className),d.onselectstart=f,d.onmousemove=f}});function Sf(d,v,S){return new Tf(d,v,S)}var $r=Sr.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(d,v){d&&(d instanceof pe||C(d))?(this._latlng=Ce(d),_(this,v)):(_(this,d),this._source=v),this.options.content&&(this._content=this.options.content)},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&Cn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&Cn(this._container,1),this.bringToFront(),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(Cn(this._container,0),this._removeTimeout=setTimeout(o(_i,void 0,this._container),200)):_i(this._container),this.options.interactive&&(di(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=Ce(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&xa(this._container),this},bringToBack:function(){return this._map&&us(this._container),this},_prepareOpen:function(d){var v=this._source;if(!v._map)return!1;if(v instanceof fs){v=null;var S=this._source._layers;for(var R in S)if(S[R]._map){v=S[R];break}if(!v)return!1;this._source=v}if(!d)if(v.getCenter)d=v.getCenter();else if(v.getLatLng)d=v.getLatLng();else if(v.getBounds)d=v.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var d=this._contentNode,v=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof v=="string")d.innerHTML=v;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(v)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var d=this._map.latLngToLayerPoint(this._latlng),v=se(this.options.offset),S=this._getAnchor();this._zoomAnimated?ki(this._container,d.add(S)):v=v.add(d).add(S);var R=this._containerBottom=-v.y,O=this._containerLeft=-Math.round(this._containerWidth/2)+v.x;this._container.style.bottom=R+"px",this._container.style.left=O+"px"}},_getAnchor:function(){return[0,0]}});Bt.include({_initOverlay:function(d,v,S,R){var O=v;return O instanceof d||(O=new d(R).setContent(v)),S&&O.setLatLng(S),O}}),Sr.include({_initOverlay:function(d,v,S,R){var O=S;return O instanceof d?(_(O,R),O._source=this):(O=v&&!R?v:new d(R,this),O.setContent(S)),O}});var Hu=$r.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,$r.prototype.openOn.call(this,d)},onAdd:function(d){$r.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $s||this._source.on("preclick",Gr))},onRemove:function(d){$r.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $s||this._source.off("preclick",Gr))},getEvents:function(){var d=$r.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",v=this._container=Rt("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),S=this._wrapper=Rt("div",d+"-content-wrapper",v);if(this._contentNode=Rt("div",d+"-content",S),nc(v),Lu(this._contentNode),Tt(v,"contextmenu",Gr),this._tipContainer=Rt("div",d+"-tip-container",v),this._tip=Rt("div",d+"-tip",this._tipContainer),this.options.closeButton){var R=this._closeButton=Rt("a",d+"-close-button",v);R.setAttribute("role","button"),R.setAttribute("aria-label","Close popup"),R.href="#close",R.innerHTML='<span aria-hidden="true">&#215;</span>',Tt(R,"click",function(O){Ci(O),this.close()},this)}},_updateLayout:function(){var d=this._contentNode,v=d.style;v.width="",v.whiteSpace="nowrap";var S=d.offsetWidth;S=Math.min(S,this.options.maxWidth),S=Math.max(S,this.options.minWidth),v.width=S+1+"px",v.whiteSpace="",v.height="";var R=d.offsetHeight,O=this.options.maxHeight,j="leaflet-popup-scrolled";O&&R>O?(v.height=O+"px",bt(d,j)):di(d,j),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var v=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),S=this._getAnchor();ki(this._container,v.add(S))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var d=this._map,v=parseInt(Ql(this._container,"marginBottom"),10)||0,S=this._container.offsetHeight+v,R=this._containerWidth,O=new J(this._containerLeft,-S-this._containerBottom);O._add(hs(this._container));var j=d.layerPointToContainerPoint(O),ae=se(this.options.autoPanPadding),me=se(this.options.autoPanPaddingTopLeft||ae),Te=se(this.options.autoPanPaddingBottomRight||ae),De=d.getSize(),We=0,ut=0;j.x+R+Te.x>De.x&&(We=j.x+R-De.x+Te.x),j.x-We-me.x<0&&(We=j.x-me.x),j.y+S+Te.y>De.y&&(ut=j.y+S-De.y+Te.y),j.y-ut-me.y<0&&(ut=j.y-me.y),(We||ut)&&(this.options.keepInView&&(this._autopanning=!0),d.fire("autopanstart").panBy([We,ut]))}},_getAnchor:function(){return se(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Na=function(d,v){return new Hu(d,v)};Bt.mergeOptions({closePopupOnClick:!0}),Bt.include({openPopup:function(d,v,S){return this._initOverlay(Hu,d,v,S).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),Sr.include({bindPopup:function(d,v){return this._popup=this._initOverlay(Hu,this._popup,d,v),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&(this instanceof fs||(this._popup._source=this),this._popup._prepareOpen(d||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){wr(d);var v=d.layer||d.target;if(this._popup._source===v&&!(v instanceof $s)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=v,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var Fa=$r.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){$r.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){$r.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=$r.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",v=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Rt("div",v),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var v,S,R=this._map,O=this._container,j=R.latLngToContainerPoint(R.getCenter()),ae=R.layerPointToContainerPoint(d),me=this.options.direction,Te=O.offsetWidth,De=O.offsetHeight,We=se(this.options.offset),ut=this._getAnchor();me==="top"?(v=Te/2,S=De):me==="bottom"?(v=Te/2,S=0):me==="center"?(v=Te/2,S=De/2):me==="right"?(v=0,S=De/2):me==="left"?(v=Te,S=De/2):ae.x<j.x?(me="right",v=0,S=De/2):(me="left",v=Te+(We.x+ut.x)*2,S=De/2),d=d.subtract(se(v,S,!0)).add(We).add(ut),di(O,"leaflet-tooltip-right"),di(O,"leaflet-tooltip-left"),di(O,"leaflet-tooltip-top"),di(O,"leaflet-tooltip-bottom"),bt(O,"leaflet-tooltip-"+me),ki(O,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&Cn(this._container,d)},_animateZoom:function(d){var v=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(v)},_getAnchor:function(){return se(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),cc=function(d,v){return new Fa(d,v)};Bt.include({openTooltip:function(d,v,S){return this._initOverlay(Fa,d,v,S).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),Sr.include({bindTooltip:function(d,v){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Fa,this._tooltip,d,v),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var v=d?"off":"on",S={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?S.add=this._openTooltip:(S.mouseover=this._openTooltip,S.mouseout=this.closeTooltip,S.click=this._openTooltip,this._map?this._addFocusListeners():S.add=this._addFocusListeners),this._tooltip.options.sticky&&(S.mousemove=this._moveTooltip),this[v](S),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&(this instanceof fs||(this._tooltip._source=this),this._tooltip._prepareOpen(d)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(d){var v=typeof d.getElement=="function"&&d.getElement();v&&(Tt(v,"focus",function(){this._tooltip._source=d,this.openTooltip()},this),Tt(v,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(d){var v=typeof d.getElement=="function"&&d.getElement();v&&v.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(d){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var v=this;this._map.once("moveend",function(){v._openOnceFlag=!1,v._openTooltip(d)});return}this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0)}},_moveTooltip:function(d){var v=d.latlng,S,R;this._tooltip.options.sticky&&d.originalEvent&&(S=this._map.mouseEventToContainerPoint(d.originalEvent),R=this._map.containerPointToLayerPoint(S),v=this._map.layerPointToLatLng(R)),this._tooltip.setLatLng(v)}});var $u=Io.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var v=d&&d.tagName==="DIV"?d:document.createElement("div"),S=this.options;if(S.html instanceof Element?(Su(v),v.appendChild(S.html)):v.innerHTML=S.html!==!1?S.html:"",S.bgPos){var R=se(S.bgPos);v.style.backgroundPosition=-R.x+"px "+-R.y+"px"}return this._setIconStyles(v,"icon"),v},createShadow:function(){return null}});function Xg(d){return new $u(d)}Io.Default=Oa;var js=Sr.extend({options:{tileSize:256,opacity:1,updateWhenIdle:nt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){_(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),_i(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(xa(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(us(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof J?d:new J(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var v=this.getPane().children,S=-d(-1/0,1/0),R=0,O=v.length,j;R<O;R++)j=v[R].style.zIndex,v[R]!==this._container&&j&&(S=d(S,+j));isFinite(S)&&(this.options.zIndex=S+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!nt.ielt9){Cn(this._container,this.options.opacity);var d=+new Date,v=!1,S=!1;for(var R in this._tiles){var O=this._tiles[R];if(!(!O.current||!O.loaded)){var j=Math.min(1,(d-O.loaded)/200);Cn(O.el,j),j<1?v=!0:(O.active?S=!0:this._onOpaqueTile(O),O.active=!0)}}S&&!this._noPrune&&this._pruneTiles(),v&&(Y(this._fadeFrame),this._fadeFrame=H(this._updateOpacity,this))}},_onOpaqueTile:f,_initContainer:function(){this._container||(this._container=Rt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,v=this.options.maxZoom;if(d!==void 0){for(var S in this._levels)S=Number(S),this._levels[S].el.children.length||S===d?(this._levels[S].el.style.zIndex=v-Math.abs(d-S),this._onUpdateLevel(S)):(_i(this._levels[S].el),this._removeTilesAtZoom(S),this._onRemoveLevel(S),delete this._levels[S]);var R=this._levels[d],O=this._map;return R||(R=this._levels[d]={},R.el=Rt("div","leaflet-tile-container leaflet-zoom-animated",this._container),R.el.style.zIndex=v,R.origin=O.project(O.unproject(O.getPixelOrigin()),d).round(),R.zoom=d,this._setZoomTransform(R,O.getCenter(),O.getZoom()),f(R.el.offsetWidth),this._onCreateLevel(R)),this._level=R,R}},_onUpdateLevel:f,_onRemoveLevel:f,_onCreateLevel:f,_pruneTiles:function(){if(this._map){var d,v,S=this._map.getZoom();if(S>this.options.maxZoom||S<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)v=this._tiles[d],v.retain=v.current;for(d in this._tiles)if(v=this._tiles[d],v.current&&!v.active){var R=v.coords;this._retainParent(R.x,R.y,R.z,R.z-5)||this._retainChildren(R.x,R.y,R.z,R.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var v in this._tiles)this._tiles[v].coords.z===d&&this._removeTile(v)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)_i(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,v,S,R){var O=Math.floor(d/2),j=Math.floor(v/2),ae=S-1,me=new J(+O,+j);me.z=+ae;var Te=this._tileCoordsToKey(me),De=this._tiles[Te];return De&&De.active?(De.retain=!0,!0):(De&&De.loaded&&(De.retain=!0),ae>R?this._retainParent(O,j,ae,R):!1)},_retainChildren:function(d,v,S,R){for(var O=2*d;O<2*d+2;O++)for(var j=2*v;j<2*v+2;j++){var ae=new J(O,j);ae.z=S+1;var me=this._tileCoordsToKey(ae),Te=this._tiles[me];if(Te&&Te.active){Te.retain=!0;continue}else Te&&Te.loaded&&(Te.retain=!0);S+1<R&&this._retainChildren(O,j,S+1,R)}},_resetView:function(d){var v=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),v,v)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var v=this.options;return v.minNativeZoom!==void 0&&d<v.minNativeZoom?v.minNativeZoom:v.maxNativeZoom!==void 0&&v.maxNativeZoom<d?v.maxNativeZoom:d},_setView:function(d,v,S,R){var O=Math.round(v);this.options.maxZoom!==void 0&&O>this.options.maxZoom||this.options.minZoom!==void 0&&O<this.options.minZoom?O=void 0:O=this._clampZoom(O);var j=this.options.updateWhenZooming&&O!==this._tileZoom;(!R||j)&&(this._tileZoom=O,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),O!==void 0&&this._update(d),S||this._pruneTiles(),this._noPrune=!!S),this._setZoomTransforms(d,v)},_setZoomTransforms:function(d,v){for(var S in this._levels)this._setZoomTransform(this._levels[S],d,v)},_setZoomTransform:function(d,v,S){var R=this._map.getZoomScale(S,d.zoom),O=d.origin.multiplyBy(R).subtract(this._map._getNewPixelOrigin(v,S)).round();nt.any3d?_r(d.el,O,R):ki(d.el,O)},_resetGrid:function(){var d=this._map,v=d.options.crs,S=this._tileSize=this.getTileSize(),R=this._tileZoom,O=this._map.getPixelWorldBounds(this._tileZoom);O&&(this._globalTileRange=this._pxBoundsToTileRange(O)),this._wrapX=v.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,v.wrapLng[0]],R).x/S.x),Math.ceil(d.project([0,v.wrapLng[1]],R).x/S.y)],this._wrapY=v.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([v.wrapLat[0],0],R).y/S.x),Math.ceil(d.project([v.wrapLat[1],0],R).y/S.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var v=this._map,S=v._animatingZoom?Math.max(v._animateToZoom,v.getZoom()):v.getZoom(),R=v.getZoomScale(S,this._tileZoom),O=v.project(d,this._tileZoom).floor(),j=v.getSize().divideBy(R*2);return new te(O.subtract(j),O.add(j))},_update:function(d){var v=this._map;if(v){var S=this._clampZoom(v.getZoom());if(d===void 0&&(d=v.getCenter()),this._tileZoom!==void 0){var R=this._getTiledPixelBounds(d),O=this._pxBoundsToTileRange(R),j=O.getCenter(),ae=[],me=this.options.keepBuffer,Te=new te(O.getBottomLeft().subtract([me,-me]),O.getTopRight().add([me,-me]));if(!(isFinite(O.min.x)&&isFinite(O.min.y)&&isFinite(O.max.x)&&isFinite(O.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var De in this._tiles){var We=this._tiles[De].coords;(We.z!==this._tileZoom||!Te.contains(new J(We.x,We.y)))&&(this._tiles[De].current=!1)}if(Math.abs(S-this._tileZoom)>1){this._setView(d,S);return}for(var ut=O.min.y;ut<=O.max.y;ut++)for(var Pt=O.min.x;Pt<=O.max.x;Pt++){var qi=new J(Pt,ut);if(qi.z=this._tileZoom,!!this._isValidTile(qi)){var Gi=this._tiles[this._tileCoordsToKey(qi)];Gi?Gi.current=!0:ae.push(qi)}}if(ae.sort(function(An,Ha){return An.distanceTo(j)-Ha.distanceTo(j)}),ae.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var $n=document.createDocumentFragment();for(Pt=0;Pt<ae.length;Pt++)this._addTile(ae[Pt],$n);this._level.el.appendChild($n)}}}},_isValidTile:function(d){var v=this._map.options.crs;if(!v.infinite){var S=this._globalTileRange;if(!v.wrapLng&&(d.x<S.min.x||d.x>S.max.x)||!v.wrapLat&&(d.y<S.min.y||d.y>S.max.y))return!1}if(!this.options.bounds)return!0;var R=this._tileCoordsToBounds(d);return fe(this.options.bounds).overlaps(R)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var v=this._map,S=this.getTileSize(),R=d.scaleBy(S),O=R.add(S),j=v.unproject(R,d.z),ae=v.unproject(O,d.z);return[j,ae]},_tileCoordsToBounds:function(d){var v=this._tileCoordsToNwSe(d),S=new _e(v[0],v[1]);return this.options.noWrap||(S=this._map.wrapLatLngBounds(S)),S},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var v=d.split(":"),S=new J(+v[0],+v[1]);return S.z=+v[2],S},_removeTile:function(d){var v=this._tiles[d];v&&(_i(v.el),delete this._tiles[d],this.fire("tileunload",{tile:v.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){bt(d,"leaflet-tile");var v=this.getTileSize();d.style.width=v.x+"px",d.style.height=v.y+"px",d.onselectstart=f,d.onmousemove=f,nt.ielt9&&this.options.opacity<1&&Cn(d,this.options.opacity)},_addTile:function(d,v){var S=this._getTilePos(d),R=this._tileCoordsToKey(d),O=this.createTile(this._wrapCoords(d),o(this._tileReady,this,d));this._initTile(O),this.createTile.length<2&&H(o(this._tileReady,this,d,null,O)),ki(O,S),this._tiles[R]={el:O,coords:d,current:!0},v.appendChild(O),this.fire("tileloadstart",{tile:O,coords:d})},_tileReady:function(d,v,S){v&&this.fire("tileerror",{error:v,tile:S,coords:d});var R=this._tileCoordsToKey(d);S=this._tiles[R],S&&(S.loaded=+new Date,this._map._fadeAnimated?(Cn(S.el,0),Y(this._fadeFrame),this._fadeFrame=H(this._updateOpacity,this)):(S.active=!0,this._pruneTiles()),v||(bt(S.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:S.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),nt.ielt9||!this._map._fadeAnimated?H(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var v=new J(this._wrapX?u(d.x,this._wrapX):d.x,this._wrapY?u(d.y,this._wrapY):d.y);return v.z=d.z,v},_pxBoundsToTileRange:function(d){var v=this.getTileSize();return new te(d.min.unscaleBy(v).floor(),d.max.unscaleBy(v).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function Ba(d){return new js(d)}var Ws=js.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,v){this._url=d,v=_(this,v),v.detectRetina&&nt.retina&&v.maxZoom>0?(v.tileSize=Math.floor(v.tileSize/2),v.zoomReverse?(v.zoomOffset--,v.minZoom=Math.min(v.maxZoom,v.minZoom+1)):(v.zoomOffset++,v.maxZoom=Math.max(v.minZoom,v.maxZoom-1)),v.minZoom=Math.max(0,v.minZoom)):v.zoomReverse?v.minZoom=Math.min(v.maxZoom,v.minZoom):v.maxZoom=Math.max(v.minZoom,v.maxZoom),typeof v.subdomains=="string"&&(v.subdomains=v.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,v){return this._url===d&&v===void 0&&(v=!0),this._url=d,v||this.redraw(),this},createTile:function(d,v){var S=document.createElement("img");return Tt(S,"load",o(this._tileOnLoad,this,v,S)),Tt(S,"error",o(this._tileOnError,this,v,S)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(S.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(S.referrerPolicy=this.options.referrerPolicy),S.alt="",S.src=this.getTileUrl(d),S},getTileUrl:function(d){var v={r:nt.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var S=this._globalTileRange.max.y-d.y;this.options.tms&&(v.y=S),v["-y"]=S}return x(this._url,r(v,this.options))},_tileOnLoad:function(d,v){nt.ielt9?setTimeout(o(d,this,null,v),0):d(null,v)},_tileOnError:function(d,v,S){var R=this.options.errorTileUrl;R&&v.getAttribute("src")!==R&&(v.src=R),d(S,v)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,v=this.options.maxZoom,S=this.options.zoomReverse,R=this.options.zoomOffset;return S&&(d=v-d),d+R},_getSubdomain:function(d){var v=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[v]},_abortLoading:function(){var d,v;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(v=this._tiles[d].el,v.onload=f,v.onerror=f,!v.complete)){v.src=D;var S=this._tiles[d].coords;_i(v),delete this._tiles[d],this.fire("tileabort",{tile:v,coords:S})}},_removeTile:function(d){var v=this._tiles[d];if(v)return v.el.setAttribute("src",D),js.prototype._removeTile.call(this,d)},_tileReady:function(d,v,S){if(!(!this._map||S&&S.getAttribute("src")===D))return js.prototype._tileReady.call(this,d,v,S)}});function bf(d,v){return new Ws(d,v)}var uc=Ws.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,v){this._url=d;var S=r({},this.defaultWmsParams);for(var R in v)R in this.options||(S[R]=v[R]);v=_(this,v);var O=v.detectRetina&&nt.retina?2:1,j=this.getTileSize();S.width=j.x*O,S.height=j.y*O,this.wmsParams=S},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var v=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[v]=this._crs.code,Ws.prototype.onAdd.call(this,d)},getTileUrl:function(d){var v=this._tileCoordsToNwSe(d),S=this._crs,R=Q(S.project(v[0]),S.project(v[1])),O=R.min,j=R.max,ae=(this._wmsVersion>=1.3&&this._crs===Vg?[O.y,O.x,j.y,j.x]:[O.x,O.y,j.x,j.y]).join(","),me=Ws.prototype.getTileUrl.call(this,d);return me+w(this.wmsParams,me,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ae},setParams:function(d,v){return r(this.wmsParams,d),v||this.redraw(),this}});function Jg(d,v){return new uc(d,v)}Ws.WMS=uc,bf.wms=Jg;var Vr=Sr.extend({options:{padding:.1},initialize:function(d){_(this,d),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),bt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,v){var S=this._map.getZoomScale(v,this._zoom),R=this._map.getSize().multiplyBy(.5+this.options.padding),O=this._map.project(this._center,v),j=R.multiplyBy(-S).add(O).subtract(this._map._getNewPixelOrigin(d,v));nt.any3d?_r(this._container,j,S):ki(this._container,j)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,v=this._map.getSize(),S=this._map.containerPointToLayerPoint(v.multiplyBy(-d)).round();this._bounds=new te(S,S.add(v.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),xf=Vr.extend({options:{tolerance:0},getEvents:function(){var d=Vr.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Vr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");Tt(d,"mousemove",this._onMouseMove,this),Tt(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Tt(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){Y(this._redrawRequest),delete this._ctx,_i(this._container),oi(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var v in this._layers)d=this._layers[v],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Vr.prototype._update.call(this);var d=this._bounds,v=this._container,S=d.getSize(),R=nt.retina?2:1;ki(v,d.min),v.width=R*S.x,v.height=R*S.y,v.style.width=S.x+"px",v.style.height=S.y+"px",nt.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){Vr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[l(d)]=d;var v=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=v),this._drawLast=v,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var v=d._order,S=v.next,R=v.prev;S?S.prev=R:this._drawLast=R,R?R.next=S:this._drawFirst=S,delete d._order,delete this._layers[l(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var v=d.options.dashArray.split(/[, ]+/),S=[],R,O;for(O=0;O<v.length;O++){if(R=Number(v[O]),isNaN(R))return;S.push(R)}d.options._dashArray=S}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){this._map&&(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||H(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var v=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new te,this._redrawBounds.extend(d._pxBounds.min.subtract([v,v])),this._redrawBounds.extend(d._pxBounds.max.add([v,v]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var v=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,v.x,v.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,v=this._redrawBounds;if(this._ctx.save(),v){var S=v.getSize();this._ctx.beginPath(),this._ctx.rect(v.min.x,v.min.y,S.x,S.y),this._ctx.clip()}this._drawing=!0;for(var R=this._drawFirst;R;R=R.next)d=R.layer,(!v||d._pxBounds&&d._pxBounds.intersects(v))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,v){if(this._drawing){var S,R,O,j,ae=d._parts,me=ae.length,Te=this._ctx;if(me){for(Te.beginPath(),S=0;S<me;S++){for(R=0,O=ae[S].length;R<O;R++)j=ae[S][R],Te[R?"lineTo":"moveTo"](j.x,j.y);v&&Te.closePath()}this._fillStroke(Te,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var v=d._point,S=this._ctx,R=Math.max(Math.round(d._radius),1),O=(Math.max(Math.round(d._radiusY),1)||R)/R;O!==1&&(S.save(),S.scale(1,O)),S.beginPath(),S.arc(v.x,v.y/O,R,0,Math.PI*2,!1),O!==1&&S.restore(),this._fillStroke(S,d)}},_fillStroke:function(d,v){var S=v.options;S.fill&&(d.globalAlpha=S.fillOpacity,d.fillStyle=S.fillColor||S.color,d.fill(S.fillRule||"evenodd")),S.stroke&&S.weight!==0&&(d.setLineDash&&d.setLineDash(v.options&&v.options._dashArray||[]),d.globalAlpha=S.opacity,d.lineWidth=S.weight,d.strokeStyle=S.color,d.lineCap=S.lineCap,d.lineJoin=S.lineJoin,d.stroke())},_onClick:function(d){for(var v=this._map.mouseEventToLayerPoint(d),S,R,O=this._drawFirst;O;O=O.next)S=O.layer,S.options.interactive&&S._containsPoint(v)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(S))&&(R=S);this._fireEvent(R?[R]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var v=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,v)}},_handleMouseOut:function(d){var v=this._hoveredLayer;v&&(di(this._container,"leaflet-interactive"),this._fireEvent([v],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,v){if(!this._mouseHoverThrottled){for(var S,R,O=this._drawFirst;O;O=O.next)S=O.layer,S.options.interactive&&S._containsPoint(v)&&(R=S);R!==this._hoveredLayer&&(this._handleMouseOut(d),R&&(bt(this._container,"leaflet-interactive"),this._fireEvent([R],d,"mouseover"),this._hoveredLayer=R)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,v,S){this._map._fireDOMEvent(v,S||v.type,d)},_bringToFront:function(d){var v=d._order;if(v){var S=v.next,R=v.prev;if(S)S.prev=R;else return;R?R.next=S:S&&(this._drawFirst=S),v.prev=this._drawLast,this._drawLast.next=v,v.next=null,this._drawLast=v,this._requestRedraw(d)}},_bringToBack:function(d){var v=d._order;if(v){var S=v.next,R=v.prev;if(R)R.next=S;else return;S?S.prev=R:R&&(this._drawLast=R),v.prev=null,v.next=this._drawFirst,this._drawFirst.prev=v,this._drawFirst=v,this._requestRedraw(d)}}});function Cf(d){return nt.canvas?new xf(d):null}var Ua=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Qg={_initContainer:function(){this._container=Rt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Vr.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var v=d._container=Ua("shape");bt(v,"leaflet-vml-shape "+(this.options.className||"")),v.coordsize="1 1",d._path=Ua("path"),v.appendChild(d._path),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){var v=d._container;this._container.appendChild(v),d.options.interactive&&d.addInteractiveTarget(v)},_removePath:function(d){var v=d._container;_i(v),d.removeInteractiveTarget(v),delete this._layers[l(d)]},_updateStyle:function(d){var v=d._stroke,S=d._fill,R=d.options,O=d._container;O.stroked=!!R.stroke,O.filled=!!R.fill,R.stroke?(v||(v=d._stroke=Ua("stroke")),O.appendChild(v),v.weight=R.weight+"px",v.color=R.color,v.opacity=R.opacity,R.dashArray?v.dashStyle=C(R.dashArray)?R.dashArray.join(" "):R.dashArray.replace(/( *, *)/g," "):v.dashStyle="",v.endcap=R.lineCap.replace("butt","flat"),v.joinstyle=R.lineJoin):v&&(O.removeChild(v),d._stroke=null),R.fill?(S||(S=d._fill=Ua("fill")),O.appendChild(S),S.color=R.fillColor||R.color,S.opacity=R.fillOpacity):S&&(O.removeChild(S),d._fill=null)},_updateCircle:function(d){var v=d._point.round(),S=Math.round(d._radius),R=Math.round(d._radiusY||S);this._setPath(d,d._empty()?"M0 0":"AL "+v.x+","+v.y+" "+S+","+R+" 0,"+65535*360)},_setPath:function(d,v){d._path.v=v},_bringToFront:function(d){xa(d._container)},_bringToBack:function(d){us(d._container)}},xr=nt.vml?Ua:ii,Po=Vr.extend({_initContainer:function(){this._container=xr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=xr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){_i(this._container),oi(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Vr.prototype._update.call(this);var d=this._bounds,v=d.getSize(),S=this._container;(!this._svgSize||!this._svgSize.equals(v))&&(this._svgSize=v,S.setAttribute("width",v.x),S.setAttribute("height",v.y)),ki(S,d.min),S.setAttribute("viewBox",[d.min.x,d.min.y,v.x,v.y].join(" ")),this.fire("update")}},_initPath:function(d){var v=d._path=xr("path");d.options.className&&bt(v,d.options.className),d.options.interactive&&bt(v,"leaflet-interactive"),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){_i(d._path),d.removeInteractiveTarget(d._path),delete this._layers[l(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var v=d._path,S=d.options;v&&(S.stroke?(v.setAttribute("stroke",S.color),v.setAttribute("stroke-opacity",S.opacity),v.setAttribute("stroke-width",S.weight),v.setAttribute("stroke-linecap",S.lineCap),v.setAttribute("stroke-linejoin",S.lineJoin),S.dashArray?v.setAttribute("stroke-dasharray",S.dashArray):v.removeAttribute("stroke-dasharray"),S.dashOffset?v.setAttribute("stroke-dashoffset",S.dashOffset):v.removeAttribute("stroke-dashoffset")):v.setAttribute("stroke","none"),S.fill?(v.setAttribute("fill",S.fillColor||S.color),v.setAttribute("fill-opacity",S.fillOpacity),v.setAttribute("fill-rule",S.fillRule||"evenodd")):v.setAttribute("fill","none"))},_updatePoly:function(d,v){this._setPath(d,Yt(d._parts,v))},_updateCircle:function(d){var v=d._point,S=Math.max(Math.round(d._radius),1),R=Math.max(Math.round(d._radiusY),1)||S,O="a"+S+","+R+" 0 1,0 ",j=d._empty()?"M0 0":"M"+(v.x-S)+","+v.y+O+S*2+",0 "+O+-S*2+",0 ";this._setPath(d,j)},_setPath:function(d,v){d._path.setAttribute("d",v)},_bringToFront:function(d){xa(d._path)},_bringToBack:function(d){us(d._path)}});nt.vml&&Po.include(Qg);function Vu(d){return nt.svg||nt.vml?new Po(d):null}Bt.include({getRenderer:function(d){var v=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return v||(v=this._renderer=this._createRenderer()),this.hasLayer(v)||this.addLayer(v),v},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var v=this._paneRenderers[d];return v===void 0&&(v=this._createRenderer({pane:d}),this._paneRenderers[d]=v),v},_createRenderer:function(d){return this.options.preferCanvas&&Cf(d)||Vu(d)}});var em=gs.extend({initialize:function(d,v){gs.prototype.initialize.call(this,this._boundsToLatLngs(d),v)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=fe(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function $_(d,v){return new em(d,v)}Po.create=xr,Po.pointsToPath=Yt,Hr.geometryToLayer=ka,Hr.coordsToLatLng=Bu,Hr.coordsToLatLngs=lc,Hr.latLngToCoords=Uu,Hr.latLngsToCoords=zu,Hr.getFeature=Ma,Hr.asFeature=Gu,Bt.mergeOptions({boxZoom:!0});var za=Qn.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){Tt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){oi(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){_i(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),$t(),Cu(),this._startPoint=this._map.mouseEventToContainerPoint(d),Tt(document,{contextmenu:wr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=Rt("div","leaflet-zoom-box",this._container),bt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var v=new te(this._point,this._startPoint),S=v.getSize();ki(this._box,v.min),this._box.style.width=S.x+"px",this._box.style.height=S.y+"px"},_finish:function(){this._moved&&(_i(this._box),di(this._container,"leaflet-crosshair")),Aa(),Ru(),oi(document,{contextmenu:wr,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var v=new _e(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(v).fire("boxzoomend",{boxZoomBounds:v})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Bt.addInitHook("addHandler","boxZoom",za),Bt.mergeOptions({doubleClickZoom:!0});var tm=Qn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var v=this._map,S=v.getZoom(),R=v.options.zoomDelta,O=d.originalEvent.shiftKey?S-R:S+R;v.options.doubleClickZoom==="center"?v.setZoom(O):v.setZoomAround(d.containerPoint,O)}});Bt.addInitHook("addHandler","doubleClickZoom",tm),Bt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Rf=Qn.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new Tr(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}bt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){di(this._map._container,"leaflet-grab"),di(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var v=fe(this._map.options.maxBounds);this._offsetLimit=Q(this._map.latLngToContainerPoint(v.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(v.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var v=this._lastTime=+new Date,S=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(S),this._times.push(v),this._prunePositions(v)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),v=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=v.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,v){return d-(d-v)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),v=this._offsetLimit;d.x<v.min.x&&(d.x=this._viscousLimit(d.x,v.min.x)),d.y<v.min.y&&(d.y=this._viscousLimit(d.y,v.min.y)),d.x>v.max.x&&(d.x=this._viscousLimit(d.x,v.max.x)),d.y>v.max.y&&(d.y=this._viscousLimit(d.y,v.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,v=Math.round(d/2),S=this._initialWorldOffset,R=this._draggable._newPos.x,O=(R-v+S)%d+v-S,j=(R+v+S)%d-v-S,ae=Math.abs(O+S)<Math.abs(j+S)?O:j;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ae},_onDragEnd:function(d){var v=this._map,S=v.options,R=!S.inertia||d.noInertia||this._times.length<2;if(v.fire("dragend",d),R)v.fire("moveend");else{this._prunePositions(+new Date);var O=this._lastPos.subtract(this._positions[0]),j=(this._lastTime-this._times[0])/1e3,ae=S.easeLinearity,me=O.multiplyBy(ae/j),Te=me.distanceTo([0,0]),De=Math.min(S.inertiaMaxSpeed,Te),We=me.multiplyBy(De/Te),ut=De/(S.inertiaDeceleration*ae),Pt=We.multiplyBy(-ut/2).round();!Pt.x&&!Pt.y?v.fire("moveend"):(Pt=v._limitOffset(Pt,v.options.maxBounds),H(function(){v.panBy(Pt,{duration:ut,easeLinearity:ae,noMoveStart:!0,animate:!0})}))}}});Bt.addInitHook("addHandler","dragging",Rf),Bt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Af=Qn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),Tt(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),oi(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,v=document.documentElement,S=d.scrollTop||v.scrollTop,R=d.scrollLeft||v.scrollLeft;this._map._container.focus(),window.scrollTo(R,S)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var v=this._panKeys={},S=this.keyCodes,R,O;for(R=0,O=S.left.length;R<O;R++)v[S.left[R]]=[-1*d,0];for(R=0,O=S.right.length;R<O;R++)v[S.right[R]]=[d,0];for(R=0,O=S.down.length;R<O;R++)v[S.down[R]]=[0,d];for(R=0,O=S.up.length;R<O;R++)v[S.up[R]]=[0,-1*d]},_setZoomDelta:function(d){var v=this._zoomKeys={},S=this.keyCodes,R,O;for(R=0,O=S.zoomIn.length;R<O;R++)v[S.zoomIn[R]]=d;for(R=0,O=S.zoomOut.length;R<O;R++)v[S.zoomOut[R]]=-d},_addHooks:function(){Tt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){oi(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var v=d.keyCode,S=this._map,R;if(v in this._panKeys){if(!S._panAnim||!S._panAnim._inProgress)if(R=this._panKeys[v],d.shiftKey&&(R=se(R).multiplyBy(3)),S.options.maxBounds&&(R=S._limitOffset(se(R),S.options.maxBounds)),S.options.worldCopyJump){var O=S.wrapLatLng(S.unproject(S.project(S.getCenter()).add(R)));S.panTo(O)}else S.panBy(R)}else if(v in this._zoomKeys)S.setZoom(S.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[v]);else if(v===27&&S._popup&&S._popup.options.closeOnEscapeKey)S.closePopup();else return;wr(d)}}});Bt.addInitHook("addHandler","keyboard",Af),Bt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ai=Qn.extend({addHooks:function(){Tt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){oi(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var v=Ng(d),S=this._map.options.wheelDebounceTime;this._delta+=v,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var R=Math.max(S-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),R),wr(d)},_performZoom:function(){var d=this._map,v=d.getZoom(),S=this._map.options.zoomSnap||0;d._stop();var R=this._delta/(this._map.options.wheelPxPerZoomLevel*4),O=4*Math.log(2/(1+Math.exp(-Math.abs(R))))/Math.LN2,j=S?Math.ceil(O/S)*S:O,ae=d._limitZoom(v+(this._delta>0?j:-j))-v;this._delta=0,this._startTime=null,ae&&(d.options.scrollWheelZoom==="center"?d.setZoom(v+ae):d.setZoomAround(this._lastMousePos,v+ae))}});Bt.addInitHook("addHandler","scrollWheelZoom",ai);var Lf=600;Bt.mergeOptions({tapHold:nt.touchNative&&nt.safari&&nt.mobile,tapTolerance:15});var hc=Qn.extend({addHooks:function(){Tt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){oi(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var v=d.touches[0];this._startPos=this._newPos=new J(v.clientX,v.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(Tt(document,"touchend",Ci),Tt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",v))},this),Lf),Tt(document,"touchend touchcancel contextmenu",this._cancel,this),Tt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){oi(document,"touchend",Ci),oi(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),oi(document,"touchend touchcancel contextmenu",this._cancel,this),oi(document,"touchmove",this._onMove,this)},_onMove:function(d){var v=d.touches[0];this._newPos=new J(v.clientX,v.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,v){var S=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:v.screenX,screenY:v.screenY,clientX:v.clientX,clientY:v.clientY});S._simulated=!0,v.target.dispatchEvent(S)}});Bt.addInitHook("addHandler","tapHold",hc),Bt.mergeOptions({touchZoom:nt.touch,bounceAtZoomLimits:!0});var Ga=Qn.extend({addHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),Tt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){di(this._map._container,"leaflet-touch-zoom"),oi(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var v=this._map;if(!(!d.touches||d.touches.length!==2||v._animatingZoom||this._zooming)){var S=v.mouseEventToContainerPoint(d.touches[0]),R=v.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=v.getSize()._divideBy(2),this._startLatLng=v.containerPointToLatLng(this._centerPoint),v.options.touchZoom!=="center"&&(this._pinchStartLatLng=v.containerPointToLatLng(S.add(R)._divideBy(2))),this._startDist=S.distanceTo(R),this._startZoom=v.getZoom(),this._moved=!1,this._zooming=!0,v._stop(),Tt(document,"touchmove",this._onTouchMove,this),Tt(document,"touchend touchcancel",this._onTouchEnd,this),Ci(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var v=this._map,S=v.mouseEventToContainerPoint(d.touches[0]),R=v.mouseEventToContainerPoint(d.touches[1]),O=S.distanceTo(R)/this._startDist;if(this._zoom=v.getScaleZoom(O,this._startZoom),!v.options.bounceAtZoomLimits&&(this._zoom<v.getMinZoom()&&O<1||this._zoom>v.getMaxZoom()&&O>1)&&(this._zoom=v._limitZoom(this._zoom)),v.options.touchZoom==="center"){if(this._center=this._startLatLng,O===1)return}else{var j=S._add(R)._divideBy(2)._subtract(this._centerPoint);if(O===1&&j.x===0&&j.y===0)return;this._center=v.unproject(v.project(this._pinchStartLatLng,this._zoom).subtract(j),this._zoom)}this._moved||(v._moveStart(!0,!1),this._moved=!0),Y(this._animRequest);var ae=o(v._move,v,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=H(ae,this,!0),Ci(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Y(this._animRequest),oi(document,"touchmove",this._onTouchMove,this),oi(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Bt.addInitHook("addHandler","touchZoom",Ga),Bt.BoxZoom=za,Bt.DoubleClickZoom=tm,Bt.Drag=Rf,Bt.Keyboard=Af,Bt.ScrollWheelZoom=ai,Bt.TapHold=hc,Bt.TouchZoom=Ga,t.Bounds=te,t.Browser=nt,t.CRS=xe,t.Canvas=xf,t.Circle=Nu,t.CircleMarker=Mu,t.Class=le,t.Control=Gn,t.DivIcon=$u,t.DivOverlay=$r,t.DomEvent=Iu,t.DomUtil=ic,t.Draggable=Tr,t.Evented=ne,t.FeatureGroup=fs,t.GeoJSON=Hr,t.GridLayer=js,t.Handler=Qn,t.Icon=Io,t.ImageOverlay=Vs,t.LatLng=pe,t.LatLngBounds=_e,t.Layer=Sr,t.LayerGroup=Hs,t.LineUtil=$g,t.Map=Bt,t.Marker=ps,t.Mixin=df,t.Path=$s,t.Point=J,t.PolyUtil=D_,t.Polygon=gs,t.Polyline=Hn,t.Popup=Hu,t.PosAnimation=Pu,t.Projection=F_,t.Rectangle=em,t.Renderer=Vr,t.SVG=Po,t.SVGOverlay=Tf,t.TileLayer=Ws,t.Tooltip=Fa,t.Transformation=lt,t.Util=ee,t.VideoOverlay=wf,t.bind=o,t.bounds=Q,t.canvas=Cf,t.circle=ac,t.circleMarker=qg,t.control=Gs,t.divIcon=Xg,t.extend=r,t.featureGroup=jg,t.geoJSON=Kg,t.geoJson=br,t.gridLayer=Ba,t.icon=Wg,t.imageOverlay=Zg,t.latLng=Ce,t.latLngBounds=fe,t.layerGroup=oc,t.map=zs,t.marker=z_,t.point=se,t.polygon=H_,t.polyline=G_,t.popup=Na,t.rectangle=$_,t.setOptions=_,t.stamp=l,t.svg=Vu,t.svgOverlay=Sf,t.tileLayer=bf,t.tooltip=cc,t.transformation=ct,t.version=i,t.videoOverlay=Yg;var im=window.L;t.noConflict=function(){return window.L=im,this},window.L=t})})(tb,tb.exports);var de=tb.exports;L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(n){var e=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",e),this.link.href="#",this._map=n,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),e},_click:function(n){L.DomEvent.stopPropagation(n),L.DomEvent.preventDefault(n),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(n){var e=this.getContainer();this.isFullscreen()?n&&n.pseudoFullscreen?this._disablePseudoFullscreen(e):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(e):n&&n.pseudoFullscreen?this._enablePseudoFullscreen(e):e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():this._enablePseudoFullscreen(e)},_enablePseudoFullscreen:function(n){L.DomUtil.addClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(n){L.DomUtil.removeClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(n){this._isFullscreen=n;var e=this.getContainer();n?L.DomUtil.addClass(e,"leaflet-fullscreen-on"):L.DomUtil.removeClass(e,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(n){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;e===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):e!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var n;if("onfullscreenchange"in document?n="fullscreenchange":"onmozfullscreenchange"in document?n="mozfullscreenchange":"onwebkitfullscreenchange"in document?n="webkitfullscreenchange":"onmsfullscreenchange"in document&&(n="MSFullscreenChange"),n){var e=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,n,e)}),this.on("unload",function(){L.DomEvent.off(document,n,e)})}});L.control.fullscreen=function(n){return new L.Control.Fullscreen(n)};var h_=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,dl=document.documentElement.style.pointerEvents==="",Mc={cors:h_,pointerEvents:dl},Tce={attributionWidthOffset:55},mD=0;function d_(n){var e="";n.f=n.f||"json";for(var t in n)if(Object.prototype.hasOwnProperty.call(n,t)){var i=n[t],r=Object.prototype.toString.call(i),s;e.length&&(e+="&"),r==="[object Array]"?s=Object.prototype.toString.call(i[0])==="[object Object]"?JSON.stringify(i):i.join(","):r==="[object Object]"?s=JSON.stringify(i):r==="[object Date]"?s=i.valueOf():s=i,e+=encodeURIComponent(t)+"="+encodeURIComponent(s)}return e.replaceAll("'","%27")}function B1(n,e){var t=new window.XMLHttpRequest;return t.onerror=function(i){t.onreadystatechange=de.Util.falseFn,n.call(e,{error:{code:500,message:"XMLHttpRequest error"}},null)},t.onreadystatechange=function(){var i,r;if(t.readyState===4){try{i=JSON.parse(t.responseText)}catch{i=null,r={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!r&&i.error&&(r=i.error,i=null),t.onerror=de.Util.falseFn,n.call(e,r,i)}},t.ontimeout=function(){this.onerror()},t}function Sce(n,e,t,i){var r=B1(t,i);return r.open("POST",n),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(r.timeout=i.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(d_(e)),r}function s3(n,e,t,i){var r=B1(t,i);return r.open("GET",n+"?"+d_(e),!0),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(r.timeout=i.options.timeout,i.options.withCredentials&&(r.withCredentials=!0)),r.send(null),r}function o3(n,e,t,i){var r=d_(e),s=B1(t,i),o=(n+"?"+r).length;if(o<=2e3&&Mc.cors?s.open("GET",n+"?"+r):o>2e3&&Mc.cors&&(s.open("POST",n),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(s.timeout=i.options.timeout,i.options.withCredentials&&(s.withCredentials=!0)),o<=2e3&&Mc.cors)s.send(null);else if(o>2e3&&Mc.cors)s.send(r);else{if(o<=2e3&&!Mc.cors)return U1(n,e,t,i);su("a request to "+n+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");return}return s}function U1(n,e,t,i){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var r="c"+mD;e.callback="window._EsriLeafletCallbacks."+r,window._EsriLeafletCallbacks[r]=function(o){if(window._EsriLeafletCallbacks[r]!==!0){var a,l=Object.prototype.toString.call(o);l==="[object Object]"||l==="[object Array]"||(a={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!a&&o.error&&(a=o,o=null),t.call(i,a,o),window._EsriLeafletCallbacks[r]=!0}};var s=de.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=n+"?"+d_(e),s.id=r,s.onerror=function(o){if(o&&window._EsriLeafletCallbacks[r]!==!0){var a={error:{code:500,message:"An unknown error occurred"}};t.call(i,a),window._EsriLeafletCallbacks[r]=!0}},de.DomUtil.addClass(s,"esri-leaflet-jsonp"),mD++,{id:r,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[r]({code:0,message:"Request aborted."})}}}var z1=Mc.cors?s3:U1;z1.CORS=s3;z1.JSONP=U1;function su(){console&&console.warn&&console.warn.apply(console,arguments)}var l0={request:o3,get:z1,post:Sce};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var bce=function(e,t,i,r){var s=(r[0]-i[0])*(e[1]-i[1])-(r[1]-i[1])*(e[0]-i[0]),o=(t[0]-e[0])*(e[1]-i[1])-(t[1]-e[1])*(e[0]-i[0]),a=(r[1]-i[1])*(t[0]-e[0])-(r[0]-i[0])*(t[1]-e[1]);if(a!==0){var l=s/a,c=o/a;if(l>=0&&l<=1&&c>=0&&c<=1)return!0}return!1},xce=function(e,t){for(var i=!1,r=-1,s=e.length,o=s-1;++r<s;o=r)(e[r][1]<=t[1]&&t[1]<e[o][1]||e[o][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[o][0]-e[r][0])*(t[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(i=!i);return i},Cce=function(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},a3=function(e,t){for(var i=0;i<e.length-1;i++)for(var r=0;r<t.length-1;r++)if(bce(e[i],e[i+1],t[r],t[r+1]))return!0;return!1},ib=function(e){return Cce(e[0],e[e.length-1])||e.push(e[0]),e},nb=function(e){var t=0,i=0,r=e.length,s=e[i],o;for(i;i<r-1;i++)o=e[i+1],t+=(o[0]-s[0])*(o[1]+s[1]),s=o;return t>=0},l3=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},Rce=function(e,t){var i=a3(e,t),r=xce(e,t[0]);return!!(!i&&r)},Ace=function(e){for(var t=[],i=[],r,s,o,a=0;a<e.length;a++){var l=ib(e[a].slice(0));if(!(l.length<4))if(nb(l)){var c=[l.slice().reverse()];t.push(c)}else i.push(l.slice().reverse())}for(var u=[];i.length;){o=i.pop();var f=!1;for(r=t.length-1;r>=0;r--)if(s=t[r][0],Rce(s,o)){t[r].push(o),f=!0;break}f||u.push(o)}for(;u.length;){o=u.pop();var p=!1;for(r=t.length-1;r>=0;r--)if(s=t[r][0],a3(s,o)){t[r].push(o),p=!0;break}p||t.push([o.reverse()])}return t.length===1?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}},Lce=function(e,t){for(var i=t?[t,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<i.length;r++){var s=i[r];if(s in e&&(typeof e[s]=="string"||typeof e[s]=="number"))return e[s]}throw Error("No valid id attribute found")},Ice=function n(e,t){var i={};if(e.features){i.type="FeatureCollection",i.features=[];for(var r=0;r<e.features.length;r++)i.features.push(n(e.features[r],t))}if(typeof e.x=="number"&&typeof e.y=="number"&&(i.type="Point",i.coordinates=[e.x,e.y],typeof e.z=="number"&&i.coordinates.push(e.z)),e.points&&(i.type="MultiPoint",i.coordinates=e.points.slice(0)),e.paths&&(e.paths.length===1?(i.type="LineString",i.coordinates=e.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=e.paths.slice(0))),e.rings&&(i=Ace(e.rings.slice(0))),typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"&&(i.type="Polygon",i.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(i.type="Feature",i.geometry=e.geometry?n(e.geometry):null,i.properties=e.attributes?l3(e.attributes):null,e.attributes))try{i.id=Lce(e.attributes,t)}catch{}return JSON.stringify(i.geometry)===JSON.stringify({})&&(i.geometry=null),e.spatialReference&&e.spatialReference.wkid&&e.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),i},c3=function(e){var t=[],i=e.slice(0),r=ib(i.shift().slice(0));if(r.length>=4){nb(r)||r.reverse(),t.push(r);for(var s=0;s<i.length;s++){var o=ib(i[s].slice(0));o.length>=4&&(nb(o)&&o.reverse(),t.push(o))}}return t},Pce=function(e){for(var t=[],i=0;i<e.length;i++)for(var r=c3(e[i]),s=r.length-1;s>=0;s--){var o=r[s].slice(0);t.push(o)}return t},Dce=function n(e,t){t=t||"OBJECTID";var i={wkid:4326},r={},s;switch(e.type){case"Point":r.x=e.coordinates[0],r.y=e.coordinates[1],e.coordinates[2]!=null&&(r.z=e.coordinates[2]),r.spatialReference=i;break;case"MultiPoint":r.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=i;break;case"LineString":r.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(r.hasZ=!0),r.spatialReference=i;break;case"MultiLineString":r.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=i;break;case"Polygon":r.rings=c3(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=i;break;case"MultiPolygon":r.rings=Pce(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(r.hasZ=!0),r.spatialReference=i;break;case"Feature":e.geometry&&(r.geometry=n(e.geometry,t)),r.attributes=e.properties?l3(e.properties):{},e.id&&(r.attributes[t]=e.id);break;case"FeatureCollection":for(r=[],s=0;s<e.features.length;s++)r.push(n(e.features[s],t));break;case"GeometryCollection":for(r=[],s=0;s<e.geometries.length;s++)r.push(n(e.geometries[s],t));break}return r},Oce='Powered by <a href="https://www.esri.com">Esri</a>';function c0(n,e){return Dce(n,e)}function kce(n,e){return Ice(n,e)}function vD(n){if(n.xmin!=="NaN"&&n.ymin!=="NaN"&&n.xmax!=="NaN"&&n.ymax!=="NaN"){var e=de.latLng(n.ymin,n.xmin),t=de.latLng(n.ymax,n.xmax);return de.latLngBounds(e,t)}else return null}function u3(n){return n=de.latLngBounds(n),{xmin:n.getSouthWest().lng,ymin:n.getSouthWest().lat,xmax:n.getNorthEast().lng,ymax:n.getNorthEast().lat,spatialReference:{wkid:4326}}}var h3=/^(OBJECTID|FID|OID|ID)$/i;function Mce(n){var e;if(n.objectIdFieldName)e=n.objectIdFieldName;else if(n.fields){for(var t=0;t<=n.fields.length-1;t++)if(n.fields[t].type==="esriFieldTypeOID"){e=n.fields[t].name;break}if(!e){for(t=0;t<=n.fields.length-1;t++)if(n.fields[t].name.match(h3)){e=n.fields[t].name;break}}}return e}function Nce(n){for(var e in n.attributes)if(e.match(h3))return e}function f_(n,e){var t,i=n.features||n.results,r=i&&i.length;t=Mce(n);var s={type:"FeatureCollection",features:[]};if(r)for(var o=i.length-1;o>=0;o--){var a=kce(i[o],t||Nce(i[o]));s.features.push(a)}return s}function G1(n){return n=de.Util.trim(n),n[n.length-1]!=="/"&&(n+="/"),n}function p_(n){if(n.url.indexOf("?")!==-1){n.requestParams=n.requestParams||{};var e=n.url.substring(n.url.indexOf("?")+1);n.url=n.url.split("?")[0],n.requestParams=JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return n.url=G1(n.url.split("?")[0]),n}function Fce(n){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(n)}function yD(n){var e;switch(n){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":e="esriGeometryPolyline";break;case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":e="esriGeometryPolygon";break;case"MultiPolygon":e="esriGeometryPolygon";break}return e}function rb(n){return n.getSize().x-Tce.attributionWidthOffset+"px"}function g_(n){if(n.attributionControl){if(n.attributionControl._esriAttributionLayerCount||(n.attributionControl._esriAttributionLayerCount=0),n.attributionControl._esriAttributionLayerCount===0){if(!n.attributionControl._esriAttributionAddedOnce){var e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+rb(n)+";}",document.getElementsByTagName("head")[0].appendChild(t),n.on("resize",function(i){n.attributionControl&&(n.attributionControl._container.style.maxWidth=rb(i.target))}),n.attributionControl._esriAttributionAddedOnce=!0}de.DomUtil.addClass(n.attributionControl._container,"esri-truncated-attribution:hover"),de.DomUtil.addClass(n.attributionControl._container,"esri-truncated-attribution")}n.attributionControl._esriAttributionLayerCount=n.attributionControl._esriAttributionLayerCount+1}}function m_(n){n.attributionControl&&(n.attributionControl._esriAttributionLayerCount&&n.attributionControl._esriAttributionLayerCount===1&&(de.DomUtil.removeClass(n.attributionControl._container,"esri-truncated-attribution:hover"),de.DomUtil.removeClass(n.attributionControl._container,"esri-truncated-attribution")),n.attributionControl._esriAttributionLayerCount=n.attributionControl._esriAttributionLayerCount-1)}function d3(n){var e={geometry:null,geometryType:null};if(n instanceof de.LatLngBounds)return e.geometry=u3(n),e.geometryType="esriGeometryEnvelope",e;if(n.getLatLng&&(n=n.getLatLng()),n instanceof de.LatLng&&(n={type:"Point",coordinates:[n.lng,n.lat]}),n instanceof de.GeoJSON&&(n=n.getLayers()[0].feature.geometry,e.geometry=c0(n),e.geometryType=yD(n.type)),n.toGeoJSON&&(n=n.toGeoJSON()),n.type==="Feature"&&(n=n.geometry),n.type==="Point"||n.type==="LineString"||n.type==="Polygon"||n.type==="MultiPolygon")return e.geometry=c0(n),e.geometryType=yD(n.type),e;su("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function Bce(n,e){Mc.cors&&o3(n,{},de.Util.bind(function(t,i){if(!t){e._esriAttributions=[];for(var r=0;r<i.contributors.length;r++)for(var s=i.contributors[r],o=0;o<s.coverageAreas.length;o++){var a=s.coverageAreas[o],l=de.latLng(a.bbox[0],a.bbox[1]),c=de.latLng(a.bbox[2],a.bbox[3]);e._esriAttributions.push({attribution:s.attribution,score:a.score,bounds:de.latLngBounds(l,c),minZoom:a.zoomMin,maxZoom:a.zoomMax})}e._esriAttributions.sort(function(f,p){return p.score-f.score});var u={target:e};sb(u)}},this))}function sb(n){var e=n.target,t=e._esriAttributions;if(!(!e||!e.attributionControl)){var i=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(i&&t){for(var r="",s=e.getBounds(),o=de.latLngBounds(s.getSouthWest().wrap(),s.getNorthEast().wrap()),a=e.getZoom(),l=0;l<t.length;l++){var c=t[l],u=c.attribution;!r.match(u)&&c.bounds.intersects(o)&&a>=c.minZoom&&a<=c.maxZoom&&(r+=", "+u)}r=Oce+" | "+r.substr(2),i.innerHTML=r,i.style.maxWidth=rb(e),e.fire("attributionupdated",{attribution:r})}}}var H1=de.Class.extend({options:{proxy:!1,useCors:h_},generateSetter:function(n,e){return de.Util.bind(function(t){return this.params[n]=t,this},e)},initialize:function(n){if(n.request&&n.options?(this._service=n,de.Util.setOptions(this,n.options)):(de.Util.setOptions(this,n),this.options.url=G1(n.url)),this.params=de.Util.extend({},this.params||{}),this.setters)for(var e in this.setters){var t=this.setters[e];this[e]=this.generateSetter(t,this)}},token:function(n){return this._service?this._service.authenticate(n):this.params.token=n,this},apikey:function(n){return this.token(n)},format:function(n){return this.params.returnUnformattedValues=!n,this},request:function(n,e){return this.options.requestParams&&de.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,n,e):this._request("request",this.path,this.params,n,e)},_request:function(n,e,t,i,r){var s=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return(n==="get"||n==="request")&&!this.options.useCors?l0.get.JSONP(s,t,i,r):l0[n](s,t,i,r)}}),Uce=H1.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(n){return this._setGeometryParams(n),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(n,e){return n=de.latLng(n),this.params.geometry=[n.lng,n.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSR=4326,this},where:function(n){return this.params.where=n,this},between:function(n,e){return this.params.time=[n.valueOf(),e.valueOf()],this},simplify:function(n,e){var t=Math.abs(n.getBounds().getWest()-n.getBounds().getEast());return this.params.maxAllowableOffset=t/n.getSize().y*e,this},orderBy:function(n,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[n,e].join(" "),this},run:function(n,e){return this._cleanParams(),this.options.isModern||Fce(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(t,i){this._trapSQLerrors(t),n.call(e,t,i,i)},this)):this.request(function(t,i){this._trapSQLerrors(t),n.call(e,t,i&&f_(i),i)},this)},count:function(n,e){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(t,i){n.call(this,t,i&&i.count,i)},e)},ids:function(n,e){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(t,i){n.call(this,t,i&&i.objectIds,i)},e)},bounds:function(n,e){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(t,i){i&&i.extent&&vD(i.extent)?n.call(e,t,vD(i.extent),i):(t={message:"Invalid Bounds"},n.call(e,t,null,i))},e)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(n){var e=de.point(n);return this.params.pixelSize=[e.x,e.y],this},layer:function(n){return this.path=n+"/query",this},_trapSQLerrors:function(n){n&&n.code==="400"&&su("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(n){this.params.inSR=4326;var e=d3(n);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function $1(n){return new Uce(n)}var zce=H1.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(n,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[n,e].join(":"),this},simplify:function(n,e){var t=Math.abs(n.getBounds().getWest()-n.getBounds().getEast());return this.params.maxAllowableOffset=t/n.getSize().y*e,this},run:function(n,e){return this.request(function(t,i){n.call(e,t,i&&f_(i),i)},e)}});function Gce(n){return new zce(n)}var f3=H1.extend({path:"identify",between:function(n,e){return this.params.time=[n.valueOf(),e.valueOf()],this}}),Hce=f3.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(n){var e=u3(n.getBounds()),t=n.getSize();return this.params.imageDisplay=[t.x,t.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at:function(n){return n.length===2&&(n=de.latLng(n)),this._setGeometryParams(n),this},layerDef:function(n,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[n,e].join(":"),this},simplify:function(n,e){var t=Math.abs(n.getBounds().getWest()-n.getBounds().getEast());return this.params.maxAllowableOffset=t/n.getSize().y*e,this},run:function(n,e){return this.request(function(t,i){if(t)n.call(e,t,void 0,i);else{var r=f_(i);i.results=i.results.reverse();for(var s=0;s<r.features.length;s++){var o=r.features[s];o.layerId=i.results[s].layerId}n.call(e,void 0,r,i)}})},_setGeometryParams:function(n){var e=d3(n);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function p3(n){return new Hce(n)}var $ce=f3.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(n){return n=de.latLng(n),this.params.geometry=JSON.stringify({x:n.lng,y:n.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(n,e){return this.request(function(t,i){n.call(e,t,i&&this._responseToGeoJSON(i),i)},this)},_responseToGeoJSON:function(n){var e=n.location,t=n.catalogItems,i=n.catalogItemVisibilities,r={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:n.objectId,name:n.name,value:n.value},id:n.objectId}};if(n.properties&&n.properties.Values&&(r.pixel.properties.values=n.properties.Values),t&&t.features&&(r.catalogItems=f_(t),i&&i.length===r.catalogItems.features.length))for(var s=i.length-1;s>=0;s--)r.catalogItems.features[s].properties.catalogItemVisibility=i[s];return r}});function Vce(n){return new $ce(n)}var V1=de.Evented.extend({options:{proxy:!1,useCors:h_,timeout:0},initialize:function(n){n=n||{},this._requestQueue=[],this._authenticating=!1,de.Util.setOptions(this,n),this.options.url=G1(this.options.url)},get:function(n,e,t,i){return this._request("get",n,e,t,i)},post:function(n,e,t,i){return this._request("post",n,e,t,i)},request:function(n,e,t,i){return this._request("request",n,e,t,i)},metadata:function(n,e){return this._request("get","",{},n,e)},authenticate:function(n){return this._authenticating=!1,this.options.token=n,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(n){this.options.timeout=n},_request:function(n,e,t,i,r){this.fire("requeststart",{url:this.options.url+e,params:t,method:n},!0);var s=this._createServiceCallback(n,e,t,i,r);if(this.options.token&&(t.token=this.options.token),this.options.requestParams&&de.Util.extend(t,this.options.requestParams),this._authenticating)this._requestQueue.push([n,e,t,i,r]);else{var o=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return(n==="get"||n==="request")&&!this.options.useCors?l0.get.JSONP(o,t,s,r):l0[n](o,t,s,r)}},_createServiceCallback:function(n,e,t,i,r){return de.Util.bind(function(s,o){s&&(s.code===499||s.code===498)&&(this._authenticating=!0,this._requestQueue.push([n,e,t,i,r]),this.fire("authenticationrequired",{authenticate:de.Util.bind(this.authenticate,this)},!0),s.authenticate=de.Util.bind(this.authenticate,this)),i.call(r,s,o),s?this.fire("requesterror",{url:this.options.url+e,params:t,message:s.message,code:s.code,method:n},!0):this.fire("requestsuccess",{url:this.options.url+e,params:t,response:o,method:n},!0),this.fire("requestend",{url:this.options.url+e,params:t,method:n},!0)},this)},_runQueue:function(){for(var n=this._requestQueue.length-1;n>=0;n--){var e=this._requestQueue[n],t=e.shift();this[t].apply(this,e)}this._requestQueue=[]}}),jce=V1.extend({identify:function(){return p3(this)},find:function(){return Gce(this)},query:function(){return $1(this)}});function g3(n){return new jce(n)}var Wce=V1.extend({query:function(){return $1(this)},identify:function(){return Vce(this)}});function qce(n){return new Wce(n)}var Kce=V1.extend({options:{idAttribute:"OBJECTID"},query:function(){return $1(this)},addFeature:function(n,e,t){this.addFeatures(n,e,t)},addFeatures:function(n,e,t){for(var i=n.features?n.features:[n],r=i.length-1;r>=0;r--)delete i[r].id;return n=c0(n),n=i.length>1?n:[n],this.post("addFeatures",{features:n},function(s,o){var a=o&&o.addResults?o.addResults.length>1?o.addResults:o.addResults[0]:void 0;e&&e.call(t,s||o.addResults[0].error,a)},t)},updateFeature:function(n,e,t){this.updateFeatures(n,e,t)},updateFeatures:function(n,e,t){var i=n.features?n.features:[n];return n=c0(n,this.options.idAttribute),n=i.length>1?n:[n],this.post("updateFeatures",{features:n},function(r,s){var o=s&&s.updateResults?s.updateResults.length>1?s.updateResults:s.updateResults[0]:void 0;e&&e.call(t,r||s.updateResults[0].error,o)},t)},deleteFeature:function(n,e,t){this.deleteFeatures(n,e,t)},deleteFeatures:function(n,e,t){return this.post("deleteFeatures",{objectIds:n},function(i,r){var s=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;e&&e.call(t,i||r.deleteResults[0].error,s)},t)}});function Zce(n){return new Kce(n)}var $i=window.location.protocol!=="https:"?"http:":"https:",_D=de.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:$i+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:dl?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:$i+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:$i+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:$i+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:$i+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(n,e){var t;if(typeof n=="object"&&n.urlTemplate&&n.options)t=n;else if(typeof n=="string"&&_D.TILES[n])t=_D.TILES[n];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var i=de.Util.extend(t.options,e);de.Util.setOptions(this,i),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&t.urlTemplate.indexOf("token=")===-1&&(t.urlTemplate+="?token="+this.options.token),this.options.proxy&&(t.urlTemplate=this.options.proxy+"?"+t.urlTemplate),de.TileLayer.prototype.initialize.call(this,t.urlTemplate,i)},onAdd:function(n){g_(n),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&Bce((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,n),n.on("moveend",sb),de.TileLayer.prototype.onAdd.call(this,n)},onRemove:function(n){m_(n),n.off("moveend",sb),de.TileLayer.prototype.onRemove.call(this,n)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var n=this._map.createPane(this.options.pane);n.style.pointerEvents="none",n.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var n='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return n}}),m3=de.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(n){n=de.Util.setOptions(this,n),n=p_(n),this.tileUrl=(n.proxy?n.proxy+"?":"")+n.url+"tile/{z}/{y}/{x}"+(n.requestParams&&Object.keys(n.requestParams).length>0?de.Util.getParamString(n.requestParams):""),n.url.indexOf("{s}")!==-1&&n.subdomains&&(n.url=n.url.replace("{s}",n.subdomains[0])),this.service=g3(n),this.service.addEventParent(this);var e=new RegExp(/tiles.arcgis(online)?\.com/g);e.test(n.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),n.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),de.TileLayer.prototype.initialize.call(this,this.tileUrl,n)},getTileUrl:function(n){var e=this._getZoomForUrl();return de.Util.template(this.tileUrl,de.Util.extend({s:this._getSubdomain(n),x:n.x,y:n.y,z:this._lodMap&&this._lodMap[e]!==void 0?this._lodMap[e]:e},this.options))},createTile:function(n,e){var t=document.createElement("img");return de.DomEvent.on(t,"load",de.Util.bind(this._tileOnLoad,this,e,t)),de.DomEvent.on(t,"error",de.Util.bind(this._tileOnError,this,e,t)),this.options.crossOrigin&&(t.crossOrigin=""),t.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]!==void 0?t.src=this.getTileUrl(n):this.once("lodmap",function(){t.src=this.getTileUrl(n)},this),t},onAdd:function(n){g_(n),this._lodMap||this.metadata(function(e,t){if(!e&&t.spatialReference){var i=t.spatialReference.latestWkid||t.spatialReference.wkid;if(!this.options.attribution&&n.attributionControl&&t.copyrightText&&(this.options.attribution=t.copyrightText,n.attributionControl.addAttribution(this.getAttribution())),n.options.crs===de.CRS.EPSG3857&&(i===102100||i===3857)){this._lodMap={};for(var r=t.tileInfo.lods,s=m3.MercatorZoomLevels,o=0;o<r.length;o++){var a=r[o];for(var l in s){var c=s[l];if(this._withinPercentage(a.resolution,c,this.options.zoomOffsetAllowance)){this._lodMap[l]=a.level;break}}}this.fire("lodmap")}else n.options.crs&&n.options.crs.code&&n.options.crs.code.indexOf(i)>-1||su("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),de.TileLayer.prototype.onAdd.call(this,n)},onRemove:function(n){m_(n),de.TileLayer.prototype.onRemove.call(this,n)},metadata:function(n,e){return this.service.metadata(n,e),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(n){var e="?token="+n;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=n,this.service.authenticate(n),this},_withinPercentage:function(n,e,t){var i=Math.abs(n/e-1);return i<t}});function Yce(n,e){return new m3(n,e)}var Xce=de.ImageOverlay.extend({onAdd:function(n){this._topLeft=n.getPixelBounds().min,de.ImageOverlay.prototype.onAdd.call(this,n)},_reset:function(){this._map.options.crs===de.CRS.EPSG3857?de.ImageOverlay.prototype._reset.call(this):de.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),v3=de.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:h_,attribution:null,interactive:!1,alt:""},onAdd:function(n){g_(n),this.options.zIndex&&(this.options.position=null),this._update=de.Util.throttle(this._update,this.options.updateInterval,this),n.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?n.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(e,t){!e&&!this.options.attribution&&n.attributionControl&&t.copyrightText&&(this.options.attribution=t.copyrightText,n.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(n){m_(n),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(n,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=de.popup(e),this._popupFunction=n,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(n){return this.options.zIndex=n,this._currentImage&&this._currentImage.setZIndex(n),this},_setAutoZIndex:function(n){if(this._currentImage){for(var e=this._currentImage.getPane().children,t=-n(-1/0,1/0),i=0,r=e.length,s;i<r;i++)s=e[i].style.zIndex,e[i]!==this._currentImage._image&&s&&(t=n(t,+s));isFinite(t)&&(this.options.zIndex=t+n(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(n){return this.options.opacity=n,this._currentImage&&this._currentImage.setOpacity(n),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(n,e){return this.options.from=n,this.options.to=e,this._update(),this},metadata:function(n,e){return this.service.metadata(n,e),this},authenticate:function(n){return this.service.authenticate(n),this},redraw:function(){this._update()},_renderImage:function(n,e,t){if(this._map){if(t&&(n="data:"+t+";base64,"+n),!n)return;var i=new Xce(n,e,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),r=function(){this._map.removeLayer(i),this.fire("error"),i.off("load",s,this)},s=function(o){if(i.off("error",r,this),this._map){var a=o.target,l=this._currentImage;a._bounds.equals(e)&&a._bounds.equals(this._map.getBounds())?(this._currentImage=a,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),l&&this._map&&this._map.removeLayer(l),l&&l._map&&l._map.removeLayer(l)):this._map.removeLayer(a)}this.fire("load",{bounds:e})};i.once("error",r,this),i.once("load",s,this)}},_update:function(){if(this._map){var n=this._map.getZoom(),e=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(n>this.options.maxZoom||n<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var t=this._buildExportParams();de.Util.extend(t,this.options.requestParams),t?(this._requestExport(t,e),this.fire("loading",{bounds:e})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(n,e,t,i){if(n=de.latLng(n),this._shouldRenderPopup&&this._lastClick.equals(n)){var r=this._popupFunction(e,t,i);r&&this._popup.setLatLng(n).setContent(r).openOn(this._map)}},_resetPopupState:function(n){this._shouldRenderPopup=!1,this._lastClick=n.latlng},_calculateBbox:function(){var n=this._map.getPixelBounds(),e=this._map.unproject(n.getBottomLeft()),t=this._map.unproject(n.getTopRight()),i=this._map.options.crs.project(t),r=this._map.options.crs.project(e),s=de.bounds(i,r);return[s.getBottomLeft().x,s.getBottomLeft().y,s.getTopRight().x,s.getTopRight().y].join(",")},_calculateImageSize:function(){var n=this._map.getPixelBounds(),e=this._map.getSize(),t=this._map.unproject(n.getBottomLeft()),i=this._map.unproject(n.getTopRight()),r=this._map.latLngToLayerPoint(i).y,s=this._map.latLngToLayerPoint(t).y;return(r>0||s<e.y)&&(e.y=s-r),e.x+","+e.y}}),Jce=v3.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(n){n=p_(n),this.service=qce(n),this.service.addEventParent(this),de.Util.setOptions(this,n)},setPixelType:function(n){return this.options.pixelType=n,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(n){return de.Util.isArray(n)?this.options.bandIds=n.join(","):this.options.bandIds=n.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(n,e){return de.Util.isArray(n)?this.options.noData=n.join(","):this.options.noData=n.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(n){this.options.renderingRule=n,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(n){this.options.mosaicRule=n,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(n){var e=de.Util.bind(function(i,r,s){i||setTimeout(de.Util.bind(function(){this._renderPopup(n.latlng,i,r,s)},this),300)},this),t=this.identify().at(n.latlng);this.options.mosaicRule&&t.setMosaicRule(this.options.mosaicRule),t.run(e),this._shouldRenderPopup=!0,this._lastClick=n.latlng},_buildExportParams:function(){var n=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:n,imageSR:n};return this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport:function(n,e){if(this.options.f==="json")this.service.request("exportImage",n,function(i,r){i||(this.options.token&&(r.href+="?token="+this.options.token),this.options.proxy&&(r.href=this.options.proxy+"?"+r.href),this._renderImage(r.href,e))},this);else{n.f="image";var t=this.options.url+"exportImage"+de.Util.getParamString(n);this.options.proxy&&(t=this.options.proxy+"?"+t),this._renderImage(t,e)}}});function Qce(n,e){return new Jce(n,e)}var eue=v3.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(n){n=p_(n),this.service=g3(n),this.service.addEventParent(this),de.Util.setOptions(this,n)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(n){return this.options.dynamicLayers=n,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(n){return this.options.layers=n,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(n){return this.options.layerDefs=n,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(n){return this.options.timeOptions=n,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(n){var e=de.Util.bind(function(r,s,o){r||setTimeout(de.Util.bind(function(){this._renderPopup(n.latlng,r,s,o)},this),300)},this),t;if(this.options.popup?t=this.options.popup.on(this._map).at(n.latlng):t=this.identify().on(this._map).at(n.latlng),t.params.maxAllowableOffset||t.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?t.layers("visible:"+this.options.layers.join(",")):t.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!t.params.layerDefs)for(var i in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,i)&&t.layerDef(i,this.options.layerDefs[i]);t.run(e),this._shouldRenderPopup=!0,this._lastClick=n.latlng},_buildExportParams:function(){var n=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:n,imageSR:n};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;e.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(e.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport:function(n,e){if(this.options.f==="json")this.service.request("export",n,function(i,r){i||(this.options.token&&r.href&&(r.href+="?token="+this.options.token),this.options.proxy&&r.href&&(r.href=this.options.proxy+"?"+r.href),r.href?this._renderImage(r.href,e):this._renderImage(r.imageData,e,r.contentType))},this);else{n.f="image";var t=this.options.url+"export"+de.Util.getParamString(n);this.options.proxy&&(t=this.options.proxy+"?"+t),this._renderImage(t,e)}}});function tue(n,e){return new eue(n,e)}var Fv=de.Layer.extend({options:{cellSize:512,updateWhenIdle:de.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(n){de.Util.setOptions(this,n)},onAdd:function(n){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(n){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var n={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=de.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),n.move=this._onMove),n},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var n=this.options.cellSize;return n instanceof de.Point?n:new de.Point(n,n)},_pruneCells:function(){if(this._map){var n,e;for(n in this._cells)e=this._cells[n],e.retain=e.current;for(n in this._cells)if(e=this._cells[n],e.current&&!e.active){var t=e.coords;this._retainParent(t.x,t.y,t.z,t.z-5)||this._retainChildren(t.x,t.y,t.z,t.z+2)}for(n in this._cells)this._cells[n].retain||this._removeCell(n)}},_removeAllCells:function(){for(var n in this._cells)this._removeCell(n)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(n,e,t,i){var r=Math.floor(n/2),s=Math.floor(e/2),o=t-1,a=new de.Point(+r,+s);a.z=+o;var l=this._cellCoordsToKey(a),c=this._cells[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),o>i?this._retainParent(r,s,o,i):!1)},_retainChildren:function(n,e,t,i){for(var r=2*n;r<2*n+2;r++)for(var s=2*e;s<2*e+2;s++){var o=new de.Point(r,s);o.z=t+1;var a=this._cellCoordsToKey(o),l=this._cells[a];if(l&&l.active){l.retain=!0;continue}else l&&l.loaded&&(l.retain=!0);t+1<i&&this._retainChildren(r,s,t+1,i)}},_resetView:function(n){var e=n&&(n.pinch||n.flyTo);e||this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_setView:function(n,e,t,i){var r=Math.round(e);i||(this._cellZoom=r,this._abortLoading&&this._abortLoading(),this._resetGrid(),r!==void 0&&this._update(n),t||this._pruneCells(),this._noPrune=!!t)},_resetGrid:function(){var n=this._map,e=n.options.crs,t=this._cellSize=this.getCellSize(),i=this._cellZoom,r=this._map.getPixelWorldBounds(this._cellZoom);r&&(this._globalCellRange=this._pxBoundsToCellRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(n.project([0,e.wrapLng[0]],i).x/t.x),Math.ceil(n.project([0,e.wrapLng[1]],i).x/t.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(n.project([e.wrapLat[0],0],i).y/t.x),Math.ceil(n.project([e.wrapLat[1],0],i).y/t.y)]},_onMoveEnd:function(n){var e=n&&(n.pinch||n.flyTo);e||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(n){var e=this._map,t=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(t,this._cellZoom),r=e.project(n,this._cellZoom).floor(),s=e.getSize().divideBy(i*2);return new de.Bounds(r.subtract(s),r.add(s))},_update:function(n){var e=this._map;if(e){var t=Math.round(e.getZoom());n===void 0&&(n=e.getCenter());var i=this._getCelldPixelBounds(n),r=this._pxBoundsToCellRange(i),s=r.getCenter(),o=[],a=this.options.keepBuffer,l=new de.Bounds(r.getBottomLeft().subtract([a,-a]),r.getTopRight().add([a,-a]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var c in this._cells){var u=this._cells[c].coords;(u.z!==this._cellZoom||!l.contains(new de.Point(u.x,u.y)))&&(this._cells[c].current=!1)}if(Math.abs(t-this._cellZoom)>1){this._setView(n,t);return}for(var f=r.min.y;f<=r.max.y;f++)for(var p=r.min.x;p<=r.max.x;p++){var m=new de.Point(p,f);if(m.z=this._cellZoom,!!this._isValidCell(m)){var y=this._cells[this._cellCoordsToKey(m)];y?y.current=!0:o.push(m)}}if(o.sort(function(T,x){return T.distanceTo(s)-x.distanceTo(s)}),o.length!==0)for(this._loading||(this._loading=!0),p=0;p<o.length;p++){var _=this._cellCoordsToKey(o[p]),w=this._keyToCellCoords(_);this._activeCells[w]?this._reuseCell(o[p]):this._createCell(o[p])}}},_isValidCell:function(n){var e=this._map.options.crs;if(!e.infinite){var t=this._globalCellRange;if(!e.wrapLng&&(n.x<t.min.x||n.x>t.max.x)||!e.wrapLat&&(n.y<t.min.y||n.y>t.max.y))return!1}if(!this.options.bounds)return!0;var i=this._cellCoordsToBounds(n);return de.toLatLngBounds(this.options.bounds).overlaps(i)},_keyToBounds:function(n){return this._cellCoordsToBounds(this._keyToCellCoords(n))},_cellCoordsToNwSe:function(n){var e=this._map,t=this.getCellSize(),i=n.scaleBy(t),r=i.add(t),s=e.unproject(i,n.z),o=e.unproject(r,n.z);return[s,o]},_cellCoordsToBounds:function(n){var e=this._cellCoordsToNwSe(n),t=new de.LatLngBounds(e[0],e[1]);return this.options.noWrap||(t=this._map.wrapLatLngBounds(t)),t},_cellCoordsToKey:function(n){return n.x+":"+n.y+":"+n.z},_keyToCellCoords:function(n){var e=n.split(":"),t=new de.Point(+e[0],+e[1]);return t.z=+e[2],t},_removeCell:function(n){var e=this._cells[n];if(e){var t=this._keyToCellCoords(n),i=this._wrapCoords(t),r=this._cellCoordsToBounds(this._wrapCoords(t));e.current=!1,delete this._cells[n],this._activeCells[n]=e,this.cellLeave(r,i,n),this.fire("cellleave",{key:n,coords:i,bounds:r})}},_reuseCell:function(n){var e=this._cellCoordsToKey(n);this._cells[e]=this._activeCells[e],this._cells[e].current=!0;var t=this._wrapCoords(n),i=this._cellCoordsToBounds(this._wrapCoords(n));this.cellEnter(i,t,e),this.fire("cellenter",{key:e,coords:t,bounds:i})},_createCell:function(n){var e=this._cellCoordsToKey(n),t=this._wrapCoords(n),i=this._cellCoordsToBounds(this._wrapCoords(n));this.createCell(i,t,e),this.fire("cellcreate",{key:e,coords:t,bounds:i}),this._cells[e]={coords:n,current:!0},de.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(n,e,t){var i=this._cellCoordsToKey(n);t=this._cells[i],t&&(t.loaded=+new Date,t.active=!0)},_getCellPos:function(n){return n.scaleBy(this.getCellSize())},_wrapCoords:function(n){var e=new de.Point(this._wrapX?de.Util.wrapNum(n.x,this._wrapX):n.x,this._wrapY?de.Util.wrapNum(n.y,this._wrapY):n.y);return e.z=n.z,e},_pxBoundsToCellRange:function(n){var e=this.getCellSize();return new de.Bounds(n.min.unscaleBy(e).floor(),n.max.unscaleBy(e).ceil().subtract([1,1]))}});function la(n){this.values=[].concat(n||[])}la.prototype.query=function(n){var e=this.getIndex(n);return this.values[e]};la.prototype.getIndex=function(e){this.dirty&&this.sort();for(var t=0,i=this.values.length-1,r,s;t<=i;)if(r=(t+i)/2|0,s=this.values[Math.round(r)],+s.value<+e)t=r+1;else if(+s.value>+e)i=r-1;else return r;return Math.abs(~i)};la.prototype.between=function(e,t){var i=this.getIndex(e),r=this.getIndex(t);if(i===0&&r===0)return[];for(;this.values[i-1]&&this.values[i-1].value===e;)i--;for(;this.values[r+1]&&this.values[r+1].value===t;)r++;return this.values[r]&&this.values[r].value===t&&this.values[r+1]&&r++,this.values.slice(i,r)};la.prototype.insert=function(e){return this.values.splice(this.getIndex(e.value),0,e),this};la.prototype.bulkAdd=function(e,t){return this.values=this.values.concat([].concat(e||[])),t?this.sort():this.dirty=!0,this};la.prototype.sort=function(){return this.values.sort(function(e,t){return+t.value-+e.value}).reverse(),this.dirty=!1,this};var pT=Fv.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(n){if(Fv.prototype.initialize.call(this,n),n=p_(n),n=de.Util.setOptions(this,n),this.service=Zce(n),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var e=!1,t=0;t<this.options.fields.length;t++)this.options.fields[t].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);e===!1&&su("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new la,this._endTimeIndex=new la):this.options.timeField&&(this._timeIndex=new la),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(n){return g_(n),this.service.metadata(function(e,t){if(!e){var i=t.supportedQueryFormats,r=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(r=!0),!r&&i&&i.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),t.objectIdField&&(this.service.options.idAttribute=t.objectIdField),!this.options.attribution&&n.attributionControl&&t.copyrightText&&(this.options.attribution=t.copyrightText,n.attributionControl.addAttribution(this.getAttribution()))}},this),n.on("zoomend",this._handleZoomChange,this),Fv.prototype.onAdd.call(this,n)},onRemove:function(n){return m_(n),n.off("zoomend",this._handleZoomChange,this),Fv.prototype.onRemove.call(this,n)},getAttribution:function(){return this.options.attribution},createCell:function(n,e){this._visibleZoom()&&this._requestFeatures(n,e)},_requestFeatures:function(n,e,t,i){this._activeRequests++,i=i||0;var r=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:n},!0),this._buildQuery(n,i).run(function(s,o,a){a&&a.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===r&&(!s&&o&&o.features.length&&de.Util.requestAnimFrame(de.Util.bind(function(){this._addFeatures(o.features,e),this._postProcessFeatures(n)},this)),!s&&o&&!o.features.length&&this._postProcessFeatures(n),s&&this._postProcessFeatures(n),t&&t.call(this,s,o),a&&(a.exceededTransferLimit||a.properties&&a.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(n,e,t,i+o.features.length))},this)},_postProcessFeatures:function(n){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:n})},_cacheKey:function(n){return n.z+":"+n.x+":"+n.y},_addFeatures:function(n,e){if(e){var t=this._cacheKey(e);this._cache[t]=this._cache[t]||[]}for(var i=n.length-1;i>=0;i--){var r=n[i].id;this._currentSnapshot.indexOf(r)===-1&&this._currentSnapshot.push(r),typeof t<"u"&&this._cache[t].indexOf(r)===-1&&this._cache[t].push(r)}this.options.timeField&&this._buildTimeIndexes(n),this.createLayers(n)},_buildQuery:function(n,e){var t=this.service.query().intersects(n).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(e))&&(t=t.offset(e)),t.params.resultType="tile",this.options.requestParams&&de.Util.extend(t.params,this.options.requestParams),this.options.simplifyFactor&&t.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&t.between(this.options.from,this.options.to),t},setWhere:function(n,e,t){this.options.where=n&&n.length?n:"1=1";for(var i=[],r=[],s=0,o=null,a=de.Util.bind(function(p,m){if(p&&(o=p),m)for(var y=m.features.length-1;y>=0;y--)r.push(m.features[y].id);s--,s<=0&&this._visibleZoom()&&n===this.options.where&&(this._currentSnapshot=r,de.Util.requestAnimFrame(de.Util.bind(function(){this.removeLayers(i),this.addLayers(r),e&&e.call(t,o)},this)))},this),l=this._currentSnapshot.length-1;l>=0;l--)i.push(this._currentSnapshot[l]);this._cache={};for(var c in this._cells){s++;var u=this._keyToCellCoords(c),f=this._cellCoordsToBounds(u);this._requestFeatures(f,u,a)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(n,e,t,i){var r=this.options.from,s=this.options.to,o=0,a=null,l=de.Util.bind(function(p){p&&(a=p),this._filterExistingFeatures(r,s,n,e),o--,t&&o<=0&&t.call(i,a)},this);if(this.options.from=n,this.options.to=e,this._filterExistingFeatures(r,s,n,e),this.options.timeFilterMode==="server")for(var c in this._cells){o++;var u=this._keyToCellCoords(c),f=this._cellCoordsToBounds(u);this._requestFeatures(f,u,l)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(n,e,t,i){var r=n&&e?this._getFeaturesInTimeRange(n,e):this._currentSnapshot,s=this._getFeaturesInTimeRange(t,i);if(s.indexOf)for(var o=0;o<s.length;o++){var a=r.indexOf(s[o]);a>=0&&r.splice(a,1)}de.Util.requestAnimFrame(de.Util.bind(function(){this.removeLayers(r),this.addLayers(s)},this))},_getFeaturesInTimeRange:function(n,e){var t=[],i;if(this.options.timeField.start&&this.options.timeField.end){var r=this._startTimeIndex.between(n,e),s=this._endTimeIndex.between(n,e);i=r.concat(s)}else if(this._timeIndex)i=this._timeIndex.between(n,e);else return su("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var o=i.length-1;o>=0;o--)t.push(i[o].id);return t},_buildTimeIndexes:function(n){var e,t;if(this.options.timeField.start&&this.options.timeField.end){var i=[],r=[];for(e=n.length-1;e>=0;e--)t=n[e],i.push({id:t.id,value:new Date(t.properties[this.options.timeField.start])}),r.push({id:t.id,value:new Date(t.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(i),this._endTimeIndex.bulkAdd(r)}else{var s=[];for(e=n.length-1;e>=0;e--)t=n[e],s.push({id:t.id,value:new Date(t.properties[this.options.timeField])});this._timeIndex.bulkAdd(s)}},_featureWithinTimeRange:function(n){if(!this.options.from||!this.options.to)return!0;var e=+this.options.from.valueOf(),t=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var i=+n.properties[this.options.timeField];return i>=e&&i<=t}if(this.options.timeField.start&&this.options.timeField.end){var r=+n.properties[this.options.timeField.start],s=+n.properties[this.options.timeField.end];return r>=e&&r<=t||s>=e&&s<=t||r<=e&&s>=t}},_visibleZoom:function(){if(!this._map)return!1;var n=this._map.getZoom();return!(n>this.options.maxZoom||n<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(var n in this._cells){var e=this._cells[n].coords,t=this._cacheKey(e);this._cache[t]&&this.addLayers(this._cache[t])}},authenticate:function(n){return this.service.authenticate(n),this},metadata:function(n,e){return this.service.metadata(n,e),this},query:function(){return this.service.query()},_getMetadata:function(n){if(this._metadata){var e;n(e,this._metadata)}else this.metadata(de.Util.bind(function(t,i){this._metadata=i,n(t,this._metadata)},this))},addFeature:function(n,e,t){this.addFeatures(n,e,t)},addFeatures:function(n,e,t){this._getMetadata(de.Util.bind(function(i,r){if(i){e&&e.call(this,i,null);return}var s=n.features?n.features:[n];this.service.addFeatures(n,de.Util.bind(function(o,a){if(!o){for(var l=s.length-1;l>=0;l--)s[l].properties[r.objectIdField]=s.length>1?a[l].objectId:a.objectId,s[l].id=s.length>1?a[l].objectId:a.objectId;this._addFeatures(s)}e&&e.call(t,o,a)},this))},this))},updateFeature:function(n,e,t){this.updateFeatures(n,e,t)},updateFeatures:function(n,e,t){var i=n.features?n.features:[n];this.service.updateFeatures(n,function(r,s){if(!r){for(var o=i.length-1;o>=0;o--)this.removeLayers([i[o].id],!0);this._addFeatures(i)}e&&e.call(t,r,s)},this)},deleteFeature:function(n,e,t){this.deleteFeatures(n,e,t)},deleteFeatures:function(n,e,t){return this.service.deleteFeatures(n,function(i,r){var s=r.length?r:[r];if(!i&&s.length>0)for(var o=s.length-1;o>=0;o--)this.removeLayers([s[o].objectId],!0);e&&e.call(t,i,r)},this)}}),iue=pT.extend({options:{cacheLayers:!0},initialize:function(n){n.apikey&&(n.token=n.apikey),pT.prototype.initialize.call(this,n),this._originalStyle=this.options.style,this._layers={}},onRemove:function(n){for(var e in this._layers)n.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return pT.prototype.onRemove.call(this,n)},createNewLayer:function(n){var e=de.GeoJSON.geometryToLayer(n,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer:function(n,e){var t=[],i=this.options.coordsToLatLng||de.GeoJSON.coordsToLatLng;switch(e.properties&&(n.feature.properties=e.properties),e.geometry.type){case"Point":t=de.GeoJSON.coordsToLatLng(e.geometry.coordinates),n.setLatLng(t);break;case"LineString":t=de.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,i),n.setLatLngs(t);break;case"MultiLineString":t=de.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,i),n.setLatLngs(t);break;case"Polygon":t=de.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,i),n.setLatLngs(t);break;case"MultiPolygon":t=de.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,i),n.setLatLngs(t);break}this.redraw(n.feature.id)},createLayers:function(n){for(var e=n.length-1;e>=0;e--){var t=n[e],i=this._layers[t.id],r;this._visibleZoom()&&i&&!this._map.hasLayer(i)&&(!this.options.timeField||this._featureWithinTimeRange(t))&&(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0)),i&&(i.setLatLngs||i.setLatLng)&&this._updateLayer(i,t),i||(r=this.createNewLayer(t),r?(r.feature=t,r.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(r.feature,r),this._layers[r.feature.id]=r,this.setFeatureStyle(r.feature.id,this.options.style),this.fire("createfeature",{feature:r.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(t))&&this._map.addLayer(r)):su("invalid GeoJSON encountered"))}},addLayers:function(n){for(var e=n.length-1;e>=0;e--){var t=this._layers[n[e]];t&&(!this.options.timeField||this._featureWithinTimeRange(t.feature))&&(this._map.addLayer(t),this.fire("addfeature",{feature:t.feature},!0))}},removeLayers:function(n,e){for(var t=n.length-1;t>=0;t--){var i=n[t],r=this._layers[i];r&&(this.fire("removefeature",{feature:r.feature,permanent:e},!0),this._map.removeLayer(r)),r&&e&&delete this._layers[i]}},cellEnter:function(n,e){this._visibleZoom()&&!this._zooming&&this._map&&de.Util.requestAnimFrame(de.Util.bind(function(){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t];this._activeCells[i]&&r&&this.addLayers(r)},this))},cellLeave:function(n,e){this._zooming||de.Util.requestAnimFrame(de.Util.bind(function(){if(this._map){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t],s=this._map.getBounds();if(!this._activeCells[i]&&r){for(var o=!0,a=0;a<r.length;a++){var l=this._layers[r[a]];l&&l.getBounds&&s.intersects(l.getBounds())&&(o=!1)}o&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[t],delete this._cells[i],delete this._activeCells[i])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(n){this.resetFeatureStyle(n.feature.id)},this),this},setStyle:function(n){return this.options.style=n,this.eachFeature(function(e){this.setFeatureStyle(e.feature.id,n)},this),this},resetFeatureStyle:function(n){var e=this._layers[n],t=this._originalStyle||de.Path.prototype.options;return e&&(de.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(n,t)),this},setFeatureStyle:function(n,e){var t=this._layers[n];return typeof e=="function"&&(e=e(t.feature)),t.setStyle&&t.setStyle(e),this},eachActiveFeature:function(n,e){if(this._map){var t=this._map.getBounds();for(var i in this._layers)this._currentSnapshot.indexOf(this._layers[i].feature.id)!==-1&&(typeof this._layers[i].getLatLng=="function"&&t.contains(this._layers[i].getLatLng())?n.call(e,this._layers[i]):typeof this._layers[i].getBounds=="function"&&t.intersects(this._layers[i].getBounds())&&n.call(e,this._layers[i]))}return this},eachFeature:function(n,e){for(var t in this._layers)n.call(e,this._layers[t]);return this},getFeature:function(n){return this._layers[n]},bringToBack:function(){this.eachFeature(function(n){n.bringToBack&&n.bringToBack()})},bringToFront:function(){this.eachFeature(function(n){n.bringToFront&&n.bringToFront()})},redraw:function(n){return n&&this._redraw(n),this},_redraw:function(n){var e=this._layers[n],t=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var i=this.options.pointToLayer(t,de.latLng(t.geometry.coordinates[1],t.geometry.coordinates[0])),r=i.options.icon;e.setIcon(r)}if(e&&e.setStyle&&this.options.pointToLayer){var s=this.options.pointToLayer(t,de.latLng(t.geometry.coordinates[1],t.geometry.coordinates[0])),o=s.options;this.setFeatureStyle(t.id,o)}e&&e.setStyle&&this.options.style&&this.resetFeatureStyle(t.id)},openPopup(n){return this._popup&&this._popup._prepareOpen(n||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(n){return this._tooltip&&this._tooltip._prepareOpen(n)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});function nue(n){return new iue(n)}const ob={darkMatter:{url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},positron:{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},positronLite:{url:"https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},worldAntique:{url:"https://cartocdn_{s}.global.ssl.fastly.net/base-antique/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},worldEco:{url:"https://cartocdn_{s}.global.ssl.fastly.net/base-eco/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},flatBlue:{url:"https://cartocdn_{s}.global.ssl.fastly.net/base-flatblue/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},midnightCommander:{url:"https://cartocdn_{s}.global.ssl.fastly.net/base-midnight/{z}/{x}/{y}{retina}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://carto.com/attributions">Carto</a>',maxZoom:18,worldCopyJump:!0,retina:"@2x"},openstreetmapHot:{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>',maxZoom:19,worldCopyJump:!0,retina:"@2x"},openstreetmapStandard:{url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,worldCopyJump:!0,retina:"@2x"}},rue=n=>{let e=n.getSouthWest(),t=n.getNorthEast();return t.lng-e.lng>=360&&(e.lng=-180,t.lng=180),e=e.wrap(),t=t.wrap(),[de.Util.formatNum(e.lng,6),de.Util.formatNum(e.lat,6),de.Util.formatNum(t.lng,6),de.Util.formatNum(t.lat,6)]},ab=n=>de.geoJSON(n).getBounds(),sue=(n,e)=>{let t=null;return function(...i){clearTimeout(t),t=setTimeout(()=>{n.apply(this,i)},e)}},oue=n=>{const e=n.bounds;if(e){const t=de.latLng(e[1],e[0]),i=de.latLng(e[3],e[2]);return de.latLngBounds(t,i)}},y3=()=>{const n=`<tbody class="attribute-table-body"><tr><td colspan="2">
    <span id="attribute-table">
    <div class="spinner-border" role="status"><span class="visually-hidden">Inspecting</span></div>
    </span>
    </td></tr></tbody>`;document.querySelector(".attribute-table-body").innerHTML=n},_3=()=>{document.querySelector(".attribute-table-body").innerHTML=`<tbody class="attribute-table-body">
    <tr><td colspan="2">Could not find that feature</td></tr></tbody>`},aue=n=>{if(!n)return"";const e=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g;return n.toString().replace(e,"<a href='$1'>$1</a>")},E3=n=>n.options.fillOpacity?n.options.fillOpacity:n.options.opacity;class lue extends de.Control{constructor(e,t={}){super(t),this.options.position="topleft";var i=[e];typeof e.getLayers<"u"?(i=e.getLayers(),i=i&&i[0]instanceof L.Layer?i:[e]):this.layersOnLoad=Object.keys(e).includes("_layers"),this.options.layer=i[0],this.options.layers=this.layersOnLoad?[]:i}onAdd(e){const t=de.DomUtil.create("div","opacity-control unselectable");de.DomUtil.create("div","opacity-area",t);const i=de.DomUtil.create("div","opacity-handle",t);de.DomUtil.create("div","opacity-arrow-up",i);const r=de.DomUtil.create("div","opacity-text",i);de.DomUtil.create("div","opacity-arrow-down",i);const s=de.DomUtil.create("div","opacity-bottom",t);de.DomEvent.stopPropagation(t),de.DomEvent.disableClickPropagation(t),this.setListeners(i,s,r,e),i.setAttribute("tabindex","0");let o=E3(this.options.layer);const a=parseInt(o*100);return i.style.zIndex=4,i.style.top=`calc(100% - ${a}% - 12px)`,r.innerHTML=`${a}%`,t}updateMapOpacity(e){this.options.layers.forEach(t=>this.layerOpacity(t,e))}layerOpacity(e,t){try{e.setStyle({fillOpacity:t,opacity:t})}catch{try{e.setOpacity(t)}catch{console.log(e)}}}setListeners(e,t,i,r){let s=!1,o;de.DomEvent.on(document,"mousemove",l=>{if(!s)return;const c=Math.max(0,Math.min(200,o+parseInt(l.clientY,10)-s))/2;e.style.top=`${c*2-13}px`,i.innerHTML=`${Math.round((1-c/100)*100)}%`,t.style.height=`${Math.max(0,(100-c)*2-13)}px`,t.style.top=`${Math.min(200,c*2+13)}px`,this.updateMapOpacity(1-c/100)}),de.DomEvent.on(e,"mousedown",l=>(s=parseInt(l.clientY,10),o=e.offsetTop-12,!1)),de.DomEvent.on(document,"mouseup",()=>{s=null});let a=this;de.DomEvent.on(r,"layeradd",function(l){(l.layer.options.addToOpacitySlider||a.layersOnLoad&&l.layer instanceof L.Layer)&&a.options.layers.push(l.layer)}),de.DomEvent.on(r,"layerremove",function(l){if(l.layer.options.addToOpacitySlider){const c=a.options.layers.indexOf(l.layer);c&&a.options.layers.splice(c,1)}}),de.DomEvent.on(e,"keydown",function(l){const c=a.geoJSON?a.options.layer.style.fillOpacity:a.options.layer.options.opacity,u=1;var f;if(l.key=="ArrowDown")f=c*100-u;else if(l.key=="ArrowUp")f=c*100+u;else return;l.preventDefault(),!(f>100||f<0)&&(f=Math.round(f),e.style.top=`calc(100% - ${f}% - 12px)`,i.innerHTML=f+"%",t.style.height=f+"%",t.style.top=`calc(100% - ${f}%)`,a.updateMapOpacity(f/100))})}}const cue={dynamic:!0,delay:800};class uue extends de.Control{constructor(e){const t={...cue,...e};super(t),de.setOptions(this,t)}onAdd(e){this.map=e,this.map.options.geoSearchControl=this,this.staticButton=this.createStaticButton(),this.dynamicButton=this.createDynamicButton();const t=de.DomUtil.create("div");return t.className="leaflet-control search-control",t.appendChild(this.staticButton),t.appendChild(this.dynamicButton),this.options.dynamic?this.dynamicButton.style.display="block":this.staticButton.style.display="block",this.dynamicSearcher=sue(()=>{this.options.dynamic&&this.applySearch()},this.options.delay),this.map.addHandler("geosearch",hue),t}createStaticButton(){const e=de.DomUtil.create("a");return e.setAttribute("id","gbl-static-button"),e.setAttribute("href","#"),e.setAttribute("style","display:none;"),e.className="btn btn-primary",e.textContent="Search here",e.addEventListener("click",this.staticSearch.bind(this)),e}createDynamicButton(){const e=de.DomUtil.create("label");e.setAttribute("id","gbl-dynamic-button"),e.textContent=" Search when I move the map",e.setAttribute("style","display:none;");const t=de.DomUtil.create("input");return t.setAttribute("type","checkbox"),t.checked=!0,e.insertBefore(t,e.firstChild),e.addEventListener("input",this.toggleDynamicSearch.bind(this)),e}staticSearch(){this.staticButton.style.display="none",this.options.dynamic&&(this.dynamicButton.style.display="block"),this.applySearch({turbo:!1})}applySearch(e={turbo:!0}){const t=new URL(window.location).searchParams;t.delete("page"),t.delete("bbox");const i=rue(this._map.getBounds());t.set("bbox",i.join(" "));const r=new URL(this.options.baseUrl);r.search=t.toString(),window.Turbo&&e.turbo?window.Turbo.visit(r):window.location.href=r}toggleDynamicSearch(){this.options.dynamic=!this.options.dynamic}hideDynamicButton(){this.dynamicButton.style.display="none",this.staticButton.style.display="block"}}class hue extends de.Handler{constructor(e){super(e),this.map=e,this.control=e.options.geoSearchControl,this.wasResized=!1}addHooks(){this.map.on("resize",this.handleResize.bind(this)),this.map.on("dragend",this.handleDragEnd.bind(this)),this.map.on("dragstart",this.handleDragStart.bind(this)),this.map.on("zoomstart",this.handleDragEnd.bind(this)),this.map.on("zoomend",this.handleDragStart.bind(this))}removeHooks(){this.map.off("resize"),this.map.off("dragend"),this.map.off("dragstart"),this.map.off("zoomend"),this.map.off("zoomstart")}handleResize(){this.wasResized=!0}handleDragEnd(){this.wasResized?this.wasResized=!1:this.control.dynamicSearcher.apply(this.control)}handleDragStart(){this.control.options.dynamic||this.control.hideDynamicButton()}}const due=(n,e,t,i)=>{n.getContainer().classList.add("leaflet-clickable"),n.on("click",async r=>{const s=document.createElement("tbody");s.className="attribute-table-body",s.innerHTML='<tr><td colspan="2"><div class="spinner-border" role="status"><span class="visually-hidden">Inspecting</span></div></td></tr>',document.querySelector(".attribute-table-body").replaceWith(s);const o={URL:e,LAYERS:t,BBOX:n.getBounds().toBBoxString(),WIDTH:Math.round(document.getElementById("leaflet-viewer").clientWidth),HEIGHT:Math.round(document.getElementById("leaflet-viewer").clientHeight),QUERY_LAYERS:t,X:Math.round(r.containerPoint.x),Y:Math.round(r.containerPoint.y)};try{const a=await fetch("/wms/handle",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(o)});if(!a.ok)throw new Error("Network response was not ok.");const l=await a.json();if(l.hasOwnProperty("error")||l.hasOwnProperty("exceptions")||l.features.length===0){document.querySelector(".attribute-table-body").innerHTML='<tr><td colspan="2">Could not find that feature</td></tr>';return}const c=l.features[0];c.isHTML||j1(n,c,i),W1(c)}catch(a){console.error("Fetch error: ",a)}})},j1=(n,e,t)=>{const i=Object.values(n._layers).filter(a=>a.options.highlightLayer);if(i[0]&&i.map(a=>n.removeLayer(a)),!e)return;let r;const s=E3(t),o=n.options.selected_color;e._latlngs?r=L.polygon(e._latlngs,{color:o,weight:2,layer:!0,fillOpacity:s,addToOpacitySlider:!0,highlightLayer:!0}):r=L.geoJSON(e,{color:o,opacity:s,addToOpacitySlider:!0,highlightLayer:!0,pointToLayer:function(a,l){return L.circleMarker(l,{radius:8,fillColor:o,color:o,weight:1,opacity:s,fillOpacity:s})}}),L.layerGroup([r]).addTo(n)},fue=(n,e,t)=>{n.getContainer().classList.add("leaflet-clickable"),n.on("click",i=>{y3();const r=p3({url:e.options.url,useCors:!0}).tolerance(2).returnGeometry(!0).on(n).at(i.latlng);t&&r.layers("all: "+t),r.run((s,o,a)=>{s||a.results<1?_3():(j1(n,o.features[0],e),W1(o.features[0]))})})},pue=(n,e)=>{e.on("load",function(){this.eachFeature(function(t){var i=t._path?t._path:t._icon;i&&i.classList.add("leaflet-clickable")})}),e.on("click",t=>{const i=3e3/(1+n.getZoom());y3(),e.query().returnGeometry(!0).nearby(t.latlng,i).run((r,s)=>{r||!s.features.length?_3():(j1(n,s.features[0],e),W1(s.features[0]))})})},W1=n=>{let e='<tbody class="attribute-table-body">';Object.keys(n.properties).forEach(i=>{e+=`<tr><td>${i}</td>
               <td>${aue(n.properties[i])}</td></tr>`}),e+="</tbody>";const t=document.querySelector(".attribute-table-body");t&&(t.outerHTML=e)},gue=(n,e)=>{const t=new DOMParser,i=t.parseFromString(n,"application/xml"),r=i.getElementsByTagName("Layer"),s=mue(r,e);return{url:s.getElementsByTagName("ResourceURL")[0].getAttribute("template").replace("{Style}",vue(s)).replace("{TileMatrixSet}",yue(s)).replace("TileMatrix","z").replace("TileCol","x").replace("TileRow","y"),bounds:_ue(s)}},mue=(n,e)=>{if(n.length===1)return n[0];for(let t=0;t<n.length;t++){const i=n[t].getElementsByTagName("ows:Identifier");for(let r=0;r<i.length;r++)if(i[r].textContent===e)return n[t]}},vue=n=>{const e=n.getElementsByTagName("Style")[0];return e?e.getElementsByTagName("ows:Identifier")[0].textContent:void 0},yue=n=>{const e=n.getElementsByTagName("TileMatrixSet")[0];return e?e.textContent:void 0},_ue=n=>{const e=n.getElementsByTagName("ows:LowerCorner")[0],t=n.getElementsByTagName("ows:UpperCorner")[0];if(e&&t){const i=e.textContent.split(" "),r=t.textContent.split(" "),s=de.latLng(i[1],i[0]),o=de.latLng(r[1],r[0]);return de.latLngBounds(s,o)}},Eue=n=>`
  <div class="index-map-info">
    ${n.title?`
      <div class="col-sm-12">
        <h3>${n.title}</h3>
      </div>`:""}
    <div class="col-sm-12">
      ${n.thumbnailUrl?`
        ${n.websiteUrl?`
          <a href="${n.websiteUrl}">
            <img src="${n.thumbnailUrl}" class="img-responsive">
          </a>`:`
          <img src="${n.thumbnailUrl}">`}`:""}
      <dl class="row dl-invert document-metadata">
        ${n.websiteUrl?`
          <dt class="col-sm-3">Website:</dt>
          <dd class="col-sm-9"><a href="${n.websiteUrl}">${n.websiteUrl}</a></dd>`:""}
        ${n.downloadUrl?`
          <dt class="col-sm-3">Download:</dt>
          <dd class="col-sm-9"><a href="${n.downloadUrl}">${n.downloadUrl}</a></dd>`:""}
        ${n.recordIdentifier?`
          <dt class="col-sm-3">Record Identifier:</dt>
          <dd class="col-sm-9">${n.recordIdentifier}</dd>`:""}
        ${n.label?`
          <dt class="col-sm-3">Label:</dt>
          <dd class="col-sm-9">${n.label}</dd>`:""}
        ${n.note?`
          <dt class="col-sm-3">Note:</dt>
          <dd class="col-sm-9">${n.note}</dd>`:""}
      </dl>
    </div>
  </div>`,wue=n=>n.downloadUrl?`
  <li class="list-group-item download js-index-map-feature">
    <h3 class="card-subtitle">Selected feature</h3>
    <ul class="list-group list-group-flush list-group-nested">
      <li class="list-group-item download">
        <div class="download-link-container">
          <a class="btn btn-default download download-original" href="${n.downloadUrl}">
            ${n.label?n.label:"Download"}
          </a>
        </div>
      </li>
    </ul>
  </li>
`:"",Tue=n=>new Promise(e=>{n.iiifUrl&&!n.thumbnailUrl?fetch(n.iiifUrl).then(t=>t.json()).then(t=>{t.thumbnail["@id"]!==null&&(n.thumbnailUrl=t.thumbnail["@id"]),e(n)}).catch(()=>e(n)):e(n)}),Sue=(n,e)=>{var t=n||typeof n>"u"?e.LAYERS.INDEX.DEFAULT:e.LAYERS.INDEX.UNAVAILABLE;return t.fillOpacity=e.opacity||.65,t.opacity=e.opacity||.65,t},bue=n=>{Tue(n).then(e=>{const t=Eue(e);document.querySelector(".viewer-information").innerHTML=t;const i=wue(e),r=document.querySelector(".js-download-list");r&&(r.innerHTML+=i,r.querySelectorAll(".js-index-map-feature").forEach(s=>s.remove()))})},xue=(n,{layerId:e,opacity:t,detectRetina:i})=>de.tileLayer.wms(n,{layers:e,format:"image/png",transparent:!0,tiled:!0,CRS:"EPSG:3857",opacity:t,detectRetina:i}),Cue=async(n,{opacity:e,detectRetina:t,layerId:i})=>{const r=await fetch(n);if(!r.ok)throw new Error("Unable to fetch WMTSCapabilities document",n);const s=await r.text();if(!s)throw new Error("Unable to parse WMTSCapabilities document",n);const o=gue(s,i),a=o.bounds?{bounds:o.bounds}:{};return de.tileLayer(o.url,{opacity:e,detectRetina:t,...a})},Rue=(n,{opacity:e,detectRetina:t})=>{n=n.replace(/\/$/,"");const i=n.split("/"),r=i[i.length-1];let s;return Number(r)===parseInt(r,10)&&(s=r,n=n.slice(0,-(r.length+1))),tue({url:n,opacity:e,detectRetina:t,...s?{layers:[s]}:{}})},Aue=(n,{opacity:e,detectRetina:t})=>nue({url:n,opacity:e,detectRetina:t}),Lue=async(n,e)=>{const t=await fetch(n);if(!t.ok)throw new Error("Unable to fetch EsriTiledMapLayer document",n);let i;try{i=await t.json()}catch{throw new Error("Unable to parse TiledMapLayer document",t)}if(i.singleFusedMapCache===!0&&i.spatialReference.wkid===102100)return Yce({url:n,...e})},Iue=async(n,e)=>{const t=await fetch(n);if(!t.ok)throw new Error("Unable to fetch TiledJson document",n);const i=await t.json(),r=oue(i);r&&(e.bounds=r);const s=i.tiles[0];return de.tileLayer(s,e)},Pue=async(n,e)=>{let t=null;const i=await fetch(n);if(!i.ok)throw new Error("Unable to fetch indexMapLayer document",n);const r=await i.json(),s=de.geoJson(r,{style:o=>Sue(o.properties.available,e),onEachFeature:(o,a)=>{o.properties.label!==null&&a.bindTooltip(o.properties.label),o.properties.available!==null&&a.on("click",l=>{a.setStyle(e.LAYERS.INDEX.SELECTED),t!==null&&(e.opacity=a.options.fillOpacity,s.resetStyle(t)),t=a,bue(o.properties)})},pointToLayer:(o,a)=>de.circleMarker(a)});return s},w3=new de.LatLngBounds([[-30,-100],[30,100]]),Due=.75,Oue={color:"#3388ff",dashArray:"5 5",weight:2,opacity:1,fillOpacity:0};class q1 extends Os{connect(){de.Icon.Default.imagePath="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/",this.basemap=this.getBasemap(),this.overlay=de.layerGroup(),this.bounds=w3,this.hasMapGeomValue&&(this.bounds=ab(this.mapGeomValue)),this.loadMap()}get config(){return!this.optionsValue.VIEWERS||!this.hasProtocolValue?{}:this.optionsValue.VIEWERS[this.protocolValue.toUpperCase()]}async loadMap(){this.map||(this.map=de.map(this.element),this.map.addLayer(this.basemap),this.map.addLayer(this.overlay),this.fitBounds(this.bounds),this.map.options.selected_color=this.optionsValue.SELECTED_COLOR||"blue",this.availableValue&&this.protocolValue?(await this.addPreviewOverlay(),this.addInspection()):this.drawInitialBoundsValue&&this.bounds&&this.addBoundsOverlay(this.bounds),this.addControls(),this.protocolValue=="IndexMap"&&this.fitBounds(this.previewOverlay.getBounds()),this.map.geosearch&&this.map.geosearch.enable(),this.dispatch("loaded"))}fitBounds(e){this.map.geosearch&&this.map.geosearch.disable(),this.map.fitBounds(e,{animate:!1,noMoveStart:!0}),this.bounds=e,this.map.geosearch&&this.map.geosearch.enable(),this.element.dataset.bounds=this.bounds.toBBoxString()}getBasemap(){const e=this.basemapValue||"positron";return de.tileLayer(ob[e].url,{...ob[e],detectRetina:this.optionsValue.LAYERS.DETECT_RETINA||!1})}addControls(){const e=this.optionsValue.CONTROLS||{};if(Object.entries(e).forEach(([t,i])=>{const r=this.getControl(t,i);r&&this.addControl(r)}),this.hasProtocolValue){if(this.availableValue){const i=this.getControl("Opacity");this.addControl(i)}const t=this.getControl("Fullscreen");this.addControl(t)}}addControl(e){this.map.addControl(e)}getControl(e,t){if(e=="Opacity")return new lue(this.previewOverlay);if(e=="Fullscreen")return new de.Control.Fullscreen({position:"topright",...t});if(e=="Geosearch")return new uue({baseUrl:this.catalogBaseUrlValue,...t});console.error(`Unsupported control name: "${e}"`)}addBoundsOverlay(e){const t=Object.keys(this.mapGeomValue).length>0&&!this.map.geosearch;var i=t?Oue:{};const r=this.optionsValue.BOUNDSOVERLAY||{},s={...i,...r[this.pageValue]},o=de.polygon([e.getSouthWest(),e.getSouthEast(),e.getNorthEast(),e.getNorthWest()],s);t&&this.map.addLayer(L.geoJSON(this.mapGeomValue,r[this.pageValue])),this.boundsOverlay=o,this.overlay.addLayer(o)}removeBoundsOverlay(){this.boundsOverlay&&this.overlay.removeLayer(this.boundsOverlay)}addInspection(){if(this.protocolValue=="Wms")return due(this.map,this.urlValue,this.layerIdValue,this.previewOverlay);if(this.protocolValue=="FeatureLayer")return pue(this.map,this.previewOverlay);if(this.protocolValue=="DynamicMapLayer")return fue(this.map,this.previewOverlay,this.layerIdValue)}async addPreviewOverlay(){this.previewOverlay=await this.getPreviewOverlay(this.protocolValue,this.urlValue,{layerId:this.layerIdValue,opacity:this.optionsValue.opacity||Due,detectRetina:this.optionsValue.LAYERS.DETECT_RETINA||!1}),this.previewOverlay&&this.overlay.addLayer(this.previewOverlay)}async getPreviewOverlay(e,t,i){if(e=="DynamicMapLayer")return Rue(t,i);if(e=="FeatureLayer")return Aue(t,i);if(e=="ImageMapLayer")return Qce({url:t,...i});if(e=="IndexMap")return await Pue(t,this.optionsValue);if(e=="TiledMapLayer")return await Lue(t,i);if(e=="Tilejson")return await Iue(t,i);if(e=="Tms")return de.tileLayer(t,{tms:!0,...i});if(e=="Wms")return xue(t,i);if(e=="Wmts")return await Cue(t,i);if(e=="Xyz")return de.tileLayer(t,i);console.error(`Unsupported protocol name: "${e}"`)}}wn(q1,"values",{url:String,catalogBaseUrl:String,protocol:String,available:Boolean,options:Object,basemap:String,mapGeom:Object,page:String,layerId:String,drawInitialBounds:Boolean});class v_ extends Os{fitResultBounds(){new URL(window.location).searchParams.get("bbox")||this.leafletViewerOutlet.fitBounds(this.getMaximalBounds())}getResultBounds(e){const t=e.querySelector("[data-geom]");if(t&&t.dataset.geom)return ab(JSON.parse(t.dataset.geom))}getMaximalBounds(){const t=this.resultTargets.map(this.getResultBounds).filter(i=>i);return t.length>0?t.reduce((i,r)=>i.extend(r)):w3}previewResultOnMap(e){const t=e.target.querySelector("[data-geom]");if(t&&t.dataset.geom!==""){const i=JSON.parse(t.dataset.geom),r=ab(i);this.leafletViewerOutlet.addBoundsOverlay(r)}}clearPreview(){this.leafletViewerOutlet.removeBoundsOverlay()}}wn(v_,"targets",["result"]);wn(v_,"outlets",["leaflet-viewer"]);class T3 extends Os{download(e){if(e.preventDefault(),this.downloading)return;this.downloading=!0,e.target.classList.add("download-in-progress");const t=e.target.dataset.downloadPath;e.target.removeAttribute("href"),e.target.innerHTML='<div class="spinner-border spinner-border-sm float-end"></div> Preparing download...',fetch(t).then(i=>i.ok?i.json():i.json().then(r=>{const s=new Error("Network response was not ok");throw s.data=r,s})).then(i=>this.complete(i,e.target)).catch(i=>this.error(i,e.target))}complete(e,t){this.downloading=!1,t.classList.remove("download-in-progress"),t.classList.add("download-complete"),t.innerHTML=`Download ready (${t.dataset.downloadType})`,t.href=e[1],this.renderMessage(e[0])}error(e,t){this.downloading=!1,t.classList.remove("download-in-progress"),t.classList.add("download-complete"),t.innerHTML=`Download failed (${t.dataset.downloadType})`,this.renderMessage(e.data[0])}renderMessage(e){Object.entries(e).forEach(([t,i])=>{const r=document.createElement("div");r.className=`alert alert-${i[0]}`,r.innerHTML=`<button type="button" class="close" data-bs-dismiss="alert" aria-hidden="true">&times;</button>${i[1]}`,document.querySelector("div.flash_messages").appendChild(r)})}}class K1 extends Os{async copyToClipboard(e){let t=e.params.value;await navigator.clipboard.writeText(t),this.alertTarget.classList.remove("d-none")}}wn(K1,"targets",["alert"]);var Zn="top",Nr="bottom",Fr="right",Yn="left",y_="auto",Jd=[Zn,Nr,Fr,Yn],ou="start",Rd="end",S3="clippingParents",Z1="viewport",Bh="popper",b3="reference",lb=Jd.reduce(function(n,e){return n.concat([e+"-"+ou,e+"-"+Rd])},[]),Y1=[].concat(Jd,[y_]).reduce(function(n,e){return n.concat([e,e+"-"+ou,e+"-"+Rd])},[]),x3="beforeRead",C3="read",R3="afterRead",A3="beforeMain",L3="main",I3="afterMain",P3="beforeWrite",D3="write",O3="afterWrite",k3=[x3,C3,R3,A3,L3,I3,P3,D3,O3];function _o(n){return n?(n.nodeName||"").toLowerCase():null}function Br(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function au(n){var e=Br(n).Element;return n instanceof e||n instanceof Element}function is(n){var e=Br(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function X1(n){if(typeof ShadowRoot>"u")return!1;var e=Br(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function kue(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},s=e.elements[t];!is(s)||!_o(s)||(Object.assign(s.style,i),Object.keys(r).forEach(function(o){var a=r[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function Mue(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],s=e.attributes[i]||{},o=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),a=o.reduce(function(l,c){return l[c]="",l},{});!is(r)||!_o(r)||(Object.assign(r.style,a),Object.keys(s).forEach(function(l){r.removeAttribute(l)}))})}}const J1={name:"applyStyles",enabled:!0,phase:"write",fn:kue,effect:Mue,requires:["computeStyles"]};function ho(n){return n.split("-")[0]}var Xc=Math.max,u0=Math.min,Ad=Math.round;function cb(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function M3(){return!/^((?!chrome|android).)*safari/i.test(cb())}function Ld(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=n.getBoundingClientRect(),r=1,s=1;e&&is(n)&&(r=n.offsetWidth>0&&Ad(i.width)/n.offsetWidth||1,s=n.offsetHeight>0&&Ad(i.height)/n.offsetHeight||1);var o=au(n)?Br(n):window,a=o.visualViewport,l=!M3()&&t,c=(i.left+(l&&a?a.offsetLeft:0))/r,u=(i.top+(l&&a?a.offsetTop:0))/s,f=i.width/r,p=i.height/s;return{width:f,height:p,top:u,right:c+f,bottom:u+p,left:c,x:c,y:u}}function Q1(n){var e=Ld(n),t=n.offsetWidth,i=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:i}}function N3(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&X1(t)){var i=e;do{if(i&&n.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function va(n){return Br(n).getComputedStyle(n)}function Nue(n){return["table","td","th"].indexOf(_o(n))>=0}function ql(n){return((au(n)?n.ownerDocument:n.document)||window.document).documentElement}function __(n){return _o(n)==="html"?n:n.assignedSlot||n.parentNode||(X1(n)?n.host:null)||ql(n)}function ED(n){return!is(n)||va(n).position==="fixed"?null:n.offsetParent}function Fue(n){var e=/firefox/i.test(cb()),t=/Trident/i.test(cb());if(t&&is(n)){var i=va(n);if(i.position==="fixed")return null}var r=__(n);for(X1(r)&&(r=r.host);is(r)&&["html","body"].indexOf(_o(r))<0;){var s=va(r);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return r;r=r.parentNode}return null}function bg(n){for(var e=Br(n),t=ED(n);t&&Nue(t)&&va(t).position==="static";)t=ED(t);return t&&(_o(t)==="html"||_o(t)==="body"&&va(t).position==="static")?e:t||Fue(n)||e}function eC(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function mp(n,e,t){return Xc(n,u0(e,t))}function Bue(n,e,t){var i=mp(n,e,t);return i>t?t:i}function F3(){return{top:0,right:0,bottom:0,left:0}}function B3(n){return Object.assign({},F3(),n)}function U3(n,e){return e.reduce(function(t,i){return t[i]=n,t},{})}var Uue=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,B3(typeof e!="number"?e:U3(e,Jd))};function zue(n){var e,t=n.state,i=n.name,r=n.options,s=t.elements.arrow,o=t.modifiersData.popperOffsets,a=ho(t.placement),l=eC(a),c=[Yn,Fr].indexOf(a)>=0,u=c?"height":"width";if(!(!s||!o)){var f=Uue(r.padding,t),p=Q1(s),m=l==="y"?Zn:Yn,y=l==="y"?Nr:Fr,_=t.rects.reference[u]+t.rects.reference[l]-o[l]-t.rects.popper[u],w=o[l]-t.rects.reference[l],T=bg(s),x=T?l==="y"?T.clientHeight||0:T.clientWidth||0:0,C=_/2-w/2,I=f[m],D=x-p[u]-f[y],B=x/2-p[u]/2+C,N=mp(I,B,D),z=l;t.modifiersData[i]=(e={},e[z]=N,e.centerOffset=N-B,e)}}function Gue(n){var e=n.state,t=n.options,i=t.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||N3(e.elements.popper,r)&&(e.elements.arrow=r))}const z3={name:"arrow",enabled:!0,phase:"main",fn:zue,effect:Gue,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Id(n){return n.split("-")[1]}var Hue={top:"auto",right:"auto",bottom:"auto",left:"auto"};function $ue(n,e){var t=n.x,i=n.y,r=e.devicePixelRatio||1;return{x:Ad(t*r)/r||0,y:Ad(i*r)/r||0}}function wD(n){var e,t=n.popper,i=n.popperRect,r=n.placement,s=n.variation,o=n.offsets,a=n.position,l=n.gpuAcceleration,c=n.adaptive,u=n.roundOffsets,f=n.isFixed,p=o.x,m=p===void 0?0:p,y=o.y,_=y===void 0?0:y,w=typeof u=="function"?u({x:m,y:_}):{x:m,y:_};m=w.x,_=w.y;var T=o.hasOwnProperty("x"),x=o.hasOwnProperty("y"),C=Yn,I=Zn,D=window;if(c){var B=bg(t),N="clientHeight",z="clientWidth";if(B===Br(t)&&(B=ql(t),va(B).position!=="static"&&a==="absolute"&&(N="scrollHeight",z="scrollWidth")),B=B,r===Zn||(r===Yn||r===Fr)&&s===Rd){I=Nr;var Z=f&&B===D&&D.visualViewport?D.visualViewport.height:B[N];_-=Z-i.height,_*=l?1:-1}if(r===Yn||(r===Zn||r===Nr)&&s===Rd){C=Fr;var q=f&&B===D&&D.visualViewport?D.visualViewport.width:B[z];m-=q-i.width,m*=l?1:-1}}var H=Object.assign({position:a},c&&Hue),Y=u===!0?$ue({x:m,y:_},Br(t)):{x:m,y:_};if(m=Y.x,_=Y.y,l){var ee;return Object.assign({},H,(ee={},ee[I]=x?"0":"",ee[C]=T?"0":"",ee.transform=(D.devicePixelRatio||1)<=1?"translate("+m+"px, "+_+"px)":"translate3d("+m+"px, "+_+"px, 0)",ee))}return Object.assign({},H,(e={},e[I]=x?_+"px":"",e[C]=T?m+"px":"",e.transform="",e))}function Vue(n){var e=n.state,t=n.options,i=t.gpuAcceleration,r=i===void 0?!0:i,s=t.adaptive,o=s===void 0?!0:s,a=t.roundOffsets,l=a===void 0?!0:a,c={placement:ho(e.placement),variation:Id(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,wD(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,wD(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const tC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Vue,data:{}};var Bv={passive:!0};function jue(n){var e=n.state,t=n.instance,i=n.options,r=i.scroll,s=r===void 0?!0:r,o=i.resize,a=o===void 0?!0:o,l=Br(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",t.update,Bv)}),a&&l.addEventListener("resize",t.update,Bv),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",t.update,Bv)}),a&&l.removeEventListener("resize",t.update,Bv)}}const iC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:jue,data:{}};var Wue={left:"right",right:"left",bottom:"top",top:"bottom"};function cy(n){return n.replace(/left|right|bottom|top/g,function(e){return Wue[e]})}var que={start:"end",end:"start"};function TD(n){return n.replace(/start|end/g,function(e){return que[e]})}function nC(n){var e=Br(n),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function rC(n){return Ld(ql(n)).left+nC(n).scrollLeft}function Kue(n,e){var t=Br(n),i=ql(n),r=t.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;var c=M3();(c||!c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a+rC(n),y:l}}function Zue(n){var e,t=ql(n),i=nC(n),r=(e=n.ownerDocument)==null?void 0:e.body,s=Xc(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=Xc(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-i.scrollLeft+rC(n),l=-i.scrollTop;return va(r||t).direction==="rtl"&&(a+=Xc(t.clientWidth,r?r.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function sC(n){var e=va(n),t=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+i)}function G3(n){return["html","body","#document"].indexOf(_o(n))>=0?n.ownerDocument.body:is(n)&&sC(n)?n:G3(__(n))}function vp(n,e){var t;e===void 0&&(e=[]);var i=G3(n),r=i===((t=n.ownerDocument)==null?void 0:t.body),s=Br(i),o=r?[s].concat(s.visualViewport||[],sC(i)?i:[]):i,a=e.concat(o);return r?a:a.concat(vp(__(o)))}function ub(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function Yue(n,e){var t=Ld(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function SD(n,e,t){return e===Z1?ub(Kue(n,t)):au(e)?Yue(e,t):ub(Zue(ql(n)))}function Xue(n){var e=vp(__(n)),t=["absolute","fixed"].indexOf(va(n).position)>=0,i=t&&is(n)?bg(n):n;return au(i)?e.filter(function(r){return au(r)&&N3(r,i)&&_o(r)!=="body"}):[]}function Jue(n,e,t,i){var r=e==="clippingParents"?Xue(n):[].concat(e),s=[].concat(r,[t]),o=s[0],a=s.reduce(function(l,c){var u=SD(n,c,i);return l.top=Xc(u.top,l.top),l.right=u0(u.right,l.right),l.bottom=u0(u.bottom,l.bottom),l.left=Xc(u.left,l.left),l},SD(n,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function H3(n){var e=n.reference,t=n.element,i=n.placement,r=i?ho(i):null,s=i?Id(i):null,o=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,l;switch(r){case Zn:l={x:o,y:e.y-t.height};break;case Nr:l={x:o,y:e.y+e.height};break;case Fr:l={x:e.x+e.width,y:a};break;case Yn:l={x:e.x-t.width,y:a};break;default:l={x:e.x,y:e.y}}var c=r?eC(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(s){case ou:l[c]=l[c]-(e[u]/2-t[u]/2);break;case Rd:l[c]=l[c]+(e[u]/2-t[u]/2);break}}return l}function Pd(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=i===void 0?n.placement:i,s=t.strategy,o=s===void 0?n.strategy:s,a=t.boundary,l=a===void 0?S3:a,c=t.rootBoundary,u=c===void 0?Z1:c,f=t.elementContext,p=f===void 0?Bh:f,m=t.altBoundary,y=m===void 0?!1:m,_=t.padding,w=_===void 0?0:_,T=B3(typeof w!="number"?w:U3(w,Jd)),x=p===Bh?b3:Bh,C=n.rects.popper,I=n.elements[y?x:p],D=Jue(au(I)?I:I.contextElement||ql(n.elements.popper),l,u,o),B=Ld(n.elements.reference),N=H3({reference:B,element:C,strategy:"absolute",placement:r}),z=ub(Object.assign({},C,N)),Z=p===Bh?z:B,q={top:D.top-Z.top+T.top,bottom:Z.bottom-D.bottom+T.bottom,left:D.left-Z.left+T.left,right:Z.right-D.right+T.right},H=n.modifiersData.offset;if(p===Bh&&H){var Y=H[r];Object.keys(q).forEach(function(ee){var le=[Fr,Nr].indexOf(ee)>=0?1:-1,W=[Zn,Nr].indexOf(ee)>=0?"y":"x";q[ee]+=Y[W]*le})}return q}function Que(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=t.boundary,s=t.rootBoundary,o=t.padding,a=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?Y1:l,u=Id(i),f=u?a?lb:lb.filter(function(y){return Id(y)===u}):Jd,p=f.filter(function(y){return c.indexOf(y)>=0});p.length===0&&(p=f);var m=p.reduce(function(y,_){return y[_]=Pd(n,{placement:_,boundary:r,rootBoundary:s,padding:o})[ho(_)],y},{});return Object.keys(m).sort(function(y,_){return m[y]-m[_]})}function ehe(n){if(ho(n)===y_)return[];var e=cy(n);return[TD(n),e,TD(e)]}function the(n){var e=n.state,t=n.options,i=n.name;if(!e.modifiersData[i]._skip){for(var r=t.mainAxis,s=r===void 0?!0:r,o=t.altAxis,a=o===void 0?!0:o,l=t.fallbackPlacements,c=t.padding,u=t.boundary,f=t.rootBoundary,p=t.altBoundary,m=t.flipVariations,y=m===void 0?!0:m,_=t.allowedAutoPlacements,w=e.options.placement,T=ho(w),x=T===w,C=l||(x||!y?[cy(w)]:ehe(w)),I=[w].concat(C).reduce(function(fe,pe){return fe.concat(ho(pe)===y_?Que(e,{placement:pe,boundary:u,rootBoundary:f,padding:c,flipVariations:y,allowedAutoPlacements:_}):pe)},[]),D=e.rects.reference,B=e.rects.popper,N=new Map,z=!0,Z=I[0],q=0;q<I.length;q++){var H=I[q],Y=ho(H),ee=Id(H)===ou,le=[Zn,Nr].indexOf(Y)>=0,W=le?"width":"height",ie=Pd(e,{placement:H,boundary:u,rootBoundary:f,altBoundary:p,padding:c}),ne=le?ee?Fr:Yn:ee?Nr:Zn;D[W]>B[W]&&(ne=cy(ne));var J=cy(ne),ce=[];if(s&&ce.push(ie[Y]<=0),a&&ce.push(ie[ne]<=0,ie[J]<=0),ce.every(function(fe){return fe})){Z=H,z=!1;break}N.set(H,ce)}if(z)for(var se=y?3:1,te=function(pe){var Ce=I.find(function(xe){var Le=N.get(xe);if(Le)return Le.slice(0,pe).every(function(je){return je})});if(Ce)return Z=Ce,"break"},Q=se;Q>0;Q--){var _e=te(Q);if(_e==="break")break}e.placement!==Z&&(e.modifiersData[i]._skip=!0,e.placement=Z,e.reset=!0)}}const $3={name:"flip",enabled:!0,phase:"main",fn:the,requiresIfExists:["offset"],data:{_skip:!1}};function bD(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function xD(n){return[Zn,Fr,Nr,Yn].some(function(e){return n[e]>=0})}function ihe(n){var e=n.state,t=n.name,i=e.rects.reference,r=e.rects.popper,s=e.modifiersData.preventOverflow,o=Pd(e,{elementContext:"reference"}),a=Pd(e,{altBoundary:!0}),l=bD(o,i),c=bD(a,r,s),u=xD(l),f=xD(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:f},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":f})}const V3={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ihe};function nhe(n,e,t){var i=ho(n),r=[Yn,Zn].indexOf(i)>=0?-1:1,s=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,o=s[0],a=s[1];return o=o||0,a=(a||0)*r,[Yn,Fr].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}function rhe(n){var e=n.state,t=n.options,i=n.name,r=t.offset,s=r===void 0?[0,0]:r,o=Y1.reduce(function(u,f){return u[f]=nhe(f,e.rects,s),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=o}const j3={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:rhe};function she(n){var e=n.state,t=n.name;e.modifiersData[t]=H3({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const oC={name:"popperOffsets",enabled:!0,phase:"read",fn:she,data:{}};function ohe(n){return n==="x"?"y":"x"}function ahe(n){var e=n.state,t=n.options,i=n.name,r=t.mainAxis,s=r===void 0?!0:r,o=t.altAxis,a=o===void 0?!1:o,l=t.boundary,c=t.rootBoundary,u=t.altBoundary,f=t.padding,p=t.tether,m=p===void 0?!0:p,y=t.tetherOffset,_=y===void 0?0:y,w=Pd(e,{boundary:l,rootBoundary:c,padding:f,altBoundary:u}),T=ho(e.placement),x=Id(e.placement),C=!x,I=eC(T),D=ohe(I),B=e.modifiersData.popperOffsets,N=e.rects.reference,z=e.rects.popper,Z=typeof _=="function"?_(Object.assign({},e.rects,{placement:e.placement})):_,q=typeof Z=="number"?{mainAxis:Z,altAxis:Z}:Object.assign({mainAxis:0,altAxis:0},Z),H=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Y={x:0,y:0};if(B){if(s){var ee,le=I==="y"?Zn:Yn,W=I==="y"?Nr:Fr,ie=I==="y"?"height":"width",ne=B[I],J=ne+w[le],ce=ne-w[W],se=m?-z[ie]/2:0,te=x===ou?N[ie]:z[ie],Q=x===ou?-z[ie]:-N[ie],_e=e.elements.arrow,fe=m&&_e?Q1(_e):{width:0,height:0},pe=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:F3(),Ce=pe[le],xe=pe[W],Le=mp(0,N[ie],fe[ie]),je=C?N[ie]/2-se-Le-Ce-q.mainAxis:te-Le-Ce-q.mainAxis,Ke=C?-N[ie]/2+se+Le+xe+q.mainAxis:Q+Le+xe+q.mainAxis,lt=e.elements.arrow&&bg(e.elements.arrow),ct=lt?I==="y"?lt.clientTop||0:lt.clientLeft||0:0,Ht=(ee=H==null?void 0:H[I])!=null?ee:0,Vt=ne+je-Ht-ct,ii=ne+Ke-Ht,Yt=mp(m?u0(J,Vt):J,ne,m?Xc(ce,ii):ce);B[I]=Yt,Y[I]=Yt-ne}if(a){var k,X=I==="x"?Zn:Yn,ve=I==="x"?Nr:Fr,Pe=B[D],Ae=D==="y"?"height":"width",Ve=Pe+w[X],ze=Pe-w[ve],vt=[Zn,Yn].indexOf(T)!==-1,xt=(k=H==null?void 0:H[D])!=null?k:0,It=vt?Ve:Pe-N[Ae]-z[Ae]-xt+q.altAxis,rt=vt?Pe+N[Ae]+z[Ae]-xt-q.altAxis:ze,Ot=m&&vt?Bue(It,Pe,rt):mp(m?It:Ve,Pe,m?rt:ze);B[D]=Ot,Y[D]=Ot-Pe}e.modifiersData[i]=Y}}const W3={name:"preventOverflow",enabled:!0,phase:"main",fn:ahe,requiresIfExists:["offset"]};function lhe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function che(n){return n===Br(n)||!is(n)?nC(n):lhe(n)}function uhe(n){var e=n.getBoundingClientRect(),t=Ad(e.width)/n.offsetWidth||1,i=Ad(e.height)/n.offsetHeight||1;return t!==1||i!==1}function hhe(n,e,t){t===void 0&&(t=!1);var i=is(e),r=is(e)&&uhe(e),s=ql(e),o=Ld(n,r,t),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((_o(e)!=="body"||sC(s))&&(a=che(e)),is(e)?(l=Ld(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=rC(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function dhe(n){var e=new Map,t=new Set,i=[];n.forEach(function(s){e.set(s.name,s)});function r(s){t.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!t.has(a)){var l=e.get(a);l&&r(l)}}),i.push(s)}return n.forEach(function(s){t.has(s.name)||r(s)}),i}function fhe(n){var e=dhe(n);return k3.reduce(function(t,i){return t.concat(e.filter(function(r){return r.phase===i}))},[])}function phe(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function ghe(n){var e=n.reduce(function(t,i){var r=t[i.name];return t[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var CD={placement:"bottom",modifiers:[],strategy:"absolute"};function RD(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function E_(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,i=t===void 0?[]:t,r=e.defaultOptions,s=r===void 0?CD:r;return function(a,l,c){c===void 0&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},CD,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},f=[],p=!1,m={state:u,setOptions:function(T){var x=typeof T=="function"?T(u.options):T;_(),u.options=Object.assign({},s,u.options,x),u.scrollParents={reference:au(a)?vp(a):a.contextElement?vp(a.contextElement):[],popper:vp(l)};var C=fhe(ghe([].concat(i,u.options.modifiers)));return u.orderedModifiers=C.filter(function(I){return I.enabled}),y(),m.update()},forceUpdate:function(){if(!p){var T=u.elements,x=T.reference,C=T.popper;if(RD(x,C)){u.rects={reference:hhe(x,bg(C),u.options.strategy==="fixed"),popper:Q1(C)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(q){return u.modifiersData[q.name]=Object.assign({},q.data)});for(var I=0;I<u.orderedModifiers.length;I++){if(u.reset===!0){u.reset=!1,I=-1;continue}var D=u.orderedModifiers[I],B=D.fn,N=D.options,z=N===void 0?{}:N,Z=D.name;typeof B=="function"&&(u=B({state:u,options:z,name:Z,instance:m})||u)}}}},update:phe(function(){return new Promise(function(w){m.forceUpdate(),w(u)})}),destroy:function(){_(),p=!0}};if(!RD(a,l))return m;m.setOptions(c).then(function(w){!p&&c.onFirstUpdate&&c.onFirstUpdate(w)});function y(){u.orderedModifiers.forEach(function(w){var T=w.name,x=w.options,C=x===void 0?{}:x,I=w.effect;if(typeof I=="function"){var D=I({state:u,name:T,instance:m,options:C}),B=function(){};f.push(D||B)}})}function _(){f.forEach(function(w){return w()}),f=[]}return m}}var mhe=E_(),vhe=[iC,oC,tC,J1],yhe=E_({defaultModifiers:vhe}),_he=[iC,oC,tC,J1,j3,$3,W3,z3,V3],aC=E_({defaultModifiers:_he});const q3=Object.freeze(Object.defineProperty({__proto__:null,afterMain:I3,afterRead:R3,afterWrite:O3,applyStyles:J1,arrow:z3,auto:y_,basePlacements:Jd,beforeMain:A3,beforeRead:x3,beforeWrite:P3,bottom:Nr,clippingParents:S3,computeStyles:tC,createPopper:aC,createPopperBase:mhe,createPopperLite:yhe,detectOverflow:Pd,end:Rd,eventListeners:iC,flip:$3,hide:V3,left:Yn,main:L3,modifierPhases:k3,offset:j3,placements:Y1,popper:Bh,popperGenerator:E_,popperOffsets:oC,preventOverflow:W3,read:C3,reference:b3,right:Fr,start:ou,top:Zn,variationPlacements:lb,viewport:Z1,write:D3},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const ll=new Map,gT={set(n,e,t){ll.has(n)||ll.set(n,new Map);const i=ll.get(n);if(!i.has(e)&&i.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(i.keys())[0]}.`);return}i.set(e,t)},get(n,e){return ll.has(n)&&ll.get(n).get(e)||null},remove(n,e){if(!ll.has(n))return;const t=ll.get(n);t.delete(e),t.size===0&&ll.delete(n)}},Ehe=1e6,whe=1e3,hb="transitionend",K3=n=>(n&&window.CSS&&window.CSS.escape&&(n=n.replace(/#([^\s"#']+)/g,(e,t)=>`#${CSS.escape(t)}`)),n),The=n=>n==null?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase(),She=n=>{do n+=Math.floor(Math.random()*Ehe);while(document.getElementById(n));return n},bhe=n=>{if(!n)return 0;let{transitionDuration:e,transitionDelay:t}=window.getComputedStyle(n);const i=Number.parseFloat(e),r=Number.parseFloat(t);return!i&&!r?0:(e=e.split(",")[0],t=t.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(t))*whe)},Z3=n=>{n.dispatchEvent(new Event(hb))},ca=n=>!n||typeof n!="object"?!1:(typeof n.jquery<"u"&&(n=n[0]),typeof n.nodeType<"u"),Ml=n=>ca(n)?n.jquery?n[0]:n:typeof n=="string"&&n.length>0?document.querySelector(K3(n)):null,Qd=n=>{if(!ca(n)||n.getClientRects().length===0)return!1;const e=getComputedStyle(n).getPropertyValue("visibility")==="visible",t=n.closest("details:not([open])");if(!t)return e;if(t!==n){const i=n.closest("summary");if(i&&i.parentNode!==t||i===null)return!1}return e},Nl=n=>!n||n.nodeType!==Node.ELEMENT_NODE||n.classList.contains("disabled")?!0:typeof n.disabled<"u"?n.disabled:n.hasAttribute("disabled")&&n.getAttribute("disabled")!=="false",Y3=n=>{if(!document.documentElement.attachShadow)return null;if(typeof n.getRootNode=="function"){const e=n.getRootNode();return e instanceof ShadowRoot?e:null}return n instanceof ShadowRoot?n:n.parentNode?Y3(n.parentNode):null},h0=()=>{},xg=n=>{n.offsetHeight},X3=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,mT=[],xhe=n=>{document.readyState==="loading"?(mT.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of mT)e()}),mT.push(n)):n()},os=()=>document.documentElement.dir==="rtl",ls=n=>{xhe(()=>{const e=X3();if(e){const t=n.NAME,i=e.fn[t];e.fn[t]=n.jQueryInterface,e.fn[t].Constructor=n,e.fn[t].noConflict=()=>(e.fn[t]=i,n.jQueryInterface)}})},gr=(n,e=[],t=n)=>typeof n=="function"?n(...e):t,J3=(n,e,t=!0)=>{if(!t){gr(n);return}const r=bhe(e)+5;let s=!1;const o=({target:a})=>{a===e&&(s=!0,e.removeEventListener(hb,o),gr(n))};e.addEventListener(hb,o),setTimeout(()=>{s||Z3(e)},r)},lC=(n,e,t,i)=>{const r=n.length;let s=n.indexOf(e);return s===-1?!t&&i?n[r-1]:n[0]:(s+=t?1:-1,i&&(s=(s+r)%r),n[Math.max(0,Math.min(s,r-1))])},Che=/[^.]*(?=\..*)\.|.*/,Rhe=/\..*/,Ahe=/::\d+$/,vT={};let AD=1;const Q3={mouseenter:"mouseover",mouseleave:"mouseout"},Lhe=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function e5(n,e){return e&&`${e}::${AD++}`||n.uidEvent||AD++}function t5(n){const e=e5(n);return n.uidEvent=e,vT[e]=vT[e]||{},vT[e]}function Ihe(n,e){return function t(i){return cC(i,{delegateTarget:n}),t.oneOff&&Fe.off(n,i.type,e),e.apply(n,[i])}}function Phe(n,e,t){return function i(r){const s=n.querySelectorAll(e);for(let{target:o}=r;o&&o!==this;o=o.parentNode)for(const a of s)if(a===o)return cC(r,{delegateTarget:o}),i.oneOff&&Fe.off(n,r.type,e,t),t.apply(o,[r])}}function i5(n,e,t=null){return Object.values(n).find(i=>i.callable===e&&i.delegationSelector===t)}function n5(n,e,t){const i=typeof e=="string",r=i?t:e||t;let s=r5(n);return Lhe.has(s)||(s=n),[i,r,s]}function LD(n,e,t,i,r){if(typeof e!="string"||!n)return;let[s,o,a]=n5(e,t,i);e in Q3&&(o=(y=>function(_){if(!_.relatedTarget||_.relatedTarget!==_.delegateTarget&&!_.delegateTarget.contains(_.relatedTarget))return y.call(this,_)})(o));const l=t5(n),c=l[a]||(l[a]={}),u=i5(c,o,s?t:null);if(u){u.oneOff=u.oneOff&&r;return}const f=e5(o,e.replace(Che,"")),p=s?Phe(n,t,o):Ihe(n,o);p.delegationSelector=s?t:null,p.callable=o,p.oneOff=r,p.uidEvent=f,c[f]=p,n.addEventListener(a,p,s)}function db(n,e,t,i,r){const s=i5(e[t],i,r);s&&(n.removeEventListener(t,s,!!r),delete e[t][s.uidEvent])}function Dhe(n,e,t,i){const r=e[t]||{};for(const[s,o]of Object.entries(r))s.includes(i)&&db(n,e,t,o.callable,o.delegationSelector)}function r5(n){return n=n.replace(Rhe,""),Q3[n]||n}const Fe={on(n,e,t,i){LD(n,e,t,i,!1)},one(n,e,t,i){LD(n,e,t,i,!0)},off(n,e,t,i){if(typeof e!="string"||!n)return;const[r,s,o]=n5(e,t,i),a=o!==e,l=t5(n),c=l[o]||{},u=e.startsWith(".");if(typeof s<"u"){if(!Object.keys(c).length)return;db(n,l,o,s,r?t:null);return}if(u)for(const f of Object.keys(l))Dhe(n,l,f,e.slice(1));for(const[f,p]of Object.entries(c)){const m=f.replace(Ahe,"");(!a||e.includes(m))&&db(n,l,o,p.callable,p.delegationSelector)}},trigger(n,e,t){if(typeof e!="string"||!n)return null;const i=X3(),r=r5(e),s=e!==r;let o=null,a=!0,l=!0,c=!1;s&&i&&(o=i.Event(e,t),i(n).trigger(o),a=!o.isPropagationStopped(),l=!o.isImmediatePropagationStopped(),c=o.isDefaultPrevented());const u=cC(new Event(e,{bubbles:a,cancelable:!0}),t);return c&&u.preventDefault(),l&&n.dispatchEvent(u),u.defaultPrevented&&o&&o.preventDefault(),u}};function cC(n,e={}){for(const[t,i]of Object.entries(e))try{n[t]=i}catch{Object.defineProperty(n,t,{configurable:!0,get(){return i}})}return n}function ID(n){if(n==="true")return!0;if(n==="false")return!1;if(n===Number(n).toString())return Number(n);if(n===""||n==="null")return null;if(typeof n!="string")return n;try{return JSON.parse(decodeURIComponent(n))}catch{return n}}function yT(n){return n.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const ua={setDataAttribute(n,e,t){n.setAttribute(`data-bs-${yT(e)}`,t)},removeDataAttribute(n,e){n.removeAttribute(`data-bs-${yT(e)}`)},getDataAttributes(n){if(!n)return{};const e={},t=Object.keys(n.dataset).filter(i=>i.startsWith("bs")&&!i.startsWith("bsConfig"));for(const i of t){let r=i.replace(/^bs/,"");r=r.charAt(0).toLowerCase()+r.slice(1,r.length),e[r]=ID(n.dataset[i])}return e},getDataAttribute(n,e){return ID(n.getAttribute(`data-bs-${yT(e)}`))}};class Cg{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const i=ca(t)?ua.getDataAttribute(t,"config"):{};return{...this.constructor.Default,...typeof i=="object"?i:{},...ca(t)?ua.getDataAttributes(t):{},...typeof e=="object"?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[i,r]of Object.entries(t)){const s=e[i],o=ca(s)?"element":The(s);if(!new RegExp(r).test(o))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${i}" provided type "${o}" but expected type "${r}".`)}}}const Ohe="5.3.3";class Ns extends Cg{constructor(e,t){super(),e=Ml(e),e&&(this._element=e,this._config=this._getConfig(t),gT.set(this._element,this.constructor.DATA_KEY,this))}dispose(){gT.remove(this._element,this.constructor.DATA_KEY),Fe.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,i=!0){J3(e,t,i)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return gT.get(Ml(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,typeof t=="object"?t:null)}static get VERSION(){return Ohe}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const _T=n=>{let e=n.getAttribute("data-bs-target");if(!e||e==="#"){let t=n.getAttribute("href");if(!t||!t.includes("#")&&!t.startsWith("."))return null;t.includes("#")&&!t.startsWith("#")&&(t=`#${t.split("#")[1]}`),e=t&&t!=="#"?t.trim():null}return e?e.split(",").map(t=>K3(t)).join(","):null},dt={find(n,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,n))},findOne(n,e=document.documentElement){return Element.prototype.querySelector.call(e,n)},children(n,e){return[].concat(...n.children).filter(t=>t.matches(e))},parents(n,e){const t=[];let i=n.parentNode.closest(e);for(;i;)t.push(i),i=i.parentNode.closest(e);return t},prev(n,e){let t=n.previousElementSibling;for(;t;){if(t.matches(e))return[t];t=t.previousElementSibling}return[]},next(n,e){let t=n.nextElementSibling;for(;t;){if(t.matches(e))return[t];t=t.nextElementSibling}return[]},focusableChildren(n){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(t=>`${t}:not([tabindex^="-"])`).join(",");return this.find(e,n).filter(t=>!Nl(t)&&Qd(t))},getSelectorFromElement(n){const e=_T(n);return e&&dt.findOne(e)?e:null},getElementFromSelector(n){const e=_T(n);return e?dt.findOne(e):null},getMultipleElementsFromSelector(n){const e=_T(n);return e?dt.find(e):[]}},w_=(n,e="hide")=>{const t=`click.dismiss${n.EVENT_KEY}`,i=n.NAME;Fe.on(document,t,`[data-bs-dismiss="${i}"]`,function(r){if(["A","AREA"].includes(this.tagName)&&r.preventDefault(),Nl(this))return;const s=dt.getElementFromSelector(this)||this.closest(`.${i}`);n.getOrCreateInstance(s)[e]()})},khe="alert",Mhe="bs.alert",s5=`.${Mhe}`,Nhe=`close${s5}`,Fhe=`closed${s5}`,Bhe="fade",Uhe="show";class T_ extends Ns{static get NAME(){return khe}close(){if(Fe.trigger(this._element,Nhe).defaultPrevented)return;this._element.classList.remove(Uhe);const t=this._element.classList.contains(Bhe);this._queueCallback(()=>this._destroyElement(),this._element,t)}_destroyElement(){this._element.remove(),Fe.trigger(this._element,Fhe),this.dispose()}static jQueryInterface(e){return this.each(function(){const t=T_.getOrCreateInstance(this);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}w_(T_,"close");ls(T_);const zhe="button",Ghe="bs.button",Hhe=`.${Ghe}`,$he=".data-api",Vhe="active",PD='[data-bs-toggle="button"]',jhe=`click${Hhe}${$he}`;class S_ extends Ns{static get NAME(){return zhe}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(Vhe))}static jQueryInterface(e){return this.each(function(){const t=S_.getOrCreateInstance(this);e==="toggle"&&t[e]()})}}Fe.on(document,jhe,PD,n=>{n.preventDefault();const e=n.target.closest(PD);S_.getOrCreateInstance(e).toggle()});ls(S_);const Whe="swipe",ef=".bs.swipe",qhe=`touchstart${ef}`,Khe=`touchmove${ef}`,Zhe=`touchend${ef}`,Yhe=`pointerdown${ef}`,Xhe=`pointerup${ef}`,Jhe="touch",Qhe="pen",ede="pointer-event",tde=40,ide={endCallback:null,leftCallback:null,rightCallback:null},nde={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class d0 extends Cg{constructor(e,t){super(),this._element=e,!(!e||!d0.isSupported())&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return ide}static get DefaultType(){return nde}static get NAME(){return Whe}dispose(){Fe.off(this._element,ef)}_start(e){if(!this._supportPointerEvents){this._deltaX=e.touches[0].clientX;return}this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX)}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),gr(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=tde)return;const t=e/this._deltaX;this._deltaX=0,t&&gr(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Fe.on(this._element,Yhe,e=>this._start(e)),Fe.on(this._element,Xhe,e=>this._end(e)),this._element.classList.add(ede)):(Fe.on(this._element,qhe,e=>this._start(e)),Fe.on(this._element,Khe,e=>this._move(e)),Fe.on(this._element,Zhe,e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&(e.pointerType===Qhe||e.pointerType===Jhe)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const rde="carousel",sde="bs.carousel",Kl=`.${sde}`,o5=".data-api",ode="ArrowLeft",ade="ArrowRight",lde=500,ep="next",Ih="prev",Uh="left",uy="right",cde=`slide${Kl}`,ET=`slid${Kl}`,ude=`keydown${Kl}`,hde=`mouseenter${Kl}`,dde=`mouseleave${Kl}`,fde=`dragstart${Kl}`,pde=`load${Kl}${o5}`,gde=`click${Kl}${o5}`,a5="carousel",Uv="active",mde="slide",vde="carousel-item-end",yde="carousel-item-start",_de="carousel-item-next",Ede="carousel-item-prev",l5=".active",c5=".carousel-item",wde=l5+c5,Tde=".carousel-item img",Sde=".carousel-indicators",bde="[data-bs-slide], [data-bs-slide-to]",xde='[data-bs-ride="carousel"]',Cde={[ode]:uy,[ade]:Uh},Rde={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Ade={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Rg extends Ns{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=dt.findOne(Sde,this._element),this._addEventListeners(),this._config.ride===a5&&this.cycle()}static get Default(){return Rde}static get DefaultType(){return Ade}static get NAME(){return rde}next(){this._slide(ep)}nextWhenVisible(){!document.hidden&&Qd(this._element)&&this.next()}prev(){this._slide(Ih)}pause(){this._isSliding&&Z3(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Fe.one(this._element,ET,()=>this.cycle());return}this.cycle()}}to(e){const t=this._getItems();if(e>t.length-1||e<0)return;if(this._isSliding){Fe.one(this._element,ET,()=>this.to(e));return}const i=this._getItemIndex(this._getActive());if(i===e)return;const r=e>i?ep:Ih;this._slide(r,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&Fe.on(this._element,ude,e=>this._keydown(e)),this._config.pause==="hover"&&(Fe.on(this._element,hde,()=>this.pause()),Fe.on(this._element,dde,()=>this._maybeEnableCycle())),this._config.touch&&d0.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const i of dt.find(Tde,this._element))Fe.on(i,fde,r=>r.preventDefault());const t={leftCallback:()=>this._slide(this._directionToOrder(Uh)),rightCallback:()=>this._slide(this._directionToOrder(uy)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),lde+this._config.interval))}};this._swipeHelper=new d0(this._element,t)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const t=Cde[e.key];t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const t=dt.findOne(l5,this._indicatorsElement);t.classList.remove(Uv),t.removeAttribute("aria-current");const i=dt.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);i&&(i.classList.add(Uv),i.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const t=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return;const i=this._getActive(),r=e===ep,s=t||lC(this._getItems(),i,r,this._config.wrap);if(s===i)return;const o=this._getItemIndex(s),a=m=>Fe.trigger(this._element,m,{relatedTarget:s,direction:this._orderToDirection(e),from:this._getItemIndex(i),to:o});if(a(cde).defaultPrevented||!i||!s)return;const c=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(o),this._activeElement=s;const u=r?yde:vde,f=r?_de:Ede;s.classList.add(f),xg(s),i.classList.add(u),s.classList.add(u);const p=()=>{s.classList.remove(u,f),s.classList.add(Uv),i.classList.remove(Uv,f,u),this._isSliding=!1,a(ET)};this._queueCallback(p,i,this._isAnimated()),c&&this.cycle()}_isAnimated(){return this._element.classList.contains(mde)}_getActive(){return dt.findOne(wde,this._element)}_getItems(){return dt.find(c5,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return os()?e===Uh?Ih:ep:e===Uh?ep:Ih}_orderToDirection(e){return os()?e===Ih?Uh:uy:e===Ih?uy:Uh}static jQueryInterface(e){return this.each(function(){const t=Rg.getOrCreateInstance(this,e);if(typeof e=="number"){t.to(e);return}if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}Fe.on(document,gde,bde,function(n){const e=dt.getElementFromSelector(this);if(!e||!e.classList.contains(a5))return;n.preventDefault();const t=Rg.getOrCreateInstance(e),i=this.getAttribute("data-bs-slide-to");if(i){t.to(i),t._maybeEnableCycle();return}if(ua.getDataAttribute(this,"slide")==="next"){t.next(),t._maybeEnableCycle();return}t.prev(),t._maybeEnableCycle()});Fe.on(window,pde,()=>{const n=dt.find(xde);for(const e of n)Rg.getOrCreateInstance(e)});ls(Rg);const Lde="collapse",Ide="bs.collapse",Ag=`.${Ide}`,Pde=".data-api",Dde=`show${Ag}`,Ode=`shown${Ag}`,kde=`hide${Ag}`,Mde=`hidden${Ag}`,Nde=`click${Ag}${Pde}`,wT="show",qh="collapse",zv="collapsing",Fde="collapsed",Bde=`:scope .${qh} .${qh}`,Ude="collapse-horizontal",zde="width",Gde="height",Hde=".collapse.show, .collapse.collapsing",fb='[data-bs-toggle="collapse"]',$de={parent:null,toggle:!0},Vde={parent:"(null|element)",toggle:"boolean"};class eg extends Ns{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[];const i=dt.find(fb);for(const r of i){const s=dt.getSelectorFromElement(r),o=dt.find(s).filter(a=>a===this._element);s!==null&&o.length&&this._triggerArray.push(r)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return $de}static get DefaultType(){return Vde}static get NAME(){return Lde}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(Hde).filter(a=>a!==this._element).map(a=>eg.getOrCreateInstance(a,{toggle:!1}))),e.length&&e[0]._isTransitioning||Fe.trigger(this._element,Dde).defaultPrevented)return;for(const a of e)a.hide();const i=this._getDimension();this._element.classList.remove(qh),this._element.classList.add(zv),this._element.style[i]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const r=()=>{this._isTransitioning=!1,this._element.classList.remove(zv),this._element.classList.add(qh,wT),this._element.style[i]="",Fe.trigger(this._element,Ode)},o=`scroll${i[0].toUpperCase()+i.slice(1)}`;this._queueCallback(r,this._element,!0),this._element.style[i]=`${this._element[o]}px`}hide(){if(this._isTransitioning||!this._isShown()||Fe.trigger(this._element,kde).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,xg(this._element),this._element.classList.add(zv),this._element.classList.remove(qh,wT);for(const r of this._triggerArray){const s=dt.getElementFromSelector(r);s&&!this._isShown(s)&&this._addAriaAndCollapsedClass([r],!1)}this._isTransitioning=!0;const i=()=>{this._isTransitioning=!1,this._element.classList.remove(zv),this._element.classList.add(qh),Fe.trigger(this._element,Mde)};this._element.style[t]="",this._queueCallback(i,this._element,!0)}_isShown(e=this._element){return e.classList.contains(wT)}_configAfterMerge(e){return e.toggle=!!e.toggle,e.parent=Ml(e.parent),e}_getDimension(){return this._element.classList.contains(Ude)?zde:Gde}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(fb);for(const t of e){const i=dt.getElementFromSelector(t);i&&this._addAriaAndCollapsedClass([t],this._isShown(i))}}_getFirstLevelChildren(e){const t=dt.find(Bde,this._config.parent);return dt.find(e,this._config.parent).filter(i=>!t.includes(i))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const i of e)i.classList.toggle(Fde,!t),i.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={};return typeof e=="string"&&/show|hide/.test(e)&&(t.toggle=!1),this.each(function(){const i=eg.getOrCreateInstance(this,t);if(typeof e=="string"){if(typeof i[e]>"u")throw new TypeError(`No method named "${e}"`);i[e]()}})}}Fe.on(document,Nde,fb,function(n){(n.target.tagName==="A"||n.delegateTarget&&n.delegateTarget.tagName==="A")&&n.preventDefault();for(const e of dt.getMultipleElementsFromSelector(this))eg.getOrCreateInstance(e,{toggle:!1}).toggle()});ls(eg);const DD="dropdown",jde="bs.dropdown",vu=`.${jde}`,uC=".data-api",Wde="Escape",OD="Tab",qde="ArrowUp",kD="ArrowDown",Kde=2,Zde=`hide${vu}`,Yde=`hidden${vu}`,Xde=`show${vu}`,Jde=`shown${vu}`,u5=`click${vu}${uC}`,h5=`keydown${vu}${uC}`,Qde=`keyup${vu}${uC}`,zh="show",efe="dropup",tfe="dropend",ife="dropstart",nfe="dropup-center",rfe="dropdown-center",Hc='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',sfe=`${Hc}.${zh}`,hy=".dropdown-menu",ofe=".navbar",afe=".navbar-nav",lfe=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",cfe=os()?"top-end":"top-start",ufe=os()?"top-start":"top-end",hfe=os()?"bottom-end":"bottom-start",dfe=os()?"bottom-start":"bottom-end",ffe=os()?"left-start":"right-start",pfe=os()?"right-start":"left-start",gfe="top",mfe="bottom",vfe={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},yfe={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class fo extends Ns{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=dt.next(this._element,hy)[0]||dt.prev(this._element,hy)[0]||dt.findOne(hy,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return vfe}static get DefaultType(){return yfe}static get NAME(){return DD}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Nl(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!Fe.trigger(this._element,Xde,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(afe))for(const i of[].concat(...document.body.children))Fe.on(i,"mouseover",h0);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(zh),this._element.classList.add(zh),Fe.trigger(this._element,Jde,e)}}hide(){if(Nl(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!Fe.trigger(this._element,Zde,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const i of[].concat(...document.body.children))Fe.off(i,"mouseover",h0);this._popper&&this._popper.destroy(),this._menu.classList.remove(zh),this._element.classList.remove(zh),this._element.setAttribute("aria-expanded","false"),ua.removeDataAttribute(this._menu,"popper"),Fe.trigger(this._element,Yde,e)}}_getConfig(e){if(e=super._getConfig(e),typeof e.reference=="object"&&!ca(e.reference)&&typeof e.reference.getBoundingClientRect!="function")throw new TypeError(`${DD.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(typeof q3>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;this._config.reference==="parent"?e=this._parent:ca(this._config.reference)?e=Ml(this._config.reference):typeof this._config.reference=="object"&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=aC(e,this._menu,t)}_isShown(){return this._menu.classList.contains(zh)}_getPlacement(){const e=this._parent;if(e.classList.contains(tfe))return ffe;if(e.classList.contains(ife))return pfe;if(e.classList.contains(nfe))return gfe;if(e.classList.contains(rfe))return mfe;const t=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return e.classList.contains(efe)?t?ufe:cfe:t?dfe:hfe}_detectNavbar(){return this._element.closest(ofe)!==null}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(t=>Number.parseInt(t,10)):typeof e=="function"?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ua.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...gr(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:t}){const i=dt.find(lfe,this._menu).filter(r=>Qd(r));i.length&&lC(i,t,e===kD,!i.includes(t)).focus()}static jQueryInterface(e){return this.each(function(){const t=fo.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}static clearMenus(e){if(e.button===Kde||e.type==="keyup"&&e.key!==OD)return;const t=dt.find(sfe);for(const i of t){const r=fo.getInstance(i);if(!r||r._config.autoClose===!1)continue;const s=e.composedPath(),o=s.includes(r._menu);if(s.includes(r._element)||r._config.autoClose==="inside"&&!o||r._config.autoClose==="outside"&&o||r._menu.contains(e.target)&&(e.type==="keyup"&&e.key===OD||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const a={relatedTarget:r._element};e.type==="click"&&(a.clickEvent=e),r._completeHide(a)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),i=e.key===Wde,r=[qde,kD].includes(e.key);if(!r&&!i||t&&!i)return;e.preventDefault();const s=this.matches(Hc)?this:dt.prev(this,Hc)[0]||dt.next(this,Hc)[0]||dt.findOne(Hc,e.delegateTarget.parentNode),o=fo.getOrCreateInstance(s);if(r){e.stopPropagation(),o.show(),o._selectMenuItem(e);return}o._isShown()&&(e.stopPropagation(),o.hide(),s.focus())}}Fe.on(document,h5,Hc,fo.dataApiKeydownHandler);Fe.on(document,h5,hy,fo.dataApiKeydownHandler);Fe.on(document,u5,fo.clearMenus);Fe.on(document,Qde,fo.clearMenus);Fe.on(document,u5,Hc,function(n){n.preventDefault(),fo.getOrCreateInstance(this).toggle()});ls(fo);const d5="backdrop",_fe="fade",MD="show",ND=`mousedown.bs.${d5}`,Efe={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},wfe={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class f5 extends Cg{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return Efe}static get DefaultType(){return wfe}static get NAME(){return d5}show(e){if(!this._config.isVisible){gr(e);return}this._append();const t=this._getElement();this._config.isAnimated&&xg(t),t.classList.add(MD),this._emulateAnimation(()=>{gr(e)})}hide(e){if(!this._config.isVisible){gr(e);return}this._getElement().classList.remove(MD),this._emulateAnimation(()=>{this.dispose(),gr(e)})}dispose(){this._isAppended&&(Fe.off(this._element,ND),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add(_fe),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=Ml(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),Fe.on(e,ND,()=>{gr(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){J3(e,this._getElement(),this._config.isAnimated)}}const Tfe="focustrap",Sfe="bs.focustrap",f0=`.${Sfe}`,bfe=`focusin${f0}`,xfe=`keydown.tab${f0}`,Cfe="Tab",Rfe="forward",FD="backward",Afe={autofocus:!0,trapElement:null},Lfe={autofocus:"boolean",trapElement:"element"};class p5 extends Cg{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Afe}static get DefaultType(){return Lfe}static get NAME(){return Tfe}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Fe.off(document,f0),Fe.on(document,bfe,e=>this._handleFocusin(e)),Fe.on(document,xfe,e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Fe.off(document,f0))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const i=dt.focusableChildren(t);i.length===0?t.focus():this._lastTabNavDirection===FD?i[i.length-1].focus():i[0].focus()}_handleKeydown(e){e.key===Cfe&&(this._lastTabNavDirection=e.shiftKey?FD:Rfe)}}const BD=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",UD=".sticky-top",Gv="padding-right",zD="margin-right";class pb{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Gv,t=>t+e),this._setElementAttributes(BD,Gv,t=>t+e),this._setElementAttributes(UD,zD,t=>t-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Gv),this._resetElementAttributes(BD,Gv),this._resetElementAttributes(UD,zD)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,i){const r=this.getWidth(),s=o=>{if(o!==this._element&&window.innerWidth>o.clientWidth+r)return;this._saveInitialAttribute(o,t);const a=window.getComputedStyle(o).getPropertyValue(t);o.style.setProperty(t,`${i(Number.parseFloat(a))}px`)};this._applyManipulationCallback(e,s)}_saveInitialAttribute(e,t){const i=e.style.getPropertyValue(t);i&&ua.setDataAttribute(e,t,i)}_resetElementAttributes(e,t){const i=r=>{const s=ua.getDataAttribute(r,t);if(s===null){r.style.removeProperty(t);return}ua.removeDataAttribute(r,t),r.style.setProperty(t,s)};this._applyManipulationCallback(e,i)}_applyManipulationCallback(e,t){if(ca(e)){t(e);return}for(const i of dt.find(e,this._element))t(i)}}const Ife="modal",Pfe="bs.modal",as=`.${Pfe}`,Dfe=".data-api",Ofe="Escape",kfe=`hide${as}`,Mfe=`hidePrevented${as}`,g5=`hidden${as}`,m5=`show${as}`,Nfe=`shown${as}`,Ffe=`resize${as}`,Bfe=`click.dismiss${as}`,Ufe=`mousedown.dismiss${as}`,zfe=`keydown.dismiss${as}`,Gfe=`click${as}${Dfe}`,GD="modal-open",Hfe="fade",HD="show",TT="modal-static",$fe=".modal.show",Vfe=".modal-dialog",jfe=".modal-body",Wfe='[data-bs-toggle="modal"]',qfe={backdrop:!0,focus:!0,keyboard:!0},Kfe={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Dd extends Ns{constructor(e,t){super(e,t),this._dialog=dt.findOne(Vfe,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new pb,this._addEventListeners()}static get Default(){return qfe}static get DefaultType(){return Kfe}static get NAME(){return Ife}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||Fe.trigger(this._element,m5,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(GD),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){!this._isShown||this._isTransitioning||Fe.trigger(this._element,kfe).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(HD),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Fe.off(window,as),Fe.off(this._dialog,as),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new f5({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new p5({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=dt.findOne(jfe,this._dialog);t&&(t.scrollTop=0),xg(this._element),this._element.classList.add(HD);const i=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Fe.trigger(this._element,Nfe,{relatedTarget:e})};this._queueCallback(i,this._dialog,this._isAnimated())}_addEventListeners(){Fe.on(this._element,zfe,e=>{if(e.key===Ofe){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Fe.on(window,Ffe,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Fe.on(this._element,Ufe,e=>{Fe.one(this._element,Bfe,t=>{if(!(this._element!==e.target||this._element!==t.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(GD),this._resetAdjustments(),this._scrollBar.reset(),Fe.trigger(this._element,g5)})}_isAnimated(){return this._element.classList.contains(Hfe)}_triggerBackdropTransition(){if(Fe.trigger(this._element,Mfe).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,i=this._element.style.overflowY;i==="hidden"||this._element.classList.contains(TT)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(TT),this._queueCallback(()=>{this._element.classList.remove(TT),this._queueCallback(()=>{this._element.style.overflowY=i},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),i=t>0;if(i&&!e){const r=os()?"paddingLeft":"paddingRight";this._element.style[r]=`${t}px`}if(!i&&e){const r=os()?"paddingRight":"paddingLeft";this._element.style[r]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each(function(){const i=Dd.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]>"u")throw new TypeError(`No method named "${e}"`);i[e](t)}})}}Fe.on(document,Gfe,Wfe,function(n){const e=dt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&n.preventDefault(),Fe.one(e,m5,r=>{r.defaultPrevented||Fe.one(e,g5,()=>{Qd(this)&&this.focus()})});const t=dt.findOne($fe);t&&Dd.getInstance(t).hide(),Dd.getOrCreateInstance(e).toggle(this)});w_(Dd);ls(Dd);const Zfe="offcanvas",Yfe="bs.offcanvas",Sa=`.${Yfe}`,v5=".data-api",Xfe=`load${Sa}${v5}`,Jfe="Escape",$D="show",VD="showing",jD="hiding",Qfe="offcanvas-backdrop",y5=".offcanvas.show",epe=`show${Sa}`,tpe=`shown${Sa}`,ipe=`hide${Sa}`,WD=`hidePrevented${Sa}`,_5=`hidden${Sa}`,npe=`resize${Sa}`,rpe=`click${Sa}${v5}`,spe=`keydown.dismiss${Sa}`,ope='[data-bs-toggle="offcanvas"]',ape={backdrop:!0,keyboard:!0,scroll:!1},lpe={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Fl extends Ns{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ape}static get DefaultType(){return lpe}static get NAME(){return Zfe}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||Fe.trigger(this._element,epe,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new pb().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(VD);const i=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add($D),this._element.classList.remove(VD),Fe.trigger(this._element,tpe,{relatedTarget:e})};this._queueCallback(i,this._element,!0)}hide(){if(!this._isShown||Fe.trigger(this._element,ipe).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(jD),this._backdrop.hide();const t=()=>{this._element.classList.remove($D,jD),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new pb().reset(),Fe.trigger(this._element,_5)};this._queueCallback(t,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=()=>{if(this._config.backdrop==="static"){Fe.trigger(this._element,WD);return}this.hide()},t=!!this._config.backdrop;return new f5({className:Qfe,isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?e:null})}_initializeFocusTrap(){return new p5({trapElement:this._element})}_addEventListeners(){Fe.on(this._element,spe,e=>{if(e.key===Jfe){if(this._config.keyboard){this.hide();return}Fe.trigger(this._element,WD)}})}static jQueryInterface(e){return this.each(function(){const t=Fl.getOrCreateInstance(this,e);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}Fe.on(document,rpe,ope,function(n){const e=dt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),Nl(this))return;Fe.one(e,_5,()=>{Qd(this)&&this.focus()});const t=dt.findOne(y5);t&&t!==e&&Fl.getInstance(t).hide(),Fl.getOrCreateInstance(e).toggle(this)});Fe.on(window,Xfe,()=>{for(const n of dt.find(y5))Fl.getOrCreateInstance(n).show()});Fe.on(window,npe,()=>{for(const n of dt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(n).position!=="fixed"&&Fl.getOrCreateInstance(n).hide()});w_(Fl);ls(Fl);const cpe=/^aria-[\w-]*$/i,E5={"*":["class","dir","id","lang","role",cpe],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},upe=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),hpe=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,dpe=(n,e)=>{const t=n.nodeName.toLowerCase();return e.includes(t)?upe.has(t)?!!hpe.test(n.nodeValue):!0:e.filter(i=>i instanceof RegExp).some(i=>i.test(t))};function fpe(n,e,t){if(!n.length)return n;if(t&&typeof t=="function")return t(n);const r=new window.DOMParser().parseFromString(n,"text/html"),s=[].concat(...r.body.querySelectorAll("*"));for(const o of s){const a=o.nodeName.toLowerCase();if(!Object.keys(e).includes(a)){o.remove();continue}const l=[].concat(...o.attributes),c=[].concat(e["*"]||[],e[a]||[]);for(const u of l)dpe(u,c)||o.removeAttribute(u.nodeName)}return r.body.innerHTML}const ppe="TemplateFactory",gpe={allowList:E5,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},mpe={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},vpe={entry:"(string|element|function|null)",selector:"(string|element)"};class ype extends Cg{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return gpe}static get DefaultType(){return mpe}static get NAME(){return ppe}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[r,s]of Object.entries(this._config.content))this._setContent(e,s,r);const t=e.children[0],i=this._resolvePossibleFunction(this._config.extraClass);return i&&t.classList.add(...i.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,i]of Object.entries(e))super._typeCheckConfig({selector:t,entry:i},vpe)}_setContent(e,t,i){const r=dt.findOne(i,e);if(r){if(t=this._resolvePossibleFunction(t),!t){r.remove();return}if(ca(t)){this._putElementInTemplate(Ml(t),r);return}if(this._config.html){r.innerHTML=this._maybeSanitize(t);return}r.textContent=t}}_maybeSanitize(e){return this._config.sanitize?fpe(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return gr(e,[this])}_putElementInTemplate(e,t){if(this._config.html){t.innerHTML="",t.append(e);return}t.textContent=e.textContent}}const _pe="tooltip",Epe=new Set(["sanitize","allowList","sanitizeFn"]),ST="fade",wpe="modal",Hv="show",Tpe=".tooltip-inner",qD=`.${wpe}`,KD="hide.bs.modal",tp="hover",bT="focus",Spe="click",bpe="manual",xpe="hide",Cpe="hidden",Rpe="show",Ape="shown",Lpe="inserted",Ipe="click",Ppe="focusin",Dpe="focusout",Ope="mouseenter",kpe="mouseleave",Mpe={AUTO:"auto",TOP:"top",RIGHT:os()?"left":"right",BOTTOM:"bottom",LEFT:os()?"right":"left"},Npe={allowList:E5,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Fpe={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class yu extends Ns{constructor(e,t){if(typeof q3>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Npe}static get DefaultType(){return Fpe}static get NAME(){return _pe}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Fe.off(this._element.closest(qD),KD,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const e=Fe.trigger(this._element,this.constructor.eventName(Rpe)),i=(Y3(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!i)return;this._disposePopper();const r=this._getTipElement();this._element.setAttribute("aria-describedby",r.getAttribute("id"));const{container:s}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(s.append(r),Fe.trigger(this._element,this.constructor.eventName(Lpe))),this._popper=this._createPopper(r),r.classList.add(Hv),"ontouchstart"in document.documentElement)for(const a of[].concat(...document.body.children))Fe.on(a,"mouseover",h0);const o=()=>{Fe.trigger(this._element,this.constructor.eventName(Ape)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(o,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Fe.trigger(this._element,this.constructor.eventName(xpe)).defaultPrevented)return;if(this._getTipElement().classList.remove(Hv),"ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))Fe.off(r,"mouseover",h0);this._activeTrigger[Spe]=!1,this._activeTrigger[bT]=!1,this._activeTrigger[tp]=!1,this._isHovered=null;const i=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Fe.trigger(this._element,this.constructor.eventName(Cpe)))};this._queueCallback(i,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(ST,Hv),t.classList.add(`bs-${this.constructor.NAME}-auto`);const i=She(this.constructor.NAME).toString();return t.setAttribute("id",i),this._isAnimated()&&t.classList.add(ST),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new ype({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Tpe]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(ST)}_isShown(){return this.tip&&this.tip.classList.contains(Hv)}_createPopper(e){const t=gr(this._config.placement,[this,e,this._element]),i=Mpe[t.toUpperCase()];return aC(this._element,e,this._getPopperConfig(i))}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(t=>Number.parseInt(t,10)):typeof e=="function"?t=>e(t,this._element):e}_resolvePossibleFunction(e){return gr(e,[this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:i=>{this._getTipElement().setAttribute("data-popper-placement",i.state.placement)}}]};return{...t,...gr(this._config.popperConfig,[t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if(t==="click")Fe.on(this._element,this.constructor.eventName(Ipe),this._config.selector,i=>{this._initializeOnDelegatedTarget(i).toggle()});else if(t!==bpe){const i=t===tp?this.constructor.eventName(Ope):this.constructor.eventName(Ppe),r=t===tp?this.constructor.eventName(kpe):this.constructor.eventName(Dpe);Fe.on(this._element,i,this._config.selector,s=>{const o=this._initializeOnDelegatedTarget(s);o._activeTrigger[s.type==="focusin"?bT:tp]=!0,o._enter()}),Fe.on(this._element,r,this._config.selector,s=>{const o=this._initializeOnDelegatedTarget(s);o._activeTrigger[s.type==="focusout"?bT:tp]=o._element.contains(s.relatedTarget),o._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Fe.on(this._element.closest(qD),KD,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=ua.getDataAttributes(this._element);for(const i of Object.keys(t))Epe.has(i)&&delete t[i];return e={...t,...typeof e=="object"&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=e.container===!1?document.body:Ml(e.container),typeof e.delay=="number"&&(e.delay={show:e.delay,hide:e.delay}),typeof e.title=="number"&&(e.title=e.title.toString()),typeof e.content=="number"&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,i]of Object.entries(this._config))this.constructor.Default[t]!==i&&(e[t]=i);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const t=yu.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}}ls(yu);const Bpe="popover",Upe=".popover-header",zpe=".popover-body",Gpe={...yu.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Hpe={...yu.DefaultType,content:"(null|string|element|function)"};class b_ extends yu{static get Default(){return Gpe}static get DefaultType(){return Hpe}static get NAME(){return Bpe}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Upe]:this._getTitle(),[zpe]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const t=b_.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e]()}})}}ls(b_);const $pe="scrollspy",Vpe="bs.scrollspy",hC=`.${Vpe}`,jpe=".data-api",Wpe=`activate${hC}`,ZD=`click${hC}`,qpe=`load${hC}${jpe}`,Kpe="dropdown-item",Ph="active",Zpe='[data-bs-spy="scroll"]',xT="[href]",Ype=".nav, .list-group",YD=".nav-link",Xpe=".nav-item",Jpe=".list-group-item",Qpe=`${YD}, ${Xpe} > ${YD}, ${Jpe}`,ege=".dropdown",tge=".dropdown-toggle",ige={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},nge={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class x_ extends Ns{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return ige}static get DefaultType(){return nge}static get NAME(){return $pe}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=Ml(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,typeof e.threshold=="string"&&(e.threshold=e.threshold.split(",").map(t=>Number.parseFloat(t))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Fe.off(this._config.target,ZD),Fe.on(this._config.target,ZD,xT,e=>{const t=this._observableSections.get(e.target.hash);if(t){e.preventDefault();const i=this._rootElement||window,r=t.offsetTop-this._element.offsetTop;if(i.scrollTo){i.scrollTo({top:r,behavior:"smooth"});return}i.scrollTop=r}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(t=>this._observerCallback(t),e)}_observerCallback(e){const t=o=>this._targetLinks.get(`#${o.target.id}`),i=o=>{this._previousScrollData.visibleEntryTop=o.target.offsetTop,this._process(t(o))},r=(this._rootElement||document.documentElement).scrollTop,s=r>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=r;for(const o of e){if(!o.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(o));continue}const a=o.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(s&&a){if(i(o),!r)return;continue}!s&&!a&&i(o)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=dt.find(xT,this._config.target);for(const t of e){if(!t.hash||Nl(t))continue;const i=dt.findOne(decodeURI(t.hash),this._element);Qd(i)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,i))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(Ph),this._activateParents(e),Fe.trigger(this._element,Wpe,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains(Kpe)){dt.findOne(tge,e.closest(ege)).classList.add(Ph);return}for(const t of dt.parents(e,Ype))for(const i of dt.prev(t,Qpe))i.classList.add(Ph)}_clearActiveClass(e){e.classList.remove(Ph);const t=dt.find(`${xT}.${Ph}`,e);for(const i of t)i.classList.remove(Ph)}static jQueryInterface(e){return this.each(function(){const t=x_.getOrCreateInstance(this,e);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}Fe.on(window,qpe,()=>{for(const n of dt.find(Zpe))x_.getOrCreateInstance(n)});ls(x_);const rge="tab",sge="bs.tab",_u=`.${sge}`,oge=`hide${_u}`,age=`hidden${_u}`,lge=`show${_u}`,cge=`shown${_u}`,uge=`click${_u}`,hge=`keydown${_u}`,dge=`load${_u}`,fge="ArrowLeft",XD="ArrowRight",pge="ArrowUp",JD="ArrowDown",CT="Home",QD="End",$c="active",eO="fade",RT="show",gge="dropdown",w5=".dropdown-toggle",mge=".dropdown-menu",AT=`:not(${w5})`,vge='.list-group, .nav, [role="tablist"]',yge=".nav-item, .list-group-item",_ge=`.nav-link${AT}, .list-group-item${AT}, [role="tab"]${AT}`,T5='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',LT=`${_ge}, ${T5}`,Ege=`.${$c}[data-bs-toggle="tab"], .${$c}[data-bs-toggle="pill"], .${$c}[data-bs-toggle="list"]`;class Od extends Ns{constructor(e){super(e),this._parent=this._element.closest(vge),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Fe.on(this._element,hge,t=>this._keydown(t)))}static get NAME(){return rge}show(){const e=this._element;if(this._elemIsActive(e))return;const t=this._getActiveElem(),i=t?Fe.trigger(t,oge,{relatedTarget:e}):null;Fe.trigger(e,lge,{relatedTarget:t}).defaultPrevented||i&&i.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){if(!e)return;e.classList.add($c),this._activate(dt.getElementFromSelector(e));const i=()=>{if(e.getAttribute("role")!=="tab"){e.classList.add(RT);return}e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),Fe.trigger(e,cge,{relatedTarget:t})};this._queueCallback(i,e,e.classList.contains(eO))}_deactivate(e,t){if(!e)return;e.classList.remove($c),e.blur(),this._deactivate(dt.getElementFromSelector(e));const i=()=>{if(e.getAttribute("role")!=="tab"){e.classList.remove(RT);return}e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),Fe.trigger(e,age,{relatedTarget:t})};this._queueCallback(i,e,e.classList.contains(eO))}_keydown(e){if(![fge,XD,pge,JD,CT,QD].includes(e.key))return;e.stopPropagation(),e.preventDefault();const t=this._getChildren().filter(r=>!Nl(r));let i;if([CT,QD].includes(e.key))i=t[e.key===CT?0:t.length-1];else{const r=[XD,JD].includes(e.key);i=lC(t,e.target,r,!0)}i&&(i.focus({preventScroll:!0}),Od.getOrCreateInstance(i).show())}_getChildren(){return dt.find(LT,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist");for(const i of t)this._setInitialAttributesOnChild(i)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const t=this._elemIsActive(e),i=this._getOuterElement(e);e.setAttribute("aria-selected",t),i!==e&&this._setAttributeIfNotExists(i,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=dt.getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const i=this._getOuterElement(e);if(!i.classList.contains(gge))return;const r=(s,o)=>{const a=dt.findOne(s,i);a&&a.classList.toggle(o,t)};r(w5,$c),r(mge,RT),i.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,i){e.hasAttribute(t)||e.setAttribute(t,i)}_elemIsActive(e){return e.classList.contains($c)}_getInnerElement(e){return e.matches(LT)?e:dt.findOne(LT,e)}_getOuterElement(e){return e.closest(yge)||e}static jQueryInterface(e){return this.each(function(){const t=Od.getOrCreateInstance(this);if(typeof e=="string"){if(t[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);t[e]()}})}}Fe.on(document,uge,T5,function(n){["A","AREA"].includes(this.tagName)&&n.preventDefault(),!Nl(this)&&Od.getOrCreateInstance(this).show()});Fe.on(window,dge,()=>{for(const n of dt.find(Ege))Od.getOrCreateInstance(n)});ls(Od);const wge="toast",Tge="bs.toast",Zl=`.${Tge}`,Sge=`mouseover${Zl}`,bge=`mouseout${Zl}`,xge=`focusin${Zl}`,Cge=`focusout${Zl}`,Rge=`hide${Zl}`,Age=`hidden${Zl}`,Lge=`show${Zl}`,Ige=`shown${Zl}`,Pge="fade",tO="hide",$v="show",Vv="showing",Dge={animation:"boolean",autohide:"boolean",delay:"number"},Oge={animation:!0,autohide:!0,delay:5e3};class C_ extends Ns{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Oge}static get DefaultType(){return Dge}static get NAME(){return wge}show(){if(Fe.trigger(this._element,Lge).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(Pge);const t=()=>{this._element.classList.remove(Vv),Fe.trigger(this._element,Ige),this._maybeScheduleHide()};this._element.classList.remove(tO),xg(this._element),this._element.classList.add($v,Vv),this._queueCallback(t,this._element,this._config.animation)}hide(){if(!this.isShown()||Fe.trigger(this._element,Rge).defaultPrevented)return;const t=()=>{this._element.classList.add(tO),this._element.classList.remove(Vv,$v),Fe.trigger(this._element,Age)};this._element.classList.add(Vv),this._queueCallback(t,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove($v),super.dispose()}isShown(){return this._element.classList.contains($v)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=t;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=t;break}}if(t){this._clearTimeout();return}const i=e.relatedTarget;this._element===i||this._element.contains(i)||this._maybeScheduleHide()}_setListeners(){Fe.on(this._element,Sge,e=>this._onInteraction(e,!0)),Fe.on(this._element,bge,e=>this._onInteraction(e,!1)),Fe.on(this._element,xge,e=>this._onInteraction(e,!0)),Fe.on(this._element,Cge,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const t=C_.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof t[e]>"u")throw new TypeError(`No method named "${e}"`);t[e](this)}})}}w_(C_);ls(C_);function kge(){document.querySelectorAll('[data-bs-toggle="popover"]').forEach(e=>{new b_(e,{trigger:"hover"})})}const Mge=(n,e)=>{n.style.opacity=0,n.style.display="block";let t=null;function i(r){t||(t=r);const s=r-t;n.style.opacity=Math.min(s/e,1),s<e&&window.requestAnimationFrame(i)}window.requestAnimationFrame(i)};function Nge(){document.querySelectorAll('[data-relations="true"]').forEach(n=>{const t=`${n.dataset.url}/relations`;fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(i=>{if(!i.ok)throw new Error("Network response was not ok");return i.text()}).then(i=>{const r=document.createElement("div");r.innerHTML=i,n.appendChild(r),r.style.display="none",Mge(r,200)}).catch(i=>console.error("Error:",i))})}function Fge(){document.body.addEventListener("mouseenter",n=>{if(n.target.closest(".blacklight-icons.svg_tooltip svg")){const e=n.target.closest(".blacklight-icons.svg_tooltip svg"),t=e.querySelector("title"),i=t?t.textContent:"";i!==void 0&&i!==""&&(new yu(e,{placement:"bottom",title:i}).show(),e.setAttribute("data-original-title",i),t.remove())}},!0),document.body.addEventListener("mouseleave",n=>{if(n.target.closest(".blacklight-icons.svg_tooltip svg")){const e=n.target.closest(".blacklight-icons.svg_tooltip svg"),t=e.getAttribute("data-original-title");if(t!==void 0&&t!==""){const i=document.createElement("title");i.textContent=t,e.prepend(i),e.setAttribute("data-original-title","")}}document.querySelectorAll(".tooltip").forEach(e=>e.remove())},!0)}class Bge{constructor(e,{lines:t,id:i}){var r;const s=t*parseFloat(window.getComputedStyle(e).fontSize);e.getBoundingClientRect().height<s||(this.element=e,(r=this.element).id||(r.id=i),this.button=document.createElement("button"),this.button.classList.add("btn","btn-link","p-0","border-0"),this.button.dataset.bsToggle="collapse",this.button.dataset.bsTarget=`#${this.element.id}`,this.button.setAttribute("aria-expanded","false"),this.button.setAttribute("aria-controls",this.element.id),this.button.textContent="Read more",this.button.addEventListener("click",this.toggle.bind(this)),e.parentNode.insertBefore(this.button,e.nextSibling),this.element.classList.add("collapse"))}toggle(){this.button.textContent=="Read more"?this.button.textContent="Close":this.button.textContent="Read more"}}function Uge(){document.querySelectorAll(".truncate-abstract").forEach((n,e)=>{new Bge(n,{lines:12,id:`truncate-${e}`})})}class zge{constructor(e,t,i={}){this.options=i,this.el=typeof e=="string"?document.querySelector(e):e,this.download=document.querySelector(this.options.target||this.el.getAttribute("data-ref-download")),t===0&&this.setRefUrl(),this.configureHandler()}configureHandler(){this.el.addEventListener("click",()=>this.setRefUrl())}setRefUrl(){const e=this.el.getAttribute("data-ref-endpoint");e?(this.download.style.display="",this.download.setAttribute("href",e)):this.download.style.display="none"}}function Gge(){const n=document.getElementById("blacklight-modal");n.addEventListener("focus",e=>{Array.from(e.target.classList).includes("show")&&(e.target.querySelectorAll(".metadata-body").forEach(t=>{t.closest(".modal-content").classList.add("metadata-modal")}),e.target.querySelectorAll(".pill-metadata").forEach((t,i)=>{new zge(t,i)}))}),n.addEventListener("blur",e=>{Array.from(e.target.classList).includes("show")||e.target.querySelectorAll(".metadata-body").forEach(t=>{t.closest(".modal-content").classList.remove("metadata-modal")})})}const ya=function(){const n=[];return{onLoad:function(e){n.push(e)},activate:function(e){n.forEach(t=>{t(e)})},listeners:function(){return typeof Turbo<"u"?["turbo:load","turbo:frame-load"]:["DOMContentLoaded"]}}}();ya.listeners().forEach(n=>document.addEventListener(n,e=>ya.activate(e)));ya.onLoad(kge);ya.onLoad(Nge);ya.onLoad(Fge);ya.onLoad(Uge);ya.onLoad(Gge);typeof Stimulus<"u"?(Stimulus.register("openlayers-viewer",Tx),Stimulus.register("clover-viewer",N1),Stimulus.register("oembed-viewer",F1),Stimulus.register("leaflet-viewer",q1),Stimulus.register("search-results",v_),Stimulus.register("downloads",T3),Stimulus.register("clipboard",K1)):console.error("Couldn't find Stimulus. Check installation instructions at https://github.com/hotwired/stimulus-rails.");const Hge={OpenlayersViewerController:Tx,CloverViewerController:N1,OembedViewerController:F1,LeafletViewerController:q1,SearchResultsController:v_,DownloadsController:T3,ClipboardController:K1,openLayersBasemaps:RM,leafletBasemaps:ob,Core:ya,onLoad:ya.onLoad},Bme=Object.freeze(Object.defineProperty({__proto__:null,default:Hge},Symbol.toStringTag,{value:"Module"}));export{ime as L,nme as a,Bme as b,hu as g};
